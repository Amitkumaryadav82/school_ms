import{p as f,_ as c,a as p}from"./index-6e7e2aa6.js";import"./mui-vendor-a24771cc.js";import"./react-vendor-a7454736.js";import"./chart-vendor-adb38d29.js";const h=async()=>{try{const s=localStorage.getItem("token");if(!s)return console.error("No token found in local storage"),{valid:!1,message:"No authentication token found, needs to login or refresh",needsRefresh:!0};try{const e=f(s);if(!e)return console.error("Invalid token format"),{valid:!1,message:"Invalid token format",needsRefresh:!0};const r=e.exp*1e3,n=Date.now(),d=n>r,i=(r-n)/(1e3*60);if(d){const o=(n-r)/(1e3*60*60);if(o<48){console.warn(`Token expired ${o.toFixed(2)} hours ago, attempting to refresh automatically`);try{const{refreshToken:a}=await c(()=>import("./index-6e7e2aa6.js").then(m=>m.t),["assets/index-6e7e2aa6.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js","assets/index-c1abdb85.css"]);return await a(),console.log("âœ… Automatic token refresh successful during validation"),{valid:!0,message:"Token automatically refreshed",expiresAt:new Date(Date.now()+60*60*1e3).toISOString(),username:e.sub||e.username,autoRefreshed:!0}}catch(a){return console.warn("Automatic token refresh failed, will let caller handle it:",a),{valid:!1,message:"Token has expired but might be refreshable",expiresAt:new Date(r).toISOString(),username:e.sub||e.username,needsRefresh:!0}}}else return console.error("Token is expired beyond refresh window"),{valid:!1,message:"Token has expired and is too old to refresh",expiresAt:new Date(r).toISOString(),username:e.sub||e.username}}if(i<10){console.warn(`Token will expire soon (${i.toFixed(2)} minutes), starting proactive refresh`);try{const{refreshToken:t}=await c(()=>import("./index-6e7e2aa6.js").then(o=>o.t),["assets/index-6e7e2aa6.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js","assets/index-c1abdb85.css"]);t().catch(o=>console.warn("Proactive token refresh failed:",o)),console.log("Proactive token refresh initiated in background")}catch(t){console.warn("Failed to start proactive token refresh:",t)}}const l=Array.isArray(e.roles)?e.roles:e.authorities||(e.role?[e.role]:[]),u=l.some(t=>t.toUpperCase()==="ADMIN");return console.log("Token validation result:",{valid:!0,isAdmin:u,username:e.sub||e.username,expiresAt:new Date(r).toLocaleString(),timeLeft:`${Math.round((r-n)/1e3/60)} minutes`}),{valid:!0,username:e.sub||e.username,roles:l,expiresAt:new Date(r).toISOString()}}catch(e){console.error("Error parsing JWT token:",e)}return{valid:!0,...await p.get("/auth/validate-token")||{}}}catch(s){return console.error("Token validation error:",s),{valid:!1,message:s.message||"Token validation failed"}}},A={validateAdminToken:h};export{A as default,h as validateAdminToken};
//# sourceMappingURL=tokenValidationService-5120d7ae.js.map
