{"version":3,"mappings":"6JAUO,MAAMA,EAAgB,IAAc,CACnC,MAAAC,EAAQ,aAAa,QAAQ,OAAO,EACnC,OAAAA,EAAQ,UAAUA,CAAK,GAAK,EACrC,EAMaC,EAAoB,IAAM,CAC/B,MAAAC,EAAaC,EAAM,OAAO,CAC9B,QAASC,EAAO,OAChB,QAASA,EAAO,WAChB,gBAAiB,GACjB,QAAS,CACP,eAAgB,mBAChB,gBAAiB,sCACjB,OAAU,WACV,QAAW,GACb,EACD,EAGD,OAAAF,EAAW,aAAa,QAAQ,IAAIE,IAElC,QAAQ,IAAI,mBAAmBA,EAAO,GAAG,GAAI,CAC3C,OAAQA,EAAO,OACf,QAASA,EAAO,QAChB,UAAW,IAAI,KAAK,EAAE,YAAY,EACnC,EAEMA,EACR,EAEDF,EAAW,aAAa,SAAS,IACnBG,KACHC,GAAA,iBACP,eAAQ,MAAM,sBAAuB,CACnC,QAAQC,EAAAD,EAAM,WAAN,YAAAC,EAAgB,OACxB,YAAYC,EAAAF,EAAM,WAAN,YAAAE,EAAgB,WAC5B,MAAMC,EAAAH,EAAM,WAAN,YAAAG,EAAgB,KACtB,KAAKC,EAAAJ,EAAM,SAAN,YAAAI,EAAc,IACnB,QAAQC,EAAAL,EAAM,SAAN,YAAAK,EAAc,OACtB,SAASC,EAAAN,EAAM,SAAN,YAAAM,EAAc,QACxB,EAEM,QAAQ,OAAON,CAAK,CAC7B,GAGKJ,CACT,EAMaW,EAAY,MAAUC,EAAkBC,IAA0B,SAC7E,MAAMb,EAAaD,IAEf,IAEF,IAAIe,EAAsB,KACtB,IACoBA,EAAA,MAAAC,EAAA,IAAM,OAAO,qBAA4B,OAAAC,KAAA,iKAGzD,MAAAC,EAAS,MAAMH,EAAoB,0BACzC,GAAI,CAACG,EAAO,aAAeA,EAAO,WAAY,CAC5C,QAAQ,IAAI,wCAAwCf,EAAO,MAAM,OAAOe,EAAO,UAAU,EAAE,EAC3Ff,EAAO,OAASe,EAAO,WAGvB,MAAMC,EAAgBnB,IACXC,EAAA,SAAS,QAAUiB,EAAO,UACvC,QACOE,EAAG,CACF,cAAM,wCAAyCA,CAAC,CAC1D,CAGA,IAAIC,EAAMR,EACN,OAACQ,EAAI,WAAW,GAAG,GAAK,CAACA,EAAI,WAAW,MAAM,EAChDA,EAAM,QAAQR,CAAQ,GACbQ,EAAI,WAAW,GAAG,GAAK,CAACA,EAAI,WAAW,OAAO,IACvDA,EAAM,OAAOA,CAAG,IAGlB,QAAQ,IAAI,uCAAuClB,EAAO,MAAM,GAAGkB,CAAG,EAAE,GAGvD,MAAMpB,EAAW,KAAQoB,EAAKP,CAAI,GACnC,WACTT,EAAO,CAId,GAHQ,cAAM,qBAAsBA,CAAK,EAGpCA,aAAiB,SAASC,EAAAD,EAAM,UAAN,MAAAC,EAAe,SAAS,mBAClDD,aAAiB,SAASE,EAAAF,EAAM,UAAN,MAAAE,EAAe,SAAS,iBAAkB,CACvE,QAAQ,MAAM,0DAA0D,EAGpE,IACF,MAAMe,EAAc,IAAI,IAAInB,EAAO,MAAM,EAAE,KACrCoB,EAAiB,CAAC,OAAQ,OAAQ,OAAQ,MAAM,EAAE,OAAYC,OAAMF,CAAW,EACrF,QAAQ,IAAI,4CAA4CC,EAAe,KAAK,IAAI,CAAC,EAAE,OACzE,CAEZ,CACF,CACM,MAAAlB,CACR,CACF,EAEAoB,EAAe,CAAE,UAAAb,EAAW,kBAAAZ,CAAkB","names":["getAuthHeader","token","createAuthRequest","authClient","axios","config","response","error","_a","_b","_c","_d","_e","_f","authFetch","endpoint","data","connectivityChecker","__vitePreload","n","status","newAuthClient","e","url","currentPort","alternatePorts","p","authHelper"],"sources":["../../src/services/authHelper.ts"],"sourcesContent":["/**\r\n * Helper functions for CORS and authentication related tasks\r\n */\r\nimport axios from 'axios';\r\nimport config from '../config/environment';\r\n\r\n/**\r\n * Gets the authentication header with the current token\r\n * Returns an empty string instead of null for easier composition\r\n */\r\nexport const getAuthHeader = (): string => {\r\n  const token = localStorage.getItem('token');\r\n  return token ? `Bearer ${token}` : '';\r\n};\r\n\r\n/**\r\n * Creates a fetch function specifically for authentication requests\r\n * This adds all the necessary headers to avoid CORS preflight issues\r\n */\r\nexport const createAuthRequest = () => {\r\n  const authClient = axios.create({\r\n    baseURL: config.apiUrl,\r\n    timeout: config.apiTimeout,\r\n    withCredentials: true,\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n      'Cache-Control': 'no-cache, no-store, must-revalidate',\r\n      'Pragma': 'no-cache',\r\n      'Expires': '0'\r\n    }\r\n  });\r\n  \r\n  // Add request/response interceptors similar to the main API client\r\n  authClient.interceptors.request.use(config => {\r\n    // Log auth requests for debugging\r\n    console.log(`Auth request to ${config.url}`, {\r\n      method: config.method,\r\n      headers: config.headers,\r\n      timestamp: new Date().toISOString()\r\n    });\r\n    \r\n    return config;\r\n  });\r\n  \r\n  authClient.interceptors.response.use(\r\n    response => response,\r\n    error => {\r\n      console.error('Auth Request Error:', {\r\n        status: error.response?.status,\r\n        statusText: error.response?.statusText,\r\n        data: error.response?.data,\r\n        url: error.config?.url,\r\n        method: error.config?.method,\r\n        headers: error.config?.headers\r\n      });\r\n      \r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n  \r\n  return authClient;\r\n};\r\n\r\n/**\r\n * Direct fetch method for authentication endpoints that bypasses normal API\r\n * Use this for login/register when experiencing CORS issues\r\n */\r\nexport const authFetch = async <T>(endpoint: string, data: any): Promise<T> => {\r\n  const authClient = createAuthRequest();\r\n  \r\n  try {\r\n    // Import the connectivity checker dynamically\r\n    let connectivityChecker = null;\r\n    try {\r\n      connectivityChecker = await import('../utils/connectivityCheck');\r\n      \r\n      // Try to detect working backend URL if needed\r\n      const status = await connectivityChecker.testBackendConnectivity();\r\n      if (!status.isConnected && status.workingUrl) {\r\n        console.log(`ðŸ”„ AuthHelper: Updating API URL from ${config.apiUrl} to ${status.workingUrl}`);\r\n        config.apiUrl = status.workingUrl;\r\n        \r\n        // Recreate auth client with new URL\r\n        const newAuthClient = createAuthRequest();\r\n        authClient.defaults.baseURL = status.workingUrl;\r\n      }\r\n    } catch (e) {\r\n      console.error('Failed to import connectivity checker', e);\r\n    }\r\n    \r\n    // Ensure endpoint has proper format\r\n    let url = endpoint;\r\n    if (!url.startsWith('/') && !url.startsWith('http')) {\r\n      url = `/api/${endpoint}`;\r\n    } else if (url.startsWith('/') && !url.startsWith('/api/')) {\r\n      url = `/api${url}`;\r\n    }\r\n    \r\n    console.log(`ðŸ“¡ AuthFetch: Attempting request to ${config.apiUrl}${url}`);\r\n    \r\n    // Make the request with all necessary headers\r\n    const response = await authClient.post<T>(url, data);\r\n    return response.data;\r\n  } catch (error) {\r\n    console.error('Auth fetch failed:', error);\r\n    \r\n    // Enhanced error handling\r\n    if ((error instanceof Error && error.message?.includes('Network Error')) || \r\n        (error instanceof Error && error.message?.includes('ECONNREFUSED'))) {\r\n      console.error('ðŸ”Œ Network connection error. Backend may be unavailable.');\r\n      \r\n      // Try to suggest port changes if needed\r\n      try {\r\n        const currentPort = new URL(config.apiUrl).port;\r\n        const alternatePorts = ['8080', '8081', '8082', '5000'].filter(p => p !== currentPort);\r\n        console.log(`ðŸ’¡ Try using one of these ports instead: ${alternatePorts.join(', ')}`);\r\n      } catch (e) {\r\n        // URL parsing failed, just continue\r\n      }\r\n    }\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport default { authFetch, createAuthRequest };\r\n"],"file":"assets/authHelper-a534404a.js"}