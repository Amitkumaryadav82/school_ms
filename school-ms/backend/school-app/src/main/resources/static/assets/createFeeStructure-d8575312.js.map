{"version":3,"file":"createFeeStructure-d8575312.js","sources":["../../src/utils/createFeeStructure.ts"],"sourcesContent":["import feeService, { FeeStructure, PaymentSchedule } from '../services/feeService';\r\n\r\n/**\r\n * Process and validate a fee structure to ensure all required fields are set correctly\r\n */\r\nexport const processFeeStructureData = (feeStructure: FeeStructure): FeeStructure => {\r\n  // Calculate total fees explicitly to ensure it's set correctly\r\n  const totalFees = Number(feeStructure.annualFees || 0) + \r\n                    Number(feeStructure.buildingFees || 0) + \r\n                    Number(feeStructure.labFees || 0);\r\n  \r\n  // Make sure payment schedules have correct amounts based on annual fees\r\n  const updatedSchedules = feeStructure.paymentSchedules.map(schedule => {\r\n    let amount = 0;\r\n    switch (schedule.scheduleType) {\r\n      case 'MONTHLY':\r\n        amount = Number((feeStructure.annualFees / 12).toFixed(2));\r\n        break;\r\n      case 'QUARTERLY':\r\n        amount = Number((feeStructure.annualFees / 4).toFixed(2));\r\n        break;\r\n      case 'YEARLY':\r\n        amount = Number(feeStructure.annualFees);\r\n        break;\r\n      default:\r\n        amount = schedule.amount; // Keep existing amount if scheduleType is unknown\r\n    }\r\n    return { ...schedule, amount };\r\n  });\r\n  \r\n  // Return complete fee structure\r\n  return {\r\n    ...feeStructure,\r\n    totalFees: totalFees,\r\n    paymentSchedules: updatedSchedules\r\n  };\r\n};\r\n\r\n/**\r\n * Validate fee structure before submission\r\n */\r\nexport const validateFeeStructure = (feeStructure: FeeStructure): { \r\n  isValid: boolean; \r\n  errors: Record<string, string> \r\n} => {\r\n  const errors: Record<string, string> = {};\r\n\r\n  if (!feeStructure.classGrade) {\r\n    errors.classGrade = 'Class/Grade is required';\r\n  }\r\n\r\n  if (feeStructure.annualFees < 0) {\r\n    errors.annualFees = 'Annual fees cannot be negative';\r\n  }\r\n\r\n  if (feeStructure.buildingFees < 0) {\r\n    errors.buildingFees = 'Building fees cannot be negative';\r\n  }\r\n\r\n  if (feeStructure.labFees < 0) {\r\n    errors.labFees = 'Lab fees cannot be negative';\r\n  }\r\n\r\n  // Validate at least one payment schedule is enabled\r\n  if (!feeStructure.paymentSchedules.some(schedule => schedule.isEnabled)) {\r\n    errors.paymentSchedules = 'At least one payment schedule must be enabled';\r\n  }\r\n\r\n  return {\r\n    isValid: Object.keys(errors).length === 0,\r\n    errors\r\n  };\r\n};\r\n\r\n/**\r\n * Creates a default fee structure for the specified grade\r\n * This utility function creates a basic fee structure with default payment schedules\r\n * which can be used to fix the \"Fee not found\" error when processing payments\r\n */\r\nexport const createDefaultFeeStructure = async (grade: number): Promise<FeeStructure> => {\r\n  // Create a basic fee structure with default values\r\n  const annualFees = 25000; // Default annual fee amount\r\n  const buildingFees = 5000; // Default building fee amount\r\n  const labFees = 3000; // Default lab fee amount\r\n  \r\n  const newFeeStructure: FeeStructure = {\r\n    classGrade: grade,\r\n    annualFees: annualFees,\r\n    buildingFees: buildingFees,\r\n    labFees: labFees,\r\n    totalFees: annualFees + buildingFees + labFees,\r\n    // Default payment schedules\r\n    paymentSchedules: [\r\n      { scheduleType: 'MONTHLY', amount: Number((annualFees / 12).toFixed(2)), isEnabled: true },\r\n      { scheduleType: 'QUARTERLY', amount: Number((annualFees / 4).toFixed(2)), isEnabled: true },\r\n      { scheduleType: 'YEARLY', amount: annualFees, isEnabled: true }\r\n    ],\r\n    // No late fees by default\r\n    lateFees: []\r\n  };\r\n\r\n  try {\r\n    // Submit to the API\r\n    const createdFeeStructure = await feeService.createFeeStructure(newFeeStructure);\r\n    console.log('Fee structure created successfully:', createdFeeStructure);\r\n    return createdFeeStructure;\r\n  } catch (error) {\r\n    console.error('Error creating fee structure:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\n/**\r\n * Creates a fee structure with the provided data\r\n */\r\nexport const createFeeStructure = async (feeStructure: FeeStructure): Promise<FeeStructure> => {\r\n  try {\r\n    // Process and validate the fee structure data\r\n    const { isValid, errors } = validateFeeStructure(feeStructure);\r\n    \r\n    if (!isValid) {\r\n      const errorMessage = Object.entries(errors)\r\n        .map(([field, message]) => `${field}: ${message}`)\r\n        .join('; ');\r\n      throw new Error(`Invalid fee structure: ${errorMessage}`);\r\n    }\r\n    \r\n    // Ensure all fields are properly set\r\n    const processedFeeStructure = processFeeStructureData(feeStructure);\r\n    \r\n    // Submit to the API\r\n    const createdFeeStructure = await feeService.createFeeStructure(processedFeeStructure);\r\n    console.log('Fee structure created successfully:', createdFeeStructure);\r\n    return createdFeeStructure;\r\n  } catch (error) {\r\n    console.error('Error creating fee structure:', error);\r\n    throw error;\r\n  }\r\n};\r\n"],"names":["processFeeStructureData","feeStructure","totalFees","updatedSchedules","schedule","amount","validateFeeStructure","errors","createDefaultFeeStructure","grade","newFeeStructure","createdFeeStructure","feeService","error","createFeeStructure","isValid","errorMessage","field","message","processedFeeStructure"],"mappings":"+IAKa,MAAAA,EAA2BC,GAA6C,CAEnF,MAAMC,EAAY,OAAOD,EAAa,YAAc,CAAC,EACnC,OAAOA,EAAa,cAAgB,CAAC,EACrC,OAAOA,EAAa,SAAW,CAAC,EAG5CE,EAAmBF,EAAa,iBAAiB,IAAgBG,GAAA,CACrE,IAAIC,EAAS,EACb,OAAQD,EAAS,aAAc,CAC7B,IAAK,UACHC,EAAS,QAAQJ,EAAa,WAAa,IAAI,QAAQ,CAAC,CAAC,EACzD,MACF,IAAK,YACHI,EAAS,QAAQJ,EAAa,WAAa,GAAG,QAAQ,CAAC,CAAC,EACxD,MACF,IAAK,SACMI,EAAA,OAAOJ,EAAa,UAAU,EACvC,MACF,QACEI,EAASD,EAAS,MACtB,CACO,MAAA,CAAE,GAAGA,EAAU,OAAAC,EAAO,CAC9B,EAGM,MAAA,CACL,GAAGJ,EACH,UAAAC,EACA,iBAAkBC,CAAA,CAEtB,EAKaG,EAAwBL,GAGhC,CACH,MAAMM,EAAiC,CAAA,EAEnC,OAACN,EAAa,aAChBM,EAAO,WAAa,2BAGlBN,EAAa,WAAa,IAC5BM,EAAO,WAAa,kCAGlBN,EAAa,aAAe,IAC9BM,EAAO,aAAe,oCAGpBN,EAAa,QAAU,IACzBM,EAAO,QAAU,+BAIdN,EAAa,iBAAiB,KAAiBG,GAAAA,EAAS,SAAS,IACpEG,EAAO,iBAAmB,iDAGrB,CACL,QAAS,OAAO,KAAKA,CAAM,EAAE,SAAW,EACxC,OAAAA,CAAA,CAEJ,EAOaC,EAA4B,MAAOC,GAAyC,CAMvF,MAAMC,EAAgC,CACpC,WAAYD,EACZ,gBACA,iBACA,YACA,UAAW,KAEX,iBAAkB,CAChB,CAAE,aAAc,UAAW,OAAQ,OAAQ,mBAAiB,QAAQ,CAAC,CAAC,EAAG,UAAW,EAAK,EACzF,CAAE,aAAc,YAAa,OAAQ,OAAQ,MAAgB,QAAQ,CAAC,CAAC,EAAG,UAAW,EAAK,EAC1F,CAAE,aAAc,SAAU,OAAQ,KAAY,UAAW,EAAK,CAChE,EAEA,SAAU,CAAC,CAAA,EAGT,GAAA,CAEF,MAAME,EAAsB,MAAMC,EAAW,mBAAmBF,CAAe,EACvE,eAAA,IAAI,sCAAuCC,CAAmB,EAC/DA,QACAE,EAAO,CACN,cAAA,MAAM,gCAAiCA,CAAK,EAC9CA,CACR,CACF,EAKaC,EAAqB,MAAOb,GAAsD,CACzF,GAAA,CAEF,KAAM,CAAE,QAAAc,EAAS,OAAAR,CAAO,EAAID,EAAqBL,CAAY,EAE7D,GAAI,CAACc,EAAS,CACZ,MAAMC,EAAe,OAAO,QAAQT,CAAM,EACvC,IAAI,CAAC,CAACU,EAAOC,CAAO,IAAM,GAAGD,CAAK,KAAKC,CAAO,EAAE,EAChD,KAAK,IAAI,EACZ,MAAM,IAAI,MAAM,0BAA0BF,CAAY,EAAE,CAC1D,CAGM,MAAAG,EAAwBnB,EAAwBC,CAAY,EAG5DU,EAAsB,MAAMC,EAAW,mBAAmBO,CAAqB,EAC7E,eAAA,IAAI,sCAAuCR,CAAmB,EAC/DA,QACAE,EAAO,CACN,cAAA,MAAM,gCAAiCA,CAAK,EAC9CA,CACR,CACF"}