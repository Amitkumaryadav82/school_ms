import{a as s,b as i,c}from"./index-aebd346b.js";import{reportPaymentError as l}from"./errorReporting-2d2ad2d5.js";import{submitPaymentWithCorsHandling as d}from"./corsHelper-66efeb43.js";import"./mui-vendor-a24771cc.js";import"./react-vendor-a7454736.js";import"./chart-vendor-adb38d29.js";const u=async e=>{console.log("ðŸ” DEBUG: Submitting payment directly",e);try{const t={feeId:e.feeId||e.studentFeeId||null,studentId:e.studentId,amount:e.amount,paymentMethod:e.paymentMethod,transactionReference:e.transactionReference||e.reference||"",remarks:e.remarks||e.notes||"",payerName:e.payerName||"Parent/Guardian",payerContactInfo:e.payerContactInfo||"",payerRelationToStudent:"PARENT",receiptNumber:e.receiptNumber||`RCPT-${Date.now()}`};console.log("Submitting minimal payment data:",t);const o=await Promise.allSettled([s.post("/api/fees/payments",t),i.post(`${c.apiUrl}/api/fees/payments`,t,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},withCredentials:!0})]);console.log("Debug payment submission results:",o);const r=o.find(n=>n.status==="fulfilled");if(r&&r.status==="fulfilled")return r.value;throw o[0].status==="rejected"?o[0].reason:o[1].reason}catch(t){throw console.error("Error in debug payment submission:",t),t}},m=async e=>{try{if(console.log("Processing payment with enhanced handler:",e),!e.feeId)throw new Error("No fee ID provided. Please ensure a fee structure exists for this student and is correctly assigned.");const t=Number(e.feeId);if(isNaN(t)||t<=0)throw new Error(`Invalid fee ID: ${e.feeId}. Please ensure a valid fee structure is assigned to this student.`);const o={feeId:t,studentId:Number(e.studentId),amount:Number(e.amount),paymentMethod:e.paymentMethod==="BANK_TRANSFER"?"BANK_TRANSFER":e.paymentMethod==="CREDIT_CARD"?"CREDIT_CARD":e.paymentMethod==="UPI"?"ONLINE":"CASH",transactionReference:e.transactionReference||e.reference||"",remarks:e.remarks||e.notes||"",payerName:e.payerName||"Parent/Guardian",payerContactInfo:e.payerContactInfo||"",payerRelationToStudent:e.payerRelationToStudent||"PARENT",receiptNumber:e.receiptNumber||`RCPT-${new Date().getTime().toString().slice(-8)}`};try{try{console.log("Attempting payment with CORS handler...");const r=await d(o);return console.log("Payment successful with CORS handler"),r}catch(r){console.warn("CORS handler payment failed, trying standard API",r);try{console.log("Attempting payment with standard API...");const n=await s.post("/api/fees/payments",o);return console.log("Payment successful with standard API"),n}catch(n){console.error("Standard API payment failed, trying debug method",n),console.log("Attempting payment with debug method...");const a=await u(o);return console.log("Payment successful with debug method"),a}}}catch(r){const n=l(r,o);throw console.error("All payment methods failed. Detailed diagnostics:",n),r}}catch(t){throw console.error("Error in payment processing:",t),t}},f=async e=>{var t;try{const r=await s.get(`/api/fees/payments/receipt/${e}/verify`);return!!((t=r==null?void 0:r.data)!=null&&t.verified)}catch(o){return console.error("Error verifying receipt:",o),!1}},R={processPayment:m,verifyPaymentReceipt:f};export{R as default,m as processPayment,f as verifyPaymentReceipt};
//# sourceMappingURL=paymentHandler-6ff93e22.js.map
