var Yb=Object.defineProperty;var zb=(e,r,t)=>r in e?Yb(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t;var Qe=(e,r,t)=>(zb(e,typeof r!="symbol"?r+"":r,t),t);import{j as a,S as Fa,A as pt,T as xt,I as st,B as Fx,W as Gb,a as Mx,M as Bc,b as Te,d as ee,e as V,D as Qt,R as On,f as tf,O as qb,g as Ad,L as Gn,h as Gr,i as In,k as Fr,C as Xb,l as Kb,m as Jb,n as at,o as Px,p as Qb,q as Zb,r as k0,s as eS,t as tS,u as zo,E as Td,v as Go,w as rS,F as nS,x as aS,y as Lt,z as Ke,G as Se,H as qo,J as Jt,K as Vt,N as Wt,Q as Ge,U as Q,V as Nx,X as Ht,Y as vr,Z as rf,_ as At,$ as Dt,a0 as Tt,a1 as Mn,a2 as ye,a3 as Ui,a4 as Ct,a5 as Rx,a6 as X,a7 as za,a8 as rt,a9 as ot,aa as tt,ab as tr,ac as Xa,ad as Ma,ae as Zs,af as A0,ag as jt,ah as aa,ai as kt,aj as Cd,ak as Ut,al as nf,P as Oe,c as $r,am as ht,an as gr,ao as je,ap as Cs,aq as nt,ar as Qa,as as sS,at as Vi,au as Ox,av as ul,aw as Lx,ax as Nn,ay as $x,az as af,aA as Uc,aB as iS,aC as sf,aD as oS,aE as lS,aF as cS,aG as T0,aH as Vc,aI as dS,aJ as mu,aK as uS,aL as pu,aM as fS,aN as Za,aO as ws,aP as Wi,aQ as xu,aR as Hi,aS as dc,aT as hS,aU as Wc,aV as C0,aW as mS,aX as pS,aY as xS,aZ as js,a_ as Yi,a$ as Bx,b0 as gS,b1 as Rs,b2 as yS,b3 as ds,b4 as us,b5 as fs,b6 as Wn,b7 as zi,b8 as of,b9 as ko,ba as vS,bb as bS,bc as lf,bd as cf,be as df,bf as Ux,bg as gu,bh as tc,bi as Vx,bj as uc,bk as SS,bl as _l,bm as Il,bn as Fl,bo as D0,bp as wS,bq as jS,br as Wx,bs as Hx,bt as ES,bu as kS,bv as Dd}from"./mui-vendor-a24771cc.js";import{d as AS,r as b,u as es,N as _d,a as TS,b as it,e as Ds,g as ts,L as na,R as CS,f as DS,B as _S,h as IS,i as Nr}from"./react-vendor-a7454736.js";import{R as Io,B as uf,C as fc,X as hc,Y as mc,T as Fo,a as Mo,L as yu,P as FS,b as MS,c as PS,d as NS,e as _0}from"./chart-vendor-adb38d29.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();var vu={},I0=AS;vu.createRoot=I0.createRoot,vu.hydrateRoot=I0.hydrateRoot;const RS="modulepreload",OS=function(e){return"/"+e},F0={},qr=function(r,t,n){if(!t||t.length===0)return r();const s=document.getElementsByTagName("link");return Promise.all(t.map(i=>{if(i=OS(i),i in F0)return;F0[i]=!0;const o=i.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!n)for(let u=s.length-1;u>=0;u--){const f=s[u];if(f.href===i&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${l}`))return;const d=document.createElement("link");if(d.rel=o?"stylesheet":RS,o||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),o)return new Promise((u,f)=>{d.addEventListener("load",u),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>r()).catch(i=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=i,window.dispatchEvent(o),!o.defaultPrevented)throw i})},LS={BASE_URL:"/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}.VITE_API_URL,$S={apiUrl:LS??window.location.origin,fallbackApiUrl:"",swaggerUrl:"/swagger-ui/index.html",apiTimeout:15e3,retryAttempts:3,corsConfig:{enabled:!1,supportedOrigins:[window.location.origin]}};let ff;ff=$S;setTimeout(()=>{qr(()=>Promise.resolve().then(()=>yg),void 0).then(({applyStoredApiUrl:e})=>{e(),console.log(`Current API URL configuration: ${ff.apiUrl}`)}).catch(e=>console.error("Failed to import connectivity checker",e))},0);const Et=ff;function Yx(e,r){return function(){return e.apply(r,arguments)}}const{toString:BS}=Object.prototype,{getPrototypeOf:hf}=Object,{iterator:Hc,toStringTag:zx}=Symbol,Yc=(e=>r=>{const t=BS.call(r);return e[t]||(e[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ba=e=>(e=e.toLowerCase(),r=>Yc(r)===e),zc=e=>r=>typeof r===e,{isArray:Zi}=Array,Xo=zc("undefined");function US(e){return e!==null&&!Xo(e)&&e.constructor!==null&&!Xo(e.constructor)&&Rn(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Gx=ba("ArrayBuffer");function VS(e){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(e):r=e&&e.buffer&&Gx(e.buffer),r}const WS=zc("string"),Rn=zc("function"),qx=zc("number"),Gc=e=>e!==null&&typeof e=="object",HS=e=>e===!0||e===!1,rc=e=>{if(Yc(e)!=="object")return!1;const r=hf(e);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(zx in e)&&!(Hc in e)},YS=ba("Date"),zS=ba("File"),GS=ba("Blob"),qS=ba("FileList"),XS=e=>Gc(e)&&Rn(e.pipe),KS=e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||Rn(e.append)&&((r=Yc(e))==="formdata"||r==="object"&&Rn(e.toString)&&e.toString()==="[object FormData]"))},JS=ba("URLSearchParams"),[QS,ZS,ew,tw]=["ReadableStream","Request","Response","Headers"].map(ba),rw=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fl(e,r,{allOwnKeys:t=!1}={}){if(e===null||typeof e>"u")return;let n,s;if(typeof e!="object"&&(e=[e]),Zi(e))for(n=0,s=e.length;n<s;n++)r.call(null,e[n],n,e);else{const i=t?Object.getOwnPropertyNames(e):Object.keys(e),o=i.length;let l;for(n=0;n<o;n++)l=i[n],r.call(null,e[l],l,e)}}function Xx(e,r){r=r.toLowerCase();const t=Object.keys(e);let n=t.length,s;for(;n-- >0;)if(s=t[n],r===s.toLowerCase())return s;return null}const Gs=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),Kx=e=>!Xo(e)&&e!==Gs;function bu(){const{caseless:e}=Kx(this)&&this||{},r={},t=(n,s)=>{const i=e&&Xx(r,s)||s;rc(r[i])&&rc(n)?r[i]=bu(r[i],n):rc(n)?r[i]=bu({},n):Zi(n)?r[i]=n.slice():r[i]=n};for(let n=0,s=arguments.length;n<s;n++)arguments[n]&&fl(arguments[n],t);return r}const nw=(e,r,t,{allOwnKeys:n}={})=>(fl(r,(s,i)=>{t&&Rn(s)?e[i]=Yx(s,t):e[i]=s},{allOwnKeys:n}),e),aw=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),sw=(e,r,t,n)=>{e.prototype=Object.create(r.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),t&&Object.assign(e.prototype,t)},iw=(e,r,t,n)=>{let s,i,o;const l={};if(r=r||{},e==null)return r;do{for(s=Object.getOwnPropertyNames(e),i=s.length;i-- >0;)o=s[i],(!n||n(o,e,r))&&!l[o]&&(r[o]=e[o],l[o]=!0);e=t!==!1&&hf(e)}while(e&&(!t||t(e,r))&&e!==Object.prototype);return r},ow=(e,r,t)=>{e=String(e),(t===void 0||t>e.length)&&(t=e.length),t-=r.length;const n=e.indexOf(r,t);return n!==-1&&n===t},lw=e=>{if(!e)return null;if(Zi(e))return e;let r=e.length;if(!qx(r))return null;const t=new Array(r);for(;r-- >0;)t[r]=e[r];return t},cw=(e=>r=>e&&r instanceof e)(typeof Uint8Array<"u"&&hf(Uint8Array)),dw=(e,r)=>{const n=(e&&e[Hc]).call(e);let s;for(;(s=n.next())&&!s.done;){const i=s.value;r.call(e,i[0],i[1])}},uw=(e,r)=>{let t;const n=[];for(;(t=e.exec(r))!==null;)n.push(t);return n},fw=ba("HTMLFormElement"),hw=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,s){return n.toUpperCase()+s}),M0=(({hasOwnProperty:e})=>(r,t)=>e.call(r,t))(Object.prototype),mw=ba("RegExp"),Jx=(e,r)=>{const t=Object.getOwnPropertyDescriptors(e),n={};fl(t,(s,i)=>{let o;(o=r(s,i,e))!==!1&&(n[i]=o||s)}),Object.defineProperties(e,n)},pw=e=>{Jx(e,(r,t)=>{if(Rn(e)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=e[t];if(Rn(n)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},xw=(e,r)=>{const t={},n=s=>{s.forEach(i=>{t[i]=!0})};return Zi(e)?n(e):n(String(e).split(r)),t},gw=()=>{},yw=(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r;function vw(e){return!!(e&&Rn(e.append)&&e[zx]==="FormData"&&e[Hc])}const bw=e=>{const r=new Array(10),t=(n,s)=>{if(Gc(n)){if(r.indexOf(n)>=0)return;if(!("toJSON"in n)){r[s]=n;const i=Zi(n)?[]:{};return fl(n,(o,l)=>{const c=t(o,s+1);!Xo(c)&&(i[l]=c)}),r[s]=void 0,i}}return n};return t(e,0)},Sw=ba("AsyncFunction"),ww=e=>e&&(Gc(e)||Rn(e))&&Rn(e.then)&&Rn(e.catch),Qx=((e,r)=>e?setImmediate:r?((t,n)=>(Gs.addEventListener("message",({source:s,data:i})=>{s===Gs&&i===t&&n.length&&n.shift()()},!1),s=>{n.push(s),Gs.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Rn(Gs.postMessage)),jw=typeof queueMicrotask<"u"?queueMicrotask.bind(Gs):typeof process<"u"&&process.nextTick||Qx,Ew=e=>e!=null&&Rn(e[Hc]),Re={isArray:Zi,isArrayBuffer:Gx,isBuffer:US,isFormData:KS,isArrayBufferView:VS,isString:WS,isNumber:qx,isBoolean:HS,isObject:Gc,isPlainObject:rc,isReadableStream:QS,isRequest:ZS,isResponse:ew,isHeaders:tw,isUndefined:Xo,isDate:YS,isFile:zS,isBlob:GS,isRegExp:mw,isFunction:Rn,isStream:XS,isURLSearchParams:JS,isTypedArray:cw,isFileList:qS,forEach:fl,merge:bu,extend:nw,trim:rw,stripBOM:aw,inherits:sw,toFlatObject:iw,kindOf:Yc,kindOfTest:ba,endsWith:ow,toArray:lw,forEachEntry:dw,matchAll:uw,isHTMLForm:fw,hasOwnProperty:M0,hasOwnProp:M0,reduceDescriptors:Jx,freezeMethods:pw,toObjectSet:xw,toCamelCase:hw,noop:gw,toFiniteNumber:yw,findKey:Xx,global:Gs,isContextDefined:Kx,isSpecCompliantForm:vw,toJSONObject:bw,isAsyncFn:Sw,isThenable:ww,setImmediate:Qx,asap:jw,isIterable:Ew};function St(e,r,t,n,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),t&&(this.config=t),n&&(this.request=n),s&&(this.response=s,this.status=s.status?s.status:null)}Re.inherits(St,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Re.toJSONObject(this.config),code:this.code,status:this.status}}});const Zx=St.prototype,eg={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{eg[e]={value:e}});Object.defineProperties(St,eg);Object.defineProperty(Zx,"isAxiosError",{value:!0});St.from=(e,r,t,n,s,i)=>{const o=Object.create(Zx);return Re.toFlatObject(e,o,function(c){return c!==Error.prototype},l=>l!=="isAxiosError"),St.call(o,e.message,r,t,n,s),o.cause=e,o.name=e.name,i&&Object.assign(o,i),o};const kw=null;function Su(e){return Re.isPlainObject(e)||Re.isArray(e)}function tg(e){return Re.endsWith(e,"[]")?e.slice(0,-2):e}function P0(e,r,t){return e?e.concat(r).map(function(s,i){return s=tg(s),!t&&i?"["+s+"]":s}).join(t?".":""):r}function Aw(e){return Re.isArray(e)&&!e.some(Su)}const Tw=Re.toFlatObject(Re,{},null,function(r){return/^is[A-Z]/.test(r)});function qc(e,r,t){if(!Re.isObject(e))throw new TypeError("target must be an object");r=r||new FormData,t=Re.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(g,p){return!Re.isUndefined(p[g])});const n=t.metaTokens,s=t.visitor||u,i=t.dots,o=t.indexes,c=(t.Blob||typeof Blob<"u"&&Blob)&&Re.isSpecCompliantForm(r);if(!Re.isFunction(s))throw new TypeError("visitor must be a function");function d(m){if(m===null)return"";if(Re.isDate(m))return m.toISOString();if(!c&&Re.isBlob(m))throw new St("Blob is not supported. Use a Buffer instead.");return Re.isArrayBuffer(m)||Re.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function u(m,g,p){let y=m;if(m&&!p&&typeof m=="object"){if(Re.endsWith(g,"{}"))g=n?g:g.slice(0,-2),m=JSON.stringify(m);else if(Re.isArray(m)&&Aw(m)||(Re.isFileList(m)||Re.endsWith(g,"[]"))&&(y=Re.toArray(m)))return g=tg(g),y.forEach(function(v,E){!(Re.isUndefined(v)||v===null)&&r.append(o===!0?P0([g],E,i):o===null?g:g+"[]",d(v))}),!1}return Su(m)?!0:(r.append(P0(p,g,i),d(m)),!1)}const f=[],h=Object.assign(Tw,{defaultVisitor:u,convertValue:d,isVisitable:Su});function x(m,g){if(!Re.isUndefined(m)){if(f.indexOf(m)!==-1)throw Error("Circular reference detected in "+g.join("."));f.push(m),Re.forEach(m,function(y,S){(!(Re.isUndefined(y)||y===null)&&s.call(r,y,Re.isString(S)?S.trim():S,g,h))===!0&&x(y,g?g.concat(S):[S])}),f.pop()}}if(!Re.isObject(e))throw new TypeError("data must be an object");return x(e),r}function N0(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(n){return r[n]})}function mf(e,r){this._pairs=[],e&&qc(e,this,r)}const rg=mf.prototype;rg.append=function(r,t){this._pairs.push([r,t])};rg.toString=function(r){const t=r?function(n){return r.call(this,n,N0)}:N0;return this._pairs.map(function(s){return t(s[0])+"="+t(s[1])},"").join("&")};function Cw(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ng(e,r,t){if(!r)return e;const n=t&&t.encode||Cw;Re.isFunction(t)&&(t={serialize:t});const s=t&&t.serialize;let i;if(s?i=s(r,t):i=Re.isURLSearchParams(r)?r.toString():new mf(r,t).toString(n),i){const o=e.indexOf("#");o!==-1&&(e=e.slice(0,o)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e}class Dw{constructor(){this.handlers=[]}use(r,t,n){return this.handlers.push({fulfilled:r,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){Re.forEach(this.handlers,function(n){n!==null&&r(n)})}}const R0=Dw,ag={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_w=typeof URLSearchParams<"u"?URLSearchParams:mf,Iw=typeof FormData<"u"?FormData:null,Fw=typeof Blob<"u"?Blob:null,Mw={isBrowser:!0,classes:{URLSearchParams:_w,FormData:Iw,Blob:Fw},protocols:["http","https","file","blob","url","data"]},pf=typeof window<"u"&&typeof document<"u",wu=typeof navigator=="object"&&navigator||void 0,Pw=pf&&(!wu||["ReactNative","NativeScript","NS"].indexOf(wu.product)<0),Nw=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),Rw=pf&&window.location.href||"http://localhost",Ow=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:pf,hasStandardBrowserEnv:Pw,hasStandardBrowserWebWorkerEnv:Nw,navigator:wu,origin:Rw},Symbol.toStringTag,{value:"Module"})),cn={...Ow,...Mw};function Lw(e,r){return qc(e,new cn.classes.URLSearchParams,Object.assign({visitor:function(t,n,s,i){return cn.isNode&&Re.isBuffer(t)?(this.append(n,t.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},r))}function $w(e){return Re.matchAll(/\w+|\[(\w*)]/g,e).map(r=>r[0]==="[]"?"":r[1]||r[0])}function Bw(e){const r={},t=Object.keys(e);let n;const s=t.length;let i;for(n=0;n<s;n++)i=t[n],r[i]=e[i];return r}function sg(e){function r(t,n,s,i){let o=t[i++];if(o==="__proto__")return!0;const l=Number.isFinite(+o),c=i>=t.length;return o=!o&&Re.isArray(s)?s.length:o,c?(Re.hasOwnProp(s,o)?s[o]=[s[o],n]:s[o]=n,!l):((!s[o]||!Re.isObject(s[o]))&&(s[o]=[]),r(t,n,s[o],i)&&Re.isArray(s[o])&&(s[o]=Bw(s[o])),!l)}if(Re.isFormData(e)&&Re.isFunction(e.entries)){const t={};return Re.forEachEntry(e,(n,s)=>{r($w(n),s,t,0)}),t}return null}function Uw(e,r,t){if(Re.isString(e))try{return(r||JSON.parse)(e),Re.trim(e)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(e)}const xf={transitional:ag,adapter:["xhr","http","fetch"],transformRequest:[function(r,t){const n=t.getContentType()||"",s=n.indexOf("application/json")>-1,i=Re.isObject(r);if(i&&Re.isHTMLForm(r)&&(r=new FormData(r)),Re.isFormData(r))return s?JSON.stringify(sg(r)):r;if(Re.isArrayBuffer(r)||Re.isBuffer(r)||Re.isStream(r)||Re.isFile(r)||Re.isBlob(r)||Re.isReadableStream(r))return r;if(Re.isArrayBufferView(r))return r.buffer;if(Re.isURLSearchParams(r))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let l;if(i){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Lw(r,this.formSerializer).toString();if((l=Re.isFileList(r))||n.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return qc(l?{"files[]":r}:r,c&&new c,this.formSerializer)}}return i||s?(t.setContentType("application/json",!1),Uw(r)):r}],transformResponse:[function(r){const t=this.transitional||xf.transitional,n=t&&t.forcedJSONParsing,s=this.responseType==="json";if(Re.isResponse(r)||Re.isReadableStream(r))return r;if(r&&Re.isString(r)&&(n&&!this.responseType||s)){const o=!(t&&t.silentJSONParsing)&&s;try{return JSON.parse(r)}catch(l){if(o)throw l.name==="SyntaxError"?St.from(l,St.ERR_BAD_RESPONSE,this,null,this.response):l}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:cn.classes.FormData,Blob:cn.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Re.forEach(["delete","get","head","post","put","patch"],e=>{xf.headers[e]={}});const gf=xf,Vw=Re.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ww=e=>{const r={};let t,n,s;return e&&e.split(`
`).forEach(function(o){s=o.indexOf(":"),t=o.substring(0,s).trim().toLowerCase(),n=o.substring(s+1).trim(),!(!t||r[t]&&Vw[t])&&(t==="set-cookie"?r[t]?r[t].push(n):r[t]=[n]:r[t]=r[t]?r[t]+", "+n:n)}),r},O0=Symbol("internals");function uo(e){return e&&String(e).trim().toLowerCase()}function nc(e){return e===!1||e==null?e:Re.isArray(e)?e.map(nc):String(e)}function Hw(e){const r=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(e);)r[n[1]]=n[2];return r}const Yw=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function Id(e,r,t,n,s){if(Re.isFunction(n))return n.call(this,r,t);if(s&&(r=t),!!Re.isString(r)){if(Re.isString(n))return r.indexOf(n)!==-1;if(Re.isRegExp(n))return n.test(r)}}function zw(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,t,n)=>t.toUpperCase()+n)}function Gw(e,r){const t=Re.toCamelCase(" "+r);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+t,{value:function(s,i,o){return this[n].call(this,r,s,i,o)},configurable:!0})})}class Xc{constructor(r){r&&this.set(r)}set(r,t,n){const s=this;function i(l,c,d){const u=uo(c);if(!u)throw new Error("header name must be a non-empty string");const f=Re.findKey(s,u);(!f||s[f]===void 0||d===!0||d===void 0&&s[f]!==!1)&&(s[f||c]=nc(l))}const o=(l,c)=>Re.forEach(l,(d,u)=>i(d,u,c));if(Re.isPlainObject(r)||r instanceof this.constructor)o(r,t);else if(Re.isString(r)&&(r=r.trim())&&!Yw(r))o(Ww(r),t);else if(Re.isObject(r)&&Re.isIterable(r)){let l={},c,d;for(const u of r){if(!Re.isArray(u))throw TypeError("Object iterator must return a key-value pair");l[d=u[0]]=(c=l[d])?Re.isArray(c)?[...c,u[1]]:[c,u[1]]:u[1]}o(l,t)}else r!=null&&i(t,r,n);return this}get(r,t){if(r=uo(r),r){const n=Re.findKey(this,r);if(n){const s=this[n];if(!t)return s;if(t===!0)return Hw(s);if(Re.isFunction(t))return t.call(this,s,n);if(Re.isRegExp(t))return t.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,t){if(r=uo(r),r){const n=Re.findKey(this,r);return!!(n&&this[n]!==void 0&&(!t||Id(this,this[n],n,t)))}return!1}delete(r,t){const n=this;let s=!1;function i(o){if(o=uo(o),o){const l=Re.findKey(n,o);l&&(!t||Id(n,n[l],l,t))&&(delete n[l],s=!0)}}return Re.isArray(r)?r.forEach(i):i(r),s}clear(r){const t=Object.keys(this);let n=t.length,s=!1;for(;n--;){const i=t[n];(!r||Id(this,this[i],i,r,!0))&&(delete this[i],s=!0)}return s}normalize(r){const t=this,n={};return Re.forEach(this,(s,i)=>{const o=Re.findKey(n,i);if(o){t[o]=nc(s),delete t[i];return}const l=r?zw(i):String(i).trim();l!==i&&delete t[i],t[l]=nc(s),n[l]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const t=Object.create(null);return Re.forEach(this,(n,s)=>{n!=null&&n!==!1&&(t[s]=r&&Re.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,t])=>r+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...t){const n=new this(r);return t.forEach(s=>n.set(s)),n}static accessor(r){const n=(this[O0]=this[O0]={accessors:{}}).accessors,s=this.prototype;function i(o){const l=uo(o);n[l]||(Gw(s,o),n[l]=!0)}return Re.isArray(r)?r.forEach(i):i(r),this}}Xc.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Re.reduceDescriptors(Xc.prototype,({value:e},r)=>{let t=r[0].toUpperCase()+r.slice(1);return{get:()=>e,set(n){this[t]=n}}});Re.freezeMethods(Xc);const ga=Xc;function Fd(e,r){const t=this||gf,n=r||t,s=ga.from(n.headers);let i=n.data;return Re.forEach(e,function(l){i=l.call(t,i,s.normalize(),r?r.status:void 0)}),s.normalize(),i}function ig(e){return!!(e&&e.__CANCEL__)}function eo(e,r,t){St.call(this,e??"canceled",St.ERR_CANCELED,r,t),this.name="CanceledError"}Re.inherits(eo,St,{__CANCEL__:!0});function og(e,r,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?e(t):r(new St("Request failed with status code "+t.status,[St.ERR_BAD_REQUEST,St.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function qw(e){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""}function Xw(e,r){e=e||10;const t=new Array(e),n=new Array(e);let s=0,i=0,o;return r=r!==void 0?r:1e3,function(c){const d=Date.now(),u=n[i];o||(o=d),t[s]=c,n[s]=d;let f=i,h=0;for(;f!==s;)h+=t[f++],f=f%e;if(s=(s+1)%e,s===i&&(i=(i+1)%e),d-o<r)return;const x=u&&d-u;return x?Math.round(h*1e3/x):void 0}}function Kw(e,r){let t=0,n=1e3/r,s,i;const o=(d,u=Date.now())=>{t=u,s=null,i&&(clearTimeout(i),i=null),e.apply(null,d)};return[(...d)=>{const u=Date.now(),f=u-t;f>=n?o(d,u):(s=d,i||(i=setTimeout(()=>{i=null,o(s)},n-f)))},()=>s&&o(s)]}const pc=(e,r,t=3)=>{let n=0;const s=Xw(50,250);return Kw(i=>{const o=i.loaded,l=i.lengthComputable?i.total:void 0,c=o-n,d=s(c),u=o<=l;n=o;const f={loaded:o,total:l,progress:l?o/l:void 0,bytes:c,rate:d||void 0,estimated:d&&l&&u?(l-o)/d:void 0,event:i,lengthComputable:l!=null,[r?"download":"upload"]:!0};e(f)},t)},L0=(e,r)=>{const t=e!=null;return[n=>r[0]({lengthComputable:t,total:e,loaded:n}),r[1]]},$0=e=>(...r)=>Re.asap(()=>e(...r)),Jw=cn.hasStandardBrowserEnv?((e,r)=>t=>(t=new URL(t,cn.origin),e.protocol===t.protocol&&e.host===t.host&&(r||e.port===t.port)))(new URL(cn.origin),cn.navigator&&/(msie|trident)/i.test(cn.navigator.userAgent)):()=>!0,Qw=cn.hasStandardBrowserEnv?{write(e,r,t,n,s,i){const o=[e+"="+encodeURIComponent(r)];Re.isNumber(t)&&o.push("expires="+new Date(t).toGMTString()),Re.isString(n)&&o.push("path="+n),Re.isString(s)&&o.push("domain="+s),i===!0&&o.push("secure"),document.cookie=o.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Zw(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function ej(e,r){return r?e.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):e}function lg(e,r,t){let n=!Zw(r);return e&&(n||t==!1)?ej(e,r):r}const B0=e=>e instanceof ga?{...e}:e;function ei(e,r){r=r||{};const t={};function n(d,u,f,h){return Re.isPlainObject(d)&&Re.isPlainObject(u)?Re.merge.call({caseless:h},d,u):Re.isPlainObject(u)?Re.merge({},u):Re.isArray(u)?u.slice():u}function s(d,u,f,h){if(Re.isUndefined(u)){if(!Re.isUndefined(d))return n(void 0,d,f,h)}else return n(d,u,f,h)}function i(d,u){if(!Re.isUndefined(u))return n(void 0,u)}function o(d,u){if(Re.isUndefined(u)){if(!Re.isUndefined(d))return n(void 0,d)}else return n(void 0,u)}function l(d,u,f){if(f in r)return n(d,u);if(f in e)return n(void 0,d)}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:l,headers:(d,u,f)=>s(B0(d),B0(u),f,!0)};return Re.forEach(Object.keys(Object.assign({},e,r)),function(u){const f=c[u]||s,h=f(e[u],r[u],u);Re.isUndefined(h)&&f!==l||(t[u]=h)}),t}const cg=e=>{const r=ei({},e);let{data:t,withXSRFToken:n,xsrfHeaderName:s,xsrfCookieName:i,headers:o,auth:l}=r;r.headers=o=ga.from(o),r.url=ng(lg(r.baseURL,r.url,r.allowAbsoluteUrls),e.params,e.paramsSerializer),l&&o.set("Authorization","Basic "+btoa((l.username||"")+":"+(l.password?unescape(encodeURIComponent(l.password)):"")));let c;if(Re.isFormData(t)){if(cn.hasStandardBrowserEnv||cn.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if((c=o.getContentType())!==!1){const[d,...u]=c?c.split(";").map(f=>f.trim()).filter(Boolean):[];o.setContentType([d||"multipart/form-data",...u].join("; "))}}if(cn.hasStandardBrowserEnv&&(n&&Re.isFunction(n)&&(n=n(r)),n||n!==!1&&Jw(r.url))){const d=s&&i&&Qw.read(i);d&&o.set(s,d)}return r},tj=typeof XMLHttpRequest<"u",rj=tj&&function(e){return new Promise(function(t,n){const s=cg(e);let i=s.data;const o=ga.from(s.headers).normalize();let{responseType:l,onUploadProgress:c,onDownloadProgress:d}=s,u,f,h,x,m;function g(){x&&x(),m&&m(),s.cancelToken&&s.cancelToken.unsubscribe(u),s.signal&&s.signal.removeEventListener("abort",u)}let p=new XMLHttpRequest;p.open(s.method.toUpperCase(),s.url,!0),p.timeout=s.timeout;function y(){if(!p)return;const v=ga.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),C={data:!l||l==="text"||l==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:v,config:e,request:p};og(function(j){t(j),g()},function(j){n(j),g()},C),p=null}"onloadend"in p?p.onloadend=y:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(y)},p.onabort=function(){p&&(n(new St("Request aborted",St.ECONNABORTED,e,p)),p=null)},p.onerror=function(){n(new St("Network Error",St.ERR_NETWORK,e,p)),p=null},p.ontimeout=function(){let E=s.timeout?"timeout of "+s.timeout+"ms exceeded":"timeout exceeded";const C=s.transitional||ag;s.timeoutErrorMessage&&(E=s.timeoutErrorMessage),n(new St(E,C.clarifyTimeoutError?St.ETIMEDOUT:St.ECONNABORTED,e,p)),p=null},i===void 0&&o.setContentType(null),"setRequestHeader"in p&&Re.forEach(o.toJSON(),function(E,C){p.setRequestHeader(C,E)}),Re.isUndefined(s.withCredentials)||(p.withCredentials=!!s.withCredentials),l&&l!=="json"&&(p.responseType=s.responseType),d&&([h,m]=pc(d,!0),p.addEventListener("progress",h)),c&&p.upload&&([f,x]=pc(c),p.upload.addEventListener("progress",f),p.upload.addEventListener("loadend",x)),(s.cancelToken||s.signal)&&(u=v=>{p&&(n(!v||v.type?new eo(null,e,p):v),p.abort(),p=null)},s.cancelToken&&s.cancelToken.subscribe(u),s.signal&&(s.signal.aborted?u():s.signal.addEventListener("abort",u)));const S=qw(s.url);if(S&&cn.protocols.indexOf(S)===-1){n(new St("Unsupported protocol "+S+":",St.ERR_BAD_REQUEST,e));return}p.send(i||null)})},nj=(e,r)=>{const{length:t}=e=e?e.filter(Boolean):[];if(r||t){let n=new AbortController,s;const i=function(d){if(!s){s=!0,l();const u=d instanceof Error?d:this.reason;n.abort(u instanceof St?u:new eo(u instanceof Error?u.message:u))}};let o=r&&setTimeout(()=>{o=null,i(new St(`timeout ${r} of ms exceeded`,St.ETIMEDOUT))},r);const l=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(d=>{d.unsubscribe?d.unsubscribe(i):d.removeEventListener("abort",i)}),e=null)};e.forEach(d=>d.addEventListener("abort",i));const{signal:c}=n;return c.unsubscribe=()=>Re.asap(l),c}},aj=nj,sj=function*(e,r){let t=e.byteLength;if(!r||t<r){yield e;return}let n=0,s;for(;n<t;)s=n+r,yield e.slice(n,s),n=s},ij=async function*(e,r){for await(const t of oj(e))yield*sj(t,r)},oj=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const r=e.getReader();try{for(;;){const{done:t,value:n}=await r.read();if(t)break;yield n}}finally{await r.cancel()}},U0=(e,r,t,n)=>{const s=ij(e,r);let i=0,o,l=c=>{o||(o=!0,n&&n(c))};return new ReadableStream({async pull(c){try{const{done:d,value:u}=await s.next();if(d){l(),c.close();return}let f=u.byteLength;if(t){let h=i+=f;t(h)}c.enqueue(new Uint8Array(u))}catch(d){throw l(d),d}},cancel(c){return l(c),s.return()}},{highWaterMark:2})},Kc=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",dg=Kc&&typeof ReadableStream=="function",lj=Kc&&(typeof TextEncoder=="function"?(e=>r=>e.encode(r))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),ug=(e,...r)=>{try{return!!e(...r)}catch{return!1}},cj=dg&&ug(()=>{let e=!1;const r=new Request(cn.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),V0=64*1024,ju=dg&&ug(()=>Re.isReadableStream(new Response("").body)),xc={stream:ju&&(e=>e.body)};Kc&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(r=>{!xc[r]&&(xc[r]=Re.isFunction(e[r])?t=>t[r]():(t,n)=>{throw new St(`Response type '${r}' is not supported`,St.ERR_NOT_SUPPORT,n)})})})(new Response);const dj=async e=>{if(e==null)return 0;if(Re.isBlob(e))return e.size;if(Re.isSpecCompliantForm(e))return(await new Request(cn.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(Re.isArrayBufferView(e)||Re.isArrayBuffer(e))return e.byteLength;if(Re.isURLSearchParams(e)&&(e=e+""),Re.isString(e))return(await lj(e)).byteLength},uj=async(e,r)=>{const t=Re.toFiniteNumber(e.getContentLength());return t??dj(r)},fj=Kc&&(async e=>{let{url:r,method:t,data:n,signal:s,cancelToken:i,timeout:o,onDownloadProgress:l,onUploadProgress:c,responseType:d,headers:u,withCredentials:f="same-origin",fetchOptions:h}=cg(e);d=d?(d+"").toLowerCase():"text";let x=aj([s,i&&i.toAbortSignal()],o),m;const g=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let p;try{if(c&&cj&&t!=="get"&&t!=="head"&&(p=await uj(u,n))!==0){let C=new Request(r,{method:"POST",body:n,duplex:"half"}),A;if(Re.isFormData(n)&&(A=C.headers.get("content-type"))&&u.setContentType(A),C.body){const[j,w]=L0(p,pc($0(c)));n=U0(C.body,V0,j,w)}}Re.isString(f)||(f=f?"include":"omit");const y="credentials"in Request.prototype;m=new Request(r,{...h,signal:x,method:t.toUpperCase(),headers:u.normalize().toJSON(),body:n,duplex:"half",credentials:y?f:void 0});let S=await fetch(m);const v=ju&&(d==="stream"||d==="response");if(ju&&(l||v&&g)){const C={};["status","statusText","headers"].forEach(k=>{C[k]=S[k]});const A=Re.toFiniteNumber(S.headers.get("content-length")),[j,w]=l&&L0(A,pc($0(l),!0))||[];S=new Response(U0(S.body,V0,j,()=>{w&&w(),g&&g()}),C)}d=d||"text";let E=await xc[Re.findKey(xc,d)||"text"](S,e);return!v&&g&&g(),await new Promise((C,A)=>{og(C,A,{data:E,headers:ga.from(S.headers),status:S.status,statusText:S.statusText,config:e,request:m})})}catch(y){throw g&&g(),y&&y.name==="TypeError"&&/Load failed|fetch/i.test(y.message)?Object.assign(new St("Network Error",St.ERR_NETWORK,e,m),{cause:y.cause||y}):St.from(y,y&&y.code,e,m)}}),Eu={http:kw,xhr:rj,fetch:fj};Re.forEach(Eu,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const W0=e=>`- ${e}`,hj=e=>Re.isFunction(e)||e===null||e===!1,fg={getAdapter:e=>{e=Re.isArray(e)?e:[e];const{length:r}=e;let t,n;const s={};for(let i=0;i<r;i++){t=e[i];let o;if(n=t,!hj(t)&&(n=Eu[(o=String(t)).toLowerCase()],n===void 0))throw new St(`Unknown adapter '${o}'`);if(n)break;s[o||"#"+i]=n}if(!n){const i=Object.entries(s).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let o=r?i.length>1?`since :
`+i.map(W0).join(`
`):" "+W0(i[0]):"as no adapter specified";throw new St("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:Eu};function Md(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new eo(null,e)}function H0(e){return Md(e),e.headers=ga.from(e.headers),e.data=Fd.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),fg.getAdapter(e.adapter||gf.adapter)(e).then(function(n){return Md(e),n.data=Fd.call(e,e.transformResponse,n),n.headers=ga.from(n.headers),n},function(n){return ig(n)||(Md(e),n&&n.response&&(n.response.data=Fd.call(e,e.transformResponse,n.response),n.response.headers=ga.from(n.response.headers))),Promise.reject(n)})}const hg="1.9.0",Jc={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{Jc[e]=function(n){return typeof n===e||"a"+(r<1?"n ":" ")+e}});const Y0={};Jc.transitional=function(r,t,n){function s(i,o){return"[Axios v"+hg+"] Transitional option '"+i+"'"+o+(n?". "+n:"")}return(i,o,l)=>{if(r===!1)throw new St(s(o," has been removed"+(t?" in "+t:"")),St.ERR_DEPRECATED);return t&&!Y0[o]&&(Y0[o]=!0,console.warn(s(o," has been deprecated since v"+t+" and will be removed in the near future"))),r?r(i,o,l):!0}};Jc.spelling=function(r){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${r}`),!0)};function mj(e,r,t){if(typeof e!="object")throw new St("options must be an object",St.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let s=n.length;for(;s-- >0;){const i=n[s],o=r[i];if(o){const l=e[i],c=l===void 0||o(l,i,e);if(c!==!0)throw new St("option "+i+" must be "+c,St.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new St("Unknown option "+i,St.ERR_BAD_OPTION)}}const ac={assertOptions:mj,validators:Jc},Ea=ac.validators;class gc{constructor(r){this.defaults=r||{},this.interceptors={request:new R0,response:new R0}}async request(r,t){try{return await this._request(r,t)}catch(n){if(n instanceof Error){let s={};Error.captureStackTrace?Error.captureStackTrace(s):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";try{n.stack?i&&!String(n.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+i):n.stack=i}catch{}}throw n}}_request(r,t){typeof r=="string"?(t=t||{},t.url=r):t=r||{},t=ei(this.defaults,t);const{transitional:n,paramsSerializer:s,headers:i}=t;n!==void 0&&ac.assertOptions(n,{silentJSONParsing:Ea.transitional(Ea.boolean),forcedJSONParsing:Ea.transitional(Ea.boolean),clarifyTimeoutError:Ea.transitional(Ea.boolean)},!1),s!=null&&(Re.isFunction(s)?t.paramsSerializer={serialize:s}:ac.assertOptions(s,{encode:Ea.function,serialize:Ea.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ac.assertOptions(t,{baseUrl:Ea.spelling("baseURL"),withXsrfToken:Ea.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&Re.merge(i.common,i[t.method]);i&&Re.forEach(["delete","get","head","post","put","patch","common"],m=>{delete i[m]}),t.headers=ga.concat(o,i);const l=[];let c=!0;this.interceptors.request.forEach(function(g){typeof g.runWhen=="function"&&g.runWhen(t)===!1||(c=c&&g.synchronous,l.unshift(g.fulfilled,g.rejected))});const d=[];this.interceptors.response.forEach(function(g){d.push(g.fulfilled,g.rejected)});let u,f=0,h;if(!c){const m=[H0.bind(this),void 0];for(m.unshift.apply(m,l),m.push.apply(m,d),h=m.length,u=Promise.resolve(t);f<h;)u=u.then(m[f++],m[f++]);return u}h=l.length;let x=t;for(f=0;f<h;){const m=l[f++],g=l[f++];try{x=m(x)}catch(p){g.call(this,p);break}}try{u=H0.call(this,x)}catch(m){return Promise.reject(m)}for(f=0,h=d.length;f<h;)u=u.then(d[f++],d[f++]);return u}getUri(r){r=ei(this.defaults,r);const t=lg(r.baseURL,r.url,r.allowAbsoluteUrls);return ng(t,r.params,r.paramsSerializer)}}Re.forEach(["delete","get","head","options"],function(r){gc.prototype[r]=function(t,n){return this.request(ei(n||{},{method:r,url:t,data:(n||{}).data}))}});Re.forEach(["post","put","patch"],function(r){function t(n){return function(i,o,l){return this.request(ei(l||{},{method:r,headers:n?{"Content-Type":"multipart/form-data"}:{},url:i,data:o}))}}gc.prototype[r]=t(),gc.prototype[r+"Form"]=t(!0)});const sc=gc;class yf{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(i){t=i});const n=this;this.promise.then(s=>{if(!n._listeners)return;let i=n._listeners.length;for(;i-- >0;)n._listeners[i](s);n._listeners=null}),this.promise.then=s=>{let i;const o=new Promise(l=>{n.subscribe(l),i=l}).then(s);return o.cancel=function(){n.unsubscribe(i)},o},r(function(i,o,l){n.reason||(n.reason=new eo(i,o,l),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const t=this._listeners.indexOf(r);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const r=new AbortController,t=n=>{r.abort(n)};return this.subscribe(t),r.signal.unsubscribe=()=>this.unsubscribe(t),r.signal}static source(){let r;return{token:new yf(function(s){r=s}),cancel:r}}}const pj=yf;function xj(e){return function(t){return e.apply(null,t)}}function gj(e){return Re.isObject(e)&&e.isAxiosError===!0}const ku={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(ku).forEach(([e,r])=>{ku[r]=e});const yj=ku;function mg(e){const r=new sc(e),t=Yx(sc.prototype.request,r);return Re.extend(t,sc.prototype,r,{allOwnKeys:!0}),Re.extend(t,r,null,{allOwnKeys:!0}),t.create=function(s){return mg(ei(e,s))},t}const Mr=mg(gf);Mr.Axios=sc;Mr.CanceledError=eo;Mr.CancelToken=pj;Mr.isCancel=ig;Mr.VERSION=hg;Mr.toFormData=qc;Mr.AxiosError=St;Mr.Cancel=Mr.CanceledError;Mr.all=function(r){return Promise.all(r)};Mr.spread=xj;Mr.isAxiosError=gj;Mr.mergeConfig=ei;Mr.AxiosHeaders=ga;Mr.formToJSON=e=>sg(Re.isHTMLForm(e)?new FormData(e):e);Mr.getAdapter=fg.getAdapter;Mr.HttpStatusCode=yj;Mr.default=Mr;const Sn=Mr,Dn=Sn.create({baseURL:Et.apiUrl,timeout:Et.apiTimeout,withCredentials:!0,paramsSerializer:e=>Object.entries(e).map(([r,t])=>`${encodeURIComponent(r)}=${encodeURIComponent(String(t))}`).join("&")}),vj=async()=>{try{return(await Dn.get("/api/auth/health",{timeout:3e3,headers:{"Cache-Control":"no-cache"}})).status===200}catch(e){return console.error("Health check failed:",e),!1}},bj=async()=>{try{const{setupRefreshInterceptor:e}=await qr(()=>Promise.resolve().then(()=>ed),void 0);e(Dn),console.log("‚úÖ Token refresh interceptor set up successfully")}catch(e){console.error("‚ùå Failed to set up token refresh interceptor:",e)}};bj();Dn.interceptors.request.use(async e=>{const{getAuthHeader:r}=await qr(()=>import("./authHelper-af24341a.js"),["assets/authHelper-af24341a.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]),t=r();return t&&e.headers&&(e.headers.Authorization=t),e});Dn.interceptors.response.use(e=>e,async e=>{var n,s,i,o,l,c,d,u,f,h,x,m,g,p,y,S,v,E,C,A,j,w,k,_,I,D,B,R,Y,P,M,K,L,ae,Z,T,N,H,G,q,oe;if(((n=e.response)==null?void 0:n.status)===403){console.error("Permission Error (403) Details:"),console.error("Current localStorage token:",localStorage.getItem("token")?"Present (first 10 chars): "+((s=localStorage.getItem("token"))==null?void 0:s.substring(0,10))+"...":"Missing"),console.error("User from localStorage:",localStorage.getItem("user"));let de="";(o=(i=e.config)==null?void 0:i.url)!=null&&o.startsWith("http")?de=e.config.url:de=`${((l=e.config)==null?void 0:l.baseURL)||""}${((c=e.config)==null?void 0:c.url)||""}`,console.error("Full request URL:",de),console.error("Request Method:",(u=(d=e.config)==null?void 0:d.method)==null?void 0:u.toUpperCase()),console.error("Request Headers:",(f=e.config)==null?void 0:f.headers);try{console.error("Request Payload:",(h=e.config)!=null&&h.data?JSON.parse((x=e.config)==null?void 0:x.data):"No data")}catch{console.error("Raw Request Payload:",(m=e.config)==null?void 0:m.data)}console.error("Response Body:",(g=e.response)==null?void 0:g.data)}if(((p=e.response)==null?void 0:p.status)===500){console.error("Server Error 500 Details:");try{console.error("Request URL:",(y=e.config)==null?void 0:y.url),console.error("Request Method:",(S=e.config)==null?void 0:S.method),console.error("Request Payload:",JSON.parse((v=e.config)==null?void 0:v.data)),console.error("Response Data:",(E=e.response)==null?void 0:E.data)}catch{console.error("Raw Request Data:",(C=e.config)==null?void 0:C.data)}}if(((A=e.response)==null?void 0:A.status)===400){console.error("Validation Error Details:"),(w=(j=e.response)==null?void 0:j.data)!=null&&w.errors?console.table(e.response.data.errors):(_=(k=e.response)==null?void 0:k.data)!=null&&_.fieldErrors?console.table(e.response.data.fieldErrors):(D=(I=e.response)==null?void 0:I.data)!=null&&D.message?console.error("Validation message:",e.response.data.message):typeof((B=e.response)==null?void 0:B.data)=="object"&&console.error("Detailed validation error information:");try{const de=JSON.parse((R=e.config)==null?void 0:R.data);console.log("Request payload that caused validation error:",de);const z=[];(P=(Y=e.config)==null?void 0:Y.url)!=null&&P.includes("/api/fees/payments")&&(console.log("Validating payment request payload:"),de.feeId||z.push("feeId"),de.studentId||z.push("studentId"),de.amount||z.push("amount"),de.paymentMethod||z.push("paymentMethod"),z.length>0&&console.error("Missing required fields:",z))}catch{console.log("Request payload (could not parse):",(M=e.config)==null?void 0:M.data)}}if(((K=e.response)==null?void 0:K.status)===401)return Promise.reject(e);const t={message:((ae=(L=e.response)==null?void 0:L.data)==null?void 0:ae.message)||((T=(Z=e.response)==null?void 0:Z.data)==null?void 0:T.error)||e.message||"An error occurred",status:((N=e.response)==null?void 0:N.status)||"network_error",originalError:e,validationErrors:((G=(H=e.response)==null?void 0:H.data)==null?void 0:G.errors)||((oe=(q=e.response)==null?void 0:q.data)==null?void 0:oe.fieldErrors)};return Promise.reject(t)});function fo(e,r){if(typeof e.data=="string"&&(e.data.trim().startsWith("[")||e.data.trim().startsWith("{")))try{return console.log(`Got string response from ${r}, parsing as JSON`),JSON.parse(e.data)}catch(t){return console.error(`Failed to parse string response from ${r} as JSON:`,t),e.data}return e.data}const ge={get:(e,r)=>{const t=Ua(e);return Dn.get(t,{params:r}).then(n=>((e==="staff"||e.startsWith("staff/"))&&console.log(`API Response from ${t}:`,{status:n.status,headers:n.headers,data:n.data,dataType:n.data?typeof n.data:"undefined"}),fo(n,t))).catch(n=>{var l,c,d;const i=((l=n==null?void 0:n.response)==null?void 0:l.status)===404,o=i?console.debug:console.error;throw i?o(`API 404 from ${t}`):o(`API Error from ${t}:`,{message:n.message,response:n.response,statusText:(c=n.response)==null?void 0:c.statusText,data:(d=n.response)==null?void 0:d.data}),n})},post:(e,r,t)=>{const n=Ua(e),s=typeof FormData<"u"&&r instanceof FormData,i=t??(s?void 0:{headers:{"Content-Type":"application/json"}});return Dn.post(n,r,i).then(o=>fo(o,n))},put:(e,r)=>{const t=Ua(e),s=typeof FormData<"u"&&r instanceof FormData?void 0:{headers:{"Content-Type":"application/json"}};return Dn.put(t,r,s).then(i=>fo(i,t))},delete:e=>{const r=Ua(e);return Dn.delete(r).then(t=>fo(t,r))},patch:(e,r)=>{const t=Ua(e),s=typeof FormData<"u"&&r instanceof FormData?void 0:{headers:{"Content-Type":"application/json"}};return Dn.patch(t,r,s).then(i=>fo(i,t))},authRequest:(e,r)=>Dn.post(Ua(e),r,{headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}}).then(t=>t.data),bulkUpload:(e,r,t)=>{const n=(t==null?void 0:t.isFile)??r instanceof File,s=Ua(e);if(n){const i=new FormData;return i.append("file",r),Dn.post(s,i).then(o=>o.data)}else return Dn.post(s,r).then(i=>i.data)},downloadBlob:(e,r)=>Dn.get(Ua(e),{responseType:"blob",params:r}).then(t=>t.data),downloadBlobPost:(e,r)=>Dn.post(Ua(e),r,{responseType:"blob"}).then(t=>t.data)};function Ua(e){const r=Et.apiUrl.endsWith("/")?Et.apiUrl.slice(0,-1):Et.apiUrl;return e.startsWith("/api/")?`${r}${e}`:e.startsWith("/")?`${r}/api${e}`:`${r}/api/${e}`}const Sj=Object.freeze(Object.defineProperty({__proto__:null,api:ge,checkServerHealth:vj,default:ge},Symbol.toStringTag,{value:"Module"}));function pg(e){try{const t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(t).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""));return JSON.parse(n)}catch(r){return console.error("Error parsing JWT token:",r),null}}const Ml={setWithExpiry:(e,r,t)=>{const s={value:r,expiry:new Date().getTime()+t};localStorage.setItem(e,JSON.stringify(s))},getWithExpiry:e=>{const r=localStorage.getItem(e);if(!r)return null;try{const t=JSON.parse(r);return new Date().getTime()>t.expiry?(localStorage.removeItem(e),null):t.value}catch(t){return console.error("Error parsing stored item with TTL:",t),localStorage.removeItem(e),null}},remove:e=>{localStorage.removeItem(e)}};let Pd=null;const wj=async()=>{if(!Pd)try{Pd=await qr(()=>Promise.resolve().then(()=>yg),void 0)}catch(e){console.error("Failed to import connectivity checker",e)}return Pd},Gi={login:async e=>{console.log("üîê AuthService: Attempting login with credentials:",{username:e.username,passwordLength:e.password?e.password.length:0});try{const r=await wj();if(r){const n=await r.testBackendConnectivity();n.isConnected||(console.warn("üîå AuthService: Backend connectivity issue detected"),console.log("üîç Connection diagnosis:",n),n.workingUrl&&(console.log(`üîÑ AuthService: Updating API URL to ${n.workingUrl}`),Et.apiUrl=n.workingUrl,sessionStorage.setItem("detectedApiUrl",n.workingUrl)))}if(!navigator.onLine){console.log("üìµ AuthService: Device is offline, checking for cached credentials");const n=Ml.getWithExpiry("offlineAuth");if(n&&n.username===e.username&&n.passwordHash===Nd(e.password))return console.log("‚úÖ AuthService: Using cached credentials for offline mode"),{data:n.authData,offlineMode:!0};throw console.error("‚ùå AuthService: No valid cached credentials found for offline mode"),{message:"You appear to be offline. Cannot authenticate without internet connection.",status:"network_error",isOffline:!0}}try{console.log("üîÑ AuthService: Trying login with enhanced CORS handling...");const{authFetch:n}=await qr(()=>import("./authHelper-af24341a.js"),["assets/authHelper-af24341a.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]),s=await n("/api/auth/login",e);return console.log("‚úÖ AuthService: Login successful with enhanced CORS handling"),console.log("üîç DEBUG - Auth Response Details:",{responseData:s,token:s.token||s.access_token,username:s.username,role:s.role||s.userRole,allFields:Object.keys(s)}),Ml.setWithExpiry("offlineAuth",{username:e.username,passwordHash:Nd(e.password),authData:s,timestamp:new Date().toISOString()},864e5),s}catch(n){console.warn("‚ö†Ô∏è Enhanced auth request failed, falling back to standard request:",n);const s=await ge.authRequest("/api/auth/login",e);return console.log("‚úÖ AuthService: Login successful with fallback method"),Ml.setWithExpiry("offlineAuth",{username:e.username,passwordHash:Nd(e.password),authData:s,timestamp:new Date().toISOString()},864e5),s}}catch(r){throw console.error("‚ùå AuthService: Login failed:",r),r.message&&(r.message.includes("Network Error")||r.message.includes("CORS")||r.message.includes("header field")||r.status===0)?(console.error("üîÑ CORS Issue Detected: Adding detailed diagnostic info"),{...r,message:"Authentication failed due to CORS issues. Please try again or contact support.",corsIssue:!0,diagnostics:{browser:navigator.userAgent,time:new Date().toISOString(),corsHeaders:["Authorization","Content-Type","Cache-Control"]}}):r}},register:async e=>{try{return await ge.authRequest("/auth/register",e)}catch(r){throw console.error("‚ùå AuthService: Registration failed:",r),r}},logout:()=>{console.log("üîí AuthService: Logging out user"),localStorage.removeItem("token"),localStorage.removeItem("user"),Ml.remove("offlineAuth"),ge.authRequest("/auth/logout",{}).then(()=>console.log("‚úÖ AuthService: Server logout successful")).catch(e=>console.log("‚ÑπÔ∏è AuthService: Server logout failed, but client logout completed"))},validateToken:async e=>{try{const r=e||localStorage.getItem("token");if(!r)return console.error("‚ùå AuthService: No token to validate"),!1;try{const n=pg(r);if(n&&n.exp){const s=Date.now()/1e3;if(n.exp<s)return console.error("‚ùå AuthService: Token expired (client check)"),!1}}catch(n){console.error("‚ùå AuthService: Error parsing token:",n)}return(await ge.authRequest("/auth/validate-token",{token:r})).valid===!0}catch(r){return console.error("‚ùå AuthService: Token validation failed:",r),!1}}},jj=()=>{var t;const e=Ej();if(console.log(`[AUTH DEBUG] [${new Date().toISOString()}] Checking staff status update permission`),!e)return console.log(`[AUTH DEBUG] [${new Date().toISOString()}] Permission check failed: No user found`),!1;if(console.log(`[AUTH DEBUG] [${new Date().toISOString()}] User role: ${e.role}`),console.log(`[AUTH DEBUG] [${new Date().toISOString()}] Token present: ${!!localStorage.getItem("token")}`),localStorage.getItem("token")){const n=((t=localStorage.getItem("token"))==null?void 0:t.substring(0,15))+"...";console.log(`[AUTH DEBUG] [${new Date().toISOString()}] Token sample: ${n}`)}const r=e.role==="ADMIN"||e.role==="HR_MANAGER";return console.log(`[AUTH DEBUG] [${new Date().toISOString()}] Has permission: ${r}`),r};function Nd(e){let r=0;for(let t=0;t<e.length;t++){const n=e.charCodeAt(t);r=(r<<5)-r+n,r=r&r}return r.toString(36)}function Ej(){const e=localStorage.getItem("user");if(!e)return null;try{return JSON.parse(e)}catch(r){return console.error(`[AUTH DEBUG] [${new Date().toISOString()}] Error parsing user JSON:`,r),null}}typeof window<"u"&&(window.authService=Gi);const xg=b.createContext(void 0),kj=({children:e})=>{const[r,t]=b.useState(null),[n,s]=b.useState(!1),i=(l,c)=>{t(typeof l=="string"?{message:l,type:c||"info"}:l),s(!0)},o=()=>{s(!1)};return a.jsxs(xg.Provider,{value:{showNotification:i},children:[e,r&&a.jsx(Fa,{open:n,autoHideDuration:6e3,onClose:o,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:a.jsx(pt,{onClose:o,severity:r.type,variant:"filled",sx:{width:"100%"},children:r.message})})]})},dr=()=>{const e=b.useContext(xg);if(!e)throw new Error("useNotification must be used within a NotificationProvider");return e},Aj=10*60*1e3,gg=b.createContext(void 0),Tj=({children:e})=>{const[r,t]=b.useState(null),[n,s]=b.useState(!1),[i,o]=b.useState(!1),l=es(),{showNotification:c}=dr(),d=b.useRef(null),u=b.useCallback(()=>{n&&(d.current&&window.clearTimeout(d.current),d.current=window.setTimeout(()=>{console.log("‚è∞ User session expired due to inactivity"),c({type:"warning",message:"You are being logged out due to inactivity"}),h()},Aj),console.log("‚è∞ Inactivity timer reset - will expire in 10 minutes if no activity"))},[n]);b.useEffect(()=>{if(n){u();const m=["mousedown","mousemove","keydown","scroll","touchstart"],g=()=>{u()};return m.forEach(p=>{document.addEventListener(p,g)}),()=>{d.current&&window.clearTimeout(d.current),m.forEach(p=>{document.removeEventListener(p,g)})}}},[n,u]),b.useEffect(()=>{const m=localStorage.getItem("token"),g=localStorage.getItem("user");if(m&&g)try{try{const S=m.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),E=JSON.parse(window.atob(S)).exp*1e3;if(Date.now()>E){console.error("üîë Token expired, attempting refresh"),qr(()=>Promise.resolve().then(()=>ed),void 0).then(({refreshToken:j})=>{j().then(()=>{console.log("üîÑ Token refreshed during initial authentication");const w=localStorage.getItem("user");if(w){const k=JSON.parse(w);t(k),s(!0)}}).catch(w=>{console.error("‚ùå Token refresh failed during initial authentication:",w),localStorage.removeItem("token"),localStorage.removeItem("user"),l("/login")})});return}}catch(y){console.error("‚ùå Error validating token format:",y),localStorage.removeItem("token"),localStorage.removeItem("user"),l("/login");return}const p=JSON.parse(g);t(p),s(!0),console.log("‚úÖ User authenticated from localStorage:",{username:p.username,role:p.role})}catch(p){console.error("‚ùå Error parsing user data from localStorage:",p),localStorage.removeItem("token"),localStorage.removeItem("user")}else console.log("‚ÑπÔ∏è No authentication data found in localStorage")},[]);const f=async(m,g)=>{try{o(!0),console.log("üîê AuthContext: Attempting login for user:",m);const p=await Gi.login({username:m,password:g});console.log("‚úÖ AuthContext: Raw login response:",p);const y=p.data?p.data:p;if(!y||!y.token&&!y.access_token)throw console.error("‚ùå Invalid response format, missing token:",y),new Error("Invalid response from server. Missing authentication token.");const S=y.token||y.access_token;let v=y.role||y.userRole||"USER",E=y.roles||y.authorities||[];(!Array.isArray(E)||E.length===0)&&(E=[v]);const C={token:S,username:y.username||m,role:v,roles:E,id:y.id||y.userId||null};console.log("‚úÖ Processed user data:",C),localStorage.setItem("token",S),localStorage.setItem("user",JSON.stringify(C)),t(C),s(!0),l("/dashboard"),u(),c({type:"success",message:"Login successful"})}catch(p){console.error("‚ùå Login error in AuthContext:",p);let y="Login failed. Please check your credentials.";throw p&&typeof p=="object"&&"message"in p&&typeof p.message=="string"?y=p.message:p&&typeof p=="object"&&"response"in p&&p.response&&typeof p.response=="object"&&"data"in p.response&&p.response.data&&typeof p.response.data=="object"&&"message"in p.response.data&&typeof p.response.data.message=="string"&&(y=p.response.data.message),c({type:"error",message:y}),p}finally{o(!1)}},h=m=>{console.log(`üîí Logging out user${m?` (Reason: ${m})`:""}`),d.current&&(window.clearTimeout(d.current),d.current=null),localStorage.removeItem("token"),localStorage.removeItem("user"),t(null),s(!1);const g=m?`/login?reason=${encodeURIComponent(m)}`:"/login";l(g),c(m==="expired"?{type:"warning",message:"Your session has expired. Please log in again."}:m==="invalid"?{type:"error",message:"Authentication error. Please log in again."}:m==="permission"?{type:"warning",message:"You do not have permission to access that resource."}:{type:"info",message:"You have been logged out"})},x=r?{username:r.username||"",role:r.role||"USER",roles:Array.isArray(r.roles)?r.roles:r.role?[r.role]:["USER"],id:r.id||null}:void 0;return b.useEffect(()=>{x&&console.log("üë§ Current user context updated:",{username:x.username,role:x.role,roles:x.roles,id:x.id})},[x]),a.jsx(gg.Provider,{value:{user:r,login:f,logout:h,isAuthenticated:n,resetInactivityTimer:u,loading:i,currentUser:x},children:e})},$n=()=>{const e=b.useContext(gg);if(e===void 0)throw new Error("useAuth must be used within an AuthProvider");return e},Cj=[8080,8081,8082,5e3,3e3],Qc=async()=>{const e=Et.apiUrl,r="/api/auth/health";if(!e||e===""){console.log(`‚è±Ô∏è Testing connectivity using Vite proxy: ${r}`);try{const n=Date.now(),s=await Sn.get(r,{timeout:5e3,validateStatus:()=>!0}),i=Date.now();if(s.status===200)return console.log(`‚úÖ Successfully connected via Vite proxy in ${i-n}ms`),{isConnected:!0,workingUrl:"",originalUrl:e,serverInfo:{port:5173,responseTime:i-n,status:s.status}};console.log(`‚ö†Ô∏è Connected via Vite proxy but received status ${s.status}`)}catch(n){console.log(`‚ùå Failed to connect via Vite proxy: ${(n==null?void 0:n.message)||n}`)}}else{console.log(`‚è±Ô∏è Testing connectivity to backend at ${e}${r}`);try{const n=Date.now(),s=await Sn.get(`${e}${r}`,{timeout:5e3,validateStatus:()=>!0}),i=Date.now();if(s.status===200)return console.log(`‚úÖ Successfully connected to ${e} in ${i-n}ms`),{isConnected:!0,workingUrl:e,originalUrl:e,serverInfo:{port:parseInt(e.split(":").pop()||"0"),responseTime:i-n,status:s.status}};console.log(`‚ö†Ô∏è Connected to ${e} but received status ${s.status}`)}catch(n){console.log(`‚ùå Failed to connect to ${e}: ${(n==null?void 0:n.message)||n}`)}}const t=e.split(":").slice(0,2).join(":");for(const n of Cj){if(e.includes(`:${n}`))continue;const s=`${t}:${n}`;console.log(`üîÑ Trying alternative backend URL: ${s}`);try{const i=Date.now(),o=await Sn.get(`${s}${r}`,{timeout:3e3,validateStatus:()=>!0}),l=Date.now();if(o.status===200)return console.log(`‚úÖ Successfully connected to alternative URL ${s}`),{isConnected:!0,workingUrl:s,originalUrl:e,recommendation:`Update the configuration to use ${s} instead of ${e}`,serverInfo:{port:n,responseTime:l-i,status:o.status}}}catch{}}return{isConnected:!1,workingUrl:null,originalUrl:e,error:"Could not connect to any backend server",recommendation:"Ensure the backend server is running and accessible."}},vf=async()=>{const e=await Qc();return e.isConnected&&e.workingUrl&&e.workingUrl!==Et.apiUrl?(console.log(`üîÑ Automatically switching API URL from ${Et.apiUrl} to ${e.workingUrl}`),Et.apiUrl=e.workingUrl,sessionStorage.setItem("detectedApiUrl",e.workingUrl),!0):e.isConnected},bf=()=>{const e=sessionStorage.getItem("detectedApiUrl");e&&e!==Et.apiUrl&&(console.log(`üîÑ Applying previously detected API URL: ${e}`),Et.apiUrl=e)},Dj={testBackendConnectivity:Qc,autoDetectApiUrl:vf,applyStoredApiUrl:bf},yg=Object.freeze(Object.defineProperty({__proto__:null,applyStoredApiUrl:bf,autoDetectApiUrl:vf,default:Dj,testBackendConnectivity:Qc},Symbol.toStringTag,{value:"Module"})),Sf=b.createContext(void 0),_j=({children:e})=>{const[r,t]=b.useState({connected:!1,checking:!0,lastChecked:null,apiUrl:Et.apiUrl,workingUrl:null,error:null}),[n,s]=b.useState(!1),i=async()=>{t(d=>({...d,checking:!0}));try{const d=await Qc();return t({connected:d.isConnected,checking:!1,lastChecked:new Date,apiUrl:Et.apiUrl,workingUrl:d.workingUrl,error:d.error||null}),d.isConnected}catch(d){return t({connected:!1,checking:!1,lastChecked:new Date,apiUrl:Et.apiUrl,workingUrl:null,error:d.message||"Unknown error checking connection"}),!1}},o=async d=>{try{return Et.apiUrl=d,sessionStorage.setItem("detectedApiUrl",d),await i()}catch(u){return console.error("Error updating API URL:",u),!1}},l=async()=>{const d=window.location.origin;await o(d)};b.useEffect(()=>{bf(),vf().then(u=>{u?t(f=>({...f,connected:!0,checking:!1,lastChecked:new Date,apiUrl:Et.apiUrl,workingUrl:Et.apiUrl,error:null})):i()});const d=setInterval(()=>{i()},6e4);return()=>clearInterval(d)},[]);const c={connectionState:r,checkConnection:i,updateApiUrl:o,resetToDefaultUrl:l,showConnectionSettings:n,setShowConnectionSettings:s};return a.jsx(Sf.Provider,{value:c,children:e})},vg=()=>{const e=b.useContext(Sf);if(e===void 0)throw new Error("useConnection must be used within a ConnectionProvider");return e},z0=()=>{const{connectionState:e,checkConnection:r,setShowConnectionSettings:t}=vg(),{connected:n,checking:s,lastChecked:i}=e,[o,l]=b.useState(null),c=m=>{l(m.currentTarget)},d=()=>{l(null)},u=()=>{r(),d()},f=()=>{t(!0),d()},x=(()=>n===null?{label:"Checking connection...",color:"default"}:n?{label:"Connected to backend",color:"success"}:{label:"Backend connection issues",color:"error"})();return a.jsxs(a.Fragment,{children:[a.jsx(xt,{title:x.label,children:a.jsx(st,{color:n?"success":n===!1?"error":"default",onClick:c,children:a.jsx(Fx,{color:s?"info":"default",variant:"dot",invisible:!s,children:n?a.jsx(Gb,{}):a.jsx(Mx,{})})})}),a.jsxs(Bc,{anchorEl:o,open:!!o,onClose:d,PaperProps:{elevation:0,sx:{overflow:"visible",filter:"drop-shadow(0px 2px 8px rgba(0,0,0,0.32))",mt:1.5,width:250}},children:[a.jsx(Te,{disabled:!0,children:a.jsxs(ee,{children:[a.jsx(V,{variant:"subtitle2",fontWeight:"bold",children:"Backend Connection Status"}),a.jsx(V,{variant:"body2",color:n?"success.main":"error.main",children:n?"Connected":"Disconnected"}),i&&a.jsxs(V,{variant:"caption",color:"text.secondary",children:["Last checked: ",i.toLocaleTimeString()]})]})}),a.jsx(Qt,{}),a.jsxs(Te,{onClick:u,children:[a.jsx(On,{sx:{mr:1},fontSize:"small"}),"Check connection now"]}),a.jsxs(Te,{onClick:f,children:[a.jsx(tf,{sx:{mr:1},fontSize:"small"}),"Connection settings"]}),a.jsxs(Te,{onClick:()=>{window.open("/api/docs","_blank"),d()},children:[a.jsx(qb,{sx:{mr:1},fontSize:"small"}),"View API docs"]})]})]})},Pl=240,er={ADMIN:"ADMIN",TEACHER:"TEACHER",STAFF:"STAFF",PARENT:"PARENT",STUDENT:"STUDENT",PRINCIPAL:"PRINCIPAL",LIBRARIAN:"LIBRARIAN"},Ij=[{text:"Dashboard",icon:a.jsx(eS,{}),path:"/dashboard",allowedRoles:[er.ADMIN,er.TEACHER,er.STAFF,er.PARENT,er.STUDENT,er.LIBRARIAN]},{text:"Admissions",icon:a.jsx(tS,{}),path:"/admissions",allowedRoles:[er.ADMIN,er.STAFF]},{text:"Students",icon:a.jsx(zo,{}),path:"/students",allowedRoles:[er.ADMIN,er.TEACHER,er.STAFF]},{text:"Staff",icon:a.jsx(zo,{}),path:"/staff",allowedRoles:[er.ADMIN]},{text:"Staff Attendance",icon:a.jsx(Td,{}),path:"/staff-attendance",allowedRoles:[er.ADMIN,er.PRINCIPAL,er.STAFF,er.LIBRARIAN]},{text:"Student Attendance",icon:a.jsx(Td,{}),path:"/student-attendance",allowedRoles:[er.ADMIN,er.TEACHER]},{text:"Timetable",icon:a.jsx(Td,{}),path:"/timetable",allowedRoles:[er.ADMIN,er.PRINCIPAL,er.TEACHER]},{text:"Examinations",icon:a.jsx(Go,{}),path:"/exams",allowedRoles:[er.ADMIN,er.TEACHER,er.PRINCIPAL]},{text:"Library",icon:a.jsx(rS,{}),path:"/library",allowedRoles:[er.ADMIN,er.LIBRARIAN]},{text:"Fee Management",icon:a.jsx(nS,{}),path:"/fees",allowedRoles:[er.ADMIN]}],rn=({children:e})=>{const[r,t]=b.useState(!1),[n,s]=b.useState(null),i=es(),{user:o,logout:l}=$n(),c=()=>{t(!r)},d=m=>{s(m.currentTarget)},u=()=>{s(null)},f=()=>{u(),l()},h=Ij.filter(m=>o&&o.role&&m.allowedRoles.includes(o.role)),x=a.jsxs("div",{children:[a.jsx(Ad,{}),a.jsx(Gn,{children:h.map(m=>a.jsxs(Gr,{button:!0,onClick:()=>{m.path==="/dashboard"&&window.location.pathname==="/dashboard"?window.dispatchEvent(new CustomEvent("dashboard:refresh")):i(m.path),t(!1)},sx:{"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.04)"}},children:[a.jsx(In,{children:m.icon}),a.jsx(Fr,{primary:m.text})]},m.path))})]});return a.jsxs(ee,{sx:{display:"flex",width:"100%",height:"100vh",overflow:"hidden"},children:[a.jsx(Xb,{}),a.jsx(Kb,{position:"fixed",sx:{zIndex:m=>m.zIndex.drawer+1,width:"100%"},children:a.jsxs(Ad,{children:[a.jsx(st,{color:"inherit",edge:"start",onClick:c,sx:{mr:2,display:{sm:"none"}},children:a.jsx(Jb,{})}),a.jsxs(V,{variant:"h6",noWrap:!0,component:"div",sx:{flexGrow:1,display:"flex",alignItems:"center",fontSize:{xs:"1rem",sm:"1.25rem"}},children:["School Management System",a.jsx(xt,{title:"Backend connection status",children:a.jsx(ee,{sx:{ml:2,display:{xs:"none",sm:"flex"}},children:a.jsx(z0,{})})})]}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:["            ",a.jsx(ee,{sx:{mr:2,display:{xs:"flex",sm:"none"}},children:a.jsx(z0,{})}),o&&a.jsxs(a.Fragment,{children:[a.jsx(at,{label:o.role,color:"secondary",size:"small",sx:{mr:2,display:{xs:"none",sm:"flex"}}}),a.jsx(V,{variant:"body1",sx:{mr:2,display:{xs:"none",sm:"block"},maxWidth:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:o.username||o.email})]}),a.jsx(st,{color:"inherit",onClick:d,edge:"end",children:a.jsx(Px,{sx:{width:32,height:32},children:a.jsx(Qb,{})})})]})]})}),a.jsxs(Bc,{anchorEl:n,open:!!n,onClose:u,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[a.jsxs(Te,{onClick:f,children:[a.jsx(In,{children:a.jsx(Zb,{fontSize:"small"})}),a.jsx(Fr,{primary:"Logout"})]}),"      "]}),a.jsx(k0,{variant:"temporary",open:r,onClose:c,ModalProps:{keepMounted:!0},sx:{display:{xs:"block",sm:"none"},"& .MuiDrawer-paper":{boxSizing:"border-box",width:Pl,backgroundColor:"background.paper"}},children:x}),a.jsx(k0,{variant:"permanent",sx:{display:{xs:"none",sm:"block"},width:Pl,flexShrink:0,"& .MuiDrawer-paper":{width:Pl,boxSizing:"border-box",position:"relative",height:"100%",backgroundColor:"background.paper"}},open:!0,children:x}),a.jsxs(ee,{component:"main",sx:{flexGrow:1,p:3,width:{xs:"100%",sm:`calc(100% - ${Pl}px)`},mt:{xs:8,sm:0},height:"100%",overflow:"auto"},children:[a.jsx(Ad,{})," ",e]})]})},nn=({children:e,allowedRoles:r})=>{const{user:t,isAuthenticated:n}=$n(),{showNotification:s}=dr();if(b.useEffect(()=>{console.log("üîí RoleBasedRoute checking access for path:",window.location.pathname),console.log("üë§ User:",t),console.log("‚úÖ Allowed roles:",r);const l=localStorage.getItem("token");if(l)try{const c=JSON.parse(atob(l.split(".")[1])),d=c.exp*1e3,u=new Date().getTime(),f=u>d;console.log("üîç Token validation:",{valid:!f,expiresAt:new Date(d).toLocaleString(),timeLeft:Math.floor((d-u)/1e3/60)+" minutes",isExpired:f});const h=c.roles||c.authorities||(c.role?[c.role]:[]);if(console.log("üîç Token roles:",h),console.log("üîç User roles:",(t==null?void 0:t.roles)||[t==null?void 0:t.role].filter(Boolean)),!f&&t&&h.length>0){const x=t.roles||[t.role].filter(Boolean);!h.some(g=>x.includes(g))&&console.warn("‚ö†Ô∏è Potential role mismatch between token and stored user data")}}catch(c){console.error("Error parsing token:",c)}else console.warn("‚ö†Ô∏è No token available for role verification")},[t,r]),!n)return console.warn("‚ö†Ô∏è User not authenticated, redirecting to login"),a.jsx(_d,{to:"/login"});if(!t)return console.error("‚ùå User object is null or undefined"),s({type:"error",message:"Authentication error: User data is missing"}),a.jsx(_d,{to:"/login"});const i=Array.isArray(t.roles)?t.roles:t.role?[t.role]:t.userRole?[t.userRole]:[];return console.log("üîç Checking access with user roles:",i),i.some(l=>r.some(c=>l.toUpperCase()===c.toUpperCase()))?(console.log("‚úÖ Access granted to:",window.location.pathname),a.jsx(a.Fragment,{children:e})):(console.error(`‚ùå Access denied: User roles "${i.join(", ")||"unknown"}" not in allowed roles:`,r),i.some(c=>c.toUpperCase()==="ADMIN")&&r.some(c=>["ADMIN","PRINCIPAL"].includes(c.toUpperCase()))?(console.warn("‚ö†Ô∏è Admin user denied access to admin route. Possible token validation issue. Attempting refresh..."),qr(()=>Promise.resolve().then(()=>ed),void 0).then(({refreshToken:c})=>{c().catch(d=>console.error("Token refresh failed:",d))}),console.log("‚úÖ Granting provisional access to admin user"),a.jsx(a.Fragment,{children:e})):(s({type:"error",message:"Access denied: You do not have permission to view this page"}),a.jsx(_d,{to:"/dashboard"})))};var wf={},Rd={};const Fj=TS(aS);var G0;function $t(){return G0||(G0=1,function(e){"use client";Object.defineProperty(e,"__esModule",{value:!0}),Object.defineProperty(e,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=Fj}(Rd)),Rd}var Mj=Lt;Object.defineProperty(wf,"__esModule",{value:!0});var bg=wf.default=void 0,Pj=Mj($t()),Nj=a;bg=wf.default=(0,Pj.default)((0,Nj.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");var jf={},Rj=Lt;Object.defineProperty(jf,"__esModule",{value:!0});var ti=jf.default=void 0,Oj=Rj($t()),Lj=a;ti=jf.default=(0,Oj.default)((0,Lj.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M14 13v4h-4v-4H7l5-5 5 5z"}),"CloudUpload");var Ef={},$j=Lt;Object.defineProperty(Ef,"__esModule",{value:!0});var hl=Ef.default=void 0,Bj=$j($t()),Uj=a;hl=Ef.default=(0,Bj.default)((0,Uj.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit");var kf={},Vj=Lt;Object.defineProperty(kf,"__esModule",{value:!0});var Sg=kf.default=void 0,Wj=Vj($t()),Hj=a;Sg=kf.default=(0,Wj.default)((0,Hj.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"FileDownload");var Af={},Yj=Lt;Object.defineProperty(Af,"__esModule",{value:!0});var wg=Af.default=void 0,zj=Yj($t()),Gj=a;wg=Af.default=(0,zj.default)((0,Gj.jsx)("path",{d:"M4.25 5.61C6.27 8.2 10 13 10 13v6c0 .55.45 1 1 1h2c.55 0 1-.45 1-1v-6s3.72-4.8 5.74-7.39c.51-.66.04-1.61-.79-1.61H5.04c-.83 0-1.3.95-.79 1.61"}),"FilterAlt");var Tf={},qj=Lt;Object.defineProperty(Tf,"__esModule",{value:!0});var Cf=Tf.default=void 0,Xj=qj($t()),Kj=a;Cf=Tf.default=(0,Xj.default)((0,Kj.jsx)("path",{d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m-9-2V7H4v3H1v2h3v3h2v-3h3v-2zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"PersonAdd");function Df({columns:e,data:r,defaultRowsPerPage:t=10,rowsPerPageOptions:n=[5,10,25,50],loading:s=!1,onRefresh:i,searchEnabled:o=!0,searchPlaceholder:l="Search...",onSearch:c,initialSortBy:d,renderRowDetail:u,expandableRows:f=!1}){const[h,x]=b.useState(0),[m,g]=b.useState(t),[p,y]=b.useState(""),[S,v]=b.useState(d||null),[E,C]=b.useState("asc"),[A,j]=b.useState({});b.useEffect(()=>{x(0)},[p]);const w=(P,M)=>{x(M)},k=P=>{g(parseInt(P.target.value,10)),x(0)},_=P=>{C(S===P&&E==="asc"?"desc":"asc"),v(P)},I=P=>{const M=P.target.value;y(M),c==null||c(M)},D=P=>{j(M=>({...M,[P]:!M[P]}))},B=r.filter(P=>Object.values(P).some(M=>String(M).toLowerCase().includes(p.toLowerCase()))),R=S?[...B].sort((P,M)=>{const K=P[S],L=M[S];if(K===L)return 0;if(K==null)return 1;if(L==null)return-1;const ae=K<L?-1:1;return E==="asc"?ae:-ae}):B,Y=R.slice(h*m,h*m+m);return a.jsxs(Ke,{sx:{width:"100%",overflow:"hidden"},children:[(o||i)&&a.jsxs(ee,{sx:{p:2,display:"flex",gap:2,alignItems:"center"},children:[o&&a.jsx(Se,{size:"small",placeholder:l,value:p,onChange:I,sx:{minWidth:300},InputProps:{startAdornment:a.jsx(qo,{sx:{mr:1,color:"text.secondary"}})}}),i&&a.jsx(xt,{title:"Refresh data",children:a.jsx(st,{onClick:i,disabled:s,children:a.jsx(On,{})})})]}),a.jsx(Jt,{children:a.jsxs(Vt,{stickyHeader:!0,children:[a.jsx(Wt,{children:a.jsx(Ge,{children:e.map(P=>a.jsx(Q,{sortDirection:S===P.id?E:!1,children:P.sortable?a.jsx(Nx,{active:S===P.id,direction:S===P.id?E:"asc",onClick:()=>_(P.id),children:P.label}):P.label},P.id))})}),a.jsx(Ht,{children:s?a.jsx(Ge,{children:a.jsx(Q,{colSpan:e.length,align:"center",sx:{py:4},children:a.jsx(vr,{})})}):!R||R.length===0?a.jsx(Ge,{children:a.jsxs(Q,{colSpan:e.length,align:"center",sx:{py:4},children:[a.jsx(V,{variant:"body1",color:"text.secondary",children:"No data available"}),i&&a.jsxs(ee,{mt:2,children:[a.jsx(V,{variant:"body2",color:"text.secondary",mb:1,children:"Click refresh to try loading data again"}),a.jsx(st,{onClick:i,children:a.jsx(On,{})})]})]})}):Y.map((P,M)=>a.jsxs(it.Fragment,{children:[a.jsxs(Ge,{hover:!0,children:[e.map(K=>a.jsx(Q,{children:K.format?K.format(P[K.id],P):P[K.id]},K.id)),f&&u&&a.jsx(Q,{children:a.jsx(st,{onClick:()=>D(P.id),children:A[P.id]?"-":"+"})})]}),f&&u&&A[P.id]&&a.jsx(Ge,{children:a.jsx(Q,{colSpan:e.length,children:u(P)})})]},M))})]})}),a.jsx(rf,{rowsPerPageOptions:n,component:"div",count:R.length,rowsPerPage:m,page:h,onPageChange:w,onRowsPerPageChange:k})]})}const Kr=({error:e,message:r,title:t,resetError:n,onRetry:s,className:i=""})=>{const[o,l]=b.useState(0),[c,d]=b.useState(!1),[u,f]=b.useState("unknown");if(r)return a.jsxs("div",{className:`error-message ${i}`,children:[t&&a.jsx("h4",{children:t}),a.jsx("p",{children:r}),s&&a.jsx("button",{onClick:()=>s(),className:"retry-button",style:{marginTop:"15px",padding:"8px 16px",backgroundColor:"#4a6da7",color:"white",border:"none",borderRadius:"4px",cursor:"pointer"},children:"Try Again"})]});const h=(e==null?void 0:e.status)==="network_error",x=h&&!(e!=null&&e.isOffline),m=()=>e?typeof e=="string"?e:e.message?e.message:h?e.isOffline?"Your device appears to be offline. Please check your internet connection.":"Cannot connect to server. Please check if the backend server is running.":"An unexpected error occurred.":"",g=async()=>{if(!s&&!n)return;d(!0),l(3);const p=setInterval(()=>{l(y=>y<=1?(clearInterval(p),0):y-1)},1e3);setTimeout(async()=>{if(s)try{await s()}catch(y){console.error("Retry failed:",y)}else n&&n();d(!1)},3e3)};return b.useEffect(()=>{x&&Et.fallbackApiUrl&&(async()=>{try{await Sn.get(`${Et.fallbackApiUrl}/api/health`),f("available")}catch{f("unavailable")}})()},[x]),e?a.jsxs("div",{className:`bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative ${i}`,role:"alert",children:[a.jsx("strong",{className:"font-bold",children:"Error: "}),a.jsx("span",{className:"block sm:inline",children:m()}),h&&a.jsxs("div",{className:"mt-3",children:[e.isOffline?a.jsx("p",{className:"text-sm",children:"Your browser reports that you are currently offline. Please check your internet connection and try again."}):a.jsxs("div",{children:[a.jsx("p",{className:"text-sm mb-2",children:"The application cannot reach the server. This could be due to:"}),a.jsxs("ul",{className:"list-disc pl-5 text-sm mb-3",children:[a.jsx("li",{children:"The server is not running"}),a.jsx("li",{children:"There's a network issue between your browser and the server"}),a.jsx("li",{children:"A firewall is blocking the connection"}),a.jsx("li",{children:"The server URL is incorrect"})]}),u!=="unknown"&&a.jsxs("div",{className:"text-sm mb-3",children:[a.jsxs("p",{children:["Backup server status: "," ",u==="available"?a.jsx("span",{className:"text-green-600 font-semibold",children:"Available"}):a.jsx("span",{className:"text-red-600 font-semibold",children:"Unavailable"})]}),u==="available"&&a.jsx("p",{className:"mt-1",children:"The system will automatically try to use the backup server for your requests."})]})]}),n&&a.jsx("button",{onClick:g,disabled:c,className:`mt-2 px-4 py-2 rounded text-white ${c?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:c?`Retrying in ${o}s...`:"Retry Request"})]}),!h&&e.originalError&&a.jsxs("details",{className:"mt-3 text-sm",children:[a.jsx("summary",{className:"cursor-pointer text-gray-600",children:"View technical details"}),a.jsx("pre",{className:"mt-2 bg-gray-100 p-2 rounded overflow-auto max-h-40 text-xs",children:JSON.stringify(e.originalError,null,2)})]})]}):null},Ar=({message:e="Loading...",size:r})=>a.jsxs(ee,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:2,minHeight:r?"auto":200},children:[a.jsx(vr,{size:r}),!r&&a.jsx(V,{variant:"body1",color:"text.secondary",children:e})]}),He={ADMIN:"ADMIN",TEACHER:"TEACHER",STAFF:"STAFF",PARENT:"PARENT",STUDENT:"STUDENT",PRINCIPAL:"PRINCIPAL"},Jj={CREATE_STUDENT:[He.ADMIN,He.STAFF],EDIT_STUDENT:[He.ADMIN,He.STAFF],DELETE_STUDENT:[He.ADMIN],VIEW_STUDENT:[He.ADMIN,He.TEACHER,He.STAFF,He.PARENT,He.STUDENT],CREATE_TEACHER:[He.ADMIN],EDIT_TEACHER:[He.ADMIN],DELETE_TEACHER:[He.ADMIN],VIEW_TEACHER:[He.ADMIN,He.STAFF,He.STUDENT],MANAGE_STAFF:[He.ADMIN,He.PRINCIPAL],CREATE_COURSE:[He.ADMIN,He.STAFF],EDIT_COURSE:[He.ADMIN,He.STAFF],DELETE_COURSE:[He.ADMIN],VIEW_COURSE:[He.ADMIN,He.TEACHER,He.STAFF,He.STUDENT],MANAGE_ENROLLMENTS:[He.ADMIN,He.STAFF],VIEW_ENROLLMENTS:[He.ADMIN,He.STAFF,He.TEACHER],MANAGE_ASSIGNMENTS:[He.ADMIN,He.TEACHER],MANAGE_SCHEDULE:[He.ADMIN,He.STAFF],MANAGE_ATTENDANCE:[He.ADMIN,He.TEACHER],VIEW_ATTENDANCE:[He.ADMIN,He.TEACHER,He.STAFF,He.PARENT,He.STUDENT],MANAGE_EXAMS:[He.ADMIN,He.TEACHER],VIEW_EXAM_RESULTS:[He.ADMIN,He.TEACHER,He.STAFF,He.PARENT,He.STUDENT],MANAGE_GRADES:[He.ADMIN,He.TEACHER],MANAGE_FEES:[He.ADMIN,He.STAFF],VIEW_FEES:[He.ADMIN,He.STAFF,He.PARENT,He.STUDENT],MANAGE_ADMISSIONS:[He.ADMIN,He.STAFF],VIEW_ADMISSIONS:[He.ADMIN,He.STAFF],SEND_MESSAGE:[He.ADMIN,He.TEACHER,He.STAFF],VIEW_MESSAGE:[He.ADMIN,He.TEACHER,He.STAFF,He.PARENT,He.STUDENT],VIEW_ADMIN_DASHBOARD:[He.ADMIN,He.STAFF],VIEW_TEACHER_DASHBOARD:[He.TEACHER],VIEW_STUDENT_DASHBOARD:[He.STUDENT],VIEW_PARENT_DASHBOARD:[He.PARENT]},Rr=(e,r)=>{if(!e||!r)return!1;const t=Jj[r]||[];return Object.values(He).includes(e)?t.includes(e):!1},q0=(e,r)=>!r||!Array.isArray(r)?!1:r.some(t=>Rr(e,t)),X0=(e,r)=>!r||!Array.isArray(r)?!1:r.every(t=>Rr(e,t)),ps=({children:e,permission:r,permissions:t=[],requireAll:n=!1})=>{const{user:s}=$n();if(b.useEffect(()=>{r&&console.log(`üîí Checking permission "${r}" for user role: "${(s==null?void 0:s.role)||"unknown"}"`,{hasPermission:s&&s.role?Rr(s.role,r):!1}),t.length>0&&console.log(`üîí Checking permissions [${t.join(", ")}] for user role: "${(s==null?void 0:s.role)||"unknown"}"`,{requireAll:n,hasPermissions:s&&s.role?n?X0(s.role,t):q0(s.role,t):!1})},[s,r,t,n]),!s)return console.warn("‚ö†Ô∏è Permission check failed: No user data available"),null;if(r){const i=s.role?Rr(s.role,r):!1;if(console.log(`üîë Permission "${r}" check result: ${i?"granted ‚úÖ":"denied ‚ùå"}`),!i)return null}if(t.length>0){const i=s.role?n?X0(s.role,t):q0(s.role,t):!1;if(console.log(`üîë Permissions [${t.join(", ")}] check result: ${i?"granted ‚úÖ":"denied ‚ùå"}`),!i)return null}return a.jsx(a.Fragment,{children:e})},Qj=({error:e,onClose:r})=>{const[t,n]=b.useState(!1);return a.jsx("div",{className:"auth-error-dialog",children:a.jsxs("div",{className:"auth-error-content",children:[a.jsx("h3",{children:"Authentication Error"}),a.jsxs("div",{className:"error-message",children:[a.jsx("strong",{children:e.message||"Access Denied"}),a.jsxs("p",{children:["Status code: ",e.status]})]}),e.tokenInfo&&a.jsxs("div",{className:"token-info",children:[a.jsx("h4",{children:"Token Information:"}),a.jsxs("ul",{children:[a.jsxs("li",{children:[a.jsx("strong",{children:"Username:"})," ",e.tokenInfo.username]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Roles:"})," ",e.tokenInfo.roles]}),a.jsxs("li",{children:[a.jsx("strong",{children:"Expiration:"})," ",e.tokenInfo.exp]})]})]}),a.jsxs("div",{className:"troubleshooting",children:[a.jsx("h4",{children:"Troubleshooting:"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Verify you have the required role (ADMIN) for this operation"}),a.jsx("li",{children:"Try logging out and logging back in"}),a.jsx("li",{children:"Check that your token has not expired"})]})]}),a.jsxs("div",{className:"buttons",children:[a.jsx("button",{onClick:()=>n(!t),children:t?"Hide Technical Details":"Show Technical Details"}),a.jsx("button",{onClick:r,children:"Close"})]}),t&&a.jsxs("div",{className:"technical-details",children:[a.jsx("h4",{children:"Technical Details:"}),a.jsx("pre",{children:JSON.stringify(e,null,2)})]})]})})};var _f={},Zj=Lt;Object.defineProperty(_f,"__esModule",{value:!0});var If=_f.default=void 0,e2=Zj($t()),t2=a;If=_f.default=(0,e2.default)((0,t2.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle");var Ff={},r2=Lt;Object.defineProperty(Ff,"__esModule",{value:!0});var yc=Ff.default=void 0,n2=r2($t()),a2=a;yc=Ff.default=(0,n2.default)((0,a2.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error");var Mf={},s2=Lt;Object.defineProperty(Mf,"__esModule",{value:!0});var jg=Mf.default=void 0,i2=s2($t()),o2=a;jg=Mf.default=(0,i2.default)((0,o2.jsx)("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"GetApp");var Pf={},l2=Lt;Object.defineProperty(Pf,"__esModule",{value:!0});var Nf=Pf.default=void 0,c2=l2($t()),d2=a;Nf=Pf.default=(0,c2.default)((0,d2.jsx)("path",{d:"M11 18h2v-2h-2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8m0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4"}),"HelpOutline");const Ei=e=>{let r="",t="";if(e&&e.name){const i=e.name.split(" ");r=i[0]||"",t=i.length>1?i.slice(1).join(" "):""}let n;try{if(e.dateOfBirth)if(/^\d{4}-\d{2}-\d{2}$/.test(e.dateOfBirth))n=e.dateOfBirth;else{const i=e.dateOfBirth.split(/[-/\.]/);let o;i.length===3?(i[0].length===4?o=new Date(`${i[0]}-${i[1]}-${i[2]}`):(o=new Date(`${i[2]}-${i[0]}-${i[1]}`),isNaN(o.getTime())&&(o=new Date(`${i[2]}-${i[1]}-${i[0]}`))),isNaN(o.getTime())?(console.warn(`Invalid date format "${e.dateOfBirth}" for student ${e.name||e.studentId}, using current date`),n=new Date().toISOString().split("T")[0]):n=o.toISOString().split("T")[0]):(o=new Date(e.dateOfBirth),isNaN(o.getTime())?(console.warn(`Invalid date format "${e.dateOfBirth}" for student ${e.name||e.studentId}, using current date`),n=new Date().toISOString().split("T")[0]):n=o.toISOString().split("T")[0])}else n=new Date().toISOString().split("T")[0]}catch(i){console.warn(`Error parsing date ${e.dateOfBirth} for student ${e.name||e.studentId}: ${i==null?void 0:i.message}`),n=new Date().toISOString().split("T")[0]}const s=parseInt(e.grade||"0",10);return{id:e.id,studentId:e.studentId||`ST${Date.now().toString().slice(-6)}`,firstName:r||"First",lastName:t||"Last",grade:isNaN(s)?1:s,section:e.section||"A",email:e.email||`student${Date.now()}@example.com`,contactNumber:e.phoneNumber||e.parentPhone||"0000000000",dateOfBirth:n,status:e.status||"ACTIVE",address:e.address||"Address not provided",guardianName:e.parentName||"Guardian",guardianContact:e.parentPhone||"0000000000",guardianEmail:e.parentEmail||e.email||"",guardianOccupation:e.guardianOccupation||"",guardianOfficeAddress:e.guardianOfficeAddress||"",aadharNumber:e.aadharNumber||"",udiseNumber:e.udiseNumber||"",houseAlloted:e.houseAlloted||"",guardianAnnualIncome:parseFloat(e.guardianAnnualIncome||"0")||0,previousSchool:e.previousSchool||"",tcNumber:e.tcNumber||"",tcReason:e.tcReason||"",tcDate:e.tcDate||"",whatsappNumber:e.whatsappNumber||"",subjects:e.subjects||"",transportMode:e.transportMode||"",busRouteNumber:e.busRouteNumber||"",admissionDate:e.admissionDate||new Date().toISOString().split("T")[0],bloodGroup:e.bloodGroup||"",gender:e.gender&&["MALE","FEMALE","OTHER"].includes(e.gender.toUpperCase())?e.gender.toUpperCase():"MALE",medicalConditions:e.medicalConditions||""}},Tn=e=>{var r;return{id:e.id,studentId:e.studentId,name:`${e.firstName} ${e.lastName}`.trim(),grade:e.grade.toString(),section:e.section,email:e.email,phoneNumber:e.contactNumber,dateOfBirth:e.dateOfBirth,status:e.status,address:e.address,parentName:e.guardianName,parentPhone:e.guardianContact,parentEmail:e.guardianEmail,guardianOccupation:e.guardianOccupation,guardianOfficeAddress:e.guardianOfficeAddress,aadharNumber:e.aadharNumber,udiseNumber:e.udiseNumber,houseAlloted:e.houseAlloted,guardianAnnualIncome:(r=e.guardianAnnualIncome)==null?void 0:r.toString(),previousSchool:e.previousSchool,tcNumber:e.tcNumber,tcReason:e.tcReason,tcDate:e.tcDate,whatsappNumber:e.whatsappNumber,subjects:e.subjects,transportMode:e.transportMode,busRouteNumber:e.busRouteNumber,admissionDate:e.admissionDate,bloodGroup:e.bloodGroup,gender:e.gender,medicalConditions:e.medicalConditions}};async function Od(e,r,t){const n=JSON.parse(localStorage.getItem("user")||sessionStorage.getItem("user")||"{}");if(n&&n.role==="ADMIN"){const o=localStorage.getItem("token")||sessionStorage.getItem("token");if(o)try{return await Sn({method:e,url:`${Et.apiUrl}${r}`,data:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}})}catch(l){throw console.error("Error with admin token:",l),l}}const i=localStorage.getItem("adminToken")||sessionStorage.getItem("adminToken");if(i)try{return await Sn({method:e,url:`${Et.apiUrl}${r}`,data:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`}})}catch(o){throw console.error(`Error with admin token: ${o}`),sessionStorage.removeItem("adminToken"),localStorage.removeItem("adminToken"),new Error("Admin session expired. Please try again.")}else{const o=prompt("Admin username required for this action:"),l=prompt("Admin password required for this action:");if(!o||!l)throw new Error("Admin credentials required for this operation");try{const c=await Sn.post(`${Et.apiUrl}/api/auth/admin-login`,{username:o,password:l});if(c.data&&c.data.token)return sessionStorage.setItem("adminToken",c.data.token),await Sn({method:e,url:`${Et.apiUrl}${r}`,data:t,headers:{"Content-Type":"application/json",Authorization:`Bearer ${c.data.token}`}})}catch(c){throw console.error("Admin authentication failed:",c),new Error("Admin authentication failed. Please try again with correct credentials.")}}}const zr={getAll:async()=>(await ge.get("/api/students")).map(Tn),getAllStudents:async()=>(await ge.get("/api/students")).map(Tn),getById:async e=>{const r=await ge.get(`/api/students/${e}`);return Tn(r)},create:async e=>{const r=Ei(e),t=await ge.post("/api/students",r);return Tn(t)},update:async(e,r)=>{const t=Ei({...r,id:e}),n=await ge.put(`/api/students/${e}`,t);return Tn(n)},updateStatus:async(e,r)=>{try{console.log(`Updating student ${e} status to: ${r}`);const n={...await ge.get(`/api/students/${e}`),status:r},s=await ge.put(`/api/students/${e}`,n);return Tn(s)}catch(t){throw console.error("Error updating student status:",t),t}},delete:async e=>{try{return console.log(`Deleting student with ID: ${e}`),await ge.delete(`/api/students/${e}`),{success:!0,message:"Student deleted successfully"}}catch(r){throw console.error("Error deleting student:",r),r}},getByGrade:async e=>(await ge.get(`/api/students/grade/${e}`)).map(Tn),getByGradeAndSection:async(e,r)=>{const t=typeof e=="string"?e:String(e);return(await ge.get(`/api/students/grade/${encodeURIComponent(t)}/section/${encodeURIComponent(r)}`)).map(Tn)},getByStatus:async e=>(await ge.get(`/api/students/status/${e}`)).map(Tn),search:async e=>(await ge.get(`/api/students/search?query=${e}`)).map(Tn),createWithElevatedPermissions:async e=>{const r=Ei(e),t=await Od("post","/api/students",r);return t!=null&&t.data?Tn(t.data):null},updateWithElevatedPermissions:async(e,r)=>{const t=Ei({...r,id:e}),n=await Od("put",`/api/students/${e}`,t);return n!=null&&n.data?Tn(n.data):null},createBulk:async e=>{const r=e.map(Ei);return(await ge.post("/api/students/bulk",{students:r,expectedCount:e.length})).map(Tn)},createBulkWithElevatedPermissions:async e=>{const r=e.map(Ei),t=await Od("post","/api/students/bulk",{students:r,expectedCount:e.length});return t!=null&&t.data?t.data.map(Tn):[]}},Hn={getAllApplications:async()=>{const e=await ge.get("/api/admissions");return console.log("API Response for getAllApplications:",e),(Array.isArray(e)?e:[]).map(Nl)},getApplicationById:async e=>{try{console.log(`Fetching admission details for ID: ${e}`);const r=await ge.get(`/api/admissions/${e}`);if(console.log("Admission details from backend:",r),!r||typeof r!="object")throw new Error("Invalid admission data received from server");const t=Nl(r);if(r.studentId)try{console.log(`Admission has associated student ID: ${r.studentId}, fetching student details`);const n=await zr.getById(r.studentId);console.log("Student data retrieved:",n),n&&n.address&&(console.log("Found address in student record:",n.address),t.address=n.address)}catch(n){console.warn("Could not fetch student data:",n)}else console.log("No associated student ID found for this admission");return t}catch(r){throw console.error(`Failed to get admission details for ID ${e}:`,r),r}},createApplication:e=>{var n;let r=e.dateOfBirth;if(r&&!r.includes("-")){const s=new Date(r);isNaN(s.getTime())||(r=s.toISOString().split("T")[0])}const t={applicantName:e.studentName,dateOfBirth:r,email:e.email,contactNumber:e.contactNumber,guardianName:e.parentName,guardianContact:e.contactNumber,guardianEmail:e.email,address:e.address,gradeApplying:parseInt(e.gradeApplying,10)||1,previousGrade:e.previousGrade||"Not Available",previousPercentage:((n=e.previousPercentage)==null?void 0:n.toString())||"75.0",bloodGroup:e.bloodGroup||"",medicalConditions:e.medicalConditions||"",documents:e.documents,documentsFormat:e.documentsFormat};return console.log("Sending admission request with structured data:",t),console.log("Date format checking - original:",e.dateOfBirth,"formatted:",r),console.log("Address value being sent:",e.address),ge.post("/api/admissions",t)},updateApplication:async(e,r)=>{var n;if(console.log(`Updating admission application with ID: ${e}`,r),!localStorage.getItem("token"))throw new Error("You must be logged in to update applications");try{const s={applicantName:r.studentName,dateOfBirth:r.dateOfBirth,email:r.email,contactNumber:r.contactNumber,guardianName:r.parentName,guardianContact:r.contactNumber,guardianEmail:r.email,address:r.address,gradeApplying:parseInt(r.gradeApplying,10),previousSchool:r.previousSchool||"Not Available",previousGrade:r.previousGrade||"Not Available",previousPercentage:((n=r.previousPercentage)==null?void 0:n.toString())||"75.0",bloodGroup:r.bloodGroup||"",medicalConditions:r.medicalConditions||"",documents:r.documents,documentsFormat:r.documentsFormat};console.log("Sending general update request with data:",s);const i=await ge.put(`/api/admissions/${e}`,s);return console.log("Update response:",i),i}catch(s){throw console.error("Update attempt failed:",s),s}},updateStatus:async(e,r,t)=>{console.log(`Updating admission status ${e} to ${r}`);const n=new URLSearchParams;return n.append("status",r),t&&n.append("remarks",t),ge.put(`/api/admissions/${e}/status?${n.toString()}`)},getByStatus:async e=>{const r=await ge.get(`/api/admissions/status/${e}`);return Array.isArray(r)?r:[]},searchApplications:async e=>{const r=await ge.get(`/api/admissions/search?query=${e}`);return Array.isArray(r)?r:[]},getByDateRange:async(e,r)=>{const t=await ge.get(`/api/admissions/date-range?startDate=${e}&endDate=${r}`);return Array.isArray(t)?t:[]},getByGrade:async e=>{const r=await ge.get(`/api/admissions/grade/${e}`);return Array.isArray(r)?r:[]},deleteApplication:e=>ge.delete(`/api/admissions/${e}`),processAdmission:async(e,r,t)=>{console.log(`Processing admission ${e} with action: ${r}`);try{const n=r==="APPROVE"?"APPROVED":"REJECTED",s=new URLSearchParams;s.append("status",n),r==="REJECT"&&t&&s.append("remarks",t);const i=await ge.put(`/api/admissions/${e}/status?${s.toString()}`);return console.log(`Admission ${e} processed with response:`,i),i}catch(n){throw console.error(`Error processing admission ${e}:`,n),n}},createStudentFromAdmission:async(e,r={})=>{console.log(`Creating student from admission ${e}`);const t=await Hn.getApplicationById(e);if(!t)throw new Error(`Admission record ${e} not found`);if(t.status!=="APPROVED")throw new Error(`Cannot create student from admission with status ${t.status}`);return{studentId:`STU${new Date().getFullYear()}${Math.floor(1e3+Math.random()*9e3)}`,name:t.studentName,email:t.email,phoneNumber:t.contactNumber,dateOfBirth:t.dateOfBirth,grade:String(parseInt(t.gradeApplying,10)),section:r.section||"A",address:t.address||"",parentName:t.parentName,parentPhone:t.contactNumber,parentEmail:t.email,status:"ACTIVE",admissionDate:new Date().toISOString().split("T")[0],gender:r.gender||"MALE",bloodGroup:t.bloodGroup||"",medicalConditions:t.medicalConditions||"",...r}},hasStudentRecord:async e=>{try{const r=await ge.get(`/api/admissions/${e}/student-status`);return r&&r.hasStudent}catch(r){return console.warn(`Error checking if admission ${e} has student record:`,r),!1}},getDebugInfo:async()=>{const e=localStorage.getItem("user"),r=localStorage.getItem("token");let t=null,n=null;try{if(e&&(t=JSON.parse(e)),r){const s=r.split(".");if(s.length===3){const i=JSON.parse(atob(s[1]));n={exp:new Date(i.exp*1e3).toLocaleString(),roles:i.roles||i.authorities||i.role||"Not found in token",sub:i.sub||i.username}}}}catch(s){console.error("Error parsing user/token data",s)}return{user:t,token:r?`${r.substring(0,20)}...`:null,tokenInfo:n,endpoints:{getAllApplications:"/api/admissions",getApplicationById:"/api/admissions/:id",createApplication:"/api/admissions",updateApplication:"/api/admissions/:id",updateStatus:"/api/admissions/:id/status",deleteApplication:"/api/admissions/:id",getByStatus:"/api/admissions/status/:status",searchApplications:"/api/admissions/search?query=:query",getByDateRange:"/api/admissions/date-range",getByGrade:"/api/admissions/grade/:grade",checkStudentStatus:"/api/admissions/:id/student-status"}}},submitBulkApplications:async e=>{const r={admissions:e,expectedCount:e.length},t=await ge.post("/api/admissions/bulk",r);return console.log("Bulk submission response:",t),Array.isArray(t)?t.map(Nl):[]},uploadCsv:async e=>{const r=new FormData;r.append("file",e);try{const t=await ge.post("/api/admissions/upload-csv",r,{headers:{"Content-Type":"multipart/form-data"}});return console.log("CSV upload response:",t),Array.isArray(t)?t.map(Nl):[]}catch(t){throw console.error("Error uploading CSV:",t),t}},downloadCsvTemplate:async()=>{try{const e=await ge.get("/api/admissions/download-template",{responseType:"blob"}),r=new Blob([e]),t=window.URL.createObjectURL(r),n=document.createElement("a");return n.href=t,n.setAttribute("download","admission_template.csv"),document.body.appendChild(n),n.click(),document.body.removeChild(n),!0}catch(e){throw console.error("Error downloading CSV template:",e),e}}};function Nl(e){var n;console.log("Transforming response to application:",e);const r=["PENDING","UNDER_REVIEW","APPROVED","REJECTED","WAITLISTED","CANCELLED","ENROLLED"],t=e.status&&r.includes(e.status)?e.status:"PENDING";return{id:e.id,studentName:e.applicantName,dateOfBirth:e.dateOfBirth,gradeApplying:((n=e.gradeApplying)==null?void 0:n.toString())||"",parentName:e.guardianName,contactNumber:e.contactNumber||e.guardianContact||"",email:e.email||e.guardianEmail||"",address:e.address||"",status:t,submissionDate:e.applicationDate,rejectionReason:e.rejectionReason,bloodGroup:e.bloodGroup||"",medicalConditions:e.medicalConditions||"",previousSchool:e.previousSchool||"",previousGrade:e.previousGrade||"",previousPercentage:e.previousPercentage,documents:e.documents,documentsFormat:e.documentsFormat||""}}const u2=({open:e,onClose:r,onSuccess:t})=>{const[n,s]=b.useState(null),[i,o]=b.useState(!1),[l,c]=b.useState(null),[d,u]=b.useState([]),[f,h]=b.useState(!1),x=d.filter(v=>!v.status.toString().includes("Error")),m=d.filter(v=>v.status.toString().includes("Error")),g=v=>{if(v.target.files&&v.target.files[0]){const E=v.target.files[0];if(!E.name.toLowerCase().endsWith(".csv")){c("Please upload a CSV file.");return}s(E),c(null)}},p=async()=>{try{await Hn.downloadCsvTemplate()}catch(v){c("Failed to download template. Please try again."),console.error("Template download error:",v)}},y=async()=>{if(!n){c("Please select a file to upload.");return}o(!0),c(null);try{const v=await Hn.uploadCsv(n);u(v),h(!0),v.filter(E=>!E.status.toString().includes("Error")).length>0&&t(v.filter(E=>!E.status.toString().includes("Error")))}catch(v){console.error("Upload error:",v),c(v instanceof Error?v.message:"An error occurred during upload.")}finally{o(!1)}},S=()=>{s(null),c(null),u([]),h(!1),r()};return a.jsxs(At,{open:e,onClose:i?void 0:S,maxWidth:"md",fullWidth:!0,children:[a.jsx(Dt,{children:"Bulk Upload Admission Applications"}),a.jsx(Tt,{children:f?a.jsxs(ee,{children:[a.jsxs(pt,{severity:m.length>0?x.length>0?"warning":"error":"success",sx:{mb:2},children:[a.jsx(Mn,{children:m.length===0?"Upload Successful":x.length>0?"Partially Successful":"Upload Failed"}),"Successfully uploaded ",x.length," out of ",d.length," records.",m.length>0&&` ${m.length} records failed to upload.`]}),x.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs(V,{variant:"subtitle1",sx:{mt:2},children:["Successfully uploaded applications (",x.length,")"]}),a.jsx(Ke,{variant:"outlined",sx:{mt:1,maxHeight:200,overflow:"auto"},children:a.jsx(Gn,{dense:!0,children:x.map((v,E)=>a.jsx(Gr,{secondaryAction:a.jsx(If,{color:"success",fontSize:"small"}),children:a.jsx(Fr,{primary:v.studentName,secondary:`Grade: ${v.gradeApplying}, Email: ${v.email}`})},E))})})]}),m.length>0&&a.jsxs(a.Fragment,{children:[a.jsxs(V,{variant:"subtitle1",sx:{mt:2,color:"error.main"},children:["Failed uploads (",m.length,")"]}),a.jsx(Ke,{variant:"outlined",sx:{mt:1,maxHeight:200,overflow:"auto"},children:a.jsx(Gn,{dense:!0,children:m.map((v,E)=>a.jsx(Gr,{secondaryAction:a.jsx(yc,{color:"error",fontSize:"small"}),children:a.jsx(Fr,{primary:v.studentName||"Unknown",secondary:v.status})},E))})})]})]}):a.jsxs(a.Fragment,{children:[a.jsxs(pt,{severity:"info",sx:{mb:2},children:[a.jsx(Mn,{children:"Instructions"}),a.jsx(V,{variant:"body2",children:"Upload a CSV file containing multiple admission applications. Please ensure your CSV file follows the required format."}),a.jsx(ye,{startIcon:a.jsx(jg,{}),onClick:p,variant:"outlined",size:"small",sx:{mt:1},children:"Download Template"})]}),l&&a.jsx(pt,{severity:"error",sx:{mb:2},children:l}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center",mt:2},children:[a.jsx("input",{type:"file",accept:".csv",id:"csv-upload-input",onChange:g,style:{display:"none"}}),a.jsx("label",{htmlFor:"csv-upload-input",children:a.jsx(ye,{variant:"contained",component:"span",startIcon:a.jsx(ti,{}),disabled:i,children:"Select CSV File"})}),n&&a.jsx(V,{variant:"body2",sx:{ml:2},children:n.name}),a.jsx(xt,{title:"Use the template provided to ensure your data is formatted correctly.",children:a.jsx(st,{sx:{ml:1},children:a.jsx(Nf,{})})})]}),i&&a.jsx(ee,{sx:{width:"100%",mt:2},children:a.jsx(Ui,{})})]})}),a.jsx(Ct,{children:f?a.jsx(ye,{onClick:S,variant:"contained",children:"Close"}):a.jsxs(a.Fragment,{children:[a.jsx(ye,{onClick:S,disabled:i,children:"Cancel"}),a.jsx(ye,{onClick:y,variant:"contained",disabled:!n||i,startIcon:a.jsx(ti,{}),children:"Upload"})]})})]})},Rf={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,phone:/^\+?[\d\s-]{10,}$/,name:/^[a-zA-Z\s-']{2,}$/},f2=e=>Rf.email.test(e),h2=e=>Rf.phone.test(e),K0=e=>Rf.name.test(e),m2=e=>!isNaN(Date.parse(e)),p2=e=>{const r={};return(!e.studentName||!K0(e.studentName))&&(r.studentName="Please enter a valid student name"),(!e.dateOfBirth||!m2(e.dateOfBirth))&&(r.dateOfBirth="Please enter a valid date of birth"),e.gradeApplying||(r.gradeApplying="Grade is required"),(!e.parentName||!K0(e.parentName))&&(r.parentName="Please enter a valid parent/guardian name"),(!e.contactNumber||!h2(e.contactNumber))&&(r.contactNumber="Please enter a valid phone number"),(!e.email||!f2(e.email))&&(r.email="Please enter a valid email address"),(!e.address||e.address.length<10)&&(r.address="Please enter a complete address (minimum 10 characters)"),r},Of=({open:e,onClose:r,title:t,children:n,onSubmit:s,submitLabel:i="Submit",cancelLabel:o="Cancel",loading:l=!1,maxWidth:c="sm",hideActions:d=!1,fullWidth:u=!0,disableSubmitButton:f=!1})=>a.jsxs(At,{open:e,onClose:l?void 0:r,maxWidth:c,fullWidth:u,children:[a.jsx(Dt,{children:a.jsxs(ee,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[a.jsx(V,{variant:"h6",children:t}),!l&&a.jsx(st,{onClick:r,size:"small",children:a.jsx(Rx,{})})]})}),a.jsx(Tt,{dividers:!0,children:n}),!d&&a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,disabled:l,children:o}),s&&a.jsx(ye,{onClick:s,variant:"contained",color:"primary",disabled:l||f,children:i})]})]}),x2=["1","2","3","4","5","6","7","8","9","10","11","12"],g2=["A","B","C","D"],y2=["MALE","FEMALE","OTHER"],v2=["A+","A-","B+","B-","AB+","AB-","O+","O-"],b2=({open:e,onClose:r,onSubmit:t,initialData:n,loading:s})=>{const[i,o]=b.useState(n||{studentName:"",firstName:"",lastName:"",dateOfBirth:"",gradeApplying:"1",section:"A",parentName:"",contactNumber:"",email:"",address:"",gender:"MALE",bloodGroup:"",medicalConditions:"",previousSchool:"",previousGrade:"",previousPercentage:"75",status:"PENDING"}),[l,c]=b.useState(!1),[d,u]=b.useState({}),[f,h]=b.useState(!1);b.useEffect(()=>{if(e){const g=(n==null?void 0:n.id)||n&&Object.keys(n).length>0&&n.studentName;if(c(!!g),n&&Object.keys(n).length>0){let p=n.firstName||"",y=n.lastName||"";if((!p||!y)&&n.studentName){const S=n.studentName.split(" ");p=S[0]||"",y=S.length>1?S.slice(1).join(" "):""}o({...n,id:n.id,firstName:p,lastName:y,studentName:n.studentName||"",dateOfBirth:n.dateOfBirth||"",gradeApplying:n.gradeApplying||"1",section:n.section||"A",parentName:n.parentName||"",contactNumber:n.contactNumber||"",email:n.email||"",address:n.address||"",gender:n.gender||"MALE",bloodGroup:n.bloodGroup||"",medicalConditions:n.medicalConditions||"",previousSchool:n.previousSchool||"",previousGrade:n.previousGrade||"",previousPercentage:String(n.previousPercentage||75),status:n.status||"PENDING"})}else o({studentName:"",firstName:"",lastName:"",dateOfBirth:"",gradeApplying:"1",section:"A",parentName:"",contactNumber:"",email:"",address:"",gender:"MALE",bloodGroup:"",medicalConditions:"",previousSchool:"",previousGrade:"",previousPercentage:"75",status:"PENDING"});u({})}},[e,n]),b.useEffect(()=>{if(i.firstName||i.lastName){const g=`${i.firstName||""} ${i.lastName||""}`.trim();o(p=>({...p,studentName:g}))}},[i.firstName,i.lastName]);const x=g=>p=>{o(y=>({...y,[g]:p.target.value})),d[g]&&u(y=>({...y,[g]:""}))},m=()=>{const g={...i,submissionDate:i.submissionDate||new Date().toISOString().split("T")[0]},p=p2(g);if(Object.keys(p).length>0){u(p);return}t(g)};return a.jsx(Of,{open:e,onClose:r,title:l?"Edit Application":"New Admission Application",onSubmit:m,submitLabel:l?"Update":"Submit",loading:s,maxWidth:"md",fullWidth:!0,children:a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,children:a.jsxs(Ke,{elevation:1,sx:{p:3,mb:2,borderRadius:2,borderTop:"5px solid #1976d2",bgcolor:"#f5f9ff"},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center",mb:3,pb:1,borderBottom:"1px solid #e0e0e0"},children:[a.jsx(za,{sx:{fontSize:28,mr:1,color:"#1976d2"}}),a.jsx(V,{variant:"h6",fontWeight:"500",color:"#1976d2",children:"STUDENT INFORMATION"})]}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"First Name",value:i.firstName||"",onChange:x("firstName"),error:!!d.firstName,helperText:d.firstName,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Last Name",value:i.lastName||"",onChange:x("lastName"),error:!!d.lastName,helperText:d.lastName,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Date of Birth",type:"date",value:i.dateOfBirth||"",onChange:x("dateOfBirth"),error:!!d.dateOfBirth,helperText:d.dateOfBirth||"Select date from calendar",InputLabelProps:{shrink:!0},required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,required:!0,children:[a.jsx(ot,{id:"gender-label",children:"Gender"}),a.jsx(tt,{labelId:"gender-label",value:i.gender||"MALE",onChange:x("gender"),label:"Gender",children:y2.map(g=>a.jsx(Te,{value:g,children:g},g))})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,select:!0,label:"Grade Applying",value:i.gradeApplying||"",onChange:x("gradeApplying"),error:!!d.gradeApplying,helperText:d.gradeApplying,required:!0,children:x2.map(g=>a.jsxs(Te,{value:g,children:["Grade ",g]},g))})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,select:!0,label:"Section",value:i.section||"A",onChange:x("section"),children:g2.map(g=>a.jsxs(Te,{value:g,children:["Section ",g]},g))})})]})]})}),a.jsx(X,{item:!0,xs:12,children:a.jsxs(Ke,{elevation:1,sx:{p:3,mb:2,borderRadius:2,borderTop:"5px solid #f50057",bgcolor:"#fff9fb"},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center",mb:3,pb:1,borderBottom:"1px solid #e0e0e0"},children:[a.jsx(zo,{sx:{fontSize:28,mr:1,color:"#f50057"}}),a.jsx(V,{variant:"h6",fontWeight:"500",color:"#f50057",children:"PARENT/GUARDIAN INFORMATION"})]}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,label:"Parent/Guardian Name",value:i.parentName||"",onChange:x("parentName"),error:!!d.parentName,helperText:d.parentName||"Full name of parent or guardian",required:!0})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(ee,{sx:{p:2,border:"1px dashed #f50057",borderRadius:1,mb:2},children:[a.jsx(V,{variant:"subtitle2",fontWeight:"500",color:"#f50057",sx:{mb:2},children:"Contact Information"}),a.jsxs(tr,{spacing:2,children:[a.jsx(Se,{fullWidth:!0,label:"Phone Number",value:i.contactNumber||"",onChange:x("contactNumber"),error:!!d.contactNumber,helperText:d.contactNumber||"e.g. +1234567890",required:!0}),a.jsx(Se,{fullWidth:!0,label:"Email Address",type:"email",value:i.email||"",onChange:x("email"),error:!!d.email,helperText:d.email,required:!0})]})]})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(ee,{sx:{p:2,border:"1px dashed #f50057",borderRadius:1},children:[a.jsx(V,{variant:"subtitle2",fontWeight:"500",color:"#f50057",sx:{mb:2},children:"Residence Information"}),a.jsx(Se,{fullWidth:!0,label:"Home Address",multiline:!0,rows:4,value:i.address||"",onChange:x("address"),error:!!d.address,helperText:d.address||"Complete residential address",required:!0})]})})]})]})}),a.jsx(X,{item:!0,xs:12,children:a.jsxs(Ke,{elevation:1,sx:{p:3,borderRadius:2,borderTop:"5px solid #4caf50",bgcolor:"#f5fbf5"},children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",pb:1,borderBottom:"1px solid #e0e0e0",mb:2},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(Xa,{sx:{fontSize:28,mr:1,color:"#4caf50"}}),a.jsx(V,{variant:"h6",fontWeight:"500",color:"#4caf50",children:"ADDITIONAL INFORMATION"})]}),a.jsx(V,{variant:"body2",color:"primary",sx:{cursor:"pointer",fontWeight:500,textDecoration:"underline"},onClick:()=>h(!f),children:f?"Hide Additional Fields":"Show More Fields"})]}),f&&a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(Se,{fullWidth:!0,select:!0,label:"Blood Group",value:i.bloodGroup||"",onChange:x("bloodGroup"),children:[a.jsx(Te,{value:"",children:"Not Specified"}),v2.map(g=>a.jsx(Te,{value:g,children:g},g))]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Medical Conditions",multiline:!0,rows:2,value:i.medicalConditions||"",onChange:x("medicalConditions")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Previous School",value:i.previousSchool||"",onChange:x("previousSchool")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Previous Grade",value:i.previousGrade||"",onChange:x("previousGrade")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Previous Percentage/GPA",type:"number",inputProps:{min:0,max:100,step:.1},value:i.previousPercentage||75,onChange:x("previousPercentage")})})]})]})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Ma,{sx:{textAlign:"center"},children:"Fields marked with * are required. Submission date will be set automatically."})})]})})},Eg=e=>{var r;if(e.isAxiosError){const t=e;if(!t.response)return"Network error. Please check your connection.";const n=t.response.status,s=(r=t.response.data)==null?void 0:r.message;switch(n){case 400:return s||"Invalid request. Please check your input.";case 401:return"Authentication required. Please log in.";case 403:return"You do not have permission to perform this action.";case 404:return s||"Resource not found.";case 409:return s||"Conflict with existing data.";case 422:return s||"Invalid input data.";case 500:return"Internal server error. Please try again later.";default:return s||"An unexpected error occurred."}}return e instanceof Error?e.message:"An unexpected error occurred."},Ld=new Map,S2=5*60*1e3;function Gt(e,r={}){const[t,n]=b.useState(null),[s,i]=b.useState(!0),[o,l]=b.useState(null),{showNotification:c}=dr(),{cacheKey:d,cacheDuration:u=S2,onSuccess:f,onError:h,showErrorNotification:x=!0,dependencies:m=[],skip:g=!1}=r;b.useEffect(()=>{g?i(!1):p()},Array.isArray(m)?m:[m]);const p=async(v=!1)=>{if(!g){if(d&&!v){const E=Ld.get(d);if(E&&Date.now()-E.timestamp<u){n(E.data),i(!1);return}}try{i(!0),l(null);const E=await e();n(E),d&&Ld.set(d,{data:E,timestamp:Date.now()}),f==null||f(E)}catch(E){const C=Eg(E);l(C),h==null||h(E),x&&c({type:"error",message:C})}finally{i(!1)}}};return b.useEffect(()=>{m.length===0&&!g&&p()},[]),{data:t,loading:s,error:o,refresh:()=>p(!0),refetch:()=>p(!0),clearCache:()=>d&&Ld.delete(d)}}function pr(e,r={}){const[t,n]=b.useState(!1),[s,i]=b.useState(null),{showNotification:o}=dr(),{onSuccess:l,onError:c,showErrorNotification:d=!0}=r,u=async h=>{try{n(!0),i(null);const x=await e(h);return l==null||l(x),x}catch(x){const m=Eg(x);throw i(m),c==null||c(x),d&&o({type:"error",message:m}),x}finally{n(!1)}};return{mutate:u,mutateAsync:u,loading:t,error:s,isLoading:t}}const kg=e=>new Date(e).toLocaleDateString(),w2=(e,r,t)=>({id:"actions",label:"Actions",sortable:!1,align:"right",format:(n,s)=>s?a.jsxs(ee,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[e&&a.jsx(xt,{title:"Edit",children:a.jsx(st,{size:"small",onClick:()=>{s&&e(s)},sx:{mr:.5},children:a.jsx(hl,{fontSize:"small"})})}),r&&s&&a.jsx(ye,{size:"small",color:"error",onClick:()=>{s&&r(s)},children:"Delete"}),t&&s&&t(s)]}):(console.warn("Action column received undefined row data"),null)}),ho=[{value:"PENDING",label:"Submitted"},{value:"UNDER_REVIEW",label:"Under Review"},{value:"APPROVED",label:"Approved"},{value:"REJECTED",label:"Rejected"},{value:"WAITLISTED",label:"Waitlisted"}],j2=Array.from({length:12},(e,r)=>({value:(r+1).toString(),label:`Grade ${r+1}`})),E2=()=>{const{user:e}=$n(),{showNotification:r}=dr(),[t,n]=b.useState(null),[s,i]=b.useState(!1),[o,l]=b.useState(!1),[c,d]=b.useState(!1),[u,f]=b.useState([]),[h,x]=b.useState(null),[m,g]=b.useState(!1),[p,y]=b.useState(null),[S,v]=b.useState([]),[E,C]=b.useState("PENDING"),[A,j]=b.useState(!1),[w,k]=b.useState(""),[_,I]=b.useState(()=>Promise.resolve()),[D,B]=b.useState(!1),[R,Y]=b.useState({name:"",grade:[],status:[],dateRange:{start:"",end:""}}),[P,M]=b.useState(!1),[K,L]=b.useState(!1);b.useEffect(()=>{console.log("üîç Admissions component mounted"),console.log("üë§ User:",e);const ue=localStorage.getItem("token");if(ue)try{const Me=JSON.parse(atob(ue.split(".")[1]));console.log("üîë Token payload:",{exp:new Date(Me.exp*1e3).toLocaleString(),roles:Me.roles||Me.authorities||Me.role||"Not found in token",sub:Me.sub||Me.username})}catch{console.log("‚ö†Ô∏è Could not parse token")}return Hn.getDebugInfo().then(Me=>{console.log("üìù API connection info:",Me)}),()=>{console.log("üîç Admissions component unmounted")}},[e]);const{data:ae,loading:Z,error:T,refresh:N}=Gt(()=>(console.log("üîÑ Calling admissionService.getAllApplications() with multiple fallbacks"),console.log("üîë Current user role:",e==null?void 0:e.role),console.log("üîí Auth token present:",!!localStorage.getItem("token")),Hn.getAllApplications()),{onError:ue=>(console.error("‚ùå Error in useApi for admissions:",ue),x(ue),[])}),H=b.useMemo(()=>ae?P?ae.filter(ue=>{var Ye,Ve,Xe,_t;const Me=!R.name||((Ye=ue.studentName)==null?void 0:Ye.toLowerCase().includes(R.name.toLowerCase()))||((Ve=ue.email)==null?void 0:Ve.toLowerCase().includes(R.name.toLowerCase()))||((Xe=ue.parentName)==null?void 0:Xe.toLowerCase().includes(R.name.toLowerCase())),ke=R.grade.length===0||R.grade.includes((_t=ue.gradeApplying)==null?void 0:_t.toString()),Ae=R.status.length===0||R.status.includes(ue.status);let Ue=!0;if(R.dateRange.start||R.dateRange.end){const ct=ue.submissionDate?new Date(ue.submissionDate):null;if(ct){if(R.dateRange.start){const dt=new Date(R.dateRange.start);ct<dt&&(Ue=!1)}if(R.dateRange.end&&Ue){const dt=new Date(R.dateRange.end);dt.setHours(23,59,59),ct>dt&&(Ue=!1)}}}return Me&&ke&&Ae&&Ue}):ae:[],[ae,R,P]),G=()=>{n({studentName:"",dateOfBirth:"",gradeApplying:"",parentName:"",contactNumber:"",email:"",address:"",status:"PENDING"}),i(!0)},q=async ue=>{if(console.log("Edit clicked for application:",ue),!ue){console.error("Error: Attempted to edit undefined application");return}g(!0);try{const Me={...ue,id:ue.id,studentName:ue.studentName||"",dateOfBirth:ue.dateOfBirth||"2005-01-01",gradeApplying:ue.gradeApplying||"1",parentName:ue.parentName!=="Not available"?ue.parentName:"",contactNumber:ue.contactNumber||"",email:ue.email||"",address:ue.address||"",status:ue.status||"PENDING"};if(console.log("Enhanced application object for editing:",Me),n(Me),ue.id)try{const ke=await Hn.getApplicationById(ue.id);console.log("Retrieved detailed application data:",ke),ke&&ke.studentName&&n(ke)}catch(ke){console.warn("Could not fetch complete details, using basic data:",ke)}}catch(Me){console.error("Error preparing application for edit:",Me),r({type:"warning",message:"Could not load complete application details. Some fields may be missing."})}finally{g(!1),i(!0)}},oe=async ue=>{var Me,ke;try{if(ue.id)console.log("Attempting to update application:",ue),await Hn.updateApplication(ue.id,ue),r({type:"success",message:"Application updated successfully"});else{console.log("Submitting application data:",ue);const Ae=[];if(ue.studentName||Ae.push("Student Name"),ue.dateOfBirth||Ae.push("Date of Birth"),ue.gradeApplying||Ae.push("Grade"),ue.parentName||Ae.push("Parent/Guardian Name"),ue.contactNumber||Ae.push("Contact Number"),ue.email||Ae.push("Email"),ue.address||Ae.push("Address"),Ae.length>0)throw new Error(`Missing required fields: ${Ae.join(", ")}`);if(!/^\d{4}-\d{2}-\d{2}$/.test(ue.dateOfBirth))throw new Error("Date of Birth must be in YYYY-MM-DD format");const Ye=await Hn.createApplication(ue);console.log("Submission successful, response:",Ye),r({type:"success",message:"New application created successfully"})}i(!1),N()}catch(Ae){if(console.error("Error saving application:",Ae),Ae.status===403)y(Ae);else{let Ue=Ae.message||"An error occurred while saving the application";if((ke=(Me=Ae.originalError)==null?void 0:Me.response)!=null&&ke.data&&(console.log("Backend validation errors:",Ae.originalError.response.data),Ae.originalError.response.data.message&&(Ue=`Validation error: ${Ae.originalError.response.data.message}`),Ae.originalError.response.data.errors))try{if(Array.isArray(Ae.originalError.response.data.errors))Ue=`Validation errors: ${Ae.originalError.response.data.errors.map(Ve=>Ve.defaultMessage||Ve.field).join(", ")}`;else if(typeof Ae.originalError.response.data.errors=="object"){const Ye=Ae.originalError.response.data.errors,Ve=[];for(const Xe in Ye)Ye.hasOwnProperty(Xe)&&Ve.push(`${Xe}: ${Ye[Xe]}`);Ve.length>0&&(Ue=`Validation errors: ${Ve.join(", ")}`)}}catch(Ye){console.error("Error parsing validation errors:",Ye)}r({type:"error",message:Ue})}}},de=async(ue,Me)=>{try{g(!0);let ke="";Me==="REJECTED"&&(ke=prompt("Please provide a reason for rejection:")||""),console.log(`Processing admission ${ue.id} with status: ${Me}, reason: ${ke}`);const Ae=Me==="APPROVED"?"APPROVE":"REJECT";if(ue.id!==void 0)await Hn.processAdmission(ue.id,Ae,ke);else throw new Error("Application ID is undefined");r({type:"success",message:`Application status changed to ${Me.toLowerCase()} successfully`}),N()}catch(ke){console.error(`Error updating application status to ${Me}:`,ke),ke.status===403?y(ke):r({type:"error",message:`Failed to update application status: ${ke.message}`})}finally{g(!1)}},z=async ue=>{try{if(g(!0),ue.status!=="APPROVED")if(ue.id!==void 0)await Hn.processAdmission(ue.id,"APPROVE");else throw new Error("Application ID is undefined");if(ue.id!==void 0){const Me=await Hn.createStudentFromAdmission(ue.id)}else throw new Error("Application ID is undefined");r({type:"success",message:"Student created successfully from application"}),N()}catch(Me){console.error("Error creating student from application:",Me),r({type:"error",message:`Failed to create student: ${Me.message||"Unknown error"}`})}finally{g(!1)}},O=(ue,Me)=>{v(Me?ke=>[...ke,ue]:ke=>ke.filter(Ae=>Ae.id!==ue.id))},W=ue=>{v(ue&&ae?[...ae]:[])},F=ue=>{C(ue.target.value)},U=async()=>{var ue;try{g(!0),k(`Are you sure you want to change the status of ${S.length} application(s) to ${((ue=ho.find(Me=>Me.value===E))==null?void 0:ue.label)||E}?`),I(()=>async()=>{const Me=await Promise.allSettled(S.map(Ue=>{if(Ue.status===E)return Promise.resolve();const Ye=E==="REJECTED"?"Rejected in bulk update":void 0,Ve=E==="APPROVED"?"APPROVE":"REJECT";if(Ue.id!==void 0)return Hn.processAdmission(Ue.id,Ve,Ye);throw new Error("Application ID is undefined")})),ke=Me.filter(Ue=>Ue.status==="fulfilled").length,Ae=Me.filter(Ue=>Ue.status==="rejected").length;r({type:Ae>0?"warning":"success",message:`Status update complete: ${ke} successful, ${Ae} failed`}),v([]),N()}),j(!0)}catch(Me){r({type:"error",message:`Failed to process bulk action: ${Me.message||"Unknown error"}`})}finally{g(!1)}},te=(ue,Me)=>{Me==="APPROVED"?de(ue,"APPROVED"):Me==="REJECTED"?de(ue,"REJECTED"):(async()=>{try{if(g(!0),ue.id!==void 0)await Hn.updateStatus(ue.id,Me);else throw new Error("Application ID is undefined");r({type:"success",message:`Status updated to ${Me.toLowerCase()}`}),N()}catch(ke){r({type:"error",message:`Failed to update status: ${ke.message||"Unknown error"}`})}finally{g(!1)}})()},he=(ue,Me)=>{Y(ke=>({...ke,[ue]:Me}))},ie=()=>{M(!0),B(!1)},be=()=>{Y({name:"",grade:[],status:[],dateRange:{start:"",end:""}}),M(!1)},xe=()=>{try{const ue=P?H:ae||[];if(ue.length===0){r({type:"warning",message:"No data to export"});return}const Ae=[["ID","Student Name","Date of Birth","Email","Contact Number","Parent/Guardian Name","Parent/Guardian Contact","Address","Grade Applying","Previous School","Previous Grade","Previous Percentage","Submission Date","Status"].join(","),...ue.map(Xe=>[Xe.id||"",`"${Xe.studentName||""}"`,Xe.dateOfBirth||"",`"${Xe.email||""}"`,Xe.contactNumber||"",`"${Xe.parentName||""}"`,Xe.guardianContact||Xe.contactNumber||"",`"${Xe.address||""}"`,Xe.gradeApplying||"",`"${Xe.previousSchool||""}"`,Xe.previousGrade||"",Xe.previousPercentage||"",Xe.submissionDate?new Date(Xe.submissionDate).toISOString().split("T")[0]:"",Xe.status||"PENDING"].join(","))].join(`
`),Ue=new Blob([Ae],{type:"text/csv;charset=utf-8;"}),Ye=URL.createObjectURL(Ue),Ve=document.createElement("a");Ve.setAttribute("href",Ye),Ve.setAttribute("download",`admissions_export_${new Date().toISOString().slice(0,10)}.csv`),document.body.appendChild(Ve),Ve.click(),document.body.removeChild(Ve),r({type:"success",message:`Exported ${ue.length} records to CSV`})}catch(ue){console.error("Error exporting CSV:",ue),r({type:"error",message:"Failed to export CSV: "+(ue.message||"Unknown error")})}},Fe=async()=>{d(!0),f([]);const ue=[{name:"Get all admissions (singular)",fn:()=>ge.get("/admission")},{name:"Get all admissions (plural)",fn:()=>ge.get("/admissions")},{name:"Get health check",fn:()=>ge.get("/health")},{name:"Get auth status",fn:()=>ge.get("/auth/status")}],Me=[];for(const ke of ue)try{console.log(`üß™ Testing endpoint: ${ke.name}`);const Ae=await ke.fn();Me.push({name:ke.name,success:!0,status:"OK",data:Ae})}catch(Ae){Me.push({name:ke.name,success:!1,status:Ae.status||"Error",error:Ae.message||JSON.stringify(Ae)})}f(Me),d(!1)},me=[{id:"selector",label:"Select",sortable:!1,width:50,format:(ue,Me)=>a.jsx(Zs,{checked:S.some(ke=>ke.id===Me.id),onChange:ke=>O(Me,ke.target.checked),size:"small"}),renderHeader:()=>a.jsx(Zs,{checked:!!(ae&&ae.length>0&&S.length===ae.length),indeterminate:S.length>0&&S.length<((ae==null?void 0:ae.length)||0),onChange:ue=>W(ue.target.checked),size:"small"})},{id:"id",label:"ID",sortable:!0},{id:"studentName",label:"Student Name",sortable:!0},{id:"gradeApplying",label:"Grade",sortable:!0},{id:"parentName",label:"Parent Name",sortable:!0},{id:"submissionDate",label:"Submitted On",sortable:!0,format:kg},{id:"status",label:"Status",sortable:!0,format:(ue,Me)=>a.jsx(ps,{permission:"MANAGE_ADMISSIONS",children:a.jsx(rt,{size:"small",fullWidth:!0,children:a.jsx(tt,{value:ue||"PENDING",onChange:ke=>te(Me,ke.target.value),displayEmpty:!0,variant:"standard",sx:{"& .MuiSelect-select":{py:0,color:()=>{switch(ue==null?void 0:ue.toUpperCase()){case"APPROVED":return"success.main";case"REJECTED":return"error.main";case"UNDER_REVIEW":return"info.main";case"WAITLISTED":return"warning.dark";default:return"warning.main"}}}},children:ho.map(ke=>a.jsx(Te,{value:ke.value,children:ke.label},ke.value))})})})},w2(ue=>q(ue),void 0,ue=>a.jsx(ps,{permission:"MANAGE_ADMISSIONS",children:a.jsx(xt,{title:"Create Student",children:a.jsx(st,{size:"small",onClick:()=>z(ue),color:"secondary",children:a.jsx(Cf,{fontSize:"small"})})})}))],ve=()=>a.jsxs(At,{open:D,onClose:()=>B(!1),maxWidth:"md",fullWidth:!0,children:[a.jsx(Dt,{children:"Filter Admissions"}),a.jsx(Tt,{children:a.jsxs(X,{container:!0,spacing:3,sx:{mt:.5},children:[a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{label:"Search by Name or Email",fullWidth:!0,value:R.name,onChange:ue=>he("name",ue.target.value),placeholder:"Enter student name, email, or parent name",variant:"outlined"})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{id:"grade-filter-label",children:"Filter by Grade"}),a.jsx(tt,{labelId:"grade-filter-label",multiple:!0,value:R.grade,onChange:ue=>he("grade",ue.target.value),input:a.jsx(A0,{label:"Filter by Grade"}),renderValue:ue=>a.jsx(ee,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:ue.map(Me=>a.jsx(at,{label:`Grade ${Me}`,size:"small"},Me))}),children:j2.map(ue=>a.jsx(Te,{value:ue.value,children:ue.label},ue.value))})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{id:"status-filter-label",children:"Filter by Status"}),a.jsx(tt,{labelId:"status-filter-label",multiple:!0,value:R.status,onChange:ue=>he("status",ue.target.value),input:a.jsx(A0,{label:"Filter by Status"}),renderValue:ue=>a.jsx(ee,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:ue.map(Me=>{var ke;return a.jsx(at,{label:((ke=ho.find(Ae=>Ae.value===Me))==null?void 0:ke.label)||Me,size:"small"},Me)})}),children:ho.map(ue=>a.jsx(Te,{value:ue.value,children:ue.label},ue.value))})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{label:"Date Range From",type:"date",InputLabelProps:{shrink:!0},fullWidth:!0,value:R.dateRange.start,onChange:ue=>he("dateRange",{...R.dateRange,start:ue.target.value})})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{label:"Date Range To",type:"date",InputLabelProps:{shrink:!0},fullWidth:!0,value:R.dateRange.end,onChange:ue=>he("dateRange",{...R.dateRange,end:ue.target.value})})})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:be,color:"secondary",children:"Clear All Filters"}),a.jsx(ye,{onClick:()=>B(!1),children:"Cancel"}),a.jsx(ye,{onClick:ie,variant:"contained",color:"primary",children:"Apply Filters"})]})]}),ne=()=>a.jsxs(At,{open:A,onClose:()=>j(!1),children:[a.jsx(Dt,{children:"Confirm Action"}),a.jsx(Tt,{children:a.jsx(V,{children:w})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>j(!1),children:"Cancel"}),a.jsx(ye,{onClick:async()=>{j(!1),await _()},color:"primary",variant:"contained",autoFocus:!0,children:"Confirm"})]})]}),we=()=>a.jsxs(At,{open:o,onClose:()=>l(!1),maxWidth:"md",fullWidth:!0,children:[a.jsx(Dt,{children:"API Endpoint Diagnostics"}),a.jsxs(Tt,{children:[a.jsx(V,{variant:"body2",gutterBottom:!0,children:"Testing different API endpoints to find which one works with your backend."}),c&&a.jsx(ee,{sx:{display:"flex",justifyContent:"center",my:4},children:a.jsx(vr,{})}),u.length>0&&a.jsx(Gn,{children:u.map((ue,Me)=>a.jsxs(it.Fragment,{children:[Me>0&&a.jsx(Qt,{}),a.jsx(Gr,{children:a.jsx(Fr,{primary:`${ue.name} - ${ue.success?"‚úÖ Success":"‚ùå Failed"} (${ue.status})`,secondary:a.jsx(ee,{component:"pre",sx:{mt:1,p:1,bgcolor:"grey.100",borderRadius:1,fontSize:"0.75rem",overflow:"auto",maxHeight:200},children:ue.success?JSON.stringify(ue.data,null,2):ue.error?`Error: ${ue.error}`:"No response data"})})})]},Me))}),a.jsxs(ee,{sx:{mt:3},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Authentication Information"}),a.jsxs(Ke,{sx:{p:2},children:[a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"User:"})," ",e?JSON.stringify(e):"Not logged in"]}),a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"Token present:"})," ",localStorage.getItem("token")?"Yes":"No"]}),a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"API URL:"})," ",Et.apiUrl]})]})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:Fe,disabled:c,color:"primary",children:"Run API Tests"}),a.jsx(ye,{onClick:()=>l(!1),color:"secondary",children:"Close"})]})]}),Ee=()=>{L(!0)},pe=()=>{L(!1)},Ce=ue=>{r({type:"success",message:`Successfully uploaded ${ue.length} admission applications.`}),N()};return Z?a.jsx(Ar,{}):T?a.jsxs(ee,{sx:{p:3},children:[a.jsx(Kr,{title:"Error Loading Admissions",message:typeof T=="string"?T:T.message||"Couldn't load admissions data"}),a.jsxs(ee,{sx:{mt:3,display:"flex",gap:2},children:[a.jsx(ye,{variant:"contained",onClick:N,children:"Try Again"}),a.jsx(ye,{variant:"outlined",color:"secondary",onClick:()=>l(!0),children:"Diagnostics"})]}),h&&a.jsxs(Ke,{elevation:0,variant:"outlined",sx:{p:3,mt:4},children:[a.jsxs(pt,{severity:"error",sx:{mb:2},children:[a.jsxs(Mn,{children:["HTTP Status: ",h.status||"Unknown"]}),h.message]}),a.jsx(V,{variant:"subtitle1",children:"Debug Information:"}),a.jsx(ee,{component:"pre",sx:{p:2,bgcolor:"grey.100",borderRadius:1,overflowX:"auto"},children:JSON.stringify(h.originalError||h,null,2)}),a.jsxs(ee,{sx:{mt:2},children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"Possible Solutions:"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Verify the API endpoint path is correct"}),a.jsx("li",{children:"Check that your user account has permission to access admissions"}),a.jsx("li",{children:"Ensure your authentication token is valid and not expired"}),a.jsx("li",{children:"Verify the backend server is running and accessible"})]})]})]}),we()]}):a.jsxs(ee,{sx:{p:3},children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(V,{variant:"h4",component:"h1",children:"Admission Applications"}),a.jsxs(ee,{sx:{display:"flex",gap:1},children:[a.jsx(xt,{title:"Export to CSV",children:a.jsx(st,{color:"primary",onClick:xe,disabled:(!H||H.length===0)&&(!ae||ae.length===0),children:a.jsx(Sg,{})})}),a.jsx(xt,{title:P?"Edit Filters":"Filter Applications",children:a.jsx(st,{color:P?"secondary":"default",onClick:()=>B(!0),children:a.jsx(wg,{})})}),a.jsx(ps,{children:a.jsx(ye,{variant:"outlined",color:"primary",startIcon:a.jsx(ti,{}),onClick:Ee,children:"Bulk Upload"})}),P&&a.jsx(xt,{title:"Clear All Filters",children:a.jsx(st,{color:"error",onClick:be,children:a.jsx(bg,{})})}),a.jsx(ye,{variant:"text",color:"secondary",onClick:()=>l(!0),sx:{ml:1},children:"Debug"}),a.jsx(ps,{permission:"MANAGE_ADMISSIONS",children:a.jsx(ye,{variant:"contained",onClick:G,children:"New Application"})})]})]}),P&&a.jsxs(Ke,{sx:{p:1.5,mb:2,bgcolor:"background.default",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:1},children:[a.jsx(V,{variant:"body2",sx:{fontWeight:"medium",mr:1},children:"Filters:"}),R.name&&a.jsx(at,{label:`Search: "${R.name}"`,size:"small",onDelete:()=>he("name",""),color:"primary",variant:"outlined"}),R.status.length>0&&a.jsx(at,{label:`Status: ${R.status.length} selected`,size:"small",onDelete:()=>he("status",[]),color:"primary",variant:"outlined"}),R.grade.length>0&&a.jsx(at,{label:`Grade: ${R.grade.length} selected`,size:"small",onDelete:()=>he("grade",[]),color:"primary",variant:"outlined"}),(R.dateRange.start||R.dateRange.end)&&a.jsx(at,{label:`Date Range: ${R.dateRange.start||"Any"} to ${R.dateRange.end||"Any"}`,size:"small",onDelete:()=>he("dateRange",{start:"",end:""}),color:"primary",variant:"outlined"})]}),a.jsxs(V,{variant:"body2",sx:{ml:2,color:"text.secondary"},children:[H.length," record",H.length!==1?"s":""," found"]})]}),S.length>0&&a.jsxs(Ke,{sx:{p:2,mb:3,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsxs(V,{variant:"body1",sx:{mr:2},children:[S.length," application(s) selected"]}),a.jsxs(rt,{size:"small",sx:{minWidth:200,mr:2},children:[a.jsx(ot,{id:"bulk-status-select-label",children:"Change Status To"}),a.jsx(tt,{labelId:"bulk-status-select-label",id:"bulk-status-select",value:E,label:"Change Status To",onChange:F,children:ho.map(ue=>a.jsx(Te,{value:ue.value,children:ue.label},ue.value))})]}),a.jsx(ye,{variant:"contained",onClick:U,disabled:m||S.length===0,children:"Apply Status Change"})]}),a.jsx(ye,{variant:"outlined",onClick:()=>v([]),color:"secondary",children:"Clear Selection"})]}),"      ",a.jsx(Df,{columns:me,data:H||[],defaultRowsPerPage:10}),we(),ne(),ve(),a.jsx(b2,{open:s,onClose:()=>i(!1),onSubmit:oe,initialData:t||void 0,loading:m}),p&&a.jsx(Qj,{error:p,onClose:()=>y(null)}),a.jsx(u2,{open:K,onClose:pe,onSuccess:Ce})]})};var Ag={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/(function(e,r){((t,n)=>{e.exports=n()})(Ds,function t(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},s,i=!n.document&&!!n.postMessage,o=n.IS_PAPA_WORKER||!1,l={},c=0,d={};function u(w){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(k){var _=C(k);_.chunkSize=parseInt(_.chunkSize),k.step||k.chunk||(_.chunkSize=null),this._handle=new g(_),(this._handle.streamer=this)._config=_}).call(this,w),this.parseChunk=function(k,_){var I=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<I){let B=this._config.newline;B||(D=this._config.quoteChar||'"',B=this._handle.guessLineEndings(k,D)),k=[...k.split(B).slice(I)].join(B)}this.isFirstChunk&&j(this._config.beforeFirstChunk)&&(D=this._config.beforeFirstChunk(k))!==void 0&&(k=D),this.isFirstChunk=!1,this._halted=!1;var I=this._partialLine+k,D=(this._partialLine="",this._handle.parse(I,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(k=D.meta.cursor,I=(this._finished||(this._partialLine=I.substring(k-this._baseIndex),this._baseIndex=k),D&&D.data&&(this._rowCount+=D.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),o)n.postMessage({results:D,workerId:d.WORKER_ID,finished:I});else if(j(this._config.chunk)&&!_){if(this._config.chunk(D,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=D=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(D.data),this._completeResults.errors=this._completeResults.errors.concat(D.errors),this._completeResults.meta=D.meta),this._completed||!I||!j(this._config.complete)||D&&D.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),I||D&&D.meta.paused||this._nextChunk(),D}this._halted=!0},this._sendError=function(k){j(this._config.error)?this._config.error(k):o&&this._config.error&&n.postMessage({workerId:d.WORKER_ID,error:k,finished:!1})}}function f(w){var k;(w=w||{}).chunkSize||(w.chunkSize=d.RemoteChunkSize),u.call(this,w),this._nextChunk=i?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(_){this._input=_,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(k=new XMLHttpRequest,this._config.withCredentials&&(k.withCredentials=this._config.withCredentials),i||(k.onload=A(this._chunkLoaded,this),k.onerror=A(this._chunkError,this)),k.open(this._config.downloadRequestBody?"POST":"GET",this._input,!i),this._config.downloadRequestHeaders){var _,I=this._config.downloadRequestHeaders;for(_ in I)k.setRequestHeader(_,I[_])}var D;this._config.chunkSize&&(D=this._start+this._config.chunkSize-1,k.setRequestHeader("Range","bytes="+this._start+"-"+D));try{k.send(this._config.downloadRequestBody)}catch(B){this._chunkError(B.message)}i&&k.status===0&&this._chunkError()}},this._chunkLoaded=function(){k.readyState===4&&(k.status<200||400<=k.status?this._chunkError():(this._start+=this._config.chunkSize||k.responseText.length,this._finished=!this._config.chunkSize||this._start>=(_=>(_=_.getResponseHeader("Content-Range"))!==null?parseInt(_.substring(_.lastIndexOf("/")+1)):-1)(k),this.parseChunk(k.responseText)))},this._chunkError=function(_){_=k.statusText||_,this._sendError(new Error(_))}}function h(w){(w=w||{}).chunkSize||(w.chunkSize=d.LocalChunkSize),u.call(this,w);var k,_,I=typeof FileReader<"u";this.stream=function(D){this._input=D,_=D.slice||D.webkitSlice||D.mozSlice,I?((k=new FileReader).onload=A(this._chunkLoaded,this),k.onerror=A(this._chunkError,this)):k=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var D=this._input,B=(this._config.chunkSize&&(B=Math.min(this._start+this._config.chunkSize,this._input.size),D=_.call(D,this._start,B)),k.readAsText(D,this._config.encoding));I||this._chunkLoaded({target:{result:B}})},this._chunkLoaded=function(D){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(D.target.result)},this._chunkError=function(){this._sendError(k.error)}}function x(w){var k;u.call(this,w=w||{}),this.stream=function(_){return k=_,this._nextChunk()},this._nextChunk=function(){var _,I;if(!this._finished)return _=this._config.chunkSize,k=_?(I=k.substring(0,_),k.substring(_)):(I=k,""),this._finished=!k,this.parseChunk(I)}}function m(w){u.call(this,w=w||{});var k=[],_=!0,I=!1;this.pause=function(){u.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){u.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(D){this._input=D,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){I&&k.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),k.length?this.parseChunk(k.shift()):_=!0},this._streamData=A(function(D){try{k.push(typeof D=="string"?D:D.toString(this._config.encoding)),_&&(_=!1,this._checkIsFinished(),this.parseChunk(k.shift()))}catch(B){this._streamError(B)}},this),this._streamError=A(function(D){this._streamCleanUp(),this._sendError(D)},this),this._streamEnd=A(function(){this._streamCleanUp(),I=!0,this._streamData("")},this),this._streamCleanUp=A(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function g(w){var k,_,I,D,B=Math.pow(2,53),R=-B,Y=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,P=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,M=this,K=0,L=0,ae=!1,Z=!1,T=[],N={data:[],errors:[],meta:{}};function H(de){return w.skipEmptyLines==="greedy"?de.join("").trim()==="":de.length===1&&de[0].length===0}function G(){if(N&&I&&(oe("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),I=!1),w.skipEmptyLines&&(N.data=N.data.filter(function(W){return!H(W)})),q()){let W=function(F,U){j(w.transformHeader)&&(F=w.transformHeader(F,U)),T.push(F)};if(N)if(Array.isArray(N.data[0])){for(var de=0;q()&&de<N.data.length;de++)N.data[de].forEach(W);N.data.splice(0,1)}else N.data.forEach(W)}function z(W,F){for(var U=w.header?{}:[],te=0;te<W.length;te++){var he=te,ie=W[te],ie=((be,xe)=>(Fe=>(w.dynamicTypingFunction&&w.dynamicTyping[Fe]===void 0&&(w.dynamicTyping[Fe]=w.dynamicTypingFunction(Fe)),(w.dynamicTyping[Fe]||w.dynamicTyping)===!0))(be)?xe==="true"||xe==="TRUE"||xe!=="false"&&xe!=="FALSE"&&((Fe=>{if(Y.test(Fe)&&(Fe=parseFloat(Fe),R<Fe&&Fe<B))return 1})(xe)?parseFloat(xe):P.test(xe)?new Date(xe):xe===""?null:xe):xe)(he=w.header?te>=T.length?"__parsed_extra":T[te]:he,ie=w.transform?w.transform(ie,he):ie);he==="__parsed_extra"?(U[he]=U[he]||[],U[he].push(ie)):U[he]=ie}return w.header&&(te>T.length?oe("FieldMismatch","TooManyFields","Too many fields: expected "+T.length+" fields but parsed "+te,L+F):te<T.length&&oe("FieldMismatch","TooFewFields","Too few fields: expected "+T.length+" fields but parsed "+te,L+F)),U}var O;N&&(w.header||w.dynamicTyping||w.transform)&&(O=1,!N.data.length||Array.isArray(N.data[0])?(N.data=N.data.map(z),O=N.data.length):N.data=z(N.data,0),w.header&&N.meta&&(N.meta.fields=T),L+=O)}function q(){return w.header&&T.length===0}function oe(de,z,O,W){de={type:de,code:z,message:O},W!==void 0&&(de.row=W),N.errors.push(de)}j(w.step)&&(D=w.step,w.step=function(de){N=de,q()?G():(G(),N.data.length!==0&&(K+=de.data.length,w.preview&&K>w.preview?_.abort():(N.data=N.data[0],D(N,M))))}),this.parse=function(de,z,O){var W=w.quoteChar||'"',W=(w.newline||(w.newline=this.guessLineEndings(de,W)),I=!1,w.delimiter?j(w.delimiter)&&(w.delimiter=w.delimiter(de),N.meta.delimiter=w.delimiter):((W=((F,U,te,he,ie)=>{var be,xe,Fe,me;ie=ie||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var ve=0;ve<ie.length;ve++){for(var ne,we=ie[ve],Ee=0,pe=0,Ce=0,ue=(Fe=void 0,new y({comments:he,delimiter:we,newline:U,preview:10}).parse(F)),Me=0;Me<ue.data.length;Me++)te&&H(ue.data[Me])?Ce++:(ne=ue.data[Me].length,pe+=ne,Fe===void 0?Fe=ne:0<ne&&(Ee+=Math.abs(ne-Fe),Fe=ne));0<ue.data.length&&(pe/=ue.data.length-Ce),(xe===void 0||Ee<=xe)&&(me===void 0||me<pe)&&1.99<pe&&(xe=Ee,be=we,me=pe)}return{successful:!!(w.delimiter=be),bestDelimiter:be}})(de,w.newline,w.skipEmptyLines,w.comments,w.delimitersToGuess)).successful?w.delimiter=W.bestDelimiter:(I=!0,w.delimiter=d.DefaultDelimiter),N.meta.delimiter=w.delimiter),C(w));return w.preview&&w.header&&W.preview++,k=de,_=new y(W),N=_.parse(k,z,O),G(),ae?{meta:{paused:!0}}:N||{meta:{paused:!1}}},this.paused=function(){return ae},this.pause=function(){ae=!0,_.abort(),k=j(w.chunk)?"":k.substring(_.getCharIndex())},this.resume=function(){M.streamer._halted?(ae=!1,M.streamer.parseChunk(k,!0)):setTimeout(M.resume,3)},this.aborted=function(){return Z},this.abort=function(){Z=!0,_.abort(),N.meta.aborted=!0,j(w.complete)&&w.complete(N),k=""},this.guessLineEndings=function(F,W){F=F.substring(0,1048576);var W=new RegExp(p(W)+"([^]*?)"+p(W),"gm"),O=(F=F.replace(W,"")).split("\r"),W=F.split(`
`),F=1<W.length&&W[0].length<O[0].length;if(O.length===1||F)return`
`;for(var U=0,te=0;te<O.length;te++)O[te][0]===`
`&&U++;return U>=O.length/2?`\r
`:"\r"}}function p(w){return w.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function y(w){var k=(w=w||{}).delimiter,_=w.newline,I=w.comments,D=w.step,B=w.preview,R=w.fastMode,Y=null,P=!1,M=w.quoteChar==null?'"':w.quoteChar,K=M;if(w.escapeChar!==void 0&&(K=w.escapeChar),(typeof k!="string"||-1<d.BAD_DELIMITERS.indexOf(k))&&(k=","),I===k)throw new Error("Comment character same as delimiter");I===!0?I="#":(typeof I!="string"||-1<d.BAD_DELIMITERS.indexOf(I))&&(I=!1),_!==`
`&&_!=="\r"&&_!==`\r
`&&(_=`
`);var L=0,ae=!1;this.parse=function(Z,T,N){if(typeof Z!="string")throw new Error("Input must be a string");var H=Z.length,G=k.length,q=_.length,oe=I.length,de=j(D),z=[],O=[],W=[],F=L=0;if(!Z)return Ee();if(R||R!==!1&&Z.indexOf(M)===-1){for(var U=Z.split(_),te=0;te<U.length;te++){if(W=U[te],L+=W.length,te!==U.length-1)L+=_.length;else if(N)return Ee();if(!I||W.substring(0,oe)!==I){if(de){if(z=[],me(W.split(k)),pe(),ae)return Ee()}else me(W.split(k));if(B&&B<=te)return z=z.slice(0,B),Ee(!0)}}return Ee()}for(var he=Z.indexOf(k,L),ie=Z.indexOf(_,L),be=new RegExp(p(K)+p(M),"g"),xe=Z.indexOf(M,L);;)if(Z[L]===M)for(xe=L,L++;;){if((xe=Z.indexOf(M,xe+1))===-1)return N||O.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:z.length,index:L}),ne();if(xe===H-1)return ne(Z.substring(L,xe).replace(be,M));if(M===K&&Z[xe+1]===K)xe++;else if(M===K||xe===0||Z[xe-1]!==K){he!==-1&&he<xe+1&&(he=Z.indexOf(k,xe+1));var Fe=ve((ie=ie!==-1&&ie<xe+1?Z.indexOf(_,xe+1):ie)===-1?he:Math.min(he,ie));if(Z.substr(xe+1+Fe,G)===k){W.push(Z.substring(L,xe).replace(be,M)),Z[L=xe+1+Fe+G]!==M&&(xe=Z.indexOf(M,L)),he=Z.indexOf(k,L),ie=Z.indexOf(_,L);break}if(Fe=ve(ie),Z.substring(xe+1+Fe,xe+1+Fe+q)===_){if(W.push(Z.substring(L,xe).replace(be,M)),we(xe+1+Fe+q),he=Z.indexOf(k,L),xe=Z.indexOf(M,L),de&&(pe(),ae))return Ee();if(B&&z.length>=B)return Ee(!0);break}O.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:z.length,index:L}),xe++}}else if(I&&W.length===0&&Z.substring(L,L+oe)===I){if(ie===-1)return Ee();L=ie+q,ie=Z.indexOf(_,L),he=Z.indexOf(k,L)}else if(he!==-1&&(he<ie||ie===-1))W.push(Z.substring(L,he)),L=he+G,he=Z.indexOf(k,L);else{if(ie===-1)break;if(W.push(Z.substring(L,ie)),we(ie+q),de&&(pe(),ae))return Ee();if(B&&z.length>=B)return Ee(!0)}return ne();function me(Ce){z.push(Ce),F=L}function ve(Ce){var ue=0;return ue=Ce!==-1&&(Ce=Z.substring(xe+1,Ce))&&Ce.trim()===""?Ce.length:ue}function ne(Ce){return N||(Ce===void 0&&(Ce=Z.substring(L)),W.push(Ce),L=H,me(W),de&&pe()),Ee()}function we(Ce){L=Ce,me(W),W=[],ie=Z.indexOf(_,L)}function Ee(Ce){if(w.header&&!T&&z.length&&!P){var ue=z[0],Me=Object.create(null),ke=new Set(ue);let Ae=!1;for(let Ue=0;Ue<ue.length;Ue++){let Ye=ue[Ue];if(Me[Ye=j(w.transformHeader)?w.transformHeader(Ye,Ue):Ye]){let Ve,Xe=Me[Ye];for(;Ve=Ye+"_"+Xe,Xe++,ke.has(Ve););ke.add(Ve),ue[Ue]=Ve,Me[Ye]++,Ae=!0,(Y=Y===null?{}:Y)[Ve]=Ye}else Me[Ye]=1,ue[Ue]=Ye;ke.add(Ye)}Ae&&console.warn("Duplicate headers found and renamed."),P=!0}return{data:z,errors:O,meta:{delimiter:k,linebreak:_,aborted:ae,truncated:!!Ce,cursor:F+(T||0),renamedHeaders:Y}}}function pe(){D(Ee()),z=[],O=[]}},this.abort=function(){ae=!0},this.getCharIndex=function(){return L}}function S(w){var k=w.data,_=l[k.workerId],I=!1;if(k.error)_.userError(k.error,k.file);else if(k.results&&k.results.data){var D={abort:function(){I=!0,v(k.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:E,resume:E};if(j(_.userStep)){for(var B=0;B<k.results.data.length&&(_.userStep({data:k.results.data[B],errors:k.results.errors,meta:k.results.meta},D),!I);B++);delete k.results}else j(_.userChunk)&&(_.userChunk(k.results,D,k.file),delete k.results)}k.finished&&!I&&v(k.workerId,k.results)}function v(w,k){var _=l[w];j(_.userComplete)&&_.userComplete(k),_.terminate(),delete l[w]}function E(){throw new Error("Not implemented.")}function C(w){if(typeof w!="object"||w===null)return w;var k,_=Array.isArray(w)?[]:{};for(k in w)_[k]=C(w[k]);return _}function A(w,k){return function(){w.apply(k,arguments)}}function j(w){return typeof w=="function"}return d.parse=function(w,k){var _=(k=k||{}).dynamicTyping||!1;if(j(_)&&(k.dynamicTypingFunction=_,_={}),k.dynamicTyping=_,k.transform=!!j(k.transform)&&k.transform,!k.worker||!d.WORKERS_SUPPORTED)return _=null,d.NODE_STREAM_INPUT,typeof w=="string"?(w=(I=>I.charCodeAt(0)!==65279?I:I.slice(1))(w),_=new(k.download?f:x)(k)):w.readable===!0&&j(w.read)&&j(w.on)?_=new m(k):(n.File&&w instanceof File||w instanceof Object)&&(_=new h(k)),_.stream(w);(_=(()=>{var I;return!!d.WORKERS_SUPPORTED&&(I=(()=>{var D=n.URL||n.webkitURL||null,B=t.toString();return d.BLOB_URL||(d.BLOB_URL=D.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",B,")();"],{type:"text/javascript"})))})(),(I=new n.Worker(I)).onmessage=S,I.id=c++,l[I.id]=I)})()).userStep=k.step,_.userChunk=k.chunk,_.userComplete=k.complete,_.userError=k.error,k.step=j(k.step),k.chunk=j(k.chunk),k.complete=j(k.complete),k.error=j(k.error),delete k.worker,_.postMessage({input:w,config:k,workerId:_.id})},d.unparse=function(w,k){var _=!1,I=!0,D=",",B=`\r
`,R='"',Y=R+R,P=!1,M=null,K=!1,L=((()=>{if(typeof k=="object"){if(typeof k.delimiter!="string"||d.BAD_DELIMITERS.filter(function(T){return k.delimiter.indexOf(T)!==-1}).length||(D=k.delimiter),typeof k.quotes!="boolean"&&typeof k.quotes!="function"&&!Array.isArray(k.quotes)||(_=k.quotes),typeof k.skipEmptyLines!="boolean"&&typeof k.skipEmptyLines!="string"||(P=k.skipEmptyLines),typeof k.newline=="string"&&(B=k.newline),typeof k.quoteChar=="string"&&(R=k.quoteChar),typeof k.header=="boolean"&&(I=k.header),Array.isArray(k.columns)){if(k.columns.length===0)throw new Error("Option columns is empty");M=k.columns}k.escapeChar!==void 0&&(Y=k.escapeChar+R),k.escapeFormulae instanceof RegExp?K=k.escapeFormulae:typeof k.escapeFormulae=="boolean"&&k.escapeFormulae&&(K=/^[=+\-@\t\r].*$/)}})(),new RegExp(p(R),"g"));if(typeof w=="string"&&(w=JSON.parse(w)),Array.isArray(w)){if(!w.length||Array.isArray(w[0]))return ae(null,w,P);if(typeof w[0]=="object")return ae(M||Object.keys(w[0]),w,P)}else if(typeof w=="object")return typeof w.data=="string"&&(w.data=JSON.parse(w.data)),Array.isArray(w.data)&&(w.fields||(w.fields=w.meta&&w.meta.fields||M),w.fields||(w.fields=Array.isArray(w.data[0])?w.fields:typeof w.data[0]=="object"?Object.keys(w.data[0]):[]),Array.isArray(w.data[0])||typeof w.data[0]=="object"||(w.data=[w.data])),ae(w.fields||[],w.data||[],P);throw new Error("Unable to serialize unrecognized input");function ae(T,N,H){var G="",q=(typeof T=="string"&&(T=JSON.parse(T)),typeof N=="string"&&(N=JSON.parse(N)),Array.isArray(T)&&0<T.length),oe=!Array.isArray(N[0]);if(q&&I){for(var de=0;de<T.length;de++)0<de&&(G+=D),G+=Z(T[de],de);0<N.length&&(G+=B)}for(var z=0;z<N.length;z++){var O=(q?T:N[z]).length,W=!1,F=q?Object.keys(N[z]).length===0:N[z].length===0;if(H&&!q&&(W=H==="greedy"?N[z].join("").trim()==="":N[z].length===1&&N[z][0].length===0),H==="greedy"&&q){for(var U=[],te=0;te<O;te++){var he=oe?T[te]:te;U.push(N[z][he])}W=U.join("").trim()===""}if(!W){for(var ie=0;ie<O;ie++){0<ie&&!F&&(G+=D);var be=q&&oe?T[ie]:ie;G+=Z(N[z][be],ie)}z<N.length-1&&(!H||0<O&&!F)&&(G+=B)}}return G}function Z(T,N){var H,G;return T==null?"":T.constructor===Date?JSON.stringify(T).slice(1,25):(G=!1,K&&typeof T=="string"&&K.test(T)&&(T="'"+T,G=!0),H=T.toString().replace(L,Y),(G=G||_===!0||typeof _=="function"&&_(T,N)||Array.isArray(_)&&_[N]||((q,oe)=>{for(var de=0;de<oe.length;de++)if(-1<q.indexOf(oe[de]))return!0;return!1})(H,d.BAD_DELIMITERS)||-1<H.indexOf(D)||H.charAt(0)===" "||H.charAt(H.length-1)===" ")?R+H+R:H)}},d.RECORD_SEP=String.fromCharCode(30),d.UNIT_SEP=String.fromCharCode(31),d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!i&&!!n.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=y,d.ParserHandle=g,d.NetworkStreamer=f,d.FileStreamer=h,d.StringStreamer=x,d.ReadableStreamStreamer=m,n.jQuery&&((s=n.jQuery).fn.parse=function(w){var k=w.config||{},_=[];return this.each(function(B){if(!(s(this).prop("tagName").toUpperCase()==="INPUT"&&s(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var R=0;R<this.files.length;R++)_.push({file:this.files[R],inputElem:this,instanceConfig:s.extend({},k)})}),I(),this;function I(){if(_.length===0)j(w.complete)&&w.complete();else{var B,R,Y,P,M=_[0];if(j(w.before)){var K=w.before(M.file,M.inputElem);if(typeof K=="object"){if(K.action==="abort")return B="AbortError",R=M.file,Y=M.inputElem,P=K.reason,void(j(w.error)&&w.error({name:B},R,Y,P));if(K.action==="skip")return void D();typeof K.config=="object"&&(M.instanceConfig=s.extend(M.instanceConfig,K.config))}else if(K==="skip")return void D()}var L=M.instanceConfig.complete;M.instanceConfig.complete=function(ae){j(L)&&L(ae,M.file,M.inputElem),D()},d.parse(M.file,M.instanceConfig)}}function D(){_.splice(0,1),I()}}),o&&(n.onmessage=function(w){w=w.data,d.WORKER_ID===void 0&&w&&(d.WORKER_ID=w.workerId),typeof w.input=="string"?n.postMessage({workerId:d.WORKER_ID,results:d.parse(w.input,w.config),finished:!0}):(n.File&&w.input instanceof File||w.input instanceof Object)&&(w=d.parse(w.input,w.config))&&n.postMessage({workerId:d.WORKER_ID,results:w,finished:!0})}),(f.prototype=Object.create(u.prototype)).constructor=f,(h.prototype=Object.create(u.prototype)).constructor=h,(x.prototype=Object.create(x.prototype)).constructor=x,(m.prototype=Object.create(u.prototype)).constructor=m,d})})(Ag);var Lf=Ag.exports;const k2=ts(Lf);var $f={},A2=Lt;Object.defineProperty($f,"__esModule",{value:!0});var to=$f.default=void 0,T2=A2($t()),C2=a;to=$f.default=(0,T2.default)((0,C2.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete");var Bf={},D2=Lt;Object.defineProperty(Bf,"__esModule",{value:!0});var Zc=Bf.default=void 0,_2=D2($t()),I2=a;Zc=Bf.default=(0,_2.default)((0,I2.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add");var Uf={},F2=Lt;Object.defineProperty(Uf,"__esModule",{value:!0});var Tg=Uf.default=void 0,M2=F2($t()),P2=a;Tg=Uf.default=(0,M2.default)((0,P2.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2m0 16H8V7h11z"}),"ContentCopy");const $d=async(e,r,t)=>ge.get(`/api/blueprint?examId=${e}&classId=${r}&subjectId=${t}`),N2=async e=>{const r={...e,schoolClass:{id:e.schoolClass.id},subject:{id:e.subject.id},exam:{id:e.exam.id}};return ge.post("/api/blueprint",r)},R2=async(e,r)=>{const t={...r,schoolClass:{id:r.schoolClass.id},subject:{id:r.subject.id},exam:{id:r.exam.id}};return ge.put(`/api/blueprint/${e}`,t)},O2=async e=>ge.delete(`/api/blueprint/${e}`),Pn=Sn.create({baseURL:Et.apiUrl,timeout:Et.apiTimeout,headers:{"Content-Type":"application/json"}});Pn.interceptors.request.use(e=>{var t;const r=localStorage.getItem("token");if(console.log("API Request:",{url:e.url,method:(t=e.method)==null?void 0:t.toUpperCase(),timestamp:new Date().toISOString(),hasToken:!!r,tokenFirstChars:r?`${r.substring(0,10)}...`:"none"}),r&&e.headers){e.headers.Authorization=`Bearer ${r}`;try{const n=r.split(".");if(n.length===3){const s=JSON.parse(atob(n[1])),i=s.exp*1e3,o=Date.now();console.log("Token status:",{isValid:o<i,expiresIn:`${Math.round((i-o)/1e3/60)} minutes`,expTime:new Date(i).toISOString(),currentTime:new Date(o).toISOString(),roles:s.roles||s.authorities||s.role||"Not found"}),i-o<3e5&&console.warn("Token is expired or about to expire soon")}}catch(n){console.error("Failed to decode token:",n)}}return e},e=>(console.error("Request interceptor error:",e),Promise.reject(e)));Pn.interceptors.response.use(e=>{var r;return console.log("API Success Response:",{url:e.config.url,method:(r=e.config.method)==null?void 0:r.toUpperCase(),status:e.status,timestamp:new Date().toISOString()}),e},async e=>{var n,s,i,o,l,c,d,u,f,h,x,m,g,p,y,S,v,E,C,A,j,w;const r=e.config;if(console.error("API Error Details:",{url:r==null?void 0:r.url,method:(n=r==null?void 0:r.method)==null?void 0:n.toUpperCase(),status:(s=e.response)==null?void 0:s.status,statusText:(i=e.response)==null?void 0:i.statusText,timestamp:new Date().toISOString(),requestHeaders:{contentType:(o=r==null?void 0:r.headers)==null?void 0:o["Content-Type"],hasAuthHeader:!!((l=r==null?void 0:r.headers)!=null&&l.Authorization),authHeader:(c=r==null?void 0:r.headers)!=null&&c.Authorization?`${String((d=r==null?void 0:r.headers)==null?void 0:d.Authorization).substring(0,20)}...`:"none"},requestData:r==null?void 0:r.data,responseData:(u=e.response)==null?void 0:u.data,isAuthError:((f=e.response)==null?void 0:f.status)===401||((h=e.response)==null?void 0:h.status)===403}),!r._retry&&r.url!=="/api/auth/login"&&(!e.response||e.response.status>=500&&e.response.status<600)&&(r._retryCount||(r._retryCount=0),r._retryCount<Et.retryAttempts)){r._retry=!0,r._retryCount++;const k=Math.pow(2,r._retryCount)*1e3;return await new Promise(_=>setTimeout(_,k)),console.log(`Retrying request (attempt ${r._retryCount}):`,{url:r.url,method:(x=r.method)==null?void 0:x.toUpperCase(),timestamp:new Date().toISOString()}),Pn(r)}if(!e.response)return r.baseURL===Et.apiUrl&&!r._usedFallback?(r.baseURL=Et.fallbackApiUrl,r._usedFallback=!0,Pn(r)):Promise.reject({message:"Network error. Please check your connection.",status:"network_error"});const t={message:"",status:e.response.status,originalError:e};if(e.response.status===403){const k=localStorage.getItem("token");let _=null;const I=`${r.baseURL}${r.url}`;try{if(k){const D=k.split(".");if(D.length===3){const B=JSON.parse(atob(D[1]));_={exp:new Date(B.exp*1e3).toISOString(),roles:B.roles||B.authorities||B.role||"Not found in token",username:B.sub||B.username||"Not found in token",iat:B.iat?new Date(B.iat*1e3).toISOString():"Not available",jti:B.jti||"Not available",claims:B,scope:B.scope||B.scopes||"Not found"},Date.now()>B.exp*1e3&&console.error("Permission denied with EXPIRED token",{expiredSince:`${Math.round((Date.now()-B.exp*1e3)/1e3/60)} minutes ago`})}}}catch(D){console.error("Error parsing token:",D)}t.message="Access denied. You don't have permission to perform this action.",t.tokenInfo=_,console.error("Permission Error (403 Forbidden):",{endpoint:r==null?void 0:r.url,fullUrl:I,method:(m=r==null?void 0:r.method)==null?void 0:m.toUpperCase(),tokenPresent:!!k,tokenInfo:_,requestData:r==null?void 0:r.data,requestPath:(g=r==null?void 0:r.url)==null?void 0:g.split("?")[0],requestParams:r==null?void 0:r.params,requestBody:JSON.stringify(r==null?void 0:r.data),responseData:(p=e.response)==null?void 0:p.data,responseHeaders:(y=e.response)==null?void 0:y.headers,timestamp:new Date().toISOString(),errorDetail:((v=(S=e.response)==null?void 0:S.data)==null?void 0:v.error)||((C=(E=e.response)==null?void 0:E.data)==null?void 0:C.message)||"No error details"}),k&&Et&&typeof Et=="object"&&(localStorage.setItem("last_403_url",I),localStorage.setItem("last_403_time",new Date().toISOString()),localStorage.setItem("last_403_data",JSON.stringify((r==null?void 0:r.data)||{})))}else e.response.status===401?(t.message="Unauthorized. Please log in again.",console.error("Authentication Error (401 Unauthorized):",{endpoint:r==null?void 0:r.url,method:(A=r==null?void 0:r.method)==null?void 0:A.toUpperCase(),tokenPresent:!!localStorage.getItem("token"),responseData:(j=e.response)==null?void 0:j.data,timestamp:new Date().toISOString()}),localStorage.removeItem("token"),window.location.href="/login"):t.message=((w=e.response.data)==null?void 0:w.message)||"An unexpected error occurred.";return Promise.reject(t)});Pn.get;Pn.post;Pn.put;Pn.delete;async function L2(e){return(await Pn.get("/api/exam-configs/subjects",{params:{classId:e}})).data}const $2=({exams:e=[],selectedExam:r,setSelectedExam:t,selectedClass:n,setSelectedClass:s,classes:i=[],subjects:o})=>{var j;const l=w=>{t(w.target.value)},[c,d]=b.useState([]),[u,f]=b.useState(""),[h,x]=b.useState([]),[m,g]=b.useState({open:!1,mode:"add",unit:{name:"",marks:0,questions:[]}}),[p,y]=b.useState("");b.useEffect(()=>{n?L2(n).then(d):(d([]),f(""))},[n]),b.useEffect(()=>{r&&n&&u?$d(Number(r),Number(n),Number(u)).then(x).catch(()=>x([])):x([])},[r,n,u]);const S=((j=c.find(w=>w.id===Number(u)))==null?void 0:j.theoryMarks)??0,v=h.reduce((w,k)=>w+(k.marks||0),0),E=m&&m.unit&&Array.isArray(m.unit.questions)?m.unit.questions.reduce((w,k)=>w+k.count*k.marksPerQuestion,0):0,C=async()=>{var B;if(!r){y("Please select an exam before saving a unit.");return}if(!m.unit.name.trim()){y("Unit name is required");return}if(!m.unit.questions||m.unit.questions.length===0){y("At least one question type is required");return}const w=v-(m.mode==="edit"&&((B=h.find(R=>R.id===m.unit.id))==null?void 0:B.marks)||0)+E;if(console.log("[DEBUG] totalUnitMarks:",v,"totalMarks:",E,"theoryMarks:",S,"newTotal:",w),w>S){y("Total unit marks cannot exceed theory marks");return}y("");const{id:k,..._}=m.unit,I=Array.isArray(m.unit.questions)?m.unit.questions.map(({id:R,...Y})=>Y):[],D={..._,marks:E,schoolClass:{id:Number(n)},subject:{id:Number(u)},exam:{id:Number(r)},questions:I};console.log("[DEBUG] Saving unit with payload:",D),m.mode==="add"?await N2(D):await R2(m.unit.id,D),$d(Number(r),Number(n),Number(u)).then(x),g({open:!1,mode:"add",unit:{name:"",marks:0,questions:[]}})},A=async w=>{var k;if(!r||!n||!u){y("Please select exam, class, and subject before deleting a unit.");return}try{await O2(w),$d(Number(r),Number(n),Number(u)).then(x)}catch(_){((k=_==null?void 0:_.response)==null?void 0:k.status)===409?y("Cannot delete exam: blueprints are attached. Please delete all blueprints first."):y("Failed to delete unit. Please try again.")}};return a.jsxs(ee,{mt:2,children:[a.jsx(ee,{display:"flex",alignItems:"center",gap:2,mb:2,children:a.jsxs(Se,{select:!0,label:"Select Exam",value:r,onChange:l,size:"small",sx:{minWidth:180},SelectProps:{native:!0},children:[a.jsx("option",{value:"",children:"Select Exam"}),e.map(w=>a.jsx("option",{value:w.id,children:w.name},w.id))]})}),a.jsxs(X,{container:!0,spacing:2,alignItems:"center",sx:{mb:2},children:[a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(Se,{select:!0,label:"Select Class",value:n,onChange:w=>s(w.target.value),fullWidth:!0,SelectProps:{native:!0},children:[a.jsx("option",{value:"",children:"Select Class"}),i.map(w=>a.jsx("option",{value:w.id,children:w.name},w.id))]})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(Se,{select:!0,label:"Select Subject",value:u,onChange:w=>f(w.target.value),fullWidth:!0,SelectProps:{native:!0},disabled:!n,children:[a.jsx("option",{value:"",children:"Select Subject"}),c.map(w=>a.jsx("option",{value:w.id,children:w.name},w.id))]})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(ye,{variant:"contained",startIcon:a.jsx(Zc,{}),disabled:!u||!n,onClick:()=>g({open:!0,mode:"add",unit:{name:"",marks:0}}),children:"Add Unit/Chapter"})})]}),u&&a.jsx(Jt,{component:jt,children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Unit/Chapter Name"}),a.jsx(Q,{children:"Number of Questions"}),a.jsx(Q,{children:"Marks"}),a.jsx(Q,{children:"Actions"})]})}),a.jsxs(Ht,{children:[h.map(w=>a.jsxs(Ge,{children:[a.jsx(Q,{children:w.name}),a.jsx(Q,{children:Array.isArray(w.questions)?w.questions.reduce((k,_)=>k+(_.count||0),0):0}),a.jsx(Q,{children:w.marks}),a.jsxs(Q,{children:[a.jsx(st,{onClick:()=>{const k={id:w.id,name:w.name,marks:w.marks,questions:w.questions||[],schoolClass:w.schoolClass&&w.schoolClass.id?{id:w.schoolClass.id}:void 0,subject:w.subject&&w.subject.id?{id:w.subject.id}:void 0,exam:w.exam&&w.exam.id?{id:w.exam.id}:void 0};g({open:!0,mode:"edit",unit:k})},children:a.jsx(hl,{})}),a.jsx(st,{onClick:()=>A(w.id),children:a.jsx(to,{})})]})]},w.id)),a.jsxs(Ge,{children:[a.jsx(Q,{children:a.jsx("strong",{children:"Total"})}),a.jsx(Q,{}),a.jsx(Q,{children:a.jsxs("strong",{children:[v," / ",S]})}),a.jsx(Q,{})]})]})]})}),a.jsxs(At,{open:m.open,onClose:()=>g({open:!1,mode:"add",unit:{name:"",marks:0,questions:[]}}),children:[a.jsx(Dt,{children:m.mode==="add"?"Add Unit/Chapter":"Edit Unit/Chapter"}),a.jsxs(Tt,{children:[a.jsx(Jt,{component:jt,sx:{mt:2},children:a.jsxs(Vt,{children:[a.jsxs(Wt,{children:[a.jsxs(Ge,{children:[a.jsx(Q,{children:"Unit/Chapter Name"}),a.jsx(Q,{children:"Number of Questions"}),a.jsx(Q,{children:"Marks per Question"})]}),a.jsxs(Ge,{children:[a.jsx(Q,{children:a.jsx(Se,{value:m.unit.name,onChange:w=>g({...m,unit:{...m.unit,name:w.target.value}}),placeholder:"Unit Name",size:"small"})}),a.jsx(Q,{children:a.jsx(Se,{type:"number",value:m.unit.questions&&m.unit.questions[0]?m.unit.questions[0].count:"",onChange:w=>{const k=parseInt(w.target.value)||0,_=m.unit.questions&&m.unit.questions.length>0?[...m.unit.questions]:[{count:0,marksPerQuestion:0}];_[0].count=k,g({...m,unit:{...m.unit,questions:_}})},placeholder:"Questions",size:"small"})}),a.jsx(Q,{children:a.jsx(Se,{type:"number",value:m.unit.questions&&m.unit.questions[0]?m.unit.questions[0].marksPerQuestion:"",onChange:w=>{const k=parseInt(w.target.value)||0,_=m.unit.questions&&m.unit.questions.length>0?[...m.unit.questions]:[{count:0,marksPerQuestion:0}];_[0].marksPerQuestion=k,g({...m,unit:{...m.unit,questions:_}})},placeholder:"Marks/Question",size:"small"})})]})]}),a.jsx(Ht,{children:h.map(w=>a.jsxs(Ge,{children:[a.jsx(Q,{children:w.name}),a.jsx(Q,{children:w.questions&&w.questions[0]?w.questions[0].count:""}),a.jsx(Q,{children:w.questions&&w.questions[0]?w.questions[0].marksPerQuestion:""})]},w.id))})]})}),a.jsxs(V,{variant:"body2",sx:{mb:1},children:["Total Marks: ",E]}),p&&a.jsx(V,{color:"error",children:p})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>g({open:!1,mode:"add",unit:{name:"",marks:0,questions:[]}}),children:"Cancel"}),a.jsx(ye,{onClick:C,variant:"contained",children:"Save"})]})]})]})},B2=({exams:e,classes:r,subjects:t,selectedExam:n,setSelectedExam:s,selectedClass:i,setSelectedClass:o,selectedSubject:l,setSelectedSubject:c,blueprintUnits:d})=>{console.log("[QPF] exams:",e);const[u,f]=b.useState(1),[h,x]=b.useState([{marks:"",unit:""}]);b.useState("");const[m,g]=b.useState({open:!1,success:!0,message:""}),[p,y]=b.useState(!1),S=async()=>{var P;if(!n||!i||!l){g({open:!0,success:!1,message:"Please select exam, class, and subject."});return}y(!0);try{const M=h.map((K,L)=>({examId:n,classId:i,subjectId:l,questionNumber:L+1,unitName:K.unit,marks:K.marks}));await Sn.post("/api/question-paper-format/batch",M,{params:{examId:n,classId:i,subjectId:l},headers:{...Y(),"Content-Type":"application/json"}}),g({open:!0,success:!0,message:"Question paper format saved successfully."})}catch(M){let K="Failed to save question paper format.";M.response?(console.error("Backend error:",M.response.status,M.response.data),K=((P=M.response.data)==null?void 0:P.message)||JSON.stringify(M.response.data)||K):M.request?(console.error("No response received:",M.request),K="No response from server."):(console.error("Error setting up request:",M.message),K=M.message),g({open:!0,success:!1,message:K})}finally{y(!1)}},v=()=>{var L,ae,Z;const P=((L=(e||[]).find(T=>String(T.id)===String(n)))==null?void 0:L.name)||"",M=((ae=(r||[]).find(T=>String(T.id)===String(i)))==null?void 0:ae.name)||"",K=((Z=(t||[]).find(T=>String(T.id)===String(l)))==null?void 0:Z.name)||"";return{examName:P,className:M,subjectName:K}},E=()=>{if(!n||!i||!l)return;const{examName:P,className:M,subjectName:K}=v(),L=de=>{if(de==null)return"";const z=String(de);return/[",\n]/.test(z)?'"'+z.replace(/"/g,'""')+'"':z},ae=[["Exam",P],["Class",M],["Subject",K],["Total Questions",u],["Total Marks",B]].map(de=>de.map(L).join(",")).join(`
`),Z=["Question","Marks","Unit"].join(","),T=h.map((de,z)=>[z+1,de.marks||0,de.unit||""].map(L).join(",")).join(`
`),N=ae+`

`+Z+`
`+T+`
`,H=new Blob([N],{type:"text/csv;charset=utf-8;"}),G=URL.createObjectURL(H),q=document.createElement("a"),oe=`QPF_${P||"Exam"}_${M||"Class"}_${K||"Subject"}.csv`.replace(/\s+/g,"_");q.href=G,q.download=oe,q.style.display="none",document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(G)},C=()=>{if(!n||!i||!l)return;const{examName:P,className:M,subjectName:K}=v(),L=window.open("","_blank","noopener,noreferrer");if(!L){alert("Popup blocked. Please allow popups for this site to use Print, or use your browser's print (Ctrl+P).");return}const ae=h.map((T,N)=>`
      <tr>
        <td style="text-align:center">${N+1}</td>
        <td style="text-align:center">${T.marks||""}</td>
        <td>${T.unit||""}</td>
      </tr>`).join(""),Z=`<!doctype html>
      <html>
      <head>
        <meta charset="utf-8" />
        <title>Question Paper Format - ${P}</title>
        <style>
          body{font-family:Arial,Helvetica,sans-serif;padding:24px;}
          h1{font-size:20px;margin:0 0 4px 0}
          .meta{margin-bottom:16px;color:#444}
          table{width:100%;border-collapse:collapse}
          th,td{border:1px solid #999;padding:6px}
          th{background:#f3f3f3}
          .footer{margin-top:16px;color:#444}
        </style>
      </head>
      <body>
        <h1>Question Paper Format</h1>
        <div class="meta"><strong>Exam:</strong> ${P} &nbsp; | &nbsp; <strong>Class:</strong> ${M} &nbsp; | &nbsp; <strong>Subject:</strong> ${K}</div>
        <table>
          <thead>
            <tr><th style="width:90px">Q#</th><th style="width:120px">Marks</th><th>Unit Name</th></tr>
          </thead>
          <tbody>
            ${ae}
          </tbody>
        </table>
        <div class="footer">Total Questions: ${u} &nbsp; | &nbsp; Total Marks: ${B}</div>
      </body></html>`;L.document.open(),L.document.write(Z),L.document.close(),setTimeout(()=>{try{L.focus(),L.print()}catch{}},100)},A=b.useMemo(()=>{if(!l)return 100;const P=t.find(M=>String(M.id)===String(l));return P?P.theoryMarks??P.maxMarks??100:100},[l,t]),j=(P,M,K)=>{x(L=>L.map((ae,Z)=>Z===P?{...ae,[M]:K}:ae))},w=P=>{x(M=>M.filter((K,L)=>L!==P)),f(M=>Math.max(1,M-1))},k=()=>{x(P=>[...P,{marks:"",unit:""}]),f(P=>P+1)},_=b.useMemo(()=>{const P={};return h.forEach(M=>{M.unit&&M.marks&&(P[M.unit]=(P[M.unit]||0)+parseFloat(M.marks))}),P},[h]),I=b.useMemo(()=>{const P={};return d.forEach(M=>{P[M.name]=M.marks}),P},[d]),D=Object.entries(_).some(([P,M])=>I[P]!==void 0&&M!==I[P]),B=h.reduce((P,M)=>P+(parseFloat(M.marks)||0),0),R=A>0&&B>A;h.map((P,M)=>({unit:P.unit,question:M+1,marks:P.marks}));const Y=()=>{const P=localStorage.getItem("token");return P?{Authorization:`Bearer ${P}`}:{}};return b.useEffect(()=>{n&&i&&l?Sn.get("/api/question-paper-format",{params:{examId:n,classId:i,subjectId:l},headers:{...Y(),"Content-Type":"application/json"}}).then(P=>{Array.isArray(P.data)&&P.data.length>0?(x(P.data.map(M=>({marks:M.marks,unit:M.unitName,id:M.id}))),f(P.data.length)):(x([{marks:"",unit:""}]),f(1))}).catch(()=>{x([{marks:"",unit:""}]),f(1)}):(x([{marks:"",unit:""}]),f(1))},[n,i,l]),a.jsxs(ee,{children:[a.jsx(V,{variant:"h6",sx:{mb:2},children:"Question Paper Format"}),a.jsxs(X,{container:!0,spacing:2,alignItems:"center",sx:{mb:2},children:[a.jsx(X,{item:!0,xs:12,md:3,children:a.jsxs(rt,{fullWidth:!0,size:"small",children:[a.jsx(ot,{children:"Exam"}),a.jsx(tt,{value:n,label:"Exam",onChange:P=>{s(P.target.value),o(""),c("")},disabled:e.length===0,children:e&&e.map(P=>a.jsx(Te,{value:P.id,children:P.name},P.id))})]})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsxs(rt,{fullWidth:!0,size:"small",children:[a.jsx(ot,{children:"Class"}),a.jsx(tt,{value:i,label:"Class",onChange:P=>{o(P.target.value),c("")},disabled:r.length===0||!n,children:r.map(P=>a.jsx(Te,{value:P.id,children:P.name},P.id))})]})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsxs(rt,{fullWidth:!0,size:"small",children:[a.jsx(ot,{children:"Subject"}),a.jsx(tt,{value:l,label:"Subject",onChange:P=>c(P.target.value),disabled:!i,children:t.map(P=>a.jsx(Te,{value:P.id,children:P.name},P.id))})]})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(Se,{label:"Total Questions",type:"text",size:"small",value:u,onChange:P=>{const M=P.target.value.replace(/[^0-9]/g,"");if(M===""){f(""),x([{marks:"",unit:""}]);return}let K=parseInt(M,10);(isNaN(K)||K<1)&&(K=1),f(K),x(L=>{const ae=[...L];for(;ae.length<K;)ae.push({marks:"",unit:""});return ae.slice(0,K)})},fullWidth:!0,disabled:!l})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsxs(V,{color:R?"error":"text.secondary",children:["Total Marks: ",B," / ",A]})})]}),R&&a.jsx(V,{color:"error",sx:{mb:2},children:"Total marks exceed subject's theory marks!"}),D&&a.jsx(V,{color:"error",sx:{mb:2},children:"Per-unit marks do not match blueprint marks!"}),a.jsx(Jt,{component:jt,sx:{mb:2},children:a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Q#"}),a.jsx(Q,{children:"Marks"}),a.jsx(Q,{children:"Unit Name"}),a.jsx(Q,{children:"Actions"})]})}),a.jsx(Ht,{children:h.map((P,M)=>a.jsxs(Ge,{children:[a.jsx(Q,{children:M+1}),a.jsx(Q,{children:a.jsx(Se,{type:"number",size:"small",value:P.marks,onChange:K=>j(M,"marks",K.target.value),inputProps:{min:0}})}),a.jsx(Q,{children:a.jsx(rt,{fullWidth:!0,size:"small",children:a.jsx(tt,{value:P.unit,onChange:K=>j(M,"unit",K.target.value),children:d.map(K=>a.jsx(Te,{value:K.name,children:K.name},K.name))})})}),a.jsx(Q,{children:a.jsx(st,{onClick:()=>w(M),disabled:h.length===1,children:a.jsx(to,{})})})]},M))})]})}),a.jsx(ye,{variant:"outlined",onClick:k,sx:{mb:2,mr:2},children:"Add Question"}),a.jsx(ye,{variant:"outlined",onClick:E,sx:{mb:2,mr:2},disabled:!n||!i||!l,children:"Download CSV"}),a.jsx(ye,{variant:"outlined",onClick:C,sx:{mb:2,mr:2},disabled:!n||!i||!l,children:"Print"}),a.jsx(ye,{variant:"contained",color:"primary",onClick:S,sx:{mb:2},disabled:p,startIcon:p?a.jsx(vr,{size:18}):null,children:"Save"}),a.jsx(Fa,{open:m.open,autoHideDuration:3e3,onClose:()=>g(P=>({...P,open:!1})),children:a.jsx(pt,{onClose:()=>g(P=>({...P,open:!1})),severity:m.success?"success":"error",sx:{width:"100%"},children:m.message})})]})},ki="/api",U2=({classes:e=[]})=>{const[r,t]=b.useState([]),[n,s]=b.useState(!1),[i,o]=b.useState(null),[l,c]=b.useState({name:"",startDate:"",endDate:"",classIds:[]}),[d,u]=b.useState(""),[f,h]=b.useState(null);b.useEffect(()=>{fetch(`${ki}/exams`,{headers:x()}).then(E=>E.ok?E.json():Promise.reject("Failed to load exams")).then(t).catch(()=>t([]))},[]);const x=()=>{const E=localStorage.getItem("token");return E?{Authorization:`Bearer ${E}`}:{}},m=(E=null,C=null)=>{E?(c({...E}),o(C)):(c({name:"",startDate:"",endDate:"",classIds:[]}),o(null)),u(""),s(!0)},g=()=>{s(!1),c({name:"",startDate:"",endDate:"",classIds:[]}),o(null),u("")},p=(E,C)=>{c(A=>({...A,[E]:C}))},y=()=>{var j;if(!l.name||!l.startDate||!l.endDate||!l.classIds.length){u("All fields are required.");return}const E={name:l.name,description:l.description||"",startDate:l.startDate,endDate:l.endDate,classIds:l.classIds},C=i!==null?"PUT":"POST",A=i!==null&&((j=r[i])!=null&&j.id)?`${ki}/exams/${r[i].id}`:`${ki}/exams`;fetch(A,{method:C,headers:{...x(),"Content-Type":"application/json"},body:JSON.stringify(E)}).then(w=>w.ok?w.json():Promise.reject("Failed to save exam")).then(()=>{fetch(`${ki}/exams`,{headers:x()}).then(w=>w.ok?w.json():[]).then(t),g()}).catch(()=>u("Unable to save exam."))},S=E=>{const C=r[E];if(!(C!=null&&C.id)){u("Invalid exam selected.");return}h(E)},v=()=>{const E=r[f];if(!(E!=null&&E.id)){h(null);return}fetch(`${ki}/exams/${E.id}`,{method:"DELETE",headers:x()}).then(()=>{fetch(`${ki}/exams`,{headers:x()}).then(C=>C.ok?C.json():[]).then(t),h(null)}).catch(()=>h(null))};return a.jsxs(ee,{children:[a.jsxs(ee,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[a.jsx(V,{variant:"h6",children:"Exam Management"}),a.jsx(ye,{variant:"contained",startIcon:a.jsx(Zc,{}),onClick:()=>m(),children:"Add Exam"})]}),d&&a.jsx(ee,{mb:2,children:a.jsx(V,{color:"error",children:d})}),a.jsx(Jt,{component:jt,children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Exam Name"}),a.jsx(Q,{children:"Start Date"}),a.jsx(Q,{children:"End Date"}),a.jsx(Q,{children:"Classes"}),a.jsx(Q,{align:"right",children:"Actions"})]})}),a.jsx(Ht,{children:r.length===0?a.jsx(Ge,{children:a.jsx(Q,{colSpan:5,align:"center",children:"No exams created yet."})}):r.map((E,C)=>a.jsxs(Ge,{children:[a.jsx(Q,{children:E.name}),a.jsx(Q,{children:E.startDate}),a.jsx(Q,{children:E.endDate}),a.jsx(Q,{children:E.classIds.map(A=>{const j=e.find(w=>w.id===A);return j?a.jsx(at,{label:j.name,size:"small",sx:{mr:.5}},A):null})}),a.jsxs(Q,{align:"right",children:[a.jsx(st,{onClick:()=>m(E,C),children:a.jsx(hl,{})}),a.jsx(st,{color:"error",onClick:()=>S(C),children:a.jsx(to,{})})]})]},C))})]})}),a.jsxs(At,{open:n,onClose:g,maxWidth:"sm",fullWidth:!0,children:[a.jsx(Dt,{children:i!==null?"Edit Exam":"Add Exam"}),a.jsx(Tt,{children:a.jsxs(ee,{display:"flex",flexDirection:"column",gap:2,mt:1,children:[a.jsx(Se,{label:"Exam Name",value:l.name,onChange:E=>p("name",E.target.value),fullWidth:!0,required:!0}),a.jsx(Se,{label:"Start Date",type:"date",value:l.startDate,onChange:E=>p("startDate",E.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,required:!0}),a.jsx(Se,{label:"End Date",type:"date",value:l.endDate,onChange:E=>p("endDate",E.target.value),InputLabelProps:{shrink:!0},fullWidth:!0,required:!0}),a.jsxs(ee,{children:[a.jsx(V,{variant:"body2",sx:{mb:.5,ml:.2},color:"text.secondary",children:"Classes *"}),a.jsxs(tt,{label:"Classes",multiple:!0,value:l.classIds,onChange:E=>{const C=E.target.value;C.includes("all")?p("classIds",l.classIds.length===e.length?[]:e.map(A=>A.id)):p("classIds",C)},renderValue:E=>E.length===e.length?"All Classes":E.map(C=>{const A=e.find(j=>j.id===C);return A?A.name:C}).join(", "),fullWidth:!0,required:!0,children:[a.jsxs(Te,{value:"all",children:[a.jsx(Zs,{checked:l.classIds.length===e.length,indeterminate:l.classIds.length>0&&l.classIds.length<e.length}),a.jsx(Fr,{primary:"Select All"})]}),e.map(E=>a.jsxs(Te,{value:E.id,children:[a.jsx(Zs,{checked:l.classIds.indexOf(E.id)>-1}),a.jsx(Fr,{primary:E.name})]},E.id))]})]}),d&&a.jsx(V,{color:"error",children:d})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:g,children:"Cancel"}),a.jsx(ye,{variant:"contained",onClick:y,children:i!==null?"Update":"Create"})]})]}),a.jsxs(At,{open:f!==null,onClose:()=>h(null),children:[a.jsx(Dt,{children:"Delete Exam"}),a.jsx(Tt,{children:a.jsx(V,{children:"Deleting this exam will also delete all related blueprints. Are you sure you want to proceed?"})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>h(null),children:"Cancel"}),a.jsx(ye,{color:"error",variant:"contained",onClick:v,children:"Delete"})]})]})]})},V2=({classes:e,selectedClass:r,setSelectedClass:t,subjects:n,newConfig:s,setNewConfig:i,handleConfigSave:o,configs:l,setConfirmDialog:c,error:d,setCopyDialog:u,copyDialog:f,copySource:h,setCopySource:x,copyTargets:m,setCopyTargets:g,handleCopyConfig:p})=>a.jsxs(a.Fragment,{children:[a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(tt,{value:r,onChange:y=>t(y.target.value),displayEmpty:!0,fullWidth:!0,children:[a.jsx(Te,{value:"",children:a.jsx("em",{children:"Select Class"})}),e.map(y=>a.jsx(Te,{value:y.id,children:y.name},y.id))]})}),a.jsx(X,{item:!0,xs:12,md:8,children:a.jsx(ye,{variant:"contained",startIcon:a.jsx(Tg,{}),onClick:()=>u(!0),disabled:!r,children:"Copy Configuration"})})]}),r&&a.jsxs(a.Fragment,{children:[a.jsxs(ee,{mt:3,mb:2,children:[a.jsx(V,{variant:"h6",children:"Assign Subject"}),a.jsxs(X,{container:!0,spacing:2,alignItems:"center",sx:{mt:2},children:[a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(V,{variant:"subtitle2",align:"center",children:"Subject"})}),a.jsx(X,{item:!0,xs:12,md:2,children:a.jsx(V,{variant:"subtitle2",align:"center",children:"Max Marks"})}),a.jsx(X,{item:!0,xs:12,md:2,children:a.jsx(V,{variant:"subtitle2",align:"center",children:"Theory"})}),a.jsx(X,{item:!0,xs:12,md:2,children:a.jsx(V,{variant:"subtitle2",align:"center",children:"Practical"})})]}),a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,xs:12,md:3,children:a.jsxs(tt,{value:s.subjectId,onChange:y=>{const S=y.target.value,v=n.find(E=>E.id===S);i({subjectId:S,maxMarks:(v==null?void 0:v.maxMarks)??"",theoryMarks:(v==null?void 0:v.theoryMarks)??"",practicalMarks:(v==null?void 0:v.practicalMarks)??""})},displayEmpty:!0,fullWidth:!0,children:[a.jsx(Te,{value:"",children:a.jsx("em",{children:"Select Subject"})}),n.map(y=>a.jsx(Te,{value:y.id,children:y.name},y.id))]})}),a.jsx(X,{item:!0,xs:12,md:2,children:a.jsx(Se,{type:"number",value:s.maxMarks,InputProps:{readOnly:!0},fullWidth:!0})}),a.jsx(X,{item:!0,xs:12,md:2,children:a.jsx(Se,{type:"number",value:s.theoryMarks,InputProps:{readOnly:!0},fullWidth:!0})}),a.jsx(X,{item:!0,xs:12,md:2,children:a.jsx(Se,{type:"number",value:s.practicalMarks,InputProps:{readOnly:!0},fullWidth:!0})}),a.jsx(X,{item:!0,xs:12,md:2,children:a.jsx(ye,{variant:"contained",onClick:o,children:"Assign"})})]}),d&&a.jsx(V,{color:"error",children:d})]}),a.jsx(Jt,{component:jt,children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Subject"}),a.jsx(Q,{children:"Max Marks"}),a.jsx(Q,{children:"Theory"}),a.jsx(Q,{children:"Practical"}),a.jsx(Q,{children:"Actions"})]})}),a.jsx(Ht,{children:l.map(y=>a.jsxs(Ge,{children:[a.jsx(Q,{children:y.subject.name}),a.jsx(Q,{children:y.maxMarks}),a.jsx(Q,{children:y.theoryMarks}),a.jsx(Q,{children:y.practicalMarks}),a.jsx(Q,{children:a.jsx(st,{onClick:()=>c({open:!0,type:"deleteConfig",payload:y.id}),size:"small","aria-label":"Delete",children:a.jsx(to,{})})})]},y.id))})]})})]})]}),W2=({subjectSearch:e,setSubjectSearch:r,subjectFeedback:t,setSubjectDialog:n,setBulkDialog:s,bulkDialog:i,handleBulkTemplateDownload:o,fileInputRef:l,handleBulkFileChange:c,bulkErrors:d,bulkSubjects:u,handleBulkUpload:f,subjects:h,setConfirmDialog:x})=>a.jsxs(ee,{children:[a.jsx(V,{variant:"h6",children:"Manage Subjects"}),a.jsxs(ee,{display:"flex",alignItems:"center",mb:2,mt:1,children:[a.jsx(Se,{label:"Search Subjects",value:e,onChange:m=>r(m.target.value),size:"small",sx:{mr:2,width:250}}),a.jsx(ye,{startIcon:a.jsx(Zc,{}),onClick:()=>n({open:!0,mode:"add",subject:{maxMarks:100,theoryMarks:100,practicalMarks:0}}),sx:{mr:2},children:"Add Subject"}),a.jsx(ye,{variant:"outlined",onClick:()=>s(!0),children:"Bulk Upload"}),t&&a.jsx(V,{color:"success.main",sx:{ml:2},children:t})]}),a.jsxs(At,{open:i,onClose:()=>{s(!1)},maxWidth:"md",fullWidth:!0,children:[a.jsx(Dt,{children:"Bulk Upload Subjects"}),a.jsxs(Tt,{children:[a.jsx(ye,{variant:"outlined",onClick:o,sx:{mb:2,mr:2},children:"Download Template"}),a.jsxs(ye,{variant:"outlined",component:"label",sx:{mb:2},children:["Select CSV File",a.jsx("input",{type:"file",accept:".csv",hidden:!0,ref:l,onChange:c})]}),d.length>0&&a.jsx(ee,{color:"error.main",mb:2,children:d.map((m,g)=>a.jsx("div",{children:m},g))}),u.length>0&&a.jsx(Jt,{component:jt,sx:{mb:2},children:a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Name"}),a.jsx(Q,{children:"Code"}),a.jsx(Q,{children:"Description"}),a.jsx(Q,{children:"Max Marks"}),a.jsx(Q,{children:"Theory Marks"}),a.jsx(Q,{children:"Practical Marks"})]})}),a.jsx(Ht,{children:u.map((m,g)=>a.jsxs(Ge,{children:[a.jsx(Q,{children:m.name}),a.jsx(Q,{children:m.code}),a.jsx(Q,{children:m.description}),a.jsx(Q,{children:m.max_marks}),a.jsx(Q,{children:m.theory_marks}),a.jsx(Q,{children:m.practical_marks})]},g))})]})})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>s(!1),children:"Cancel"}),a.jsx(ye,{onClick:f,disabled:d.length>0||u.length===0,variant:"contained",children:"Upload"})]})]}),a.jsx(Jt,{component:jt,sx:{mt:2},children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Name"}),a.jsx(Q,{children:"Code"}),a.jsx(Q,{children:"Description"}),a.jsx(Q,{children:"Max Marks"}),a.jsx(Q,{children:"Theory"}),a.jsx(Q,{children:"Practical"}),a.jsx(Q,{children:"Actions"})]})}),a.jsx(Ht,{children:h.filter(m=>m.name.toLowerCase().includes(e.toLowerCase())||(m.code||"").toLowerCase().includes(e.toLowerCase())).map(m=>a.jsxs(Ge,{children:[a.jsx(Q,{children:m.name}),a.jsx(Q,{children:m.code}),a.jsx(Q,{children:m.description}),a.jsx(Q,{children:m.maxMarks??100}),a.jsx(Q,{children:m.theoryMarks??m.maxMarks??100}),a.jsx(Q,{children:m.practicalMarks??0}),a.jsxs(Q,{children:[a.jsx(st,{onClick:()=>n({open:!0,mode:"edit",subject:{...m,maxMarks:m.maxMarks??100,theoryMarks:m.theoryMarks??m.maxMarks??100,practicalMarks:m.practicalMarks??0}}),size:"small","aria-label":"Edit",children:a.jsx(hl,{})}),a.jsx(st,{onClick:()=>x({open:!0,type:"deleteSubject",payload:m.id}),size:"small","aria-label":"Delete",children:a.jsx(to,{})})]})]},m.id))})]})})]}),Wr="/api",H2=({apiBaseUrl:e})=>{var Fe;const[r,t]=b.useState(""),[n,s]=b.useState(""),[i,o]=b.useState(""),[l,c]=b.useState([]),[d,u]=b.useState([]);b.useEffect(()=>{P(""),r&&r!==""&&!isNaN(Number(r))?fetch(`${Wr}/exam-configs?classId=${r}`,{headers:{...U(),"Content-Type":"application/json"},credentials:"include"}).then(me=>me.ok?me.json():Promise.reject("Failed to load exam configs")).then(me=>{c(Array.isArray(me)?me:[]),S(Array.isArray(me)?me:[]),console.log("[QPF] examConfig for class",r,me)}).catch(me=>{c([]),S([]),P(typeof me=="string"?me:"Unable to load exam configs.")}):(c([]),S([]))},[r,Wr]),b.useEffect(()=>{console.log("[DEBUG] exams state:",d)},[d]),b.useEffect(()=>{t("")},[i]);const[f,h]=b.useState([]);b.useEffect(()=>{async function me(){if(i&&r&&n)try{const ne=await(await fetch(`/api/blueprint?examId=${i}&classId=${r}&subjectId=${n}`,{headers:{...U(),"Content-Type":"application/json"}})).json();h(Array.isArray(ne)?ne:[])}catch{h([])}else h([])}me()},[i,r,n]);const[x,m]=b.useState([]),[g,p]=b.useState([]),[y,S]=b.useState([]),[v,E]=b.useState({open:!1,mode:"add",subject:{maxMarks:100,theoryMarks:100,practicalMarks:0}}),[C,A]=b.useState({open:!1,type:"",payload:null}),[j,w]=b.useState(!1),[k,_]=b.useState(""),[I,D]=b.useState([]),[B,R]=b.useState({subjectId:"",maxMarks:"",theoryMarks:"",practicalMarks:""}),[Y,P]=b.useState(""),[M,K]=b.useState(0),[L,ae]=b.useState("");b.useEffect(()=>{fetch("/api/exams",{headers:{...U(),"Content-Type":"application/json"},credentials:"include"}).then(me=>me.ok?me.json():[]).then(me=>{Array.isArray(me)?console.log(`[API] /api/exams: count=${me.length}`,me.length>0?me[0]:"(empty)"):console.log("[API] /api/exams: response not array",me),u(me)}).catch(()=>u([]))},[]);const[Z,T]=b.useState(""),[N,H]=b.useState(!1),[G,q]=b.useState([]),[oe,de]=b.useState([]),z=b.useRef(),O=()=>{window.open("/subject_bulk_template.csv","_blank")},W=me=>{const ve=me.target.files[0];ve&&k2.parse(ve,{header:!0,skipEmptyLines:!0,complete:ne=>{const we=ne.data,Ee=[],pe=new Set;we.forEach((Ce,ue)=>{(!Ce.name||!Ce.code)&&Ee.push(`Row ${ue+2}: Name and Code are required.`),pe.has(Ce.code)&&Ee.push(`Row ${ue+2}: Duplicate code in file: ${Ce.code}`),pe.add(Ce.code),(isNaN(Number(Ce.max_marks))||isNaN(Number(Ce.theory_marks))||isNaN(Number(Ce.practical_marks)))&&Ee.push(`Row ${ue+2}: Marks fields must be numbers.`)}),q(we),de(Ee)},error:ne=>de([ne.message])})},F=async()=>{T("");try{const me={subjects:G.map(ne=>({name:ne.name,code:ne.code,description:ne.description,maxMarks:Number(ne.max_marks),theoryMarks:Number(ne.theory_marks),practicalMarks:Number(ne.practical_marks)})),expectedCount:G.length};if(!(await fetch(`${Wr}/subjects/bulk`,{method:"POST",headers:{...U(),"Content-Type":"application/json"},body:JSON.stringify(me)})).ok)throw new Error("Bulk upload failed");H(!1),q([]),de([]),T("Bulk upload successful!"),fetch(`${Wr}/subjects`,{headers:{...U(),"Content-Type":"application/json"}}).then(ne=>ne.ok?ne.json():Promise.reject("Failed to load subjects")).then(p)}catch(me){de([me.message])}},U=()=>{const me=localStorage.getItem("token");return me?{Authorization:`Bearer ${me}`}:{}};b.useEffect(()=>{P(""),fetch(`${Wr}/subjects`,{headers:{...U(),"Content-Type":"application/json"}}).then(me=>me.ok?me.json():Promise.reject("Failed to load subjects")).then(p).catch(me=>P(typeof me=="string"?me:"Unable to load subjects."))},[Wr]),b.useEffect(()=>{P(""),fetch(`${Wr}/classes`,{headers:{...U(),"Content-Type":"application/json"}}).then(me=>me.ok?me.json():Promise.reject("Failed to load classes")).then(me=>{console.log("[DEBUG] /api/classes payload:",me),m(me)}).catch(me=>P(typeof me=="string"?me:"Unable to load classes."))},[Wr]);const te=()=>{const{id:me,name:ve,code:ne,description:we,maxMarks:Ee,theoryMarks:pe,practicalMarks:Ce}=v.subject,ue=parseInt(Ee)||0,Me=parseInt(pe)||0,ke=parseInt(Ce)||0,Ae={name:ve,code:ne,description:we,maxMarks:ue,theoryMarks:Me,practicalMarks:ke};if(console.log("[DEBUG] handleSubjectSave payload:",Ae),!ve||ve.trim()===""){P("Subject name is required");return}if(ne&&g.some(Ve=>Ve.code===ne&&Ve.id!==me)){P("Subject code must be unique");return}if(Me+ke!==ue){console.log("[Subject Save] Validation failed:",{m:ue,t:Me,p:ke}),P("Theory + Practical must equal Max Marks");return}const Ue=v.mode==="add"?"POST":"PUT",Ye=v.mode==="add"?`${Wr}/subjects`:`${Wr}/subjects/${me}`;fetch(Ye,{method:Ue,headers:{...U(),"Content-Type":"application/json"},body:JSON.stringify(Ae)}).then(Ve=>Ve.ok?Ve.json():Promise.reject("Failed to save subject")).then(()=>{fetch(`${Wr}/subjects`,{headers:{...U(),"Content-Type":"application/json"}}).then(Ve=>Ve.ok?Ve.json():[]).then(p),E({open:!1,mode:"add",subject:{maxMarks:100,theoryMarks:100,practicalMarks:0}}),P(""),T(v.mode==="add"?"Subject added successfully.":"Subject updated successfully."),setTimeout(()=>T(""),2e3)}).catch(Ve=>{P(typeof Ve=="string"?Ve:"Unable to save subject."),T("")})},he=me=>{const ve=g.find(ne=>ne.id===me);fetch(`${Wr}/subjects/${me}`,{method:"DELETE",headers:{...U(),"Content-Type":"application/json"}}).then(ne=>ne.ok?ne:Promise.reject("Failed to delete subject")).then(()=>fetch(`${Wr}/subjects`,{headers:{...U(),"Content-Type":"application/json"}}).then(ne=>ne.ok?ne.json():[]).then(p)).then(()=>{T(`Subject '${(ve==null?void 0:ve.name)||""}' deleted.`),setTimeout(()=>T(""),2e3)}).catch(ne=>{P(typeof ne=="string"?ne:"Unable to delete subject."),T("")})},ie=()=>{const{subjectId:me,maxMarks:ve,theoryMarks:ne,practicalMarks:we}=B;if(console.log("[Config Save] subjectId:",me,"maxMarks:",ve,"theoryMarks:",ne,"practicalMarks:",we),!me||!ve)return P("Subject and max marks required");const Ee=parseInt(ne)||0,pe=parseInt(we)||0,Ce=parseInt(ve);if(Ee+pe!==Ce)return console.log("[Config Save] Validation failed:",{m:Ce,t:Ee,p:pe}),P("Theory + Practical must equal Max Marks");fetch(`${Wr}/exam-configs`,{method:"POST",headers:{...U(),"Content-Type":"application/json"},body:JSON.stringify({schoolClass:{id:r},subject:{id:me},maxMarks:Ce,theoryMarks:Ee,practicalMarks:pe})}).then(ue=>ue.ok?ue.json():Promise.reject("Failed to save configuration")).then(()=>{fetch(`${Wr}/exam-configs?classId=${r}`,{headers:{...U(),"Content-Type":"application/json"}}).then(ue=>ue.ok?ue.json():[]).then(S),R({subjectId:"",maxMarks:"",theoryMarks:"",practicalMarks:""}),P("")}).catch(ue=>P(typeof ue=="string"?ue:"Unable to save configuration."))},be=me=>{fetch(`${Wr}/exam-configs/${me}`,{method:"DELETE",headers:{...U(),"Content-Type":"application/json"}}).then(ve=>ve.ok?ve:Promise.reject("Failed to delete configuration")).then(()=>fetch(`${Wr}/exam-configs?classId=${r}`,{headers:{...U(),"Content-Type":"application/json"}}).then(ve=>ve.ok?ve.json():[]).then(S)).catch(ve=>P(typeof ve=="string"?ve:"Unable to delete configuration."))},xe=()=>{fetch(`${Wr}/exam-configs/copy`,{method:"POST",headers:{...U(),"Content-Type":"application/json"},body:JSON.stringify({sourceClassId:k,targetClassIds:I})}).then(me=>me.ok?me:Promise.reject("Failed to copy configuration")).then(()=>w(!1)).catch(me=>P(typeof me=="string"?me:"Unable to copy configuration."))};return Y?a.jsxs(ee,{p:2,children:[a.jsx(V,{variant:"h5",gutterBottom:!0,children:"Exam Configuration"}),a.jsx(V,{color:"error",sx:{mb:2},children:Y}),a.jsx(ye,{variant:"contained",onClick:()=>window.location.reload(),children:"Retry"})]}):a.jsxs(ee,{p:2,children:[a.jsx(V,{variant:"h5",gutterBottom:!0,children:"Examinations"}),a.jsx(ee,{sx:{overflowX:"auto",whiteSpace:"nowrap",width:"100%"},children:a.jsxs(aa,{value:M,onChange:(me,ve)=>K(ve),variant:"scrollable",scrollButtons:"auto","aria-label":"Examination Tabs",sx:{minWidth:600},children:[a.jsx(kt,{label:"Exam Management"}),a.jsx(kt,{label:"Exam Configuration"}),a.jsx(kt,{label:"Manage Subjects"}),a.jsx(kt,{label:"Blueprint"}),a.jsx(kt,{label:"Question Paper Format"})]})}),M===0&&a.jsx(U2,{classes:x}),M===1&&a.jsx(V2,{classes:x,selectedClass:r,setSelectedClass:t,subjects:g,newConfig:B,setNewConfig:R,handleConfigSave:ie,configs:y,setConfirmDialog:A,error:Y,setCopyDialog:w,copyDialog:j,copySource:k,setCopySource:_,copyTargets:I,setCopyTargets:D,handleCopyConfig:xe}),M===2&&a.jsx(W2,{subjectSearch:L,setSubjectSearch:ae,subjectFeedback:Z,setSubjectDialog:E,setBulkDialog:H,bulkDialog:N,handleBulkTemplateDownload:O,fileInputRef:z,handleBulkFileChange:W,bulkErrors:oe,bulkSubjects:G,handleBulkUpload:F,subjects:g,setConfirmDialog:A}),M===3&&a.jsx($2,{exams:d,selectedExam:i,setSelectedExam:o,classes:(()=>{const me=d.find(ne=>String(ne.id)===String(i));return me&&me.classIds?x.filter(ne=>me.classIds.includes(ne.id)):[]})(),selectedClass:i?r:"",setSelectedClass:t,subjects:g}),M===4&&a.jsx(B2,{exams:d,classes:(()=>{const me=d.find(ne=>String(ne.id)===String(i));return me&&me.classIds?x.filter(ne=>me.classIds.includes(ne.id)):[]})(),subjects:(()=>{if(!g||!l)return[];const me=l.map(ne=>{var we;return(we=ne.subject)==null?void 0:we.id}).filter(Boolean);if(me.length===0)return console.log("[QPF] No subjects linked to selected class."),[];const ve=g.filter(ne=>me.some(we=>String(we)===String(ne.id)));return console.log("[QPF] filtered subjects for dropdown:",ve),ve})(),selectedExam:i,setSelectedExam:o,selectedClass:r,setSelectedClass:t,selectedSubject:n,setSelectedSubject:s,blueprintUnits:f}),a.jsxs(At,{open:v.open,onClose:()=>E({open:!1,mode:"add",subject:{maxMarks:100,theoryMarks:100,practicalMarks:0}}),children:[a.jsx(Dt,{children:v.mode==="add"?"Add Subject":"Edit Subject"}),a.jsxs(Tt,{children:[a.jsx(Se,{label:"Name",value:v.subject.name||"",onChange:me=>E({...v,subject:{...v.subject,name:me.target.value}}),fullWidth:!0,margin:"normal"}),a.jsx(Se,{label:"Code",value:v.subject.code||"",onChange:me=>E({...v,subject:{...v.subject,code:me.target.value}}),fullWidth:!0,margin:"normal"}),a.jsx(Se,{label:"Description",value:v.subject.description||"",onChange:me=>E({...v,subject:{...v.subject,description:me.target.value}}),fullWidth:!0,margin:"normal"}),a.jsx(Se,{label:"Max Marks",type:"number",value:v.subject.maxMarks??100,onChange:me=>{const ve=parseInt(me.target.value)||0;E({...v,subject:{...v.subject,maxMarks:ve,theoryMarks:ve,practicalMarks:0}})},fullWidth:!0,margin:"normal"}),a.jsx(Se,{label:"Theory",type:"number",value:v.subject.theoryMarks??v.subject.maxMarks??100,onChange:me=>{const ve=parseInt(me.target.value)||0,ne=v.subject.maxMarks??100;E({...v,subject:{...v.subject,theoryMarks:ve>ne?ne:ve,practicalMarks:ne-(ve>ne?ne:ve)}})},fullWidth:!0,margin:"normal"}),a.jsx(Se,{label:"Practical",type:"number",value:v.subject.practicalMarks??0,onChange:me=>{const ve=parseInt(me.target.value)||0,ne=v.subject.maxMarks??100;E({...v,subject:{...v.subject,practicalMarks:ve>ne?ne:ve,theoryMarks:ne-(ve>ne?ne:ve)}})},fullWidth:!0,margin:"normal"}),Y&&a.jsx(V,{color:"error",children:Y})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>E({open:!1,mode:"add",subject:{maxMarks:100,theoryMarks:100,practicalMarks:0}}),children:"Cancel"}),a.jsx(ye,{onClick:te,variant:"contained",children:"Save"})]})]}),a.jsxs(At,{open:C.open,onClose:()=>A({open:!1,type:"",payload:null}),children:[a.jsx(Dt,{children:"Confirm"}),a.jsx(Tt,{children:a.jsx(V,{children:C.type==="deleteSubject"?`Are you sure you want to delete subject '${((Fe=g.find(me=>me.id===C.payload))==null?void 0:Fe.name)||""}'?`:"Are you sure you want to delete this configuration?"})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>A({open:!1,type:"",payload:null}),children:"Cancel"}),a.jsx(ye,{color:"error",variant:"contained",onClick:()=>{C.type==="deleteSubject"?he(C.payload):C.type==="deleteConfig"&&be(C.payload),A({open:!1,type:"",payload:null})},children:"Delete"})]})]}),a.jsxs(At,{open:j,onClose:()=>w(!1),children:[a.jsx(Dt,{children:"Copy Configuration"}),a.jsxs(Tt,{children:[a.jsxs(tt,{value:k,onChange:me=>_(me.target.value),displayEmpty:!0,fullWidth:!0,sx:{mb:2},children:[a.jsx(Te,{value:"",children:a.jsx("em",{children:"Select Source Class"})}),x.map(me=>a.jsx(Te,{value:me.id,children:me.name},me.id))]}),a.jsx(V,{children:"Select Target Classes:"}),a.jsx(ee,{children:x.filter(me=>me.id!==k).map(me=>a.jsx(Te,{value:me.id,onClick:()=>D(I.includes(me.id)?I.filter(ve=>ve!==me.id):[...I,me.id]),selected:I.includes(me.id),sx:{cursor:"pointer",background:I.includes(me.id)?"#e3f2fd":void 0},children:me.name},me.id))})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>w(!1),children:"Cancel"}),a.jsx(ye,{variant:"contained",onClick:xe,disabled:!k||I.length===0,children:"Copy"})]})]})]})},Y2=()=>a.jsxs(ee,{p:3,children:[a.jsx(V,{variant:"h4",gutterBottom:!0,children:"Exams Module"}),a.jsx(V,{variant:"body1",color:"textSecondary",sx:{mb:3},children:"Welcome to the Exams module. Please select an option below:"}),a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsx(jt,{elevation:3,children:a.jsx(Cd,{component:na,to:"/examinations/configuration",children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",color:"primary",gutterBottom:!0,children:"Exam Configuration"}),a.jsx(V,{variant:"body2",color:"textSecondary",children:"Set up and manage exam details, schedules, and patterns."})]})})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsx(jt,{elevation:3,children:a.jsx(Cd,{component:na,to:"/exams/marks/entry",children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",color:"primary",gutterBottom:!0,children:"Marks Entry"}),a.jsx(V,{variant:"body2",color:"textSecondary",children:"Enter and update student marks for examinations."})]})})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsx(jt,{elevation:3,children:a.jsx(Cd,{component:na,to:"/exams/report-cards",children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",color:"primary",gutterBottom:!0,children:"Report Cards"}),a.jsx(V,{variant:"body2",color:"textSecondary",children:"Generate and print report cards for a class across selected exams."})]})})})})]})]}),z2=Sn.create({baseURL:Et.apiUrl,timeout:Et.apiTimeout,headers:{"Content-Type":"application/json"}});let Bd=!1;const Ud=[],Es=async()=>{try{if(Bd)return console.log("üîÑ Token refresh already in progress, waiting for it to complete"),new Promise(s=>{Ud.push(i=>{s(i)})});const e=localStorage.getItem("token");if(!e)throw new Error("No token available to refresh");Bd=!0,console.log("üîÑ Attempting to refresh authentication token");const{logTokenRefresh:r}=await qr(()=>Promise.resolve().then(()=>J0),void 0);try{const i=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=JSON.parse(window.atob(i)),l=o.exp*1e3,c=Date.now();console.log("Current token info:",{username:o.sub||o.username,role:o.role||o.authorities,expiresAt:new Date(l).toLocaleString(),expired:c>l})}catch(s){console.warn("Unable to parse token for debugging:",s)}const t=await z2.post("/api/auth/refresh",{token:e}),n=t.data.token||t.data.access_token;if(!n){const s=new Error("No token received from refresh endpoint");throw r(!1,s.message),s}return localStorage.setItem("token",n),console.log("‚úÖ Token refreshed successfully"),r(!0),t.data.user&&(localStorage.setItem("user",JSON.stringify(t.data.user)),console.log("‚úÖ User data updated with refresh response")),Ud.forEach(s=>s(n)),Ud.length=0,n}catch(e){console.error("‚ùå Token refresh failed:",e);try{const{logTokenRefresh:r}=await qr(()=>Promise.resolve().then(()=>J0),void 0);r(!1,e.message||"Unknown refresh error")}catch(r){console.error("Failed to log token refresh error:",r)}throw e}finally{Bd=!1}},Cg=e=>{e.interceptors.response.use(r=>r,async r=>{var n;const t=r.config;if(((n=r.response)==null?void 0:n.status)===401&&!t._retry){t._retry=!0;try{const s=await Es();return t.headers.Authorization=`Bearer ${s}`,e(t)}catch{return Promise.reject(r)}}return Promise.reject(r)})},G2={refreshToken:Es,setupRefreshInterceptor:Cg},ed=Object.freeze(Object.defineProperty({__proto__:null,default:G2,refreshToken:Es,setupRefreshInterceptor:Cg},Symbol.toStringTag,{value:"Module"})),Dg="school_ms_user_prefs",Vf="school_ms_debug_enabled",q2={theme:"system",language:"en",dashboardLayout:"default",accessLogs:[],tokenRefreshHistory:[],debugMode:!1},li=()=>{try{const e=localStorage.getItem(Dg);if(e)return JSON.parse(e)}catch(e){console.error("Error retrieving user preferences:",e)}return{...q2}},ml=e=>{try{const t={...li(),...e};localStorage.setItem(Dg,JSON.stringify(t))}catch(r){console.error("Error saving user preferences:",r)}},Po=(e,r,t)=>{try{const s=li().accessLogs||[];s.length>50&&s.shift(),s.push({timestamp:new Date().toISOString(),page:e,success:r,error:t}),ml({accessLogs:s})}catch(n){console.error("Error logging access attempt:",n)}},_g=(e,r)=>{try{const n=li().tokenRefreshHistory||[];n.length>20&&n.shift(),n.push({timestamp:new Date().toISOString(),success:e,error:r}),ml({tokenRefreshHistory:n}),n.slice(-5).filter(o=>!o.success).length>=3&&(console.warn("‚ö†Ô∏è Multiple token refresh failures detected, enabling debug mode"),localStorage.setItem(Vf,"true"))}catch(t){console.error("Error logging token refresh:",t)}},Ig=e=>{try{localStorage.setItem(Vf,e?"true":"false");const r=li();ml({...r,debugMode:e})}catch(r){console.error("Error setting debug mode:",r)}},Wf=()=>{try{return localStorage.getItem(Vf)==="true"}catch(e){return console.error("Error checking debug mode:",e),!1}},Fg=()=>{try{const e=li(),r=localStorage.getItem("token");let t="No token";if(r)try{const n=JSON.parse(atob(r.split(".")[1])),s=n.exp*1e3,i=Date.now();t=JSON.stringify({valid:i<s,expiresAt:new Date(s).toLocaleString(),timeLeft:Math.floor((s-i)/1e3/60)+" minutes",username:n.sub||n.username,roles:n.roles||n.authorities||n.role||[]})}catch{t="Invalid token format"}return{browser:navigator.userAgent,localStorage:{hasToken:!!r,hasUserData:!!localStorage.getItem("user"),debugModeEnabled:Wf()},tokenInfo:t,accessLogs:e.accessLogs||[],tokenRefreshHistory:e.tokenRefreshHistory||[],apiUrl:window.location.origin}}catch(e){return console.error("Error generating diagnostics:",e),{error:"Failed to generate diagnostics"}}},X2={getUserPreferences:li,saveUserPreferences:ml,logAccessAttempt:Po,logTokenRefresh:_g,setDebugMode:Ig,isDebugModeEnabled:Wf,getDiagnosticsInfo:Fg},J0=Object.freeze(Object.defineProperty({__proto__:null,default:X2,getDiagnosticsInfo:Fg,getUserPreferences:li,isDebugModeEnabled:Wf,logAccessAttempt:Po,logTokenRefresh:_g,saveUserPreferences:ml,setDebugMode:Ig},Symbol.toStringTag,{value:"Module"}));class Mg extends it.Component{render(){return a.jsx(K2,{...this.props,connectionContext:this.context})}}Qe(Mg,"contextType",Sf);class K2 extends b.Component{constructor(t){super(t);Qe(this,"handleReset",async()=>{try{let t=!1;this.props.connectionContext&&(t=await this.props.connectionContext.checkConnection()),t?(this.setState({hasError:!1,error:null,errorInfo:null}),this.props.onReset&&this.props.onReset()):alert("Backend server is still unreachable. Please check your connection settings.")}catch(t){console.error("Error testing connectivity:",t),alert("Could not test connectivity. Please try again.")}});this.state={hasError:!1,error:null,errorInfo:null,isConnectionError:!1}}static getDerivedStateFromError(t){return{hasError:!0,error:t}}componentDidCatch(t,n){this.setState({errorInfo:n});const s=this.isNetworkError(t);this.setState({isConnectionError:s}),console.error("Network Error Boundary caught an error:",t,n)}isNetworkError(t){const n=t.toString().toLowerCase();return["network","connection","failed to fetch","cors","refused","timeout","offline","net::err","axios","401","403","404","500","502","503","504"].some(i=>n.includes(i))}render(){var t;return this.state.hasError?this.props.fallbackComponent&&!this.state.isConnectionError?this.props.fallbackComponent:a.jsx(ee,{sx:{p:3},children:a.jsxs(Ke,{elevation:3,sx:{p:3,backgroundColor:this.state.isConnectionError?"error.light":"warning.light",color:"white"},children:[a.jsxs(pt,{severity:this.state.isConnectionError?"error":"warning",variant:"filled",sx:{mb:2},children:[a.jsx(Mn,{children:this.state.isConnectionError?"Connection Error":"Something went wrong"}),((t=this.state.error)==null?void 0:t.message)||"An unexpected error occurred"]}),a.jsx(V,{variant:"body1",component:"div",sx:{mb:2,color:"text.primary"},children:this.state.isConnectionError?"Unable to connect to the backend server. This could be due to network issues or the server may be down.":"The application encountered an error and could not complete your request."}),a.jsxs(ee,{sx:{display:"flex",gap:2,mt:3},children:[a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(On,{}),onClick:this.handleReset,children:"Retry"}),this.state.isConnectionError&&this.props.connectionContext&&a.jsx(ye,{variant:"outlined",color:"primary",startIcon:a.jsx(tf,{}),onClick:()=>{var n;return(n=this.props.connectionContext)==null?void 0:n.setShowConnectionSettings(!0)},children:"Connection Settings"})]})]})}):this.props.children}}const Q0=({error:e,message:r="Failed to connect to the backend server",title:t="Connection Error",onRetry:n,showFallbackUI:s=!0})=>{const{checkConnection:i,setShowConnectionSettings:o}=vg(),[l,c]=b.useState(!1),d=async()=>{try{await i()?n&&n():alert("Backend server is still unreachable. Please check your connection settings.")}catch(f){console.error("Error testing connectivity:",f)}};if(!s)return null;const u=e instanceof Error?e.message:typeof e=="string"?e:r;return a.jsx(ee,{sx:{width:"100%",my:2},children:a.jsxs(Ke,{elevation:3,sx:{p:2,bgcolor:"background.paper",border:"1px solid",borderColor:"error.main",borderRadius:1},children:[a.jsxs(pt,{severity:"error",icon:a.jsx(Mx,{}),sx:{mb:2},children:[a.jsx(Mn,{children:t}),u]}),a.jsxs(ee,{sx:{my:2},children:[a.jsx(V,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:"This could be due to:"}),a.jsxs("ul",{children:[a.jsx("li",{children:"The backend server is not running"}),a.jsx("li",{children:"Network connectivity issues"}),a.jsx("li",{children:"Incorrect API URL configuration"}),a.jsx("li",{children:"CORS or authentication problems"})]})]}),a.jsxs(ee,{sx:{display:"flex",gap:2,mt:2},children:[a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(On,{}),onClick:d,children:"Retry Connection"}),a.jsx(ye,{variant:"outlined",color:"primary",startIcon:a.jsx(tf,{}),onClick:()=>o(!0),children:"Connection Settings"}),e&&a.jsx(ye,{variant:"text",color:"inherit",onClick:()=>c(!l),children:l?"Hide Details":"Show Details"})]}),e&&a.jsx(nf,{in:l,children:a.jsx(ee,{sx:{mt:2,p:1,bgcolor:"grey.100",borderRadius:1},children:a.jsx(V,{variant:"caption",component:"pre",sx:{whiteSpace:"pre-wrap",overflowX:"auto"},children:e instanceof Error?e.stack||e.message:e})})})]})})},J2={getAll:()=>ge.get("/staff"),getById:e=>ge.get(`/staff/${e}`),create:e=>ge.post("/staff",e),update:(e,r)=>ge.put(`/staff/${e}`,r),delete:e=>ge.delete(`/staff/${e}`),getAllTeachers:()=>ge.get("/staff"),createTeacher:e=>ge.post("/staff",e),updateTeacher:(e,r)=>ge.put(`/staff/${e}`,r),deleteTeacher:e=>ge.delete(`/staff/${e}`)},Bt={_normalizePayment(e){var d,u,f,h,x,m,g;if(!e||typeof e!="object")return{id:void 0,studentId:0,paymentDate:new Date().toISOString(),amount:0,amountPaid:0,paymentMethod:"CASH",frequency:"MONTHLY",paymentStatus:"PENDING",academicYear:"",academicTerm:""};const r=Number(e.amount??e.amountPaid??0),t=String(e.paymentStatus??e.status??"PENDING"),n=String(((d=e.student)==null?void 0:d.name)??((u=e.student)==null?void 0:u.fullName)??e.studentName??e.name??""),s=String(e.studentGrade??e.grade??e.classGrade??((f=e.student)==null?void 0:f.grade)??((h=e.student)==null?void 0:h.classGrade)??""),i=String(e.studentSection??e.section??((x=e.student)==null?void 0:x.section)??""),o=e.receiptNumber??e.receiptNo??e.receiptId??void 0,l=e.voidedAt??e.voidDate??e.voidedOn??e.voidTimestamp??void 0,c=e.voidReason??e.reason??e.voidRemarks??void 0;return{...e,studentId:Number(e.studentId??((m=e.student)==null?void 0:m.id)??0),feeId:e.feeId??((g=e.fee)==null?void 0:g.id),amount:r,amountPaid:Number(e.amountPaid??r),paymentMethod:String(e.paymentMethod??"CASH"),paymentStatus:t,paymentDate:e.paymentDate??e.date??new Date().toISOString(),studentName:n,studentGrade:s,studentSection:i,receiptNumber:o,voidedAt:l,voidReason:c}},getAllFeeStructures:async()=>await ge.get("/api/fees/structures"),getFeeStructureById:async e=>await ge.get(`/api/fees/structures/${e}`),getFeeStructureByGrade:async e=>{try{return await ge.get(`/api/fees/structures/grade/${e}`)}catch(r){return console.error(`Error fetching fee structure for grade ${e}:`,r),null}},createFeeStructure:async e=>await ge.post("/api/fees/structures",e),updateFeeStructure:async(e,r)=>await ge.put(`/api/fees/structures/${e}`,r),deleteFeeStructure:async e=>await ge.delete(`/api/fees/structures/${e}`),getAllTransportRoutes:async()=>await ge.get("/api/fees/transport-routes"),getTransportRouteById:async e=>await ge.get(`/api/fees/transport-routes/${e}`),createTransportRoute:async e=>await ge.post("/api/fees/transport-routes",e),updateTransportRoute:async(e,r)=>await ge.put(`/api/fees/transport-routes/${e}`,r),deleteTransportRoute:async e=>await ge.delete(`/api/fees/transport-routes/${e}`),getAllPayments:async()=>{const e=await ge.get("/api/fees/payments");return Array.isArray(e)?e.map(Bt._normalizePayment):[]},getFilteredPayments:async e=>{let r="/api/fees/payments/filtered";const t=new URLSearchParams;e&&(e.grade&&t.append("grade",e.grade),e.section&&t.append("section",e.section),e.studentName&&t.append("studentName",e.studentName),e.startDate&&t.append("startDate",e.startDate),e.endDate&&t.append("endDate",e.endDate),e.paymentStatus&&t.append("status",e.paymentStatus),e.paymentMethod&&t.append("method",e.paymentMethod),e.minAmount&&t.append("minAmount",e.minAmount),e.maxAmount&&t.append("maxAmount",e.maxAmount)),t.toString()&&(r+=`?${t.toString()}`);try{const n=await ge.get(r);return Array.isArray(n)?n.map(Bt._normalizePayment):[]}catch(n){return console.error("Error fetching filtered payments:",n),[]}},getPaymentById:async e=>{const r=await ge.get(`/api/fees/payments/${e}`);return Bt._normalizePayment(r)},getPaymentByReceipt:async e=>{const r=await ge.get(`/api/fees/payments/receipt/${encodeURIComponent(e)}`);return Bt._normalizePayment(r)},getPaymentsByStudentId:async e=>{try{const r=await ge.get(`/api/fees/payments/student/${e}`);return Array.isArray(r)?r.map(Bt._normalizePayment):[]}catch(r){return console.error(`Error fetching payment history for student ${e}:`,r),[]}},getPaymentSummaryByStudent:async e=>{try{return await ge.get(`/api/fees/summary/student/${e}`)}catch(r){return console.error(`Error fetching payment summary for student ${e}:`,r),{studentId:e,studentName:"Student",totalDue:25e3,totalPaid:15e3,balance:1e4,paymentStatus:"PARTIALLY_PAID",lastPaymentDate:new Date().toISOString(),nextDueDate:new Date(Date.now()+30*24*60*60*1e3).toISOString()}}},createPayment:async e=>{try{const{debugPayment:r,validatePaymentRequest:t}=await qr(()=>import("./debugUtils-86d8ca2d.js"),["assets/debugUtils-86d8ca2d.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]),{submitPaymentWithCorsHandling:n}=await qr(()=>import("./corsHelper-66efeb43.js"),["assets/corsHelper-66efeb43.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]);let s=e.feeId&&Number(e.feeId)>0?Number(e.feeId):null;try{if(!s){const l=await zr.getById(Number(e.studentId)),c=(l==null?void 0:l.grade)??(l==null?void 0:l.classGrade)??(l==null?void 0:l.gradeLevel)??"0",d=parseInt(String(c),10);if(!Number.isFinite(d)||d<=0)throw r("Unable to derive grade for student",{studentId:e.studentId,student:l}),new Error("Unable to determine student grade to resolve applicable fee");const u=await ge.get(`/api/fees/grade/${d}`),f=Array.isArray(u)&&u.length>0?u.find(h=>(h==null?void 0:h.feeType)==="TUITION"||String((h==null?void 0:h.name)||"").toLowerCase().includes("tuition"))||u[0]:null;if(f!=null&&f.id)s=Number(f.id),r("Resolved feeId from grade",{studentId:e.studentId,gradeNumber:d,feeId:s,chosen:f});else{r("No fees returned for grade; backend may create defaults",{gradeNumber:d});try{const h=await ge.get(`/api/fees/grade/${d}`),x=Array.isArray(h)&&h.length>0?h[0]:null;x!=null&&x.id&&(s=Number(x.id))}catch{}}}}catch(l){r("Fee ID resolution failed",{err:l})}const i={feeId:s,studentId:Number(e.studentId),amount:Number(e.amount),paymentMethod:e.paymentMethod==="BANK_TRANSFER"?"BANK_TRANSFER":e.paymentMethod==="CREDIT_CARD"?"CREDIT_CARD":e.paymentMethod==="UPI"?"ONLINE":e.paymentMethod==="CHEQUE"||e.paymentMethod==="CHECK"?"CHEQUE":e.paymentMethod==="ONLINE"?"ONLINE":"CASH",transactionReference:e.transactionReference||e.reference||"",remarks:e.remarks||e.notes||"",payerName:e.payerName||"Parent/Guardian",payerContactInfo:e.payerContactInfo||"",payerRelationToStudent:e.payerRelationToStudent||"PARENT",receiptNumber:e.receiptNumber||`RCPT-${new Date().getTime().toString().slice(-8)}`},o=t(i);if(!o.valid)throw r("Payment Validation Failed",i,{message:`Missing required fields: ${o.missingFields.join(", ")}`}),new Error(`Payment validation failed. Missing: ${o.missingFields.join(", ")}`);if(!i.feeId||!Number.isFinite(Number(i.feeId)))throw new Error("Unable to resolve a valid Fee ID for this student. Please ensure fees are set up for the selected class.");r("Sending Payment Request",i);try{const l=await n(i);return r("Payment Success (CORS-aware method)",l),l}catch(l){r("CORS-aware payment failed, trying standard API",i,l);try{const c=await ge.post("/api/fees/payments",i);return r("Payment Success (standard API)",c),c}catch(c){throw r("All payment methods failed",i,c),c}}}catch(r){throw console.error("Error in createPayment:",r),r}},updatePayment:async(e,r)=>await ge.put(`/api/fees/payments/${e}`,r),voidPayment:async(e,r)=>await ge.put(`/api/fees/payments/${e}/void`,{reason:r}),getPaymentReceipt:async e=>await ge.get(`/api/fees/payments/${e}/receipt`),getPaymentAnalytics:async(e,r)=>{let t="/api/fees/analytics/payments";return e&&r&&(t+=`?startDate=${e}&endDate=${r}`),await ge.get(t)},getPaymentDistribution:async e=>{let r="/api/fees/analytics/distribution";return e&&(r+=`?academicYear=${e}`),await ge.get(r)},getRevenueTrend:async(e="monthly",r)=>{let t=`/api/fees/analytics/revenue-trend?period=${e}`;return r&&(t+=`&year=${r}`),await ge.get(t)},getOverdueAnalytics:async()=>await ge.get("/api/fees/analytics/overdue"),getStudentsWithOutstandingFees:async e=>{let r="/api/fees/analytics/outstanding";return e!==void 0&&(r+=`?gradeLevel=${e}`),await ge.get(r)},generateFeesDueReport:async e=>{let r="/api/fees/reports/fees-due";return e!=null&&(r+=`?classGrade=${e}`),await ge.get(r)},generateFeeStatusReport:async e=>{let r="/api/fees/reports/fee-status";return e!=null&&(r+=`?classGrade=${e}`),await ge.get(r)},downloadFeeReport:async(e,r)=>{var t;try{let n=`/api/fees/reports/download/${e}`;r!=null&&(n+=`?classGrade=${r}`);const s=await Sn.get(n,{responseType:"blob",baseURL:Et.apiUrl,withCredentials:!0,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),i=new Date().toISOString().split("T")[0],o=window.URL.createObjectURL(new Blob([s.data])),l=document.createElement("a");l.href=o,l.setAttribute("download",`Fee-Report-${e}-${i}.xlsx`),document.body.appendChild(l),l.click(),(t=l.parentNode)==null||t.removeChild(l)}catch(n){throw console.error("Error downloading fee report:",n),n}},exportPaymentData:async e=>{var r;try{const t=await Sn.post(`${Et.apiUrl}/api/payments/export`,e,{responseType:"blob",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}}),n=window.URL.createObjectURL(new Blob([t.data])),s=document.createElement("a");s.href=n,s.setAttribute("download",`Payments-${new Date().toISOString().split("T")[0]}.xlsx`),document.body.appendChild(s),s.click(),(r=s.parentNode)==null||r.removeChild(s)}catch(t){throw console.error("Error exporting payment data:",t),t}},getStudentFeeDetails:async e=>{try{const r=await zr.getById(e),t=parseInt(r.grade||"10",10);let n=null;try{n=await ge.get(`/api/fees/structures/grade/${t}`)}catch(s){console.error("Error fetching fee structure:",s),n=null}return{studentId:e,studentFeeId:1,feeStructure:{id:(n==null?void 0:n.id)??0,classGrade:t,annualFees:(n==null?void 0:n.annualFees)??0,buildingFees:(n==null?void 0:n.buildingFees)??0,labFees:(n==null?void 0:n.labFees)??0,amount:(n==null?void 0:n.totalFees)??0,totalFees:(n==null?void 0:n.totalFees)??0}}}catch(r){return console.error("Error fetching real fee details, using mock data:",r),{studentId:e,studentFeeId:1,feeStructure:{id:1,classGrade:10,annualFees:25e3,buildingFees:5e3,labFees:3e3,amount:33e3,totalFees:33e3}}}},getStudentPaymentHistory:async e=>{const r=await ge.get(`/api/fees/payments/student/${e}`);return Array.isArray(r)?r.map(Bt._normalizePayment):[]},downloadReceipt:async e=>{var r;try{const t=await ge.downloadBlob(`/api/fees/payments/${e}/receipt`),n=new Blob([t],{type:"application/pdf"}),s=window.URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.setAttribute("download",`Receipt-${e}.pdf`),document.body.appendChild(i),i.click(),(r=i.parentNode)==null||r.removeChild(i)}catch(t){console.error("Error downloading receipt:",t)}},downloadClassSectionReportCsv:async e=>{var r;try{const t={grade:e.grade};e.section&&(t.section=e.section),e.month&&(t.month=e.month),e.year&&(t.year=e.year);const n=await ge.downloadBlob("/api/fees/reports/class-section/csv",t),s=new Blob([n],{type:"text/csv;charset=utf-8"}),i=window.URL.createObjectURL(s),o=e.year||new Date().getFullYear(),l=e.month?String(e.month).padStart(2,"0"):"ALL",c=e.section?`-${e.section}`:"",d=document.createElement("a");d.href=i,d.setAttribute("download",`ClassSectionReport-Grade${e.grade}${c}-${l}-${o}.csv`),document.body.appendChild(d),d.click(),(r=d.parentNode)==null||r.removeChild(d)}catch(t){throw console.error("Error downloading class/section CSV report:",t),t}},downloadStudentReportCsv:async e=>{var r;try{const t={studentId:e.studentId};e.month&&(t.month=e.month),e.year&&(t.year=e.year);const n=await ge.downloadBlob("/api/fees/reports/student/csv",t),s=new Blob([n],{type:"text/csv;charset=utf-8"}),i=window.URL.createObjectURL(s),o=e.year||new Date().getFullYear(),l=e.month?String(e.month).padStart(2,"0"):"ALL",c=document.createElement("a");c.href=i,c.setAttribute("download",`StudentReport-${e.studentId}-${l}-${o}.csv`),document.body.appendChild(c),c.click(),(r=c.parentNode)==null||r.removeChild(c)}catch(t){throw console.error("Error downloading student CSV report:",t),t}}};function Q2(e,...r){const t=new URL(`https://mui.com/production-error/?code=${e}`);return r.forEach(n=>t.searchParams.append("args[]",n)),`Minified MUI error #${e}; visit ${t} for the full message.`}const Z2=Oe.oneOfType([Oe.func,Oe.object]),Pg=Z2;function eE(e){if(typeof e!="string")throw new Error(Q2(7));return e.charAt(0).toUpperCase()+e.slice(1)}function Vd(e){return e&&e.ownerDocument||document}const tE=typeof window<"u"?b.useLayoutEffect:b.useEffect,Pa=tE;let Z0=0;function rE(e){const[r,t]=b.useState(e),n=e||r;return b.useEffect(()=>{r==null&&(Z0+=1,t(`mui-${Z0}`))},[r]),n}const nE={...CS},em=nE.useId;function td(e){if(em!==void 0){const r=em();return e??r}return rE(e)}function qi(e){const{controlled:r,default:t,name:n,state:s="value"}=e,{current:i}=b.useRef(r!==void 0),[o,l]=b.useState(t),c=i?r:o,d=b.useCallback(u=>{i||l(u)},[]);return[c,d]}function Ze(e){const r=b.useRef(e);return Pa(()=>{r.current=e}),b.useRef((...t)=>(0,r.current)(...t)).current}function Ln(...e){const r=b.useRef(void 0),t=b.useCallback(n=>{const s=e.map(i=>{if(i==null)return null;if(typeof i=="function"){const o=i,l=o(n);return typeof l=="function"?l:()=>{o(null)}}return i.current=n,()=>{i.current=null}});return()=>{s.forEach(i=>i==null?void 0:i())}},e);return b.useMemo(()=>e.every(n=>n==null)?null:n=>{r.current&&(r.current(),r.current=void 0),n!=null&&(r.current=t(n))},e)}const tm={};function aE(e,r){const t=b.useRef(tm);return t.current===tm&&(t.current=e(r)),t}const sE=[];function iE(e){b.useEffect(e,sE)}class Hf{constructor(){Qe(this,"currentId",null);Qe(this,"clear",()=>{this.currentId!==null&&(clearTimeout(this.currentId),this.currentId=null)});Qe(this,"disposeEffect",()=>this.clear)}static create(){return new Hf}start(r,t){this.clear(),this.currentId=setTimeout(()=>{this.currentId=null,t()},r)}}function Pi(){const e=aE(Hf.create).current;return iE(e.disposeEffect),e}const oE={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"},lE=oE;function wr(e,r,t=void 0){const n={};for(const s in e){const i=e[s];let o="",l=!0;for(let c=0;c<i.length;c+=1){const d=i[c];d&&(o+=(l===!0?"":" ")+r(d),l=!1,t&&t[d]&&(o+=" "+t[d]))}n[s]=o}return n}const rm=e=>e,cE=()=>{let e=rm;return{configure(r){e=r},generate(r){return e(r)},reset(){e=rm}}},dE=cE(),uE=dE,fE={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",open:"open",readOnly:"readOnly",required:"required",selected:"selected"};function Pr(e,r,t="Mui"){const n=fE[r];return n?`${t}-${n}`:`${uE.generate(e)}-${r}`}function Ur(e,r,t="Mui"){const n={};return r.forEach(s=>{n[s]=Pr(e,s,t)}),n}function hE(e){return typeof e=="string"}function mE(e,r,t){return e===void 0||hE(e)?r:{...r,ownerState:{...r.ownerState,...t}}}function pE(e,r=[]){if(e===void 0)return{};const t={};return Object.keys(e).filter(n=>n.match(/^on[A-Z]/)&&typeof e[n]=="function"&&!r.includes(n)).forEach(n=>{t[n]=e[n]}),t}function nm(e){if(e===void 0)return{};const r={};return Object.keys(e).filter(t=>!(t.match(/^on[A-Z]/)&&typeof e[t]=="function")).forEach(t=>{r[t]=e[t]}),r}function xE(e){const{getSlotProps:r,additionalProps:t,externalSlotProps:n,externalForwardedProps:s,className:i}=e;if(!r){const x=$r(t==null?void 0:t.className,i,s==null?void 0:s.className,n==null?void 0:n.className),m={...t==null?void 0:t.style,...s==null?void 0:s.style,...n==null?void 0:n.style},g={...t,...s,...n};return x.length>0&&(g.className=x),Object.keys(m).length>0&&(g.style=m),{props:g,internalRef:void 0}}const o=pE({...s,...n}),l=nm(n),c=nm(s),d=r(o),u=$r(d==null?void 0:d.className,t==null?void 0:t.className,i,s==null?void 0:s.className,n==null?void 0:n.className),f={...d==null?void 0:d.style,...t==null?void 0:t.style,...s==null?void 0:s.style,...n==null?void 0:n.style},h={...d,...t,...c,...l};return u.length>0&&(h.className=u),Object.keys(f).length>0&&(h.style=f),{props:h,internalRef:d.ref}}function Ko(e,r,t){return typeof e=="function"?e(r,t):e}function zt(e){var f;const{elementType:r,externalSlotProps:t,ownerState:n,skipResolvingSlotProps:s=!1,...i}=e,o=s?{}:Ko(t,n),{props:l,internalRef:c}=xE({...i,externalSlotProps:o}),d=Ln(c,o==null?void 0:o.ref,(f=e.additionalProps)==null?void 0:f.ref);return mE(r,{...l,ref:d},n)}const gE=["localeText"],Au=b.createContext(null),jn=function(r){const{localeText:t}=r,n=ht(r,gE),{utils:s,localeText:i}=b.useContext(Au)??{utils:void 0,localeText:void 0},o=gr({props:n,name:"MuiLocalizationProvider"}),{children:l,dateAdapter:c,dateFormats:d,dateLibInstance:u,adapterLocale:f,localeText:h}=o,x=b.useMemo(()=>je({},h,i,t),[h,i,t]),m=b.useMemo(()=>{if(!c)return s||null;const y=new c({locale:f,formats:d,instance:u});if(!y.isMUIAdapter)throw new Error(["MUI X: The date adapter should be imported from `@mui/x-date-pickers` or `@mui/x-date-pickers-pro`, not from `@date-io`","For example, `import { AdapterDayjs } from '@mui/x-date-pickers/AdapterDayjs'` instead of `import AdapterDayjs from '@date-io/dayjs'`","More information on the installation documentation: https://mui.com/x/react-date-pickers/quickstart/#installation"].join(`
`));return y},[c,f,d,u,s]),g=b.useMemo(()=>m?{minDate:m.date("1900-01-01T00:00:00.000"),maxDate:m.date("2099-12-31T00:00:00.000")}:null,[m]),p=b.useMemo(()=>({utils:m,defaultDates:g,localeText:x}),[g,m,x]);return a.jsx(Au.Provider,{value:p,children:l})},yE=e=>({components:{MuiLocalizationProvider:{defaultProps:{localeText:je({},e)}}}}),Ng={previousMonth:"Previous month",nextMonth:"Next month",openPreviousView:"Open previous view",openNextView:"Open next view",calendarViewSwitchingButtonAriaLabel:e=>e==="year"?"year view is open, switch to calendar view":"calendar view is open, switch to year view",start:"Start",end:"End",startDate:"Start date",startTime:"Start time",endDate:"End date",endTime:"End time",cancelButtonLabel:"Cancel",clearButtonLabel:"Clear",okButtonLabel:"OK",todayButtonLabel:"Today",nextStepButtonLabel:"Next",datePickerToolbarTitle:"Select date",dateTimePickerToolbarTitle:"Select date & time",timePickerToolbarTitle:"Select time",dateRangePickerToolbarTitle:"Select date range",timeRangePickerToolbarTitle:"Select time range",clockLabelText:(e,r)=>`Select ${e}. ${r?`Selected time is ${r}`:"No time selected"}`,hoursClockNumberText:e=>`${e} hours`,minutesClockNumberText:e=>`${e} minutes`,secondsClockNumberText:e=>`${e} seconds`,selectViewText:e=>`Select ${e}`,calendarWeekNumberHeaderLabel:"Week number",calendarWeekNumberHeaderText:"#",calendarWeekNumberAriaLabelText:e=>`Week ${e}`,calendarWeekNumberText:e=>`${e}`,openDatePickerDialogue:e=>e?`Choose date, selected date is ${e}`:"Choose date",openTimePickerDialogue:e=>e?`Choose time, selected time is ${e}`:"Choose time",openRangePickerDialogue:e=>e?`Choose range, selected range is ${e}`:"Choose range",fieldClearLabel:"Clear",timeTableLabel:"pick time",dateTableLabel:"pick date",fieldYearPlaceholder:e=>"Y".repeat(e.digitAmount),fieldMonthPlaceholder:e=>e.contentType==="letter"?"MMMM":"MM",fieldDayPlaceholder:()=>"DD",fieldWeekDayPlaceholder:e=>e.contentType==="letter"?"EEEE":"EE",fieldHoursPlaceholder:()=>"hh",fieldMinutesPlaceholder:()=>"mm",fieldSecondsPlaceholder:()=>"ss",fieldMeridiemPlaceholder:()=>"aa",year:"Year",month:"Month",day:"Day",weekDay:"Week day",hours:"Hours",minutes:"Minutes",seconds:"Seconds",meridiem:"Meridiem",empty:"Empty"},vE=Ng;yE(Ng);const ci=()=>{const e=b.useContext(Au);if(e===null)throw new Error(["MUI X: Can not find the date and time pickers localization context.","It looks like you forgot to wrap your component in LocalizationProvider.","This can also happen if you are bundling multiple versions of the `@mui/x-date-pickers` package"].join(`
`));if(e.utils===null)throw new Error(["MUI X: Can not find the date and time pickers adapter from its localization context.","It looks like you forgot to pass a `dateAdapter` to your LocalizationProvider."].join(`
`));const r=b.useMemo(()=>je({},vE,e.localeText),[e.localeText]);return b.useMemo(()=>je({},e,{localeText:r}),[e,r])},ur=()=>ci().utils,bE=()=>ci().defaultDates,rd=e=>{const r=ur(),t=b.useRef(void 0);return t.current===void 0&&(t.current=r.date(void 0,e)),t.current},_s=()=>ci().localeText,SE=Cs(a.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown"),wE=Cs(a.jsx("path",{d:"M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"}),"ArrowLeft"),jE=Cs(a.jsx("path",{d:"M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"}),"ArrowRight"),EE=Cs(a.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"}),"Calendar");Cs(a.jsxs(b.Fragment,{children:[a.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),a.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Clock");Cs(a.jsx("path",{d:"M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"}),"DateRange");Cs(a.jsxs(b.Fragment,{children:[a.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),a.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"})]}),"Time");const kE=Cs(a.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear");function AE(e){return Pr("MuiPickersArrowSwitcher",e)}Ur("MuiPickersArrowSwitcher",["root","spacer","button","previousIconButton","nextIconButton","leftArrowIcon","rightArrowIcon"]);const Rg=b.createContext(()=>!0);function TE(){return b.useContext(Rg)}const Og=b.createContext(null);function Lg(){return b.useContext(Og)}const Yf=b.createContext(null),ro=()=>{const e=b.useContext(Yf);if(e==null)throw new Error("MUI X: The `usePickerContext` hook can only be called inside the context of a Picker component");return e},$g=b.createContext(null),Bg=b.createContext({ownerState:{isPickerDisabled:!1,isPickerReadOnly:!1,isPickerValueEmpty:!1,isPickerOpen:!1,pickerVariant:"desktop",pickerOrientation:"portrait"},rootRefObject:{current:null},labelId:void 0,dismissViews:()=>{},hasUIView:!0,getCurrentViewMode:()=>"UI",triggerElement:null,viewContainerRole:null,defaultActionBarActions:[],onPopperExited:void 0});function Ug(e){const{contextValue:r,actionsContextValue:t,privateContextValue:n,fieldPrivateContextValue:s,isValidContextValue:i,localeText:o,children:l}=e;return a.jsx(Yf.Provider,{value:r,children:a.jsx($g.Provider,{value:t,children:a.jsx(Bg.Provider,{value:n,children:a.jsx(Og.Provider,{value:s,children:a.jsx(Rg.Provider,{value:i,children:a.jsx(jn,{localeText:o,children:l})})})})})})}const tn=()=>b.useContext(Bg),CE=["children","className","slots","slotProps","isNextDisabled","isNextHidden","onGoToNext","nextLabel","isPreviousDisabled","isPreviousHidden","onGoToPrevious","previousLabel","labelId","classes"],DE=["ownerState"],_E=["ownerState"],IE=nt("div",{name:"MuiPickersArrowSwitcher",slot:"Root"})({display:"flex"}),FE=nt("div",{name:"MuiPickersArrowSwitcher",slot:"Spacer"})(({theme:e})=>({width:e.spacing(3)})),am=nt(st,{name:"MuiPickersArrowSwitcher",slot:"Button"})({variants:[{props:{isButtonHidden:!0},style:{visibility:"hidden"}}]}),ME=e=>wr({root:["root"],spacer:["spacer"],button:["button"],previousIconButton:["previousIconButton"],nextIconButton:["nextIconButton"],leftArrowIcon:["leftArrowIcon"],rightArrowIcon:["rightArrowIcon"]},AE,e),PE=b.forwardRef(function(r,t){const n=Qa(),s=gr({props:r,name:"MuiPickersArrowSwitcher"}),{children:i,className:o,slots:l,slotProps:c,isNextDisabled:d,isNextHidden:u,onGoToNext:f,nextLabel:h,isPreviousDisabled:x,isPreviousHidden:m,onGoToPrevious:g,previousLabel:p,labelId:y,classes:S}=s,v=ht(s,CE),{ownerState:E}=tn(),C=ME(S),A={isDisabled:d,isHidden:u,goTo:f,label:h},j={isDisabled:x,isHidden:m,goTo:g,label:p},w=(l==null?void 0:l.previousIconButton)??am,k=zt({elementType:w,externalSlotProps:c==null?void 0:c.previousIconButton,additionalProps:{size:"medium",title:j.label,"aria-label":j.label,disabled:j.isDisabled,edge:"end",onClick:j.goTo},ownerState:je({},E,{isButtonHidden:j.isHidden??!1}),className:$r(C.button,C.previousIconButton)}),_=(l==null?void 0:l.nextIconButton)??am,I=zt({elementType:_,externalSlotProps:c==null?void 0:c.nextIconButton,additionalProps:{size:"medium",title:A.label,"aria-label":A.label,disabled:A.isDisabled,edge:"start",onClick:A.goTo},ownerState:je({},E,{isButtonHidden:A.isHidden??!1}),className:$r(C.button,C.nextIconButton)}),D=(l==null?void 0:l.leftArrowIcon)??wE,B=zt({elementType:D,externalSlotProps:c==null?void 0:c.leftArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:E,className:C.leftArrowIcon}),R=ht(B,DE),Y=(l==null?void 0:l.rightArrowIcon)??jE,P=zt({elementType:Y,externalSlotProps:c==null?void 0:c.rightArrowIcon,additionalProps:{fontSize:"inherit"},ownerState:E,className:C.rightArrowIcon}),M=ht(P,_E);return a.jsxs(IE,je({ref:t,className:$r(C.root,o),ownerState:E},v,{children:[a.jsx(w,je({},k,{children:n?a.jsx(Y,je({},M)):a.jsx(D,je({},R))})),i?a.jsx(V,{variant:"subtitle1",component:"span",id:y,children:i}):a.jsx(FE,{className:C.spacer,ownerState:E}),a.jsx(_,je({},I,{children:n?a.jsx(D,je({},R)):a.jsx(Y,je({},M))}))]}))}),mo=(e,r)=>e.length!==r.length?!1:r.every(t=>e.includes(t)),NE=({openTo:e,defaultOpenTo:r,views:t,defaultViews:n})=>{const s=t??n;let i;if(e!=null)i=e;else if(s.includes(r))i=r;else if(s.length>0)i=s[0];else throw new Error("MUI X: The `views` prop must contain at least one view.");return{views:s,openTo:i}},RE=["hours","minutes","seconds"],OE=e=>RE.includes(e),sm=(e,r)=>r.getHours(e)*3600+r.getMinutes(e)*60+r.getSeconds(e),LE=(e,r)=>(t,n)=>e?r.isAfter(t,n):sm(t,r)>sm(n,r),Vg={hasNextStep:!1,hasSeveralSteps:!1,goToNextStep:()=>{},areViewsInSameStep:()=>!0};function $E(e){const{steps:r,isViewMatchingStep:t,onStepChange:n}=e;return s=>{if(r==null)return Vg;const i=r.findIndex(l=>t(s.view,l)),o=i===-1||i===r.length-1?null:r[i+1];return{hasNextStep:o!=null,hasSeveralSteps:r.length>1,goToNextStep:()=>{o!=null&&n(je({},s,{step:o}))},areViewsInSameStep:(l,c)=>{const d=r.find(f=>t(l,f)),u=r.find(f=>t(c,f));return d===u}}}}function Wg({onChange:e,onViewChange:r,openTo:t,view:n,views:s,autoFocus:i,focusedView:o,onFocusedViewChange:l,getStepNavigation:c}){const d=b.useRef(t),u=b.useRef(s),f=b.useRef(s.includes(t)?t:s[0]),[h,x]=qi({name:"useViews",state:"view",controlled:n,default:f.current}),m=b.useRef(i?h:null),[g,p]=qi({name:"useViews",state:"focusedView",controlled:o,default:m.current}),y=c?c({setView:x,view:h,defaultView:f.current,views:s}):Vg;b.useEffect(()=>{(d.current&&d.current!==t||u.current&&u.current.some(k=>!s.includes(k)))&&(x(s.includes(t)?t:s[0]),u.current=s,d.current=t)},[t,x,h,s]);const S=s.indexOf(h),v=s[S-1]??null,E=s[S+1]??null,C=Ze((k,_)=>{p(_?k:I=>k===I?null:I),l==null||l(k,_)}),A=Ze(k=>{C(k,!0),k!==h&&(x(k),r&&r(k))}),j=Ze(()=>{E&&A(E)}),w=Ze((k,_,I)=>{const D=_==="finish",B=I?s.indexOf(I)<s.length-1:!!E;e(k,D&&B?"partial":_,I);let Y=null;if(I!=null&&I!==h?Y=I:D&&(Y=h),Y==null)return;const P=s[s.indexOf(Y)+1];P==null||!y.areViewsInSameStep(Y,P)||A(P)});return je({},y,{view:h,setView:A,focusedView:g,setFocusedView:C,nextView:E,previousView:v,defaultView:s.includes(t)?t:s[0],goToNextView:j,setValueAndGoToNextView:w})}function BE(e,{disableFuture:r,maxDate:t,timezone:n}){const s=ur();return b.useMemo(()=>{const i=s.date(void 0,n),o=s.startOfMonth(r&&s.isBefore(i,t)?i:t);return!s.isAfter(o,e)},[r,t,e,s,n])}function UE(e,{disablePast:r,minDate:t,timezone:n}){const s=ur();return b.useMemo(()=>{const i=s.date(void 0,n),o=s.startOfMonth(r&&s.isAfter(i,t)?i:t);return!s.isBefore(o,e)},[r,t,e,s,n])}const Jo=36,nd=2,ad=320,VE=280,zf=336,WE=nt("div")({overflow:"hidden",width:ad,maxHeight:zf,display:"flex",flexDirection:"column",margin:"0 auto"}),vc=(e,r,t)=>{let n=r;return n=e.setHours(n,e.getHours(t)),n=e.setMinutes(n,e.getMinutes(t)),n=e.setSeconds(n,e.getSeconds(t)),n=e.setMilliseconds(n,e.getMilliseconds(t)),n},Qo=({date:e,disableFuture:r,disablePast:t,maxDate:n,minDate:s,isDateDisabled:i,utils:o,timezone:l})=>{const c=vc(o,o.date(void 0,l),e);t&&o.isBefore(s,c)&&(s=c),r&&o.isAfter(n,c)&&(n=c);let d=e,u=e;for(o.isBefore(e,s)&&(d=s,u=null),o.isAfter(e,n)&&(u&&(u=n),d=null);d||u;){if(d&&o.isAfter(d,n)&&(d=null),u&&o.isBefore(u,s)&&(u=null),d){if(!i(d))return d;d=o.addDays(d,1)}if(u){if(!i(u))return u;u=o.addDays(u,-1)}}return null},HE=(e,r)=>e.isValid(r)?r:null,im=(e,r,t)=>r==null||!e.isValid(r)?t:r,YE=(e,r,t)=>!e.isValid(r)&&r!=null&&!e.isValid(t)&&t!=null?!0:e.isEqual(r,t),Gf=(e,r)=>{const n=[e.startOfYear(r)];for(;n.length<12;){const s=n[n.length-1];n.push(e.addMonths(s,1))}return n},Hg=(e,r,t)=>t==="date"?e.startOfDay(e.date(void 0,r)):e.date(void 0,r),zE=["year","month","day"],om=e=>zE.includes(e),qf=(e,{format:r,views:t},n)=>{if(r!=null)return r;const s=e.formats;return mo(t,["year"])?s.year:mo(t,["month"])?s.month:mo(t,["day"])?s.dayOfMonth:mo(t,["month","year"])?`${s.month} ${s.year}`:mo(t,["day","month"])?`${s.month} ${s.dayOfMonth}`:n?/en/.test(e.getCurrentLocaleCode())?s.normalDateWithWeekday:s.normalDate:s.keyboardDate},GE=(e,r)=>{const t=e.startOfWeek(r);return[0,1,2,3,4,5,6].map(n=>e.addDays(t,n))},pl=({name:e,timezone:r,value:t,defaultValue:n,referenceDate:s,onChange:i,valueManager:o})=>{const l=ur(),[c,d]=qi({name:e,state:"value",controlled:t,default:n??o.emptyValue}),u=b.useMemo(()=>o.getTimezone(l,c),[l,o,c]),f=Ze(g=>u==null?g:o.setTimezone(l,u,g)),h=b.useMemo(()=>r||u||(s?l.getTimezone(s):"default"),[r,u,s,l]),x=b.useMemo(()=>o.setTimezone(l,h,c),[o,l,h,c]),m=Ze((g,...p)=>{const y=f(g);d(y),i==null||i(y,...p)});return{value:x,handleValueChange:m,timezone:h}},Da={year:1,month:2,day:3,hours:4,minutes:5,seconds:6,milliseconds:7},qE=e=>Math.max(...e.map(r=>Da[r.type]??1)),po=(e,r,t)=>{if(r===Da.year)return e.startOfYear(t);if(r===Da.month)return e.startOfMonth(t);if(r===Da.day)return e.startOfDay(t);let n=t;return r<Da.minutes&&(n=e.setMinutes(n,0)),r<Da.seconds&&(n=e.setSeconds(n,0)),r<Da.milliseconds&&(n=e.setMilliseconds(n,0)),n},XE=({props:e,utils:r,granularity:t,timezone:n,getTodayDate:s})=>{let i=s?s():po(r,t,Hg(r,n));e.minDate!=null&&r.isAfterDay(e.minDate,i)&&(i=po(r,t,e.minDate)),e.maxDate!=null&&r.isBeforeDay(e.maxDate,i)&&(i=po(r,t,e.maxDate));const o=LE(e.disableIgnoringDatePartForTimeValidation??!1,r);return e.minTime!=null&&o(e.minTime,i)&&(i=po(r,t,e.disableIgnoringDatePartForTimeValidation?e.minTime:vc(r,i,e.minTime))),e.maxTime!=null&&o(i,e.maxTime)&&(i=po(r,t,e.disableIgnoringDatePartForTimeValidation?e.maxTime:vc(r,i,e.maxTime))),i},Yg=(e,r)=>{const t=e.formatTokenMap[r];if(t==null)throw new Error([`MUI X: The token "${r}" is not supported by the Date and Time Pickers.`,"Please try using another token or open an issue on https://github.com/mui/mui-x/issues/new/choose if you think it should be supported."].join(`
`));return typeof t=="string"?{type:t,contentType:t==="meridiem"?"letter":"digit",maxLength:void 0}:{type:t.sectionType,contentType:t.contentType,maxLength:t.maxLength}},sd=(e,r)=>{const t=[],n=e.date(void 0,"default"),s=e.startOfWeek(n),i=e.endOfWeek(n);let o=s;for(;e.isBefore(o,i);)t.push(o),o=e.addDays(o,1);return t.map(l=>e.formatByString(l,r))},zg=(e,r,t,n)=>{switch(t){case"month":return Gf(e,e.date(void 0,r)).map(s=>e.formatByString(s,n));case"weekDay":return sd(e,n);case"meridiem":{const s=e.date(void 0,r);return[e.startOfDay(s),e.endOfDay(s)].map(i=>e.formatByString(i,n))}default:return[]}},lm="s",KE=["0","1","2","3","4","5","6","7","8","9"],JE=e=>{const r=e.date(void 0);return e.formatByString(e.setSeconds(r,0),lm)==="0"?KE:Array.from({length:10}).map((n,s)=>e.formatByString(e.setSeconds(r,s),lm))},ri=(e,r)=>{if(r[0]==="0")return e;const t=[];let n="";for(let s=0;s<e.length;s+=1){n+=e[s];const i=r.indexOf(n);i>-1&&(t.push(i.toString()),n="")}return t.join("")},Xf=(e,r)=>r[0]==="0"?e:e.split("").map(t=>r[Number(t)]).join(""),cm=(e,r)=>{const t=ri(e,r);return t!==" "&&!Number.isNaN(Number(t))},Kf=(e,r)=>Number(e).toString().padStart(r,"0"),Gg=(e,r,t,n,s)=>{if(s.type==="day"&&s.contentType==="digit-with-letter"){const o=e.setDate(t.longestMonth,r);return e.formatByString(o,s.format)}let i=r.toString();return s.hasLeadingZerosInInput&&(i=Kf(i,s.maxLength)),Xf(i,n)},Jf=(e,r,t)=>{let n=e.value||e.placeholder;const s=r==="non-input"?e.hasLeadingZerosInFormat:e.hasLeadingZerosInInput;return r==="non-input"&&e.hasLeadingZerosInInput&&!e.hasLeadingZerosInFormat&&(n=Number(ri(n,t)).toString()),["input-rtl","input-ltr"].includes(r)&&e.contentType==="digit"&&!s&&n.length===1&&(n=`${n}‚Äé`),r==="input-rtl"&&(n=`‚Å®${n}‚Å©`),n},dm=(e,r,t,n)=>e.formatByString(e.parse(r,t),n),QE=(e,r)=>e.formatByString(e.date(void 0,"system"),r).length===4,qg=(e,r,t,n)=>{if(r!=="digit")return!1;const s=e.date(void 0,"default");switch(t){case"year":return e.lib==="dayjs"&&n==="YY"?!0:e.formatByString(e.setYear(s,1),n).startsWith("0");case"month":return e.formatByString(e.startOfYear(s),n).length>1;case"day":return e.formatByString(e.startOfMonth(s),n).length>1;case"weekDay":return e.formatByString(e.startOfWeek(s),n).length>1;case"hours":return e.formatByString(e.setHours(s,1),n).length>1;case"minutes":return e.formatByString(e.setMinutes(s,1),n).length>1;case"seconds":return e.formatByString(e.setSeconds(s,1),n).length>1;default:throw new Error("Invalid section type")}},ZE=(e,r,t)=>{const n=r.some(c=>c.type==="day"),s=[],i=[];for(let c=0;c<r.length;c+=1){const d=r[c];n&&d.type==="weekDay"||(s.push(d.format),i.push(Jf(d,"non-input",t)))}const o=s.join(" "),l=i.join(" ");return e.parse(l,o)},ek=e=>e.map(r=>`${r.startSeparator}${r.value||r.placeholder}${r.endSeparator}`).join(""),tk=(e,r,t)=>{const s=e.map(i=>{const o=Jf(i,t?"input-rtl":"input-ltr",r);return`${i.startSeparator}${o}${i.endSeparator}`}).join("");return t?`‚Å¶${s}‚Å©`:s},rk=(e,r,t)=>{const n=e.date(void 0,t),s=e.endOfYear(n),i=e.endOfDay(n),{maxDaysInMonth:o,longestMonth:l}=Gf(e,n).reduce((c,d)=>{const u=e.getDaysInMonth(d);return u>c.maxDaysInMonth?{maxDaysInMonth:u,longestMonth:d}:c},{maxDaysInMonth:0,longestMonth:null});return{year:({format:c})=>({minimum:0,maximum:QE(e,c)?9999:99}),month:()=>({minimum:1,maximum:e.getMonth(s)+1}),day:({currentDate:c})=>({minimum:1,maximum:e.isValid(c)?e.getDaysInMonth(c):o,longestMonth:l}),weekDay:({format:c,contentType:d})=>{if(d==="digit"){const u=sd(e,c).map(Number);return{minimum:Math.min(...u),maximum:Math.max(...u)}}return{minimum:1,maximum:7}},hours:({format:c})=>{const d=e.getHours(i);return ri(e.formatByString(e.endOfDay(n),c),r)!==d.toString()?{minimum:1,maximum:Number(ri(e.formatByString(e.startOfDay(n),c),r))}:{minimum:0,maximum:d}},minutes:()=>({minimum:0,maximum:e.getMinutes(i)}),seconds:()=>({minimum:0,maximum:e.getSeconds(i)}),meridiem:()=>({minimum:0,maximum:1}),empty:()=>({minimum:0,maximum:0})}},nk=(e,r,t,n)=>{switch(r.type){case"year":return e.setYear(n,e.getYear(t));case"month":return e.setMonth(n,e.getMonth(t));case"weekDay":{let s=e.formatByString(t,r.format);r.hasLeadingZerosInInput&&(s=Kf(s,r.maxLength));const i=sd(e,r.format),o=i.indexOf(s),c=i.indexOf(r.value)-o;return e.addDays(t,c)}case"day":return e.setDate(n,e.getDate(t));case"meridiem":{const s=e.getHours(t)<12,i=e.getHours(n);return s&&i>=12?e.addHours(n,-12):!s&&i<12?e.addHours(n,12):n}case"hours":return e.setHours(n,e.getHours(t));case"minutes":return e.setMinutes(n,e.getMinutes(t));case"seconds":return e.setSeconds(n,e.getSeconds(t));default:return n}},um={year:1,month:2,day:3,weekDay:4,hours:5,minutes:6,seconds:7,meridiem:8,empty:9},fm=(e,r,t,n,s)=>[...t].sort((i,o)=>um[i.type]-um[o.type]).reduce((i,o)=>!s||o.modified?nk(e,o,r,i):i,n),ak=()=>navigator.userAgent.toLowerCase().includes("android"),sk=(e,r)=>{const t={};if(!r)return e.forEach((c,d)=>{const u=d===0?null:d-1,f=d===e.length-1?null:d+1;t[d]={leftIndex:u,rightIndex:f}}),{neighbors:t,startIndex:0,endIndex:e.length-1};const n={},s={};let i=0,o=0,l=e.length-1;for(;l>=0;){o=e.findIndex((c,d)=>{var u;return d>=i&&((u=c.endSeparator)==null?void 0:u.includes(" "))&&c.endSeparator!==" / "}),o===-1&&(o=e.length-1);for(let c=o;c>=i;c-=1)s[c]=l,n[l]=c,l-=1;i=o+1}return e.forEach((c,d)=>{const u=s[d],f=u===0?null:n[u-1],h=u===e.length-1?null:n[u+1];t[d]={leftIndex:f,rightIndex:h}}),{neighbors:t,startIndex:n[0],endIndex:n[e.length-1]}},Tu=(e,r)=>{if(e==null)return null;if(e==="all")return"all";if(typeof e=="string"){const t=r.findIndex(n=>n.type===e);return t===-1?null:t}return e},ik=["value","referenceDate"],Na={emptyValue:null,getTodayValue:Hg,getInitialReferenceValue:e=>{let{value:r,referenceDate:t}=e,n=ht(e,ik);return n.utils.isValid(r)?r:t??XE(n)},cleanValue:HE,areValuesEqual:YE,isSameError:(e,r)=>e===r,hasError:e=>e!=null,defaultErrorState:null,getTimezone:(e,r)=>e.isValid(r)?e.getTimezone(r):null,setTimezone:(e,r,t)=>t==null?null:e.setTimezone(t,r)},ok={updateReferenceValue:(e,r,t)=>e.isValid(r)?r:t,getSectionsFromValue:(e,r)=>r(e),getV7HiddenInputValueFromSections:ek,getV6InputValueFromSections:tk,parseValueStr:(e,r,t)=>t(e.trim(),r),getDateFromSection:e=>e,getDateSectionsFromValue:e=>e,updateDateInValue:(e,r,t)=>t,clearDateSections:e=>e.map(r=>je({},r,{value:""}))};function lk(e,r){return Array.isArray(r)?r.every(t=>e.indexOf(t)!==-1):e.indexOf(r)!==-1}const ck=e=>{setTimeout(e,0)},ln=(e=document)=>{const r=e.activeElement;return r?r.shadowRoot?ln(r.shadowRoot):r:null},dk="@media (pointer: fine)";function uk(e){return Pr("MuiPickersDay",e)}const Os=Ur("MuiPickersDay",["root","dayWithMargin","dayOutsideMonth","hiddenDaySpacingFiller","today","selected","disabled"]);function Xg(e){const{disabled:r,selected:t,today:n,outsideCurrentMonth:s,day:i,disableMargin:o,disableHighlightToday:l,showDaysOutsideCurrentMonth:c}=e,d=ur(),{ownerState:u}=tn();return b.useMemo(()=>je({},u,{day:i,isDaySelected:t??!1,isDayDisabled:r??!1,isDayCurrent:n??!1,isDayOutsideMonth:s??!1,isDayStartOfWeek:d.isSameDay(i,d.startOfWeek(i)),isDayEndOfWeek:d.isSameDay(i,d.endOfWeek(i)),disableMargin:o??!1,disableHighlightToday:l??!1,showDaysOutsideCurrentMonth:c??!1}),[d,u,i,t,r,n,s,o,l,c])}const fk=["autoFocus","className","classes","hidden","isAnimating","onClick","onDaySelect","onFocus","onBlur","onKeyDown","onMouseDown","onMouseEnter","children","isFirstVisibleCell","isLastVisibleCell","day","selected","disabled","today","outsideCurrentMonth","disableMargin","disableHighlightToday","showDaysOutsideCurrentMonth"],hk=(e,r)=>{const{isDaySelected:t,isDayDisabled:n,isDayCurrent:s,isDayOutsideMonth:i,disableMargin:o,disableHighlightToday:l,showDaysOutsideCurrentMonth:c}=r,d=i&&!c;return wr({root:["root",t&&!d&&"selected",n&&"disabled",!o&&"dayWithMargin",!l&&s&&"today",i&&c&&"dayOutsideMonth",d&&"hiddenDaySpacingFiller"],hiddenDaySpacingFiller:["hiddenDaySpacingFiller"]},uk,e)},Kg=({theme:e})=>je({},e.typography.caption,{width:Jo,height:Jo,borderRadius:"50%",padding:0,backgroundColor:"transparent",transition:e.transitions.create("background-color",{duration:e.transitions.duration.short}),color:(e.vars||e).palette.text.primary,"@media (pointer: fine)":{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.hoverOpacity})`:Vi(e.palette.primary.main,e.palette.action.hoverOpacity)}},"&:focus":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.focusOpacity})`:Vi(e.palette.primary.main,e.palette.action.focusOpacity),[`&.${Os.selected}`]:{willChange:"background-color",backgroundColor:(e.vars||e).palette.primary.dark}},[`&.${Os.selected}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.main,fontWeight:e.typography.fontWeightMedium,"&:hover":{willChange:"background-color",backgroundColor:(e.vars||e).palette.primary.dark}},[`&.${Os.disabled}:not(.${Os.selected})`]:{color:(e.vars||e).palette.text.disabled},[`&.${Os.disabled}&.${Os.selected}`]:{opacity:.6},variants:[{props:{disableMargin:!1},style:{margin:`0 ${nd}px`}},{props:{isDayOutsideMonth:!0,showDaysOutsideCurrentMonth:!0},style:{color:(e.vars||e).palette.text.secondary}},{props:{disableHighlightToday:!1,isDayCurrent:!0},style:{[`&:not(.${Os.selected})`]:{border:`1px solid ${(e.vars||e).palette.text.secondary}`}}}]}),Jg=(e,r)=>{const{ownerState:t}=e;return[r.root,!t.disableMargin&&r.dayWithMargin,!t.disableHighlightToday&&t.isDayCurrent&&r.today,!t.isDayOutsideMonth&&t.showDaysOutsideCurrentMonth&&r.dayOutsideMonth,t.isDayOutsideMonth&&!t.showDaysOutsideCurrentMonth&&r.hiddenDaySpacingFiller]},mk=nt(sS,{name:"MuiPickersDay",slot:"Root",overridesResolver:Jg})(Kg),pk=nt("div",{name:"MuiPickersDay",slot:"Root",overridesResolver:Jg})(({theme:e})=>je({},Kg({theme:e}),{opacity:0,pointerEvents:"none"})),xo=()=>{},xk=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersDay"}),{autoFocus:s=!1,className:i,classes:o,isAnimating:l,onClick:c,onDaySelect:d,onFocus:u=xo,onBlur:f=xo,onKeyDown:h=xo,onMouseDown:x=xo,onMouseEnter:m=xo,children:g,day:p,selected:y,disabled:S,today:v,outsideCurrentMonth:E,disableMargin:C,disableHighlightToday:A,showDaysOutsideCurrentMonth:j}=n,w=ht(n,fk),k=Xg({day:p,selected:y,disabled:S,today:v,outsideCurrentMonth:E,disableMargin:C,disableHighlightToday:A,showDaysOutsideCurrentMonth:j}),_=hk(o,k),I=ur(),D=b.useRef(null),B=Ln(D,t);Pa(()=>{s&&!S&&!l&&!E&&D.current.focus()},[s,S,l,E]);const R=P=>{x(P),E&&P.preventDefault()},Y=P=>{S||d(p),E&&P.currentTarget.focus(),c&&c(P)};return E&&!j?a.jsx(pk,{className:$r(_.root,_.hiddenDaySpacingFiller,i),ownerState:k,role:w.role}):a.jsx(mk,je({className:$r(_.root,i),ref:B,centerRipple:!0,disabled:S,tabIndex:y?0:-1,onKeyDown:P=>h(P,p),onFocus:P=>u(P,p),onBlur:P=>f(P,p),onMouseEnter:P=>m(P,p),onClick:Y,onMouseDown:R},w,{ownerState:k,children:g||I.format(p,"dayOfMonth")}))}),gk=b.memo(xk),Cu=["disablePast","disableFuture","minDate","maxDate","shouldDisableDate","shouldDisableMonth","shouldDisableYear"],Du=["disablePast","disableFuture","minTime","maxTime","shouldDisableTime","minutesStep","ampm","disableIgnoringDatePartForTimeValidation"],Qg=["minDateTime","maxDateTime"],yk=[...Cu,...Du,...Qg],Zg=e=>yk.reduce((r,t)=>(e.hasOwnProperty(t)&&(r[t]=e[t]),r),{}),vk=["value","defaultValue","referenceDate","format","formatDensity","onChange","timezone","onError","shouldRespectLeadingZeros","selectedSections","onSelectedSectionsChange","unstableFieldRef","unstableStartFieldRef","unstableEndFieldRef","enableAccessibleFieldDOMStructure","disabled","readOnly","dateSeparator","autoFocus","focused"],ey=(e,r)=>b.useMemo(()=>{const t=je({},e),n={},s=i=>{t.hasOwnProperty(i)&&(n[i]=t[i],delete t[i])};return vk.forEach(s),r==="date"?Cu.forEach(s):r==="time"?Du.forEach(s):r==="date-time"&&(Cu.forEach(s),Du.forEach(s),Qg.forEach(s)),{forwardedProps:t,internalProps:n}},[e,r]),bk=({utils:e,format:r})=>{let t=10,n=r,s=e.expandFormat(r);for(;s!==n;)if(n=s,s=e.expandFormat(n),t-=1,t<0)throw new Error("MUI X: The format expansion seems to be in an infinite loop. Please open an issue with the format passed to the component.");return s},Sk=({utils:e,expandedFormat:r})=>{const t=[],{start:n,end:s}=e.escapedCharacters,i=new RegExp(`(\\${n}[^\\${s}]*\\${s})+`,"g");let o=null;for(;o=i.exec(r);)t.push({start:o.index,end:i.lastIndex-1});return t},wk=(e,r,t,n)=>{switch(t.type){case"year":return r.fieldYearPlaceholder({digitAmount:e.formatByString(e.date(void 0,"default"),n).length,format:n});case"month":return r.fieldMonthPlaceholder({contentType:t.contentType,format:n});case"day":return r.fieldDayPlaceholder({format:n});case"weekDay":return r.fieldWeekDayPlaceholder({contentType:t.contentType,format:n});case"hours":return r.fieldHoursPlaceholder({format:n});case"minutes":return r.fieldMinutesPlaceholder({format:n});case"seconds":return r.fieldSecondsPlaceholder({format:n});case"meridiem":return r.fieldMeridiemPlaceholder({format:n});default:return n}},jk=({utils:e,date:r,shouldRespectLeadingZeros:t,localeText:n,localizedDigits:s,now:i,token:o,startSeparator:l})=>{if(o==="")throw new Error("MUI X: Should not call `commitToken` with an empty token");const c=Yg(e,o),d=qg(e,c.contentType,c.type,o),u=t?d:c.contentType==="digit",f=e.isValid(r);let h=f?e.formatByString(r,o):"",x=null;if(u)if(d)x=h===""?e.formatByString(i,o).length:h.length;else{if(c.maxLength==null)throw new Error(`MUI X: The token ${o} should have a 'maxLength' property on it's adapter`);x=c.maxLength,f&&(h=Xf(Kf(ri(h,s),x),s))}return je({},c,{format:o,maxLength:x,value:h,placeholder:wk(e,n,c,o),hasLeadingZerosInFormat:d,hasLeadingZerosInInput:u,startSeparator:l,endSeparator:"",modified:!1})},Ek=e=>{var x;const{utils:r,expandedFormat:t,escapedParts:n}=e,s=r.date(void 0),i=[];let o="";const l=Object.keys(r.formatTokenMap).sort((m,g)=>g.length-m.length),c=/^([a-zA-Z]+)/,d=new RegExp(`^(${l.join("|")})*$`),u=new RegExp(`^(${l.join("|")})`),f=m=>n.find(g=>g.start<=m&&g.end>=m);let h=0;for(;h<t.length;){const m=f(h),g=m!=null,p=(x=c.exec(t.slice(h)))==null?void 0:x[1];if(!g&&p!=null&&d.test(p)){let y=p;for(;y.length>0;){const S=u.exec(y)[1];y=y.slice(S.length),i.push(jk(je({},e,{now:s,token:S,startSeparator:o}))),o=""}h+=p.length}else{const y=t[h];g&&(m==null?void 0:m.start)===h||(m==null?void 0:m.end)===h||(i.length===0?o+=y:(i[i.length-1].endSeparator+=y,i[i.length-1].isEndFormatSeparator=!0)),h+=1}}return i.length===0&&o.length>0&&i.push({type:"empty",contentType:"letter",maxLength:null,format:"",value:"",placeholder:"",hasLeadingZerosInFormat:!1,hasLeadingZerosInInput:!1,startSeparator:o,endSeparator:"",modified:!1}),i},kk=({isRtl:e,formatDensity:r,sections:t})=>t.map(n=>{const s=i=>{let o=i;return e&&o!==null&&o.includes(" ")&&(o=`‚Å©${o}‚Å¶`),r==="spacious"&&["/",".","-"].includes(o)&&(o=` ${o} `),o};return n.startSeparator=s(n.startSeparator),n.endSeparator=s(n.endSeparator),n}),hm=e=>{let r=bk(e);e.isRtl&&e.enableAccessibleFieldDOMStructure&&(r=r.split(" ").reverse().join(" "));const t=Sk(je({},e,{expandedFormat:r})),n=Ek(je({},e,{expandedFormat:r,escapedParts:t}));return kk(je({},e,{sections:n}))},Qf=()=>b.useContext(Yf),Ak=()=>{const e=b.useContext($g);if(e==null)throw new Error(["MUI X: The `usePickerActionsContext` can only be called in fields that are used as a slot of a Picker component"].join(`
`));return e},Ai=e=>e.saveQuery!=null,ty=({stateResponse:{localizedDigits:e,sectionsValueBoundaries:r,state:t,timezone:n,setCharacterQuery:s,setTempAndroidValueStr:i,updateSectionValue:o}})=>{const l=ur(),c=({keyPressed:f,sectionIndex:h},x,m)=>{const g=f.toLowerCase(),p=t.sections[h];if(t.characterQuery!=null&&(!m||m(t.characterQuery.value))&&t.characterQuery.sectionIndex===h){const S=`${t.characterQuery.value}${g}`,v=x(S,p);if(!Ai(v))return s({sectionIndex:h,value:S,sectionType:p.type}),v}const y=x(g,p);return Ai(y)&&!y.saveQuery?(s(null),null):(s({sectionIndex:h,value:g,sectionType:p.type}),Ai(y)?null:y)},d=f=>{const h=(g,p,y)=>{const S=p.filter(v=>v.toLowerCase().startsWith(y));return S.length===0?{saveQuery:!1}:{sectionValue:S[0],shouldGoToNextSection:S.length===1}},x=(g,p,y,S)=>{const v=E=>zg(l,n,p.type,E);if(p.contentType==="letter")return h(p.format,v(p.format),g);if(y&&S!=null&&Yg(l,y).contentType==="letter"){const E=v(y),C=h(y,E,g);return Ai(C)?{saveQuery:!1}:je({},C,{sectionValue:S(C.sectionValue,E)})}return{saveQuery:!1}};return c(f,(g,p)=>{switch(p.type){case"month":{const y=S=>dm(l,S,l.formats.month,p.format);return x(g,p,l.formats.month,y)}case"weekDay":{const y=(S,v)=>v.indexOf(S).toString();return x(g,p,l.formats.weekday,y)}case"meridiem":return x(g,p);default:return{saveQuery:!1}}})},u=f=>{const h=(m,g)=>{const p=ri(m,e),y=Number(p),S=r[g.type]({currentDate:null,format:g.format,contentType:g.contentType});if(y>S.maximum)return{saveQuery:!1};if(y<S.minimum)return{saveQuery:!0};const v=y*10>S.maximum||p.length===S.maximum.toString().length;return{sectionValue:Gg(l,y,S,e,g),shouldGoToNextSection:v}};return c(f,(m,g)=>{if(g.contentType==="digit"||g.contentType==="digit-with-letter")return h(m,g);if(g.type==="month"){const p=qg(l,"digit","month","MM"),y=h(m,{type:g.type,format:"MM",hasLeadingZerosInFormat:p,hasLeadingZerosInInput:!0,contentType:"digit",maxLength:2});if(Ai(y))return y;const S=dm(l,y.sectionValue,"MM",g.format);return je({},y,{sectionValue:S})}if(g.type==="weekDay"){const p=h(m,g);if(Ai(p))return p;const y=sd(l,g.format)[Number(p.sectionValue)-1];return je({},p,{sectionValue:y})}return{saveQuery:!1}},m=>cm(m,e))};return Ze(f=>{const h=t.sections[f.sectionIndex],m=cm(f.keyPressed,e)?u(je({},f,{keyPressed:Xf(f.keyPressed,e)})):d(f);if(m==null){i(null);return}o({section:h,newSectionValue:m.sectionValue,shouldGoToNextSection:m.shouldGoToNextSection})})},xl=({props:e,value:r,timezone:t,adapter:n})=>{if(r===null)return null;const{shouldDisableDate:s,shouldDisableMonth:i,shouldDisableYear:o,disablePast:l,disableFuture:c,minDate:d,maxDate:u}=e,f=n.utils.date(void 0,t);switch(!0){case!n.utils.isValid(r):return"invalidDate";case!!(s&&s(r)):return"shouldDisableDate";case!!(i&&i(r)):return"shouldDisableMonth";case!!(o&&o(r)):return"shouldDisableYear";case!!(c&&n.utils.isAfterDay(r,f)):return"disableFuture";case!!(l&&n.utils.isBeforeDay(r,f)):return"disablePast";case!!(d&&n.utils.isBeforeDay(r,d)):return"minDate";case!!(u&&n.utils.isAfterDay(r,u)):return"maxDate";default:return null}};xl.valueManager=Na;function ry(e){const{props:r,validator:t,value:n,timezone:s,onError:i}=e,o=ci(),l=b.useRef(t.valueManager.defaultErrorState),c=t({adapter:o,value:n,timezone:s,props:r}),d=t.valueManager.hasError(c);b.useEffect(()=>{i&&!t.valueManager.isSameError(c,l.current)&&i(c,n),l.current=c},[t,i,c,n]);const u=Ze(f=>t({adapter:o,value:f,timezone:s,props:r}));return{validationError:c,hasValidationError:d,getValidationErrorForNewValue:u}}const Tk=5e3,ny=e=>{var be;const r=ur(),t=_s(),n=ci(),s=Qa(),{manager:{validator:i,valueType:o,internal_valueManager:l,internal_fieldValueManager:c},internalPropsWithDefaults:d,internalPropsWithDefaults:{value:u,defaultValue:f,referenceDate:h,onChange:x,format:m,formatDensity:g="dense",selectedSections:p,onSelectedSectionsChange:y,shouldRespectLeadingZeros:S=!1,timezone:v,enableAccessibleFieldDOMStructure:E=!0},forwardedProps:{error:C}}=e,{value:A,handleValueChange:j,timezone:w}=pl({name:"a field component",timezone:v,value:u,defaultValue:f,referenceDate:h,onChange:x,valueManager:l}),k=b.useRef(A);b.useEffect(()=>{k.current=A},[A]);const{hasValidationError:_}=ry({props:d,validator:i,timezone:w,value:A,onError:d.onError}),I=b.useMemo(()=>C!==void 0?C:_,[_,C]),D=b.useMemo(()=>JE(r),[r]),B=b.useMemo(()=>rk(r,D,w),[r,D,w]),R=b.useCallback(xe=>c.getSectionsFromValue(xe,Fe=>hm({utils:r,localeText:t,localizedDigits:D,format:m,date:Fe,formatDensity:g,shouldRespectLeadingZeros:S,enableAccessibleFieldDOMStructure:E,isRtl:s})),[c,m,t,D,s,S,r,g,E]),[Y,P]=b.useState(()=>{const xe=R(A),Fe={sections:xe,lastExternalValue:A,lastSectionsDependencies:{format:m,isRtl:s,locale:r.locale},tempValueStrAndroid:null,characterQuery:null},me=qE(xe),ve=l.getInitialReferenceValue({referenceDate:h,value:A,utils:r,props:d,granularity:me,timezone:w});return je({},Fe,{referenceValue:ve})}),[M,K]=qi({controlled:p,default:null,name:"useField",state:"selectedSections"}),L=xe=>{K(xe),y==null||y(xe)},ae=b.useMemo(()=>Tu(M,Y.sections),[M,Y.sections]),Z=ae==="all"?0:ae,T=b.useMemo(()=>sk(Y.sections,s&&!E),[Y.sections,s,E]),N=b.useMemo(()=>Y.sections.every(xe=>xe.value===""),[Y.sections]),H=xe=>{const Fe={validationError:i({adapter:n,value:xe,timezone:w,props:d})};j(xe,Fe)},G=(xe,Fe)=>{const me=[...Y.sections];return me[xe]=je({},me[xe],{value:Fe,modified:!0}),me},q=b.useRef(null),oe=Pi(),de=xe=>{Z!=null&&(q.current={sectionIndex:Z,value:xe},oe.start(0,()=>{q.current=null}))},z=()=>{l.areValuesEqual(r,A,l.emptyValue)?P(xe=>je({},xe,{sections:xe.sections.map(Fe=>je({},Fe,{value:""})),tempValueStrAndroid:null,characterQuery:null})):(P(xe=>je({},xe,{characterQuery:null})),H(l.emptyValue))},O=()=>{if(Z==null)return;const xe=Y.sections[Z];xe.value!==""&&(de(""),c.getDateFromSection(A,xe)===null?P(Fe=>je({},Fe,{sections:G(Z,""),tempValueStrAndroid:null,characterQuery:null})):(P(Fe=>je({},Fe,{characterQuery:null})),H(c.updateDateInValue(A,xe,null))))},W=xe=>{const Fe=(ve,ne)=>{const we=r.parse(ve,m);if(!r.isValid(we))return null;const Ee=hm({utils:r,localeText:t,localizedDigits:D,format:m,date:we,formatDensity:g,shouldRespectLeadingZeros:S,enableAccessibleFieldDOMStructure:E,isRtl:s});return fm(r,we,Ee,ne,!1)},me=c.parseValueStr(xe,Y.referenceValue,Fe);H(me)},F=Pi(),U=({section:xe,newSectionValue:Fe,shouldGoToNextSection:me})=>{oe.clear(),F.clear();const ve=c.getDateFromSection(A,xe);me&&Z<Y.sections.length-1&&L(Z+1);const ne=G(Z,Fe),we=c.getDateSectionsFromValue(ne,xe),Ee=ZE(r,we,D);if(r.isValid(Ee)){const pe=fm(r,Ee,we,c.getDateFromSection(Y.referenceValue,xe),!0);return ve==null&&F.start(0,()=>{k.current===A&&P(Ce=>je({},Ce,{sections:c.clearDateSections(Y.sections,xe),tempValueStrAndroid:null}))}),H(c.updateDateInValue(A,xe,pe))}return we.every(pe=>pe.value!=="")?(de(Fe),H(c.updateDateInValue(A,xe,Ee))):ve!=null?(de(Fe),H(c.updateDateInValue(A,xe,null))):P(pe=>je({},pe,{sections:ne,tempValueStrAndroid:null}))},te=xe=>P(Fe=>je({},Fe,{tempValueStrAndroid:xe})),he=Ze(xe=>{P(Fe=>je({},Fe,{characterQuery:xe}))});if(A!==Y.lastExternalValue){let xe;q.current!=null&&!r.isValid(c.getDateFromSection(A,Y.sections[q.current.sectionIndex]))?xe=G(q.current.sectionIndex,q.current.value):xe=R(A),P(Fe=>je({},Fe,{lastExternalValue:A,sections:xe,sectionsDependencies:{format:m,isRtl:s,locale:r.locale},referenceValue:c.updateReferenceValue(r,A,Fe.referenceValue),tempValueStrAndroid:null}))}if(s!==Y.lastSectionsDependencies.isRtl||m!==Y.lastSectionsDependencies.format||r.locale!==Y.lastSectionsDependencies.locale){const xe=R(A);P(Fe=>je({},Fe,{lastSectionsDependencies:{format:m,isRtl:s,locale:r.locale},sections:xe,tempValueStrAndroid:null,characterQuery:null}))}Y.characterQuery!=null&&!I&&Z==null&&he(null),Y.characterQuery!=null&&((be=Y.sections[Y.characterQuery.sectionIndex])==null?void 0:be.type)!==Y.characterQuery.sectionType&&he(null),b.useEffect(()=>{q.current!=null&&(q.current=null)});const ie=Pi();return b.useEffect(()=>(Y.characterQuery!=null&&ie.start(Tk,()=>he(null)),()=>{}),[Y.characterQuery,he,ie]),b.useEffect(()=>{Y.tempValueStrAndroid!=null&&Z!=null&&O()},[Y.sections]),{activeSectionIndex:Z,areAllSectionsEmpty:N,error:I,localizedDigits:D,parsedSelectedSections:ae,sectionOrder:T,sectionsValueBoundaries:B,state:Y,timezone:w,value:A,clearValue:z,clearActiveSection:O,setCharacterQuery:he,setSelectedSections:L,setTempAndroidValueStr:te,updateSectionValue:U,updateValueFromValueStr:W,getSectionsFromValue:R}};function ay(e){const{manager:{internal_useApplyDefaultValuesToFieldInternalProps:r},internalProps:t,skipContextFieldRefAssignment:n}=e,s=Qf(),i=Lg(),o=Ln(t.unstableFieldRef,n?null:i==null?void 0:i.fieldRef),l=s==null?void 0:s.setValue,c=b.useCallback((u,f)=>l==null?void 0:l(u,{validationError:f.validationError,shouldClose:!1}),[l]),d=b.useMemo(()=>i!=null&&s!=null?je({value:s.value,onChange:c,timezone:s.timezone,disabled:s.disabled,readOnly:s.readOnly,autoFocus:s.autoFocus&&!s.open,focused:s.open?!0:void 0,format:s.fieldFormat,formatDensity:i.formatDensity,enableAccessibleFieldDOMStructure:i.enableAccessibleFieldDOMStructure,selectedSections:i.selectedSections,onSelectedSectionsChange:i.onSelectedSectionsChange,unstableFieldRef:o},t):t,[s,i,t,c,o]);return r(d)}function Zf(e){const{focused:r,domGetters:t,stateResponse:{parsedSelectedSections:n,state:s}}=e;if(!t.isReady())return;const i=document.getSelection();if(!i)return;if(n==null){i.rangeCount>0&&t.getRoot().contains(i.getRangeAt(0).startContainer)&&i.removeAllRanges(),r&&t.getRoot().blur();return}if(!t.getRoot().contains(ln(document)))return;const o=new window.Range;let l;n==="all"?l=t.getRoot():s.sections[n].type==="empty"?l=t.getSectionContainer(n):l=t.getSectionContent(n),o.selectNodeContents(l),l.focus(),i.removeAllRanges(),i.addRange(o)}function sy(e){const r=ur(),{manager:{internal_fieldValueManager:t},internalPropsWithDefaults:{minutesStep:n,disabled:s,readOnly:i},stateResponse:{state:o,value:l,activeSectionIndex:c,parsedSelectedSections:d,sectionsValueBoundaries:u,localizedDigits:f,timezone:h,sectionOrder:x,clearValue:m,clearActiveSection:g,setSelectedSections:p,updateSectionValue:y}}=e;return Ze(S=>{if(!s)switch(!0){case((S.ctrlKey||S.metaKey)&&String.fromCharCode(S.keyCode)==="A"&&!S.shiftKey&&!S.altKey):{S.preventDefault(),p("all");break}case S.key==="ArrowRight":{if(S.preventDefault(),d==null)p(x.startIndex);else if(d==="all")p(x.endIndex);else{const v=x.neighbors[d].rightIndex;v!==null&&p(v)}break}case S.key==="ArrowLeft":{if(S.preventDefault(),d==null)p(x.endIndex);else if(d==="all")p(x.startIndex);else{const v=x.neighbors[d].leftIndex;v!==null&&p(v)}break}case S.key==="Delete":{if(S.preventDefault(),i)break;d==null||d==="all"?m():g();break}case["ArrowUp","ArrowDown","Home","End","PageUp","PageDown"].includes(S.key):{if(S.preventDefault(),i||c==null)break;d==="all"&&p(c);const v=o.sections[c],E=Dk(r,h,v,S.key,u,f,t.getDateFromSection(l,v),{minutesStep:n});y({section:v,newSectionValue:E,shouldGoToNextSection:!1});break}}})}function Ck(e){switch(e){case"ArrowUp":return 1;case"ArrowDown":return-1;case"PageUp":return 5;case"PageDown":return-5;default:return 0}}function Dk(e,r,t,n,s,i,o,l){const c=Ck(n),d=n==="Home",u=n==="End",f=t.value===""||d||u,h=()=>{const m=s[t.type]({currentDate:o,format:t.format,contentType:t.contentType}),g=S=>Gg(e,S,m,i,t),p=t.type==="minutes"&&(l!=null&&l.minutesStep)?l.minutesStep:1;let y;if(f){if(t.type==="year"&&!u&&!d)return e.formatByString(e.date(void 0,r),t.format);c>0||d?y=m.minimum:y=m.maximum}else y=parseInt(ri(t.value,i),10)+c*p;return y%p!==0&&((c<0||d)&&(y+=p-(p+y)%p),(c>0||u)&&(y-=y%p)),y>m.maximum?g(m.minimum+(y-m.maximum-1)%(m.maximum-m.minimum+1)):y<m.minimum?g(m.maximum-(m.minimum-y-1)%(m.maximum-m.minimum+1)):g(y)},x=()=>{const m=zg(e,r,t.type,t.format);if(m.length===0)return t.value;if(f)return c>0||d?m[0]:m[m.length-1];const y=((m.indexOf(t.value)+c)%m.length+m.length)%m.length;return m[y]};return t.contentType==="digit"||t.contentType==="digit-with-letter"?h():x()}function _k(e){const{manager:r,focused:t,setFocused:n,domGetters:s,stateResponse:i,applyCharacterEditing:o,internalPropsWithDefaults:l,stateResponse:{parsedSelectedSections:c,sectionOrder:d,state:u,clearValue:f,setCharacterQuery:h,setSelectedSections:x,updateValueFromValueStr:m},internalPropsWithDefaults:{disabled:g=!1,readOnly:p=!1}}=e,y=sy({manager:r,internalPropsWithDefaults:l,stateResponse:i}),S=Pi(),v=Ze(w=>{g||!s.isReady()||(n(!0),c==="all"?S.start(0,()=>{const k=document.getSelection().getRangeAt(0).startOffset;if(k===0){x(d.startIndex);return}let _=0,I=0;for(;I<k&&_<u.sections.length;){const D=u.sections[_];_+=1,I+=`${D.startSeparator}${D.value||D.placeholder}${D.endSeparator}`.length}x(_-1)}):t?s.getRoot().contains(w.target)||x(d.startIndex):(n(!0),x(d.startIndex)))}),E=Ze(w=>{if(!s.isReady()||c!=="all")return;const _=w.target.textContent??"";s.getRoot().innerHTML=u.sections.map(I=>`${I.startSeparator}${I.value||I.placeholder}${I.endSeparator}`).join(""),Zf({focused:t,domGetters:s,stateResponse:i}),_.length===0||_.charCodeAt(0)===10?(f(),x("all")):_.length>1?m(_):(c==="all"&&x(0),o({keyPressed:_,sectionIndex:0}))}),C=Ze(w=>{if(p||c!=="all"){w.preventDefault();return}const k=w.clipboardData.getData("text");w.preventDefault(),h(null),m(k)}),A=Ze(()=>{if(t||g||!s.isReady())return;const w=ln(document);n(!0),s.getSectionIndexFromDOMElement(w)!=null||x(d.startIndex)}),j=Ze(()=>{setTimeout(()=>{if(!s.isReady())return;const w=ln(document);!s.getRoot().contains(w)&&(n(!1),x(null))})});return{onKeyDown:y,onBlur:j,onFocus:A,onClick:v,onPaste:C,onInput:E,contentEditable:c==="all",tabIndex:c===0?-1:0}}function Ik(e){const{manager:{internal_fieldValueManager:r},stateResponse:{areAllSectionsEmpty:t,state:n,updateValueFromValueStr:s}}=e,i=Ze(l=>{s(l.target.value)});return{value:b.useMemo(()=>t?"":r.getV7HiddenInputValueFromSections(n.sections),[t,n.sections,r]),onChange:i}}function Fk(e){const{stateResponse:{setSelectedSections:r},internalPropsWithDefaults:{disabled:t=!1}}=e,n=Ze(s=>i=>{t||i.isDefaultPrevented()||r(s)});return b.useCallback(s=>({"data-sectionindex":s,onClick:n(s)}),[n])}function Mk(e){const r=ur(),t=_s(),n=td(),{focused:s,domGetters:i,stateResponse:o,applyCharacterEditing:l,manager:{internal_fieldValueManager:c},stateResponse:{parsedSelectedSections:d,sectionsValueBoundaries:u,state:f,value:h,clearActiveSection:x,setCharacterQuery:m,setSelectedSections:g,updateSectionValue:p,updateValueFromValueStr:y},internalPropsWithDefaults:{disabled:S=!1,readOnly:v=!1}}=e,E=d==="all",C=!E&&!S&&!v,A=Ze(D=>{if(!i.isReady())return;const B=f.sections[D];i.getSectionContent(D).innerHTML=B.value||B.placeholder,Zf({focused:s,domGetters:i,stateResponse:o})}),j=Ze(D=>{if(!i.isReady())return;const B=D.target,R=B.textContent??"",Y=i.getSectionIndexFromDOMElement(B),P=f.sections[Y];if(v){A(Y);return}if(R.length===0){if(P.value===""){A(Y);return}const M=D.nativeEvent.inputType;if(M==="insertParagraph"||M==="insertLineBreak"){A(Y);return}A(Y),x();return}l({keyPressed:R,sectionIndex:Y}),A(Y)}),w=Ze(D=>{D.preventDefault()}),k=Ze(D=>{if(D.preventDefault(),v||S||typeof d!="number")return;const B=f.sections[d],R=D.clipboardData.getData("text"),Y=/^[a-zA-Z]+$/.test(R),P=/^[0-9]+$/.test(R),M=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(R);B.contentType==="letter"&&Y||B.contentType==="digit"&&P||B.contentType==="digit-with-letter"&&M?(m(null),p({section:B,newSectionValue:R,shouldGoToNextSection:!0})):!Y&&!P&&(m(null),y(R))}),_=Ze(D=>{D.preventDefault(),D.dataTransfer.dropEffect="none"}),I=Ze(D=>()=>{S||g(D)});return b.useCallback((D,B)=>{const R=u[D.type]({currentDate:c.getDateFromSection(h,D),contentType:D.contentType,format:D.format});return{onInput:j,onPaste:k,onMouseUp:w,onDragOver:_,onFocus:I(B),"aria-labelledby":`${n}-${D.type}`,"aria-readonly":v,"aria-valuenow":Nk(D,r),"aria-valuemin":R.minimum,"aria-valuemax":R.maximum,"aria-valuetext":D.value?Pk(D,r):t.empty,"aria-label":t[D.type],"aria-disabled":S,tabIndex:E||B>0?-1:0,contentEditable:!E&&!S&&!v,role:"spinbutton",id:`${n}-${D.type}`,"data-range-position":D.dateName||void 0,spellCheck:C?!1:void 0,autoCapitalize:C?"off":void 0,autoCorrect:C?"off":void 0,children:D.value||D.placeholder,inputMode:D.contentType==="letter"?"text":"numeric"}},[u,n,E,S,v,C,t,r,j,k,w,_,I,c,h])}function Pk(e,r){if(e.value)switch(e.type){case"month":{if(e.contentType==="digit")return r.format(r.setMonth(r.date(),Number(e.value)-1),"month");const t=r.parse(e.value,e.format);return t?r.format(t,"month"):void 0}case"day":return e.contentType==="digit"?r.format(r.setDate(r.startOfYear(r.date()),Number(e.value)),"dayOfMonthFull"):e.value;case"weekDay":return;default:return}}function Nk(e,r){if(e.value)switch(e.type){case"weekDay":return e.contentType==="letter"?void 0:Number(e.value);case"meridiem":{const t=r.parse(`01:00 ${e.value}`,`${r.formats.hours12h}:${r.formats.minutes} ${e.format}`);return t?r.getHours(t)>=12?1:0:void 0}case"day":return e.contentType==="digit-with-letter"?parseInt(e.value,10):Number(e.value);case"month":{if(e.contentType==="digit")return Number(e.value);const t=r.parse(e.value,e.format);return t?r.getMonth(t)+1:void 0}default:return e.contentType!=="letter"?Number(e.value):void 0}}const Rk=e=>{const{props:r,manager:t,skipContextFieldRefAssignment:n,manager:{valueType:s,internal_useOpenPickerButtonAriaLabel:i}}=e,{internalProps:o,forwardedProps:l}=ey(r,s),c=ay({manager:t,internalProps:o,skipContextFieldRefAssignment:n}),{sectionListRef:d,onBlur:u,onClick:f,onFocus:h,onInput:x,onPaste:m,onKeyDown:g,onClear:p,clearable:y}=l,{disabled:S=!1,readOnly:v=!1,autoFocus:E=!1,focused:C,unstableFieldRef:A}=c,j=b.useRef(null),w=Ln(d,j),k=b.useMemo(()=>({isReady:()=>j.current!=null,getRoot:()=>j.current.getRoot(),getSectionContainer:ie=>j.current.getSectionContainer(ie),getSectionContent:ie=>j.current.getSectionContent(ie),getSectionIndexFromDOMElement:ie=>j.current.getSectionIndexFromDOMElement(ie)}),[j]),_=ny({manager:t,internalPropsWithDefaults:c,forwardedProps:l}),{areAllSectionsEmpty:I,error:D,parsedSelectedSections:B,sectionOrder:R,state:Y,value:P,clearValue:M,setSelectedSections:K}=_,L=ty({stateResponse:_}),ae=i(P),[Z,T]=b.useState(!1);function N(ie=0){if(S||!j.current||mm(j)!=null)return;const be=Tu(ie,Y.sections);T(!0),j.current.getSectionContent(be).focus()}const H=_k({manager:t,internalPropsWithDefaults:c,stateResponse:_,applyCharacterEditing:L,focused:Z,setFocused:T,domGetters:k}),G=Ik({manager:t,stateResponse:_}),q=Fk({stateResponse:_,internalPropsWithDefaults:c}),oe=Mk({manager:t,stateResponse:_,applyCharacterEditing:L,internalPropsWithDefaults:c,domGetters:k,focused:Z}),de=Ze(ie=>{g==null||g(ie),H.onKeyDown(ie)}),z=Ze(ie=>{u==null||u(ie),H.onBlur(ie)}),O=Ze(ie=>{h==null||h(ie),H.onFocus(ie)}),W=Ze(ie=>{ie.isDefaultPrevented()||(f==null||f(ie),H.onClick(ie))}),F=Ze(ie=>{m==null||m(ie),H.onPaste(ie)}),U=Ze(ie=>{x==null||x(ie),H.onInput(ie)}),te=Ze((ie,...be)=>{ie.preventDefault(),p==null||p(ie,...be),M(),pm(j)?K(R.startIndex):N(0)}),he=b.useMemo(()=>Y.sections.map((ie,be)=>{const xe=oe(ie,be);return{container:q(be),content:oe(ie,be),before:{children:ie.startSeparator},after:{children:ie.endSeparator,"data-range-position":ie.isEndFormatSeparator?xe["data-range-position"]:void 0}}}),[Y.sections,q,oe]);return b.useEffect(()=>{if(j.current==null)throw new Error(["MUI X: The `sectionListRef` prop has not been initialized by `PickersSectionList`","You probably tried to pass a component to the `textField` slot that contains an `<input />` element instead of a `PickersSectionList`.","","If you want to keep using an `<input />` HTML element for the editing, please add the `enableAccessibleFieldDOMStructure={false}` prop to your Picker or Field component:","","<DatePicker enableAccessibleFieldDOMStructure={false} slots={{ textField: MyCustomTextField }} />","","Learn more about the field accessible DOM structure on the MUI documentation: https://mui.com/x/react-date-pickers/fields/#fields-to-edit-a-single-element"].join(`
`));E&&!S&&j.current&&j.current.getSectionContent(R.startIndex).focus()},[]),Pa(()=>{if(!(!Z||!j.current)){if(B==="all")j.current.getRoot().focus();else if(typeof B=="number"){const ie=j.current.getSectionContent(B);ie&&ie.focus()}}},[B,Z]),Pa(()=>{Zf({focused:Z,domGetters:k,stateResponse:_})}),b.useImperativeHandle(A,()=>({getSections:()=>Y.sections,getActiveSectionIndex:()=>mm(j),setSelectedSections:ie=>{if(S||!j.current)return;const be=Tu(ie,Y.sections);T((be==="all"?0:be)!==null),K(ie)},focusField:N,isFieldFocused:()=>pm(j)})),je({},l,H,{onBlur:z,onClick:W,onFocus:O,onInput:U,onPaste:F,onKeyDown:de,onClear:te},G,{error:D,clearable:!!(y&&!I&&!v&&!S),focused:C??Z,sectionListRef:w,enableAccessibleFieldDOMStructure:!0,elements:he,areAllSectionsEmpty:I,disabled:S,readOnly:v,autoFocus:E,openPickerAriaLabel:ae})};function mm(e){const r=ln(document);return!r||!e.current||!e.current.getRoot().contains(r)?null:e.current.getSectionIndexFromDOMElement(r)}function pm(e){const r=ln(document);return!!e.current&&e.current.getRoot().contains(r)}const Ii=e=>e.replace(/[\u2066\u2067\u2068\u2069]/g,""),Ok=(e,r,t)=>{let n=0,s=t?1:0;const i=[];for(let o=0;o<e.length;o+=1){const l=e[o],c=Jf(l,t?"input-rtl":"input-ltr",r),d=`${l.startSeparator}${c}${l.endSeparator}`,u=Ii(d).length,f=d.length,h=Ii(c),x=s+(h===""?0:c.indexOf(h[0]))+l.startSeparator.length,m=x+h.length;i.push(je({},l,{start:n,end:n+u,startInInput:x,endInInput:m})),n+=u,s+=f}return i},Lk=e=>{const r=Qa(),t=Pi(),n=Pi(),{props:s,manager:i,skipContextFieldRefAssignment:o,manager:{valueType:l,internal_valueManager:c,internal_fieldValueManager:d,internal_useOpenPickerButtonAriaLabel:u}}=e,{internalProps:f,forwardedProps:h}=ey(s,l),x=ay({manager:i,internalProps:f,skipContextFieldRefAssignment:o}),{onFocus:m,onClick:g,onPaste:p,onBlur:y,onKeyDown:S,onClear:v,clearable:E,inputRef:C,placeholder:A}=h,{readOnly:j=!1,disabled:w=!1,autoFocus:k=!1,focused:_,unstableFieldRef:I}=x,D=b.useRef(null),B=Ln(C,D),R=ny({manager:i,internalPropsWithDefaults:x,forwardedProps:h}),{activeSectionIndex:Y,areAllSectionsEmpty:P,error:M,localizedDigits:K,parsedSelectedSections:L,sectionOrder:ae,state:Z,value:T,clearValue:N,clearActiveSection:H,setCharacterQuery:G,setSelectedSections:q,setTempAndroidValueStr:oe,updateSectionValue:de,updateValueFromValueStr:z,getSectionsFromValue:O}=R,W=ty({stateResponse:R}),F=u(T),U=b.useMemo(()=>Ok(Z.sections,K,r),[Z.sections,K,r]);function te(){const ke=D.current.selectionStart??0;let Ae;ke<=U[0].startInInput||ke>=U[U.length-1].endInInput?Ae=1:Ae=U.findIndex(Ye=>Ye.startInInput-Ye.startSeparator.length>ke);const Ue=Ae===-1?U.length-1:Ae-1;q(Ue)}function he(ke=0){var Ae;ln(document)!==D.current&&((Ae=D.current)==null||Ae.focus(),q(ke))}const ie=Ze(ke=>{m==null||m(ke);const Ae=D.current;t.start(0,()=>{!Ae||Ae!==D.current||Y==null&&(Ae.value.length&&Number(Ae.selectionEnd)-Number(Ae.selectionStart)===Ae.value.length?q("all"):te())})}),be=Ze((ke,...Ae)=>{ke.isDefaultPrevented()||(g==null||g(ke,...Ae),te())}),xe=Ze(ke=>{if(p==null||p(ke),ke.preventDefault(),j||w)return;const Ae=ke.clipboardData.getData("text");if(typeof L=="number"){const Ue=Z.sections[L],Ye=/^[a-zA-Z]+$/.test(Ae),Ve=/^[0-9]+$/.test(Ae),Xe=/^(([a-zA-Z]+)|)([0-9]+)(([a-zA-Z]+)|)$/.test(Ae);if(Ue.contentType==="letter"&&Ye||Ue.contentType==="digit"&&Ve||Ue.contentType==="digit-with-letter"&&Xe){G(null),de({section:Ue,newSectionValue:Ae,shouldGoToNextSection:!0});return}if(Ye||Ve)return}G(null),z(Ae)}),Fe=Ze(ke=>{y==null||y(ke),q(null)}),me=Ze(ke=>{if(j)return;const Ae=ke.target.value;if(Ae===""){N();return}const Ue=ke.nativeEvent.data,Ye=Ue&&Ue.length>1,Ve=Ye?Ue:Ae,Xe=Ii(Ve);if(L==="all"&&q(Y),Y==null||Ye){z(Ye?Ue:Xe);return}let _t;if(L==="all"&&Xe.length===1)_t=Xe;else{const ct=Ii(d.getV6InputValueFromSections(U,K,r));let dt=-1,qt=-1;for(let Er=0;Er<ct.length;Er+=1)dt===-1&&ct[Er]!==Xe[Er]&&(dt=Er),qt===-1&&ct[ct.length-Er-1]!==Xe[Xe.length-Er-1]&&(qt=Er);const jr=U[Y];if(dt<jr.start||ct.length-qt-1>jr.end)return;const as=Xe.length-ct.length+jr.end-Ii(jr.endSeparator||"").length;_t=Xe.slice(jr.start+Ii(jr.startSeparator||"").length,as)}if(_t.length===0){ak()&&oe(Ve),H();return}W({keyPressed:_t,sectionIndex:Y})}),ve=Ze((ke,...Ae)=>{ke.preventDefault(),v==null||v(ke,...Ae),N(),xm(D)?q(ae.startIndex):he(0)}),ne=sy({manager:i,internalPropsWithDefaults:x,stateResponse:R}),we=Ze(ke=>{S==null||S(ke),ne(ke)}),Ee=b.useMemo(()=>A!==void 0?A:d.getV6InputValueFromSections(O(c.emptyValue),K,r),[A,d,O,c.emptyValue,K,r]),pe=b.useMemo(()=>Z.tempValueStrAndroid??d.getV6InputValueFromSections(Z.sections,K,r),[Z.sections,d,Z.tempValueStrAndroid,K,r]);b.useEffect(()=>{D.current&&D.current===ln(document)&&q("all")},[]),Pa(()=>{function ke(){if(!D.current)return;if(L==null){D.current.scrollLeft&&(D.current.scrollLeft=0);return}if(D.current!==ln(document))return;const Ae=D.current.scrollTop;if(L==="all")D.current.select();else{const Ue=U[L],Ye=Ue.type==="empty"?Ue.startInInput-Ue.startSeparator.length:Ue.startInInput,Ve=Ue.type==="empty"?Ue.endInInput+Ue.endSeparator.length:Ue.endInInput;(Ye!==D.current.selectionStart||Ve!==D.current.selectionEnd)&&D.current===ln(document)&&D.current.setSelectionRange(Ye,Ve),n.start(0,()=>{D.current&&D.current===ln(document)&&D.current.selectionStart===D.current.selectionEnd&&(D.current.selectionStart!==Ye||D.current.selectionEnd!==Ve)&&ke()})}D.current.scrollTop=Ae}ke()});const Ce=b.useMemo(()=>Y==null||Z.sections[Y].contentType==="letter"?"text":"numeric",[Y,Z.sections]),Me=!(D.current&&D.current===ln(document))&&P;return b.useImperativeHandle(I,()=>({getSections:()=>Z.sections,getActiveSectionIndex:()=>{const ke=D.current.selectionStart??0,Ae=D.current.selectionEnd??0;if(ke===0&&Ae===0)return null;const Ue=ke<=U[0].startInInput?1:U.findIndex(Ye=>Ye.startInInput-Ye.startSeparator.length>ke);return Ue===-1?U.length-1:Ue-1},setSelectedSections:ke=>q(ke),focusField:he,isFieldFocused:()=>xm(D)})),je({},h,{error:M,clearable:!!(E&&!P&&!j&&!w),onBlur:Fe,onClick:be,onFocus:ie,onPaste:xe,onKeyDown:we,onClear:ve,inputRef:B,enableAccessibleFieldDOMStructure:!1,placeholder:Ee,inputMode:Ce,autoComplete:"off",value:Me?"":pe,onChange:me,focused:_,disabled:w,readOnly:j,autoFocus:k,openPickerAriaLabel:F})};function xm(e){return e.current===ln(document)}const $k=e=>{const r=Lg();return(e.props.enableAccessibleFieldDOMStructure??(r==null?void 0:r.enableAccessibleFieldDOMStructure)??!0?Rk:Lk)(e)};function Bk(e={}){const{enableAccessibleFieldDOMStructure:r=!0}=e;return b.useMemo(()=>({valueType:"date",validator:xl,internal_valueManager:Na,internal_fieldValueManager:ok,internal_enableAccessibleFieldDOMStructure:r,internal_useApplyDefaultValuesToFieldInternalProps:Vk,internal_useOpenPickerButtonAriaLabel:Uk}),[r])}function Uk(e){const r=ur(),t=_s();return b.useMemo(()=>{const n=r.isValid(e)?r.format(e,"fullDate"):null;return t.openDatePickerDialogue(n)},[e,t,r])}function Vk(e){const r=ur(),t=gl(e);return b.useMemo(()=>je({},e,t,{format:e.format??r.formats.keyboardDate}),[e,t,r])}function gl(e){const r=ur(),t=bE();return b.useMemo(()=>({disablePast:e.disablePast??!1,disableFuture:e.disableFuture??!1,minDate:im(r,e.minDate,t.minDate),maxDate:im(r,e.maxDate,t.maxDate)}),[e.minDate,e.maxDate,e.disableFuture,e.disablePast,r,t])}const Wk=e=>{const r=Bk(e);return $k({manager:r,props:e})};function eh(e){const{ownerState:r}=tn(),t=Qa();return b.useMemo(()=>je({},r,{isFieldDisabled:e.disabled??!1,isFieldReadOnly:e.readOnly??!1,isFieldRequired:e.required??!1,fieldDirection:t?"rtl":"ltr"}),[r,e.disabled,e.readOnly,e.required,t])}function Hk(e){return Pr("MuiPickersTextField",e)}Ur("MuiPickersTextField",["root","focused","disabled","error","required"]);function Yk(e){return Pr("MuiPickersInputBase",e)}const Ni=Ur("MuiPickersInputBase",["root","focused","disabled","error","notchedOutline","sectionContent","sectionBefore","sectionAfter","adornedStart","adornedEnd","input","activeBar"]);function zk(e){return Pr("MuiPickersSectionList",e)}const go=Ur("MuiPickersSectionList",["root","section","sectionContent"]),Gk=["slots","slotProps","elements","sectionListRef","classes"],iy=nt("div",{name:"MuiPickersSectionList",slot:"Root"})({direction:"ltr /*! @noflip */",outline:"none"}),oy=nt("span",{name:"MuiPickersSectionList",slot:"Section"})({}),ly=nt("span",{name:"MuiPickersSectionList",slot:"SectionSeparator"})({whiteSpace:"pre"}),cy=nt("span",{name:"MuiPickersSectionList",slot:"SectionContent"})({outline:"none"}),qk=e=>wr({root:["root"],section:["section"],sectionContent:["sectionContent"]},zk,e);function Xk(e){const{slots:r,slotProps:t,element:n,classes:s}=e,{ownerState:i}=tn(),o=(r==null?void 0:r.section)??oy,l=zt({elementType:o,externalSlotProps:t==null?void 0:t.section,externalForwardedProps:n.container,className:s.section,ownerState:i}),c=(r==null?void 0:r.sectionContent)??cy,d=zt({elementType:c,externalSlotProps:t==null?void 0:t.sectionContent,externalForwardedProps:n.content,additionalProps:{suppressContentEditableWarning:!0},className:s.sectionContent,ownerState:i}),u=(r==null?void 0:r.sectionSeparator)??ly,f=zt({elementType:u,externalSlotProps:t==null?void 0:t.sectionSeparator,externalForwardedProps:n.before,ownerState:je({},i,{separatorPosition:"before"})}),h=zt({elementType:u,externalSlotProps:t==null?void 0:t.sectionSeparator,externalForwardedProps:n.after,ownerState:je({},i,{separatorPosition:"after"})});return a.jsxs(o,je({},l,{children:[a.jsx(u,je({},f)),a.jsx(c,je({},d)),a.jsx(u,je({},h))]}))}const Kk=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersSectionList"}),{slots:s,slotProps:i,elements:o,sectionListRef:l,classes:c}=n,d=ht(n,Gk),u=qk(c),{ownerState:f}=tn(),h=b.useRef(null),x=Ln(t,h),m=y=>{if(!h.current)throw new Error(`MUI X: Cannot call sectionListRef.${y} before the mount of the component.`);return h.current};b.useImperativeHandle(l,()=>({getRoot(){return m("getRoot")},getSectionContainer(y){return m("getSectionContainer").querySelector(`.${go.section}[data-sectionindex="${y}"]`)},getSectionContent(y){return m("getSectionContent").querySelector(`.${go.section}[data-sectionindex="${y}"] .${go.sectionContent}`)},getSectionIndexFromDOMElement(y){const S=m("getSectionIndexFromDOMElement");if(y==null||!S.contains(y))return null;let v=null;return y.classList.contains(go.section)?v=y:y.classList.contains(go.sectionContent)&&(v=y.parentElement),v==null?null:Number(v.dataset.sectionindex)}}));const g=(s==null?void 0:s.root)??iy,p=zt({elementType:g,externalSlotProps:i==null?void 0:i.root,externalForwardedProps:d,additionalProps:{ref:x,suppressContentEditableWarning:!0},className:u.root,ownerState:f});return a.jsx(g,je({},p,{children:p.contentEditable?o.map(({content:y,before:S,after:v})=>`${S.children}${y.children}${v.children}`).join(""):a.jsx(b.Fragment,{children:o.map((y,S)=>a.jsx(Xk,{slots:s,slotProps:i,element:y,classes:u},S))})}))}),dy=b.createContext(null),id=()=>{const e=b.useContext(dy);if(e==null)throw new Error(["MUI X: The `usePickerTextFieldOwnerState` can only be called in components that are used inside a PickerTextField component"].join(`
`));return e},Jk=["elements","areAllSectionsEmpty","defaultValue","label","value","onChange","id","autoFocus","endAdornment","startAdornment","renderSuffix","slots","slotProps","contentEditable","tabIndex","onInput","onPaste","onKeyDown","fullWidth","name","readOnly","inputProps","inputRef","sectionListRef","onFocus","onBlur","classes","ownerState"],Qk=e=>Math.round(e*1e5)/1e5,od=nt("div",{name:"MuiPickersInputBase",slot:"Root"})(({theme:e})=>je({},e.typography.body1,{color:(e.vars||e).palette.text.primary,cursor:"text",padding:0,display:"flex",justifyContent:"flex-start",alignItems:"center",position:"relative",boxSizing:"border-box",letterSpacing:`${Qk(.15/16)}em`,variants:[{props:{isInputInFullWidth:!0},style:{width:"100%"}}]})),th=nt(iy,{name:"MuiPickersInputBase",slot:"SectionsContainer"})(({theme:e})=>({padding:"4px 0 5px",fontFamily:e.typography.fontFamily,fontSize:"inherit",lineHeight:"1.4375em",flexGrow:1,outline:"none",display:"flex",flexWrap:"nowrap",overflow:"hidden",letterSpacing:"inherit",width:"182px",variants:[{props:{fieldDirection:"rtl"},style:{textAlign:"right /*! @noflip */"}},{props:{inputSize:"small"},style:{paddingTop:1}},{props:{hasStartAdornment:!1,isFieldFocused:!1,isFieldValueEmpty:!0},style:{color:"currentColor",opacity:0}},{props:{hasStartAdornment:!1,isFieldFocused:!1,isFieldValueEmpty:!0,inputHasLabel:!1},style:e.vars?{opacity:e.vars.opacity.inputPlaceholder}:{opacity:e.palette.mode==="light"?.42:.5}}]})),Zk=nt(oy,{name:"MuiPickersInputBase",slot:"Section"})(({theme:e})=>({fontFamily:e.typography.fontFamily,fontSize:"inherit",letterSpacing:"inherit",lineHeight:"1.4375em",display:"inline-block",whiteSpace:"nowrap"})),eA=nt(cy,{name:"MuiPickersInputBase",slot:"SectionContent",overridesResolver:(e,r)=>r.content})(({theme:e})=>({fontFamily:e.typography.fontFamily,lineHeight:"1.4375em",letterSpacing:"inherit",width:"fit-content",outline:"none"})),tA=nt(ly,{name:"MuiPickersInputBase",slot:"Separator"})(()=>({whiteSpace:"pre",letterSpacing:"inherit"})),rA=nt("input",{name:"MuiPickersInputBase",slot:"Input",overridesResolver:(e,r)=>r.hiddenInput})(je({},lE)),nA=nt("div",{name:"MuiPickersInputBase",slot:"ActiveBar"})(({theme:e,ownerState:r})=>({display:"none",position:"absolute",height:2,bottom:2,borderTopLeftRadius:2,borderTopRightRadius:2,transition:e.transitions.create(["width","left"],{duration:e.transitions.duration.shortest}),backgroundColor:(e.vars||e).palette.primary.main,'[data-active-range-position="start"] &, [data-active-range-position="end"] &':{display:"block"},'[data-active-range-position="start"] &':{left:r.sectionOffsets[0]},'[data-active-range-position="end"] &':{left:r.sectionOffsets[1]}})),aA=(e,r)=>{const{isFieldFocused:t,isFieldDisabled:n,isFieldReadOnly:s,hasFieldError:i,inputSize:o,isInputInFullWidth:l,inputColor:c,hasStartAdornment:d,hasEndAdornment:u}=r,f={root:["root",t&&!n&&"focused",n&&"disabled",s&&"readOnly",i&&"error",l&&"fullWidth",`color${eE(c)}`,o==="small"&&"inputSizeSmall",d&&"adornedStart",u&&"adornedEnd"],notchedOutline:["notchedOutline"],input:["input"],sectionsContainer:["sectionsContainer"],sectionContent:["sectionContent"],sectionBefore:["sectionBefore"],sectionAfter:["sectionAfter"],activeBar:["activeBar"]};return wr(f,Yk,e)};function gm(e,r,t,n){var s;if(e.content.id){const i=(s=r.current)==null?void 0:s.querySelectorAll(`[data-sectionindex="${t}"] [data-range-position="${n}"]`);if(i)return Array.from(i).reduce((o,l)=>o+l.offsetWidth,0)}return 0}function sA(e,r){var s,i,o,l,c;let t=0;if(((s=r.current)==null?void 0:s.getAttribute("data-active-range-position"))==="end")for(let d=e.length-1;d>=e.length/2;d-=1)t+=gm(e[d],r,d,"end");else for(let d=0;d<e.length/2;d+=1)t+=gm(e[d],r,d,"start");return{activeBarWidth:t,sectionOffsets:[((o=(i=r.current)==null?void 0:i.querySelector('[data-sectionindex="0"]'))==null?void 0:o.offsetLeft)||0,((c=(l=r.current)==null?void 0:l.querySelector(`[data-sectionindex="${e.length/2}"]`))==null?void 0:c.offsetLeft)||0]}}const rh=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersInputBase"}),{elements:s,areAllSectionsEmpty:i,value:o,onChange:l,id:c,endAdornment:d,startAdornment:u,renderSuffix:f,slots:h,slotProps:x,contentEditable:m,tabIndex:g,onInput:p,onPaste:y,onKeyDown:S,name:v,readOnly:E,inputProps:C,inputRef:A,sectionListRef:j,onFocus:w,onBlur:k,classes:_,ownerState:I}=n,D=ht(n,Jk),B=id(),R=b.useRef(null),Y=b.useRef(null),P=b.useRef([]),M=Ln(t,R),K=Ln(C==null?void 0:C.ref,A),L=Ox();if(!L)throw new Error("MUI X: PickersInputBase should always be used inside a PickersTextField component");const ae=I??B,Z=O=>{var W;(W=L.onFocus)==null||W.call(L,O),w==null||w(O)},T=O=>{Z(O)},N=O=>{var W,F;if(S==null||S(O),O.key==="Enter"&&!O.defaultMuiPrevented){if((W=R.current)!=null&&W.dataset.multiInput)return;const U=(F=R.current)==null?void 0:F.closest("form"),te=U==null?void 0:U.querySelector('[type="submit"]');if(!U||!te)return;O.preventDefault(),U.requestSubmit(te)}},H=O=>{var W;(W=L.onBlur)==null||W.call(L,O),k==null||k(O)};b.useEffect(()=>{L&&L.setAdornedStart(!!u)},[L,u]),b.useEffect(()=>{L&&(i?L.onEmpty():L.onFilled())},[L,i]);const G=aA(_,ae),q=(h==null?void 0:h.root)||od,oe=zt({elementType:q,externalSlotProps:x==null?void 0:x.root,externalForwardedProps:D,additionalProps:{"aria-invalid":L.error,ref:M},className:G.root,ownerState:ae}),de=(h==null?void 0:h.input)||th,z=s.some(O=>O.content["data-range-position"]!==void 0);return b.useEffect(()=>{if(!z||!ae.isPickerOpen)return;const{activeBarWidth:O,sectionOffsets:W}=sA(s,R);P.current=[W[0],W[1]],Y.current&&(Y.current.style.width=`${O}px`)},[s,z,ae.isPickerOpen]),a.jsxs(q,je({},oe,{children:[u,a.jsx(Kk,{sectionListRef:j,elements:s,contentEditable:m,tabIndex:g,className:G.sectionsContainer,onFocus:Z,onBlur:H,onInput:p,onPaste:y,onKeyDown:N,slots:{root:de,section:Zk,sectionContent:eA,sectionSeparator:tA},slotProps:{root:je({},x==null?void 0:x.input,{ownerState:ae}),sectionContent:{className:Ni.sectionContent},sectionSeparator:({separatorPosition:O})=>({className:O==="before"?Ni.sectionBefore:Ni.sectionAfter})}}),d,f?f(je({},L)):null,a.jsx(rA,je({name:v,className:G.input,value:o,onChange:l,id:c,"aria-hidden":"true",tabIndex:-1,readOnly:E,required:L.required,disabled:L.disabled,onFocus:T},C,{ref:K})),z&&a.jsx(nA,{className:G.activeBar,ref:Y,ownerState:{sectionOffsets:P.current}})]}))});function iA(e){return Pr("MuiPickersOutlinedInput",e)}const ca=je({},Ni,Ur("MuiPickersOutlinedInput",["root","notchedOutline","input"])),oA=["children","className","label","notched","shrink"],lA=nt("fieldset",{name:"MuiPickersOutlinedInput",slot:"NotchedOutline"})(({theme:e})=>{const r=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{textAlign:"left",position:"absolute",bottom:0,right:0,top:-5,left:0,margin:0,padding:"0 8px",pointerEvents:"none",borderRadius:"inherit",borderStyle:"solid",borderWidth:1,overflow:"hidden",minWidth:"0%",borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:r}}),ym=nt("span")(({theme:e})=>({fontFamily:e.typography.fontFamily,fontSize:"inherit"})),cA=nt("legend",{shouldForwardProp:e=>ul(e)&&e!=="notched"})(({theme:e})=>({float:"unset",width:"auto",overflow:"hidden",variants:[{props:{inputHasLabel:!1},style:{padding:0,lineHeight:"11px",transition:e.transitions.create("width",{duration:150,easing:e.transitions.easing.easeOut})}},{props:{inputHasLabel:!0},style:{display:"block",padding:0,height:11,fontSize:"0.75em",visibility:"hidden",maxWidth:.01,transition:e.transitions.create("max-width",{duration:50,easing:e.transitions.easing.easeOut}),whiteSpace:"nowrap","& > span":{paddingLeft:5,paddingRight:5,display:"inline-block",opacity:0,visibility:"visible"}}},{props:{inputHasLabel:!0,notched:!0},style:{maxWidth:"100%",transition:e.transitions.create("max-width",{duration:100,easing:e.transitions.easing.easeOut,delay:50})}}]}));function dA(e){const{className:r,label:t,notched:n}=e,s=ht(e,oA),i=id();return a.jsx(lA,je({"aria-hidden":!0,className:r},s,{ownerState:i,children:a.jsx(cA,{ownerState:i,notched:n,children:t?a.jsx(ym,{children:t}):a.jsx(ym,{className:"notranslate",children:"‚Äã"})})}))}const uA=["label","autoFocus","ownerState","classes","notched"],fA=nt(od,{name:"MuiPickersOutlinedInput",slot:"Root"})(({theme:e})=>{const r=e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)";return{padding:"0 14px",borderRadius:(e.vars||e).shape.borderRadius,[`&:hover .${ca.notchedOutline}`]:{borderColor:(e.vars||e).palette.text.primary},"@media (hover: none)":{[`&:hover .${ca.notchedOutline}`]:{borderColor:e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:r}},[`&.${ca.focused} .${ca.notchedOutline}`]:{borderStyle:"solid",borderWidth:2},[`&.${ca.disabled}`]:{[`& .${ca.notchedOutline}`]:{borderColor:(e.vars||e).palette.action.disabled},"*":{color:(e.vars||e).palette.action.disabled}},[`&.${ca.error} .${ca.notchedOutline}`]:{borderColor:(e.vars||e).palette.error.main},variants:Object.keys((e.vars??e).palette).filter(t=>{var n;return((n=(e.vars??e).palette[t])==null?void 0:n.main)??!1}).map(t=>({props:{inputColor:t},style:{[`&.${ca.focused}:not(.${ca.error}) .${ca.notchedOutline}`]:{borderColor:(e.vars||e).palette[t].main}}}))}}),hA=nt(th,{name:"MuiPickersOutlinedInput",slot:"SectionsContainer"})({padding:"16.5px 0",variants:[{props:{inputSize:"small"},style:{padding:"8.5px 0"}}]}),mA=e=>{const t=wr({root:["root"],notchedOutline:["notchedOutline"],input:["input"]},iA,e);return je({},e,t)},uy=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersOutlinedInput"}),{label:s,classes:i,notched:o}=n,l=ht(n,uA),c=Ox(),d=mA(i);return a.jsx(rh,je({slots:{root:fA,input:hA},renderSuffix:u=>a.jsx(dA,{shrink:!!(o||u.adornedStart||u.focused||u.filled),notched:!!(o||u.adornedStart||u.focused||u.filled),className:d.notchedOutline,label:s!=null&&s!==""&&(c!=null&&c.required)?a.jsxs(b.Fragment,{children:[s,"‚Äâ","*"]}):s})},l,{label:s,classes:d,ref:t}))});uy.muiName="Input";function pA(e){return Pr("MuiPickersFilledInput",e)}const Ls=je({},Ni,Ur("MuiPickersFilledInput",["root","underline","input"])),xA=["label","autoFocus","disableUnderline","hiddenLabel","classes"],gA=nt(od,{name:"MuiPickersFilledInput",slot:"Root",shouldForwardProp:e=>Lx(e)&&e!=="disableUnderline"})(({theme:e})=>{const r=e.palette.mode==="light",t=r?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)",n=r?"rgba(0, 0, 0, 0.06)":"rgba(255, 255, 255, 0.09)",s=r?"rgba(0, 0, 0, 0.09)":"rgba(255, 255, 255, 0.13)",i=r?"rgba(0, 0, 0, 0.12)":"rgba(255, 255, 255, 0.12)";return{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:n,borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),"&:hover":{backgroundColor:e.vars?e.vars.palette.FilledInput.hoverBg:s,"@media (hover: none)":{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:n}},[`&.${Ls.focused}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.bg:n},[`&.${Ls.disabled}`]:{backgroundColor:e.vars?e.vars.palette.FilledInput.disabledBg:i},variants:[...Object.keys((e.vars??e).palette).filter(o=>(e.vars??e).palette[o].main).map(o=>{var l;return{props:{inputColor:o,disableUnderline:!1},style:{"&::after":{borderBottom:`2px solid ${(l=(e.vars||e).palette[o])==null?void 0:l.main}`}}}}),{props:{disableUnderline:!1},style:{"&::after":{left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${Ls.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${Ls.error}`]:{"&:before, &:after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${e.vars?`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`:t}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${Ls.disabled}, .${Ls.error}):before`]:{borderBottom:`1px solid ${(e.vars||e).palette.text.primary}`},[`&.${Ls.disabled}:before`]:{borderBottomStyle:"dotted"}}},{props:{hasStartAdornment:!0},style:{paddingLeft:12}},{props:{hasEndAdornment:!0},style:{paddingRight:12}}]}}),yA=nt(th,{name:"MuiPickersFilledInput",slot:"sectionsContainer",shouldForwardProp:e=>Lx(e)&&e!=="hiddenLabel"})({paddingTop:25,paddingRight:12,paddingBottom:8,paddingLeft:12,variants:[{props:{inputSize:"small"},style:{paddingTop:21,paddingBottom:4}},{props:{hasStartAdornment:!0},style:{paddingLeft:0}},{props:{hasEndAdornment:!0},style:{paddingRight:0}},{props:{hiddenLabel:!0},style:{paddingTop:16,paddingBottom:17}},{props:{hiddenLabel:!0,inputSize:"small"},style:{paddingTop:8,paddingBottom:9}}]}),vA=(e,r)=>{const{inputHasUnderline:t}=r,s=wr({root:["root",t&&"underline"],input:["input"]},pA,e);return je({},e,s)},fy=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersFilledInput"}),{label:s,disableUnderline:i=!1,hiddenLabel:o=!1,classes:l}=n,c=ht(n,xA),d=id(),u=je({},d,{inputHasUnderline:!i}),f=vA(l,u);return a.jsx(rh,je({slots:{root:gA,input:yA},slotProps:{root:{disableUnderline:i},input:{hiddenLabel:o}}},c,{label:s,classes:f,ref:t,ownerState:u}))});fy.muiName="Input";function bA(e){return Pr("MuiPickersFilledInput",e)}const yo=je({},Ni,Ur("MuiPickersInput",["root","underline","input"])),SA=["label","autoFocus","disableUnderline","ownerState","classes"],wA=nt(od,{name:"MuiPickersInput",slot:"Root",shouldForwardProp:e=>ul(e)&&e!=="disableUnderline"})(({theme:e})=>{let t=e.palette.mode==="light"?"rgba(0, 0, 0, 0.42)":"rgba(255, 255, 255, 0.7)";return e.vars&&(t=`rgba(${e.vars.palette.common.onBackgroundChannel} / ${e.vars.opacity.inputUnderline})`),{"label + &":{marginTop:16},variants:[...Object.keys((e.vars??e).palette).filter(n=>(e.vars??e).palette[n].main).map(n=>({props:{inputColor:n},style:{"&::after":{borderBottom:`2px solid ${(e.vars||e).palette[n].main}`}}})),{props:{disableUnderline:!1},style:{"&::after":{background:"red",left:0,bottom:0,content:'""',position:"absolute",right:0,transform:"scaleX(0)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shorter,easing:e.transitions.easing.easeOut}),pointerEvents:"none"},[`&.${yo.focused}:after`]:{transform:"scaleX(1) translateX(0)"},[`&.${yo.error}`]:{"&:before, &:after":{borderBottomColor:(e.vars||e).palette.error.main}},"&::before":{borderBottom:`1px solid ${t}`,left:0,bottom:0,content:'"\\00a0"',position:"absolute",right:0,transition:e.transitions.create("border-bottom-color",{duration:e.transitions.duration.shorter}),pointerEvents:"none"},[`&:hover:not(.${yo.disabled}, .${yo.error}):before`]:{borderBottom:`2px solid ${(e.vars||e).palette.text.primary}`,"@media (hover: none)":{borderBottom:`1px solid ${t}`}},[`&.${yo.disabled}:before`]:{borderBottomStyle:"dotted"}}}]}}),jA=(e,r)=>{const{inputHasUnderline:t}=r,s=wr({root:["root",!t&&"underline"],input:["input"]},bA,e);return je({},e,s)},hy=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersInput"}),{label:s,disableUnderline:i=!1,classes:o}=n,l=ht(n,SA),c=id(),d=je({},c,{inputHasUnderline:!i}),u=jA(o,d);return a.jsx(rh,je({slots:{root:wA},slotProps:{root:{disableUnderline:i}}},l,{label:s,classes:u,ref:t}))});hy.muiName="Input";const EA=["onFocus","onBlur","className","classes","color","disabled","error","variant","required","InputProps","inputProps","inputRef","sectionListRef","elements","areAllSectionsEmpty","onClick","onKeyDown","onKeyUp","onPaste","onInput","endAdornment","startAdornment","tabIndex","contentEditable","focused","value","onChange","fullWidth","id","name","helperText","FormHelperTextProps","label","InputLabelProps","data-active-range-position"],kA={standard:hy,filled:fy,outlined:uy},AA=nt(rt,{name:"MuiPickersTextField",slot:"Root"})({}),TA=(e,r)=>{const{isFieldFocused:t,isFieldDisabled:n,isFieldRequired:s}=r;return wr({root:["root",t&&!n&&"focused",n&&"disabled",s&&"required"]},Hk,e)},my=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersTextField"}),{onFocus:s,onBlur:i,className:o,classes:l,color:c="primary",disabled:d=!1,error:u=!1,variant:f="outlined",required:h=!1,InputProps:x,inputProps:m,inputRef:g,sectionListRef:p,elements:y,areAllSectionsEmpty:S,onClick:v,onKeyDown:E,onKeyUp:C,onPaste:A,onInput:j,endAdornment:w,startAdornment:k,tabIndex:_,contentEditable:I,focused:D,value:B,onChange:R,fullWidth:Y,id:P,name:M,helperText:K,FormHelperTextProps:L,label:ae,InputLabelProps:Z,"data-active-range-position":T}=n,N=ht(n,EA),H=b.useRef(null),G=Ln(t,H),q=td(P),oe=K&&q?`${q}-helper-text`:void 0,de=ae&&q?`${q}-label`:void 0,z=eh({disabled:n.disabled,required:n.required,readOnly:x==null?void 0:x.readOnly}),O=b.useMemo(()=>je({},z,{isFieldValueEmpty:S,isFieldFocused:D??!1,hasFieldError:u??!1,inputSize:n.size??"medium",inputColor:c??"primary",isInputInFullWidth:Y??!1,hasStartAdornment:!!(k??(x==null?void 0:x.startAdornment)),hasEndAdornment:!!(w??(x==null?void 0:x.endAdornment)),inputHasLabel:!!ae}),[z,S,D,u,n.size,c,Y,k,w,x==null?void 0:x.startAdornment,x==null?void 0:x.endAdornment,ae]),W=TA(l,O),F=kA[f];return a.jsx(dy.Provider,{value:O,children:a.jsxs(AA,je({className:$r(W.root,o),ref:G,focused:D,disabled:d,variant:f,error:u,color:c,fullWidth:Y,required:h,ownerState:O},N,{children:[ae!=null&&ae!==""&&a.jsx(ot,je({htmlFor:q,id:de},Z,{children:ae})),a.jsx(F,je({elements:y,areAllSectionsEmpty:S,onClick:v,onKeyDown:E,onKeyUp:C,onInput:j,onPaste:A,onFocus:s,onBlur:i,endAdornment:w,startAdornment:k,tabIndex:_,contentEditable:I,value:B,onChange:R,id:q,fullWidth:Y,inputProps:m,inputRef:g,sectionListRef:p,label:ae,name:M,role:"group","aria-labelledby":de,"aria-describedby":oe,"aria-live":oe?"polite":void 0,"data-active-range-position":T},x)),K&&a.jsx(Ma,je({id:oe},L,{children:K}))]}))})}),CA=["enableAccessibleFieldDOMStructure"],DA=["InputProps","readOnly","onClear","clearable","clearButtonPosition","openPickerButtonPosition","openPickerAriaLabel"],_A=["onPaste","onKeyDown","inputMode","readOnly","InputProps","inputProps","inputRef","onClear","clearable","clearButtonPosition","openPickerButtonPosition","openPickerAriaLabel"],IA=["ownerState"],FA=["ownerState"],MA=["ownerState"],PA=["ownerState"],NA=["InputProps","inputProps"],RA=e=>{let{enableAccessibleFieldDOMStructure:r}=e,t=ht(e,CA);if(r){const{InputProps:p,readOnly:y,onClear:S,clearable:v,clearButtonPosition:E,openPickerButtonPosition:C,openPickerAriaLabel:A}=t,j=ht(t,DA);return{clearable:v,onClear:S,clearButtonPosition:E,openPickerButtonPosition:C,openPickerAriaLabel:A,textFieldProps:je({},j,{InputProps:je({},p??{},{readOnly:y})})}}const{onPaste:n,onKeyDown:s,inputMode:i,readOnly:o,InputProps:l,inputProps:c,inputRef:d,onClear:u,clearable:f,clearButtonPosition:h,openPickerButtonPosition:x,openPickerAriaLabel:m}=t,g=ht(t,_A);return{clearable:f,onClear:u,clearButtonPosition:h,openPickerButtonPosition:x,openPickerAriaLabel:m,textFieldProps:je({},g,{InputProps:je({},l??{},{readOnly:o}),inputProps:je({},c??{},{inputMode:i,onPaste:n,onKeyDown:s,ref:d})})}},nh=b.createContext({slots:{},slotProps:{},inputRef:void 0});function OA(e){var L,ae;const{slots:r,slotProps:t,fieldResponse:n,defaultOpenPickerIcon:s}=e,i=_s(),o=Qf(),l=b.useContext(nh),{textFieldProps:c,onClear:d,clearable:u,openPickerAriaLabel:f,clearButtonPosition:h="end",openPickerButtonPosition:x="end"}=RA(n),m=eh(c),g=Ze(Z=>{Z.preventDefault(),o==null||o.setOpen(T=>!T)}),p=o?o.triggerStatus:"hidden",y=u?h:null,S=p!=="hidden"?x:null,v=(r==null?void 0:r.textField)??l.slots.textField??(n.enableAccessibleFieldDOMStructure===!1?Se:my),E=(r==null?void 0:r.inputAdornment)??l.slots.inputAdornment??Nn,C=zt({elementType:E,externalSlotProps:ic(l.slotProps.inputAdornment,t==null?void 0:t.inputAdornment),additionalProps:{position:"start"},ownerState:je({},m,{position:"start"})}),A=ht(C,IA),j=zt({elementType:E,externalSlotProps:t==null?void 0:t.inputAdornment,additionalProps:{position:"end"},ownerState:je({},m,{position:"end"})}),w=ht(j,FA),k=l.slots.openPickerButton??st,_=zt({elementType:k,externalSlotProps:l.slotProps.openPickerButton,additionalProps:{disabled:p==="disabled",onClick:g,"aria-label":f,edge:c.variant!=="standard"?S:!1},ownerState:m}),I=ht(_,MA),D=l.slots.openPickerIcon??s,B=zt({elementType:D,externalSlotProps:l.slotProps.openPickerIcon,ownerState:m}),R=(r==null?void 0:r.clearButton)??l.slots.clearButton??st,Y=zt({elementType:R,externalSlotProps:ic(l.slotProps.clearButton,t==null?void 0:t.clearButton),className:"clearButton",additionalProps:{title:i.fieldClearLabel,tabIndex:-1,onClick:d,disabled:n.disabled||n.readOnly,edge:c.variant!=="standard"&&y!==S?y:!1},ownerState:m}),P=ht(Y,PA),M=(r==null?void 0:r.clearIcon)??l.slots.clearIcon??kE,K=zt({elementType:M,externalSlotProps:ic(l.slotProps.clearIcon,t==null?void 0:t.clearIcon),additionalProps:{fontSize:"small"},ownerState:m});return c.ref=Ln(c.ref,o==null?void 0:o.rootRef),c.InputProps||(c.InputProps={}),o&&(c.InputProps.ref=o.triggerRef),!((L=c.InputProps)!=null&&L.startAdornment)&&(y==="start"||S==="start")&&(c.InputProps.startAdornment=a.jsxs(E,je({},A,{children:[S==="start"&&a.jsx(k,je({},I,{children:a.jsx(D,je({},B))})),y==="start"&&a.jsx(R,je({},P,{children:a.jsx(M,je({},K))}))]}))),!((ae=c.InputProps)!=null&&ae.endAdornment)&&(y==="end"||S==="end")&&(c.InputProps.endAdornment=a.jsxs(E,je({},w,{children:[y==="end"&&a.jsx(R,je({},P,{children:a.jsx(M,je({},K))})),S==="end"&&a.jsx(k,je({},I,{children:a.jsx(D,je({},B))}))]}))),y!=null&&(c.sx=[{"& .clearButton":{opacity:1},"@media (pointer: fine)":{"& .clearButton":{opacity:0},"&:hover, &:focus-within":{".clearButton":{opacity:1}}}},...Array.isArray(c.sx)?c.sx:[c.sx]]),a.jsx(v,je({},c))}function ic(e,r){return e?r?t=>je({},Ko(r,t),Ko(e,t)):e:r}function LA(e){const{ref:r,externalForwardedProps:t,slotProps:n}=e,s=b.useContext(nh),i=Qf(),o=eh(t),{InputProps:l,inputProps:c}=t,d=ht(t,NA),u=zt({elementType:my,externalSlotProps:ic(s.slotProps.textField,n==null?void 0:n.textField),externalForwardedProps:d,additionalProps:{ref:r,sx:i==null?void 0:i.rootSx,label:i==null?void 0:i.label,name:i==null?void 0:i.name,className:i==null?void 0:i.rootClassName,inputRef:s.inputRef},ownerState:o});return u.inputProps=je({},c,u.inputProps),u.InputProps=je({},l,u.InputProps),u}function py(e){const{slots:r={},slotProps:t={},inputRef:n,children:s}=e,i=b.useMemo(()=>({inputRef:n,slots:{openPickerButton:r.openPickerButton,openPickerIcon:r.openPickerIcon,textField:r.textField,inputAdornment:r.inputAdornment,clearIcon:r.clearIcon,clearButton:r.clearButton},slotProps:{openPickerButton:t.openPickerButton,openPickerIcon:t.openPickerIcon,textField:t.textField,inputAdornment:t.inputAdornment,clearIcon:t.clearIcon,clearButton:t.clearButton}}),[n,r.openPickerButton,r.openPickerIcon,r.textField,r.inputAdornment,r.clearIcon,r.clearButton,t.openPickerButton,t.openPickerIcon,t.textField,t.inputAdornment,t.clearIcon,t.clearButton]);return a.jsx(nh.Provider,{value:i,children:s})}const $A=["slots","slotProps"],xy=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiDateField"}),{slots:s,slotProps:i}=n,o=ht(n,$A),l=LA({slotProps:i,ref:t,externalForwardedProps:o}),c=Wk(l);return a.jsx(OA,{slots:s,slotProps:i,fieldResponse:c,defaultOpenPickerIcon:EE})}),gy=({shouldDisableDate:e,shouldDisableMonth:r,shouldDisableYear:t,minDate:n,maxDate:s,disableFuture:i,disablePast:o,timezone:l})=>{const c=ci();return b.useCallback(d=>xl({adapter:c,value:d,timezone:l,props:{shouldDisableDate:e,shouldDisableMonth:r,shouldDisableYear:t,minDate:n,maxDate:s,disableFuture:i,disablePast:o}})!==null,[c,e,r,t,n,s,i,o,l])},BA=(e,r)=>(t,n)=>{switch(n.type){case"setVisibleDate":return je({},t,{slideDirection:n.direction,currentMonth:n.month,isMonthSwitchingAnimating:!r.isSameMonth(n.month,t.currentMonth)&&!e&&!n.skipAnimation,focusedDay:n.focusedDay});case"changeMonthTimezone":{const s=n.newTimezone;if(r.getTimezone(t.currentMonth)===s)return t;let i=r.setTimezone(t.currentMonth,s);return r.getMonth(i)!==r.getMonth(t.currentMonth)&&(i=r.setMonth(i,r.getMonth(t.currentMonth))),je({},t,{currentMonth:i})}case"finishMonthSwitchingAnimation":return je({},t,{isMonthSwitchingAnimating:!1});default:throw new Error("missing support")}},UA=e=>{const{value:r,referenceDate:t,disableFuture:n,disablePast:s,maxDate:i,minDate:o,onMonthChange:l,onYearChange:c,reduceAnimations:d,shouldDisableDate:u,timezone:f,getCurrentMonthFromVisibleDate:h}=e,x=ur(),m=b.useRef(BA(!!d,x)).current,g=b.useMemo(()=>Na.getInitialReferenceValue({value:r,utils:x,timezone:f,props:e,referenceDate:t,granularity:Da.day}),[t,f]),[p,y]=b.useReducer(m,{isMonthSwitchingAnimating:!1,focusedDay:g,currentMonth:x.startOfMonth(g),slideDirection:"left"}),S=gy({shouldDisableDate:u,minDate:o,maxDate:i,disableFuture:n,disablePast:s,timezone:f});b.useEffect(()=>{y({type:"changeMonthTimezone",newTimezone:x.getTimezone(g)})},[g,x]);const v=Ze(({target:C,reason:A})=>{if(A==="cell-interaction"&&p.focusedDay!=null&&x.isSameDay(C,p.focusedDay))return;const j=A==="cell-interaction";let w,k;if(A==="cell-interaction")w=h(C,p.currentMonth),k=C;else if(w=x.isSameMonth(C,p.currentMonth)?p.currentMonth:x.startOfMonth(C),k=C,S(k)){const D=x.startOfMonth(C),B=x.endOfMonth(C);k=Qo({utils:x,date:k,minDate:x.isBefore(o,D)?D:o,maxDate:x.isAfter(i,B)?B:i,disablePast:s,disableFuture:n,isDateDisabled:S,timezone:f})}const _=!x.isSameMonth(p.currentMonth,w),I=!x.isSameYear(p.currentMonth,w);_&&(l==null||l(w)),I&&(c==null||c(x.startOfYear(w))),y({type:"setVisibleDate",month:w,direction:x.isAfterDay(w,p.currentMonth)?"left":"right",focusedDay:p.focusedDay!=null&&k!=null&&x.isSameDay(k,p.focusedDay)?p.focusedDay:k,skipAnimation:j})}),E=b.useCallback(()=>{y({type:"finishMonthSwitchingAnimation"})},[]);return{referenceDate:g,calendarState:p,setVisibleDate:v,isDateDisabled:S,onMonthSwitchingAnimationEnd:E}},VA=e=>Pr("MuiPickersFadeTransitionGroup",e);Ur("MuiPickersFadeTransitionGroup",["root"]);const WA=["children"],HA=e=>wr({root:["root"]},VA,e),YA=nt($x,{name:"MuiPickersFadeTransitionGroup",slot:"Root"})({display:"block",position:"relative"});function yy(e){const r=gr({props:e,name:"MuiPickersFadeTransitionGroup"}),{className:t,reduceAnimations:n,transKey:s,classes:i}=r,{children:o}=r,l=ht(r,WA),c=HA(i),d=af();return n?o:a.jsx(YA,{className:$r(c.root,t),ownerState:l,children:a.jsx(Uc,{appear:!1,mountOnEnter:!0,unmountOnExit:!0,timeout:{appear:d.transitions.duration.enteringScreen,enter:d.transitions.duration.enteringScreen,exit:0},children:o},s)})}const zA=e=>Pr("MuiPickersSlideTransition",e),Jn=Ur("MuiPickersSlideTransition",["root","slideEnter-left","slideEnter-right","slideEnterActive","slideExit","slideExitActiveLeft-left","slideExitActiveLeft-right"]),GA=["children","className","reduceAnimations","slideDirection","transKey","classes"],qA=(e,r)=>{const{slideDirection:t}=r,n={root:["root"],exit:["slideExit"],enterActive:["slideEnterActive"],enter:[`slideEnter-${t}`],exitActive:[`slideExitActiveLeft-${t}`]};return wr(n,zA,e)},XA=nt($x,{name:"MuiPickersSlideTransition",slot:"Root",overridesResolver:(e,r)=>[r.root,{[`.${Jn["slideEnter-left"]}`]:r["slideEnter-left"]},{[`.${Jn["slideEnter-right"]}`]:r["slideEnter-right"]},{[`.${Jn.slideEnterActive}`]:r.slideEnterActive},{[`.${Jn.slideExit}`]:r.slideExit},{[`.${Jn["slideExitActiveLeft-left"]}`]:r["slideExitActiveLeft-left"]},{[`.${Jn["slideExitActiveLeft-right"]}`]:r["slideExitActiveLeft-right"]}]})(({theme:e})=>{const r=e.transitions.create("transform",{duration:e.transitions.duration.complex,easing:"cubic-bezier(0.35, 0.8, 0.4, 1)"});return{display:"block",position:"relative",overflowX:"hidden","& > *":{position:"absolute",top:0,right:0,left:0},[`& .${Jn["slideEnter-left"]}`]:{willChange:"transform",transform:"translate(100%)",zIndex:1},[`& .${Jn["slideEnter-right"]}`]:{willChange:"transform",transform:"translate(-100%)",zIndex:1},[`& .${Jn.slideEnterActive}`]:{transform:"translate(0%)",transition:r},[`& .${Jn.slideExit}`]:{transform:"translate(0%)"},[`& .${Jn["slideExitActiveLeft-left"]}`]:{willChange:"transform",transform:"translate(-100%)",transition:r,zIndex:0},[`& .${Jn["slideExitActiveLeft-right"]}`]:{willChange:"transform",transform:"translate(100%)",transition:r,zIndex:0}}});function KA(e){const r=gr({props:e,name:"MuiPickersSlideTransition"}),{children:t,className:n,reduceAnimations:s,slideDirection:i,transKey:o,classes:l}=r,c=ht(r,GA),{ownerState:d}=tn(),u=je({},d,{slideDirection:i}),f=qA(l,u),h=af();if(s)return a.jsx("div",{className:$r(f.root,n),children:t});const x={exit:f.exit,enterActive:f.enterActive,enter:f.enter,exitActive:f.exitActive};return a.jsx(XA,{className:$r(f.root,n),childFactory:m=>b.cloneElement(m,{classNames:x}),role:"presentation",ownerState:u,children:a.jsx(iS,je({mountOnEnter:!0,unmountOnExit:!0,timeout:h.transitions.duration.complex,classNames:x},c,{children:t}),o)})}const JA=e=>Pr("MuiDayCalendar",e);Ur("MuiDayCalendar",["root","header","weekDayLabel","loadingContainer","slideTransition","monthContainer","weekContainer","weekNumberLabel","weekNumber"]);const QA=["parentProps","day","focusedDay","selectedDays","isDateDisabled","currentMonthNumber","isViewFocused"],ZA=["ownerState"],eT=e=>wr({root:["root"],header:["header"],weekDayLabel:["weekDayLabel"],loadingContainer:["loadingContainer"],slideTransition:["slideTransition"],monthContainer:["monthContainer"],weekContainer:["weekContainer"],weekNumberLabel:["weekNumberLabel"],weekNumber:["weekNumber"]},JA,e),vy=(Jo+nd*2)*6,tT=nt("div",{name:"MuiDayCalendar",slot:"Root"})({}),rT=nt("div",{name:"MuiDayCalendar",slot:"Header"})({display:"flex",justifyContent:"center",alignItems:"center"}),nT=nt(V,{name:"MuiDayCalendar",slot:"WeekDayLabel"})(({theme:e})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(e.vars||e).palette.text.secondary})),aT=nt(V,{name:"MuiDayCalendar",slot:"WeekNumberLabel"})(({theme:e})=>({width:36,height:40,margin:"0 2px",textAlign:"center",display:"flex",justifyContent:"center",alignItems:"center",color:(e.vars||e).palette.text.disabled})),sT=nt(V,{name:"MuiDayCalendar",slot:"WeekNumber"})(({theme:e})=>je({},e.typography.caption,{width:Jo,height:Jo,padding:0,margin:`0 ${nd}px`,color:(e.vars||e).palette.text.disabled,fontSize:"0.75rem",alignItems:"center",justifyContent:"center",display:"inline-flex"})),iT=nt("div",{name:"MuiDayCalendar",slot:"LoadingContainer"})({display:"flex",justifyContent:"center",alignItems:"center",minHeight:vy}),oT=nt(KA,{name:"MuiDayCalendar",slot:"SlideTransition"})({minHeight:vy}),lT=nt("div",{name:"MuiDayCalendar",slot:"MonthContainer"})({overflow:"hidden"}),cT=nt("div",{name:"MuiDayCalendar",slot:"WeekContainer"})({margin:`${nd}px 0`,display:"flex",justifyContent:"center"});function dT(e){let{parentProps:r,day:t,focusedDay:n,selectedDays:s,isDateDisabled:i,currentMonthNumber:o,isViewFocused:l}=e,c=ht(e,QA);const{disabled:d,disableHighlightToday:u,isMonthSwitchingAnimating:f,showDaysOutsideCurrentMonth:h,slots:x,slotProps:m,timezone:g}=r,p=ur(),y=rd(g),S=n!=null&&p.isSameDay(t,n),v=l&&S,E=s.some(R=>p.isSameDay(R,t)),C=p.isSameDay(t,y),A=b.useMemo(()=>d||i(t),[d,i,t]),j=b.useMemo(()=>p.getMonth(t)!==o,[p,t,o]),w=Xg({day:t,selected:E,disabled:A,today:C,outsideCurrentMonth:j,disableMargin:void 0,disableHighlightToday:u,showDaysOutsideCurrentMonth:h}),k=(x==null?void 0:x.day)??gk,_=zt({elementType:k,externalSlotProps:m==null?void 0:m.day,additionalProps:je({disableHighlightToday:u,showDaysOutsideCurrentMonth:h,role:"gridcell",isAnimating:f,"data-timestamp":p.toJsDate(t).valueOf()},c),ownerState:je({},w,{day:t,isDayDisabled:A,isDaySelected:E})}),I=ht(_,ZA),D=b.useMemo(()=>{const R=p.startOfMonth(p.setMonth(t,o));return h?p.isSameDay(t,p.startOfWeek(R)):p.isSameDay(t,R)},[o,t,h,p]),B=b.useMemo(()=>{const R=p.endOfMonth(p.setMonth(t,o));return h?p.isSameDay(t,p.endOfWeek(R)):p.isSameDay(t,R)},[o,t,h,p]);return a.jsx(k,je({},I,{day:t,disabled:A,autoFocus:!j&&v,today:C,outsideCurrentMonth:j,isFirstVisibleCell:D,isLastVisibleCell:B,selected:E,tabIndex:S?0:-1,"aria-selected":E,"aria-current":C?"date":void 0}))}function uT(e){const r=gr({props:e,name:"MuiDayCalendar"}),t=ur(),{onFocusedDayChange:n,className:s,classes:i,currentMonth:o,selectedDays:l,focusedDay:c,loading:d,onSelectedDaysChange:u,onMonthSwitchingAnimationEnd:f,readOnly:h,reduceAnimations:x,renderLoading:m=()=>a.jsx("span",{children:"..."}),slideDirection:g,TransitionProps:p,disablePast:y,disableFuture:S,minDate:v,maxDate:E,shouldDisableDate:C,shouldDisableMonth:A,shouldDisableYear:j,dayOfWeekFormatter:w=W=>t.format(W,"weekdayShort").charAt(0).toUpperCase(),hasFocus:k,onFocusedViewChange:_,gridLabelId:I,displayWeekNumber:D,fixedWeekNumber:B,timezone:R}=r,Y=rd(R),P=eT(i),M=Qa(),K=gy({shouldDisableDate:C,shouldDisableMonth:A,shouldDisableYear:j,minDate:v,maxDate:E,disablePast:y,disableFuture:S,timezone:R}),L=_s(),ae=Ze(W=>{h||u(W)}),Z=W=>{K(W)||(n(W),_==null||_(!0))},T=Ze((W,F)=>{switch(W.key){case"ArrowUp":Z(t.addDays(F,-7)),W.preventDefault();break;case"ArrowDown":Z(t.addDays(F,7)),W.preventDefault();break;case"ArrowLeft":{const U=t.addDays(F,M?1:-1),te=t.addMonths(F,M?1:-1),he=Qo({utils:t,date:U,minDate:M?U:t.startOfMonth(te),maxDate:M?t.endOfMonth(te):U,isDateDisabled:K,timezone:R});Z(he||U),W.preventDefault();break}case"ArrowRight":{const U=t.addDays(F,M?-1:1),te=t.addMonths(F,M?-1:1),he=Qo({utils:t,date:U,minDate:M?t.startOfMonth(te):U,maxDate:M?U:t.endOfMonth(te),isDateDisabled:K,timezone:R});Z(he||U),W.preventDefault();break}case"Home":Z(t.startOfWeek(F)),W.preventDefault();break;case"End":Z(t.endOfWeek(F)),W.preventDefault();break;case"PageUp":Z(t.addMonths(F,1)),W.preventDefault();break;case"PageDown":Z(t.addMonths(F,-1)),W.preventDefault();break}}),N=Ze((W,F)=>Z(F)),H=Ze((W,F)=>{c!=null&&t.isSameDay(c,F)&&(_==null||_(!1))}),G=t.getMonth(o),q=t.getYear(o),oe=b.useMemo(()=>l.filter(W=>!!W).map(W=>t.startOfDay(W)),[t,l]),de=`${q}-${G}`,z=b.useMemo(()=>b.createRef(),[de]),O=b.useMemo(()=>{const W=t.getWeekArray(o);let F=t.addMonths(o,1);for(;B&&W.length<B;){const U=t.getWeekArray(F),te=t.isSameDay(W[W.length-1][0],U[0][0]);U.slice(te?1:0).forEach(he=>{W.length<B&&W.push(he)}),F=t.addMonths(F,1)}return W},[o,B,t]);return a.jsxs(tT,{role:"grid","aria-labelledby":I,className:P.root,children:[a.jsxs(rT,{role:"row",className:P.header,children:[D&&a.jsx(aT,{variant:"caption",role:"columnheader","aria-label":L.calendarWeekNumberHeaderLabel,className:P.weekNumberLabel,children:L.calendarWeekNumberHeaderText}),GE(t,Y).map((W,F)=>a.jsx(nT,{variant:"caption",role:"columnheader","aria-label":t.format(W,"weekday"),className:P.weekDayLabel,children:w(W)},F.toString()))]}),d?a.jsx(iT,{className:P.loadingContainer,children:m()}):a.jsx(oT,je({transKey:de,onExited:f,reduceAnimations:x,slideDirection:g,className:$r(s,P.slideTransition)},p,{nodeRef:z,children:a.jsx(lT,{ref:z,role:"rowgroup",className:P.monthContainer,children:O.map((W,F)=>a.jsxs(cT,{role:"row",className:P.weekContainer,"aria-rowindex":F+1,children:[D&&a.jsx(sT,{className:P.weekNumber,role:"rowheader","aria-label":L.calendarWeekNumberAriaLabelText(t.getWeekNumber(W[0])),children:L.calendarWeekNumberText(t.getWeekNumber(W[0]))}),W.map((U,te)=>a.jsx(dT,{parentProps:r,day:U,selectedDays:oe,isViewFocused:k,focusedDay:c,onKeyDown:T,onFocus:N,onBlur:H,onDaySelect:ae,isDateDisabled:K,currentMonthNumber:G,"aria-colindex":te+1},U.toString()))]},`week-${W[0]}`))})}))]})}function by(e){return Pr("MuiMonthCalendar",e)}const Rl=Ur("MuiMonthCalendar",["root","button","disabled","selected"]),fT=["autoFocus","classes","disabled","selected","value","onClick","onKeyDown","onFocus","onBlur","slots","slotProps"],hT=(e,r)=>{const t={button:["button",r.isMonthDisabled&&"disabled",r.isMonthSelected&&"selected"]};return wr(t,by,e)},mT=nt("button",{name:"MuiMonthCalendar",slot:"Button",overridesResolver:(e,r)=>[r.button,{[`&.${Rl.disabled}`]:r.disabled},{[`&.${Rl.selected}`]:r.selected}]})(({theme:e})=>je({color:"unset",backgroundColor:"transparent",border:0,outline:0},e.typography.subtitle1,{height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Vi(e.palette.action.active,e.palette.action.hoverOpacity)},"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Vi(e.palette.action.active,e.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${Rl.disabled}`]:{color:(e.vars||e).palette.text.secondary},[`&.${Rl.selected}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.main,"&:focus, &:hover":{backgroundColor:(e.vars||e).palette.primary.dark}}})),pT=b.memo(function(r){const{autoFocus:t,classes:n,disabled:s,selected:i,value:o,onClick:l,onKeyDown:c,onFocus:d,onBlur:u,slots:f,slotProps:h}=r,x=ht(r,fT),m=b.useRef(null),{ownerState:g}=tn(),p=je({},g,{isMonthDisabled:s,isMonthSelected:i}),y=hT(n,p);Pa(()=>{var E;t&&((E=m.current)==null||E.focus())},[t]);const S=(f==null?void 0:f.monthButton)??mT,v=zt({elementType:S,externalSlotProps:h==null?void 0:h.monthButton,externalForwardedProps:x,additionalProps:{disabled:s,ref:m,type:"button",role:"radio","aria-checked":i,onClick:E=>l(E,o),onKeyDown:E=>c(E,o),onFocus:E=>d(E,o),onBlur:E=>u(E,o)},ownerState:p,className:y.button});return a.jsx(S,je({},v))}),xT=["autoFocus","className","classes","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","shouldDisableMonth","readOnly","disableHighlightToday","onMonthFocus","hasFocus","onFocusedViewChange","monthsPerRow","timezone","gridLabelId","slots","slotProps"],gT=e=>wr({root:["root"]},by,e);function yT(e,r){const t=gr({props:e,name:r}),n=gl(t);return je({},t,n,{monthsPerRow:t.monthsPerRow??3})}const vT=nt("div",{name:"MuiMonthCalendar",slot:"Root",shouldForwardProp:e=>ul(e)&&e!=="monthsPerRow"})({display:"flex",flexWrap:"wrap",justifyContent:"space-evenly",rowGap:16,padding:"8px 0",width:ad,boxSizing:"border-box",variants:[{props:{monthsPerRow:3},style:{columnGap:24}},{props:{monthsPerRow:4},style:{columnGap:0}}]}),bT=b.forwardRef(function(r,t){const n=yT(r,"MuiMonthCalendar"),{autoFocus:s,className:i,classes:o,value:l,defaultValue:c,referenceDate:d,disabled:u,disableFuture:f,disablePast:h,maxDate:x,minDate:m,onChange:g,shouldDisableMonth:p,readOnly:y,onMonthFocus:S,hasFocus:v,onFocusedViewChange:E,monthsPerRow:C,timezone:A,gridLabelId:j,slots:w,slotProps:k}=n,_=ht(n,xT),{value:I,handleValueChange:D,timezone:B}=pl({name:"MonthCalendar",timezone:A,value:l,defaultValue:c,referenceDate:d,onChange:g,valueManager:Na}),R=rd(B),Y=Qa(),P=ur(),{ownerState:M}=tn(),K=b.useMemo(()=>Na.getInitialReferenceValue({value:I,utils:P,props:n,timezone:B,referenceDate:d,granularity:Da.month}),[]),L=gT(o),ae=b.useMemo(()=>P.getMonth(R),[P,R]),Z=b.useMemo(()=>I!=null?P.getMonth(I):null,[I,P]),[T,N]=b.useState(()=>Z||P.getMonth(K)),[H,G]=qi({name:"MonthCalendar",state:"hasFocus",controlled:v,default:s??!1}),q=Ze(U=>{G(U),E&&E(U)}),oe=b.useCallback(U=>{const te=P.startOfMonth(h&&P.isAfter(R,m)?R:m),he=P.startOfMonth(f&&P.isBefore(R,x)?R:x),ie=P.startOfMonth(U);return P.isBefore(ie,te)||P.isAfter(ie,he)?!0:p?p(ie):!1},[f,h,x,m,R,p,P]),de=Ze((U,te)=>{if(y)return;const he=P.setMonth(I??K,te);D(he)}),z=Ze(U=>{oe(P.setMonth(I??K,U))||(N(U),q(!0),S&&S(U))});b.useEffect(()=>{N(U=>Z!==null&&U!==Z?Z:U)},[Z]);const O=Ze((U,te)=>{switch(U.key){case"ArrowUp":z((12+te-3)%12),U.preventDefault();break;case"ArrowDown":z((12+te+3)%12),U.preventDefault();break;case"ArrowLeft":z((12+te+(Y?1:-1))%12),U.preventDefault();break;case"ArrowRight":z((12+te+(Y?-1:1))%12),U.preventDefault();break}}),W=Ze((U,te)=>{z(te)}),F=Ze((U,te)=>{T===te&&q(!1)});return a.jsx(vT,je({ref:t,className:$r(L.root,i),ownerState:M,role:"radiogroup","aria-labelledby":j,monthsPerRow:C},_,{children:Gf(P,I??K).map(U=>{const te=P.getMonth(U),he=P.format(U,"monthShort"),ie=P.format(U,"month"),be=te===Z,xe=u||oe(U);return a.jsx(pT,{selected:be,value:te,onClick:de,onKeyDown:O,autoFocus:H&&te===T,disabled:xe,tabIndex:te===T&&!xe?0:-1,onFocus:W,onBlur:F,"aria-current":ae===te?"date":void 0,"aria-label":ie,slots:w,slotProps:k,classes:o,children:he},he)})}))});function Sy(e){return Pr("MuiYearCalendar",e)}const Ol=Ur("MuiYearCalendar",["root","button","disabled","selected"]),ST=["autoFocus","classes","disabled","selected","value","onClick","onKeyDown","onFocus","onBlur","slots","slotProps"],wT=(e,r)=>{const t={button:["button",r.isYearDisabled&&"disabled",r.isYearSelected&&"selected"]};return wr(t,Sy,e)},jT=nt("button",{name:"MuiYearCalendar",slot:"Button",overridesResolver:(e,r)=>[r.button,{[`&.${Ol.disabled}`]:r.disabled},{[`&.${Ol.selected}`]:r.selected}]})(({theme:e})=>je({color:"unset",backgroundColor:"transparent",border:0,outline:0},e.typography.subtitle1,{height:36,width:72,borderRadius:18,cursor:"pointer","&:focus":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.focusOpacity})`:Vi(e.palette.action.active,e.palette.action.focusOpacity)},"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:Vi(e.palette.action.active,e.palette.action.hoverOpacity)},"&:disabled":{cursor:"auto",pointerEvents:"none"},[`&.${Ol.disabled}`]:{color:(e.vars||e).palette.text.secondary},[`&.${Ol.selected}`]:{color:(e.vars||e).palette.primary.contrastText,backgroundColor:(e.vars||e).palette.primary.main,"&:focus, &:hover":{backgroundColor:(e.vars||e).palette.primary.dark}}})),ET=b.memo(function(r){const{autoFocus:t,classes:n,disabled:s,selected:i,value:o,onClick:l,onKeyDown:c,onFocus:d,onBlur:u,slots:f,slotProps:h}=r,x=ht(r,ST),m=b.useRef(null),{ownerState:g}=tn(),p=je({},g,{isYearDisabled:s,isYearSelected:i}),y=wT(n,p);Pa(()=>{var E;t&&((E=m.current)==null||E.focus())},[t]);const S=(f==null?void 0:f.yearButton)??jT,v=zt({elementType:S,externalSlotProps:h==null?void 0:h.yearButton,externalForwardedProps:x,additionalProps:{disabled:s,ref:m,type:"button",role:"radio","aria-checked":i,onClick:E=>l(E,o),onKeyDown:E=>c(E,o),onFocus:E=>d(E,o),onBlur:E=>u(E,o)},ownerState:p,className:y.button});return a.jsx(S,je({},v))}),kT=["autoFocus","className","classes","value","defaultValue","referenceDate","disabled","disableFuture","disablePast","maxDate","minDate","onChange","readOnly","shouldDisableYear","disableHighlightToday","onYearFocus","hasFocus","onFocusedViewChange","yearsOrder","yearsPerRow","timezone","gridLabelId","slots","slotProps"],AT=e=>wr({root:["root"]},Sy,e);function TT(e,r){const t=gr({props:e,name:r}),n=gl(t);return je({},t,n,{yearsPerRow:t.yearsPerRow??3,yearsOrder:t.yearsOrder??"asc"})}const CT=nt("div",{name:"MuiYearCalendar",slot:"Root",shouldForwardProp:e=>ul(e)&&e!=="yearsPerRow"})({display:"flex",flexWrap:"wrap",justifyContent:"space-evenly",rowGap:12,padding:"6px 0",overflowY:"auto",height:"100%",width:ad,maxHeight:VE,boxSizing:"border-box",position:"relative",variants:[{props:{yearsPerRow:3},style:{columnGap:24}},{props:{yearsPerRow:4},style:{columnGap:0,padding:"0 2px"}}]}),DT=nt("div",{name:"MuiYearCalendar",slot:"ButtonFiller"})({height:36,width:72}),_T=b.forwardRef(function(r,t){const n=TT(r,"MuiYearCalendar"),{autoFocus:s,className:i,classes:o,value:l,defaultValue:c,referenceDate:d,disabled:u,disableFuture:f,disablePast:h,maxDate:x,minDate:m,onChange:g,readOnly:p,shouldDisableYear:y,onYearFocus:S,hasFocus:v,onFocusedViewChange:E,yearsOrder:C,yearsPerRow:A,timezone:j,gridLabelId:w,slots:k,slotProps:_}=n,I=ht(n,kT),{value:D,handleValueChange:B,timezone:R}=pl({name:"YearCalendar",timezone:j,value:l,defaultValue:c,referenceDate:d,onChange:g,valueManager:Na}),Y=rd(R),P=Qa(),M=ur(),{ownerState:K}=tn(),L=b.useMemo(()=>Na.getInitialReferenceValue({value:D,utils:M,props:n,timezone:R,referenceDate:d,granularity:Da.year}),[]),ae=AT(o),Z=b.useMemo(()=>M.getYear(Y),[M,Y]),T=b.useMemo(()=>D!=null?M.getYear(D):null,[D,M]),[N,H]=b.useState(()=>T||M.getYear(L)),[G,q]=qi({name:"YearCalendar",state:"hasFocus",controlled:v,default:s??!1}),oe=Ze(me=>{q(me),E&&E(me)}),de=b.useCallback(me=>{if(h&&M.isBeforeYear(me,Y)||f&&M.isAfterYear(me,Y)||m&&M.isBeforeYear(me,m)||x&&M.isAfterYear(me,x))return!0;if(!y)return!1;const ve=M.startOfYear(me);return y(ve)},[f,h,x,m,Y,y,M]),z=Ze((me,ve)=>{if(p)return;const ne=M.setYear(D??L,ve);B(ne)}),O=Ze(me=>{de(M.setYear(D??L,me))||(H(me),oe(!0),S==null||S(me))});b.useEffect(()=>{H(me=>T!==null&&me!==T?T:me)},[T]);const W=C!=="desc"?A*1:A*-1,F=P&&C==="asc"||!P&&C==="desc"?-1:1,U=Ze((me,ve)=>{switch(me.key){case"ArrowUp":O(ve-W),me.preventDefault();break;case"ArrowDown":O(ve+W),me.preventDefault();break;case"ArrowLeft":O(ve-F),me.preventDefault();break;case"ArrowRight":O(ve+F),me.preventDefault();break}}),te=Ze((me,ve)=>{O(ve)}),he=Ze((me,ve)=>{N===ve&&oe(!1)}),ie=b.useRef(null),be=Ln(t,ie);b.useEffect(()=>{if(s||ie.current===null)return;const me=ie.current.querySelector('[tabindex="0"]');if(!me)return;const ve=me.offsetHeight,ne=me.offsetTop,we=ie.current.clientHeight,Ee=ie.current.scrollTop,pe=ne+ve;ve>we||ne<Ee||(ie.current.scrollTop=pe-we/2-ve/2)},[s]);const xe=M.getYearRange([m,x]);C==="desc"&&xe.reverse();let Fe=A-xe.length%A;return Fe===A&&(Fe=0),a.jsxs(CT,je({ref:be,className:$r(ae.root,i),ownerState:K,role:"radiogroup","aria-labelledby":w,yearsPerRow:A},I,{children:[xe.map(me=>{const ve=M.getYear(me),ne=ve===T,we=u||de(me);return a.jsx(ET,{selected:ne,value:ve,onClick:z,onKeyDown:U,autoFocus:G&&ve===N,disabled:we,tabIndex:ve===N&&!we?0:-1,onFocus:te,onBlur:he,"aria-current":Z===ve?"date":void 0,slots:k,slotProps:_,classes:o,children:M.format(me,"year")},M.format(me,"year"))}),Array.from({length:Fe},(me,ve)=>a.jsx(DT,{},ve))]}))}),IT=e=>Pr("MuiPickersCalendarHeader",e),FT=Ur("MuiPickersCalendarHeader",["root","labelContainer","label","switchViewButton","switchViewIcon"]),MT=["slots","slotProps","currentMonth","disabled","disableFuture","disablePast","maxDate","minDate","onMonthChange","onViewChange","view","reduceAnimations","views","labelId","className","classes","timezone","format"],PT=["ownerState"],NT=e=>wr({root:["root"],labelContainer:["labelContainer"],label:["label"],switchViewButton:["switchViewButton"],switchViewIcon:["switchViewIcon"]},IT,e),RT=nt("div",{name:"MuiPickersCalendarHeader",slot:"Root"})({display:"flex",alignItems:"center",marginTop:12,marginBottom:4,paddingLeft:24,paddingRight:12,maxHeight:40,minHeight:40}),OT=nt("div",{name:"MuiPickersCalendarHeader",slot:"LabelContainer"})(({theme:e})=>je({display:"flex",overflow:"hidden",alignItems:"center",cursor:"pointer",marginRight:"auto"},e.typography.body1,{fontWeight:e.typography.fontWeightMedium})),LT=nt("div",{name:"MuiPickersCalendarHeader",slot:"Label"})({marginRight:6}),$T=nt(st,{name:"MuiPickersCalendarHeader",slot:"SwitchViewButton"})({marginRight:"auto",variants:[{props:{view:"year"},style:{[`.${FT.switchViewIcon}`]:{transform:"rotate(180deg)"}}}]}),BT=nt(SE,{name:"MuiPickersCalendarHeader",slot:"SwitchViewIcon"})(({theme:e})=>({willChange:"transform",transition:e.transitions.create("transform"),transform:"rotate(0deg)"})),UT=b.forwardRef(function(r,t){const n=_s(),s=ur(),i=gr({props:r,name:"MuiPickersCalendarHeader"}),{slots:o,slotProps:l,currentMonth:c,disabled:d,disableFuture:u,disablePast:f,maxDate:h,minDate:x,onMonthChange:m,onViewChange:g,view:p,reduceAnimations:y,views:S,labelId:v,className:E,classes:C,timezone:A,format:j=`${s.formats.month} ${s.formats.year}`}=i,w=ht(i,MT),{ownerState:k}=tn(),_=NT(C),I=(o==null?void 0:o.switchViewButton)??$T,D=zt({elementType:I,externalSlotProps:l==null?void 0:l.switchViewButton,additionalProps:{size:"small","aria-label":n.calendarViewSwitchingButtonAriaLabel(p)},ownerState:k,className:_.switchViewButton}),B=(o==null?void 0:o.switchViewIcon)??BT,R=zt({elementType:B,externalSlotProps:l==null?void 0:l.switchViewIcon,ownerState:k,className:_.switchViewIcon}),Y=ht(R,PT),P=()=>m(s.addMonths(c,1)),M=()=>m(s.addMonths(c,-1)),K=BE(c,{disableFuture:u,maxDate:h,timezone:A}),L=UE(c,{disablePast:f,minDate:x,timezone:A}),ae=()=>{if(!(S.length===1||!g||d))if(S.length===2)g(S.find(T=>T!==p)||S[0]);else{const T=S.indexOf(p)!==0?0:1;g(S[T])}};if(S.length===1&&S[0]==="year")return null;const Z=s.formatByString(c,j);return a.jsxs(RT,je({},w,{ownerState:k,className:$r(_.root,E),ref:t,children:[a.jsxs(OT,{role:"presentation",onClick:ae,ownerState:k,"aria-live":"polite",className:_.labelContainer,children:[a.jsx(yy,{reduceAnimations:y,transKey:Z,children:a.jsx(LT,{id:v,ownerState:k,className:_.label,children:Z})}),S.length>1&&!d&&a.jsx(I,je({},D,{children:a.jsx(B,je({},Y))}))]}),a.jsx(Uc,{in:p==="day",appear:!y,enter:!y,children:a.jsx(PE,{slots:o,slotProps:l,onGoToPrevious:M,isPreviousDisabled:L,previousLabel:n.previousMonth,onGoToNext:P,isNextDisabled:K,nextLabel:n.nextMonth})})]}))}),VT="@media (prefers-reduced-motion: reduce)",Ri=typeof navigator<"u"&&navigator.userAgent.match(/android\s(\d+)|OS\s(\d+)/i),vm=Ri&&Ri[1]?parseInt(Ri[1],10):null,bm=Ri&&Ri[2]?parseInt(Ri[2],10):null,WT=vm&&vm<10||bm&&bm<13||!1;function wy(e){const r=sf(VT,{defaultMatches:!1});return e??(r||WT)}const HT=e=>Pr("MuiDateCalendar",e);Ur("MuiDateCalendar",["root","viewTransitionContainer"]);const YT=["autoFocus","onViewChange","value","defaultValue","referenceDate","disableFuture","disablePast","onChange","onYearChange","onMonthChange","reduceAnimations","shouldDisableDate","shouldDisableMonth","shouldDisableYear","view","views","openTo","className","classes","disabled","readOnly","minDate","maxDate","disableHighlightToday","focusedView","onFocusedViewChange","showDaysOutsideCurrentMonth","fixedWeekNumber","dayOfWeekFormatter","slots","slotProps","loading","renderLoading","displayWeekNumber","yearsOrder","yearsPerRow","monthsPerRow","timezone"],zT=e=>wr({root:["root"],viewTransitionContainer:["viewTransitionContainer"]},HT,e);function GT(e,r){const t=gr({props:e,name:r}),n=wy(t.reduceAnimations),s=gl(t);return je({},t,s,{loading:t.loading??!1,openTo:t.openTo??"day",views:t.views??["year","day"],reduceAnimations:n,renderLoading:t.renderLoading??(()=>a.jsx("span",{children:"..."}))})}const qT=nt(WE,{name:"MuiDateCalendar",slot:"Root"})({display:"flex",flexDirection:"column",height:zf}),XT=nt(yy,{name:"MuiDateCalendar",slot:"ViewTransitionContainer"})({}),jy=b.forwardRef(function(r,t){const n=ur(),{ownerState:s}=tn(),i=td(),o=GT(r,"MuiDateCalendar"),{autoFocus:l,onViewChange:c,value:d,defaultValue:u,referenceDate:f,disableFuture:h,disablePast:x,onChange:m,onMonthChange:g,reduceAnimations:p,shouldDisableDate:y,shouldDisableMonth:S,shouldDisableYear:v,view:E,views:C,openTo:A,className:j,classes:w,disabled:k,readOnly:_,minDate:I,maxDate:D,disableHighlightToday:B,focusedView:R,onFocusedViewChange:Y,showDaysOutsideCurrentMonth:P,fixedWeekNumber:M,dayOfWeekFormatter:K,slots:L,slotProps:ae,loading:Z,renderLoading:T,displayWeekNumber:N,yearsOrder:H,yearsPerRow:G,monthsPerRow:q,timezone:oe}=o,de=ht(o,YT),{value:z,handleValueChange:O,timezone:W}=pl({name:"DateCalendar",timezone:oe,value:d,defaultValue:u,referenceDate:f,onChange:m,valueManager:Na}),{view:F,setView:U,focusedView:te,setFocusedView:he,goToNextView:ie,setValueAndGoToNextView:be}=Wg({view:E,views:C,openTo:A,onChange:O,onViewChange:c,autoFocus:l,focusedView:R,onFocusedViewChange:Y}),{referenceDate:xe,calendarState:Fe,setVisibleDate:me,isDateDisabled:ve,onMonthSwitchingAnimationEnd:ne}=UA({value:z,referenceDate:f,reduceAnimations:p,onMonthChange:g,minDate:I,maxDate:D,shouldDisableDate:y,disablePast:x,disableFuture:h,timezone:W,getCurrentMonthFromVisibleDate:(dt,qt)=>n.isSameMonth(dt,qt)?qt:n.startOfMonth(dt)}),we=k&&z||I,Ee=k&&z||D,pe=`${i}-grid-label`,Ce=te!==null,ue=(L==null?void 0:L.calendarHeader)??UT,Me=zt({elementType:ue,externalSlotProps:ae==null?void 0:ae.calendarHeader,additionalProps:{views:C,view:F,currentMonth:Fe.currentMonth,onViewChange:U,onMonthChange:dt=>me({target:dt,reason:"header-navigation"}),minDate:we,maxDate:Ee,disabled:k,disablePast:x,disableFuture:h,reduceAnimations:p,timezone:W,labelId:pe},ownerState:s}),ke=Ze(dt=>{const qt=n.startOfMonth(dt),jr=n.endOfMonth(dt),Zt=ve(dt)?Qo({utils:n,date:dt,minDate:n.isBefore(I,qt)?qt:I,maxDate:n.isAfter(D,jr)?jr:D,disablePast:x,disableFuture:h,isDateDisabled:ve,timezone:W}):dt;Zt?(be(Zt,"finish"),me({target:Zt,reason:"cell-interaction"})):(ie(),me({target:qt,reason:"cell-interaction"}))}),Ae=Ze(dt=>{const qt=n.startOfYear(dt),jr=n.endOfYear(dt),Zt=ve(dt)?Qo({utils:n,date:dt,minDate:n.isBefore(I,qt)?qt:I,maxDate:n.isAfter(D,jr)?jr:D,disablePast:x,disableFuture:h,isDateDisabled:ve,timezone:W}):dt;Zt?(be(Zt,"finish"),me({target:Zt,reason:"cell-interaction"})):(ie(),me({target:qt,reason:"cell-interaction"}))}),Ue=Ze(dt=>O(dt&&vc(n,dt,z??xe),"finish",F));b.useEffect(()=>{n.isValid(z)&&me({target:z,reason:"controlled-value-change"})},[z]);const Ye=zT(w),Ve={disablePast:x,disableFuture:h,maxDate:D,minDate:I},Xe={disableHighlightToday:B,readOnly:_,disabled:k,timezone:W,gridLabelId:pe,slots:L,slotProps:ae},_t=b.useRef(F);b.useEffect(()=>{_t.current!==F&&(te===_t.current&&he(F,!0),_t.current=F)},[te,he,F]);const ct=b.useMemo(()=>[z],[z]);return a.jsxs(qT,je({ref:t,className:$r(Ye.root,j),ownerState:s},de,{children:[a.jsx(ue,je({},Me,{slots:L,slotProps:ae})),a.jsx(XT,{reduceAnimations:p,className:Ye.viewTransitionContainer,transKey:F,ownerState:s,children:a.jsxs("div",{children:[F==="year"&&a.jsx(_T,je({},Ve,Xe,{value:z,onChange:Ae,shouldDisableYear:v,hasFocus:Ce,onFocusedViewChange:dt=>he("year",dt),yearsOrder:H,yearsPerRow:G,referenceDate:xe})),F==="month"&&a.jsx(bT,je({},Ve,Xe,{hasFocus:Ce,className:j,value:z,onChange:ke,shouldDisableMonth:S,onFocusedViewChange:dt=>he("month",dt),monthsPerRow:q,referenceDate:xe})),F==="day"&&a.jsx(uT,je({},Fe,Ve,Xe,{onMonthSwitchingAnimationEnd:ne,hasFocus:Ce,onFocusedDayChange:dt=>me({target:dt,reason:"cell-interaction"}),reduceAnimations:p,selectedDays:ct,onSelectedDaysChange:Ue,shouldDisableDate:y,shouldDisableMonth:S,shouldDisableYear:v,onFocusedViewChange:dt=>he("day",dt),showDaysOutsideCurrentMonth:P,fixedWeekNumber:M,dayOfWeekFormatter:K,displayWeekNumber:N,loading:Z,renderLoading:T}))]})})]}))});function KT(e){return Pr("MuiPickersToolbar",e)}Ur("MuiPickersToolbar",["root","title","content"]);function Ey(){const{ownerState:e}=tn(),r=Qa();return b.useMemo(()=>je({},e,{toolbarDirection:r?"rtl":"ltr"}),[e,r])}const JT=["children","className","classes","toolbarTitle","hidden","titleId","classes","landscapeDirection"],QT=e=>wr({root:["root"],title:["title"],content:["content"]},KT,e),ZT=nt("div",{name:"MuiPickersToolbar",slot:"Root"})(({theme:e})=>({display:"flex",flexDirection:"column",alignItems:"flex-start",justifyContent:"space-between",padding:e.spacing(2,3),variants:[{props:{pickerOrientation:"landscape"},style:{height:"auto",maxWidth:160,padding:16,justifyContent:"flex-start",flexWrap:"wrap"}}]})),eC=nt("div",{name:"MuiPickersToolbar",slot:"Content",shouldForwardProp:e=>ul(e)&&e!=="landscapeDirection"})({display:"flex",flexWrap:"wrap",width:"100%",flex:1,justifyContent:"space-between",alignItems:"center",flexDirection:"row",variants:[{props:{pickerOrientation:"landscape"},style:{justifyContent:"flex-start",alignItems:"flex-start",flexDirection:"column"}},{props:{pickerOrientation:"landscape",landscapeDirection:"row"},style:{flexDirection:"row"}}]}),tC=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersToolbar"}),{children:s,className:i,classes:o,toolbarTitle:l,hidden:c,titleId:d,landscapeDirection:u}=n,f=ht(n,JT),h=Ey(),x=QT(o);return c?null:a.jsxs(ZT,je({ref:t,className:$r(x.root,i),ownerState:h},f,{children:[a.jsx(V,{color:"text.secondary",variant:"overline",id:d,className:x.title,children:l}),a.jsx(eC,{className:x.content,ownerState:h,landscapeDirection:u,children:s})]}))});function rC(e){return Pr("MuiDatePickerToolbar",e)}Ur("MuiDatePickerToolbar",["root","title"]);const nC=["toolbarFormat","toolbarPlaceholder","className","classes"],aC=e=>wr({root:["root"],title:["title"]},rC,e),sC=nt(tC,{name:"MuiDatePickerToolbar",slot:"Root"})({}),iC=nt(V,{name:"MuiDatePickerToolbar",slot:"Title"})({variants:[{props:{pickerOrientation:"landscape"},style:{margin:"auto 16px auto auto"}}]}),oC=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiDatePickerToolbar"}),{toolbarFormat:s,toolbarPlaceholder:i="‚Äì‚Äì",className:o,classes:l}=n,c=ht(n,nC),d=ur(),{value:u,views:f,orientation:h}=ro(),x=_s(),m=Ey(),g=aC(l),p=b.useMemo(()=>{if(!d.isValid(u))return i;const y=qf(d,{format:s,views:f},!0);return d.formatByString(u,y)},[u,s,i,d,f]);return a.jsx(sC,je({ref:t,toolbarTitle:x.datePickerToolbarTitle,className:$r(g.root,o)},c,{children:a.jsx(iC,{variant:"h4",align:h==="landscape"?"left":"center",ownerState:m,className:g.title,children:p})}))});function ky(e,r){const t=gr({props:e,name:r}),n=gl(t),s=b.useMemo(()=>{var i;return((i=t.localeText)==null?void 0:i.toolbarTitle)==null?t.localeText:je({},t.localeText,{datePickerToolbarTitle:t.localeText.toolbarTitle})},[t.localeText]);return je({},t,n,{localeText:s},NE({views:t.views,openTo:t.openTo,defaultViews:["year","day"],defaultOpenTo:"day"}),{slots:je({toolbar:oC},t.slots)})}function lC(e){return Pr("MuiPickerPopper",e)}Ur("MuiPickerPopper",["root","paper"]);const cC=["PaperComponent","ownerState","children","paperSlotProps","paperClasses","onPaperClick","onPaperTouchStart"],dC=e=>wr({root:["root"],paper:["paper"]},lC,e),uC=nt(oS,{name:"MuiPickerPopper",slot:"Root"})(({theme:e})=>({zIndex:e.zIndex.modal})),fC=nt(Ke,{name:"MuiPickerPopper",slot:"Paper"})({outline:0,transformOrigin:"top center",variants:[{props:({popperPlacement:e})=>["top","top-start","top-end"].includes(e),style:{transformOrigin:"bottom center"}}]});function hC(e,r){return r.documentElement.clientWidth<e.clientX||r.documentElement.clientHeight<e.clientY}function mC(e,r){const t=b.useRef(!1),n=b.useRef(!1),s=b.useRef(null),i=b.useRef(!1);b.useEffect(()=>{if(!e)return;function c(){i.current=!0}return document.addEventListener("mousedown",c,!0),document.addEventListener("touchstart",c,!0),()=>{document.removeEventListener("mousedown",c,!0),document.removeEventListener("touchstart",c,!0),i.current=!1}},[e]);const o=Ze(c=>{if(!i.current)return;const d=n.current;n.current=!1;const u=Vd(s.current);if(!s.current||"clientX"in c&&hC(c,u))return;if(t.current){t.current=!1;return}let f;c.composedPath?f=c.composedPath().indexOf(s.current)>-1:f=!u.documentElement.contains(c.target)||s.current.contains(c.target),!f&&!d&&r(c)}),l=()=>{n.current=!0};return b.useEffect(()=>{if(e){const c=Vd(s.current),d=()=>{t.current=!0};return c.addEventListener("touchstart",o),c.addEventListener("touchmove",d),()=>{c.removeEventListener("touchstart",o),c.removeEventListener("touchmove",d)}}},[e,o]),b.useEffect(()=>{if(e){const c=Vd(s.current);return c.addEventListener("click",o),()=>{c.removeEventListener("click",o),n.current=!1}}},[e,o]),[s,l,l]}const pC=b.forwardRef((e,r)=>{const{PaperComponent:t,ownerState:n,children:s,paperSlotProps:i,paperClasses:o,onPaperClick:l,onPaperTouchStart:c}=e,d=ht(e,cC),u=zt({elementType:t,externalSlotProps:i,additionalProps:{tabIndex:-1,elevation:8,ref:r},className:o,ownerState:n});return a.jsx(t,je({},d,u,{onClick:f=>{var h;l(f),(h=u.onClick)==null||h.call(u,f)},onTouchStart:f=>{var h;c(f),(h=u.onTouchStart)==null||h.call(u,f)},ownerState:n,children:s}))});function xC(e){const r=gr({props:e,name:"MuiPickerPopper"}),{children:t,placement:n="bottom-start",slots:s,slotProps:i,classes:o}=r,{open:l,popupRef:c,reduceAnimations:d}=ro(),{dismissViews:u,getCurrentViewMode:f,onPopperExited:h,triggerElement:x,viewContainerRole:m}=tn();b.useEffect(()=>{function M(K){l&&K.key==="Escape"&&u()}return document.addEventListener("keydown",M),()=>{document.removeEventListener("keydown",M)}},[u,l]);const g=b.useRef(null);b.useEffect(()=>{m==="tooltip"||f()==="field"||(l?g.current=ln(document):g.current&&g.current instanceof HTMLElement&&setTimeout(()=>{g.current instanceof HTMLElement&&g.current.focus()}))},[l,m,f]);const p=dC(o),{ownerState:y,rootRefObject:S}=tn(),v=je({},y,{popperPlacement:n}),E=Ze(()=>{m==="tooltip"?ck(()=>{var M,K;(M=S.current)!=null&&M.contains(ln(document))||(K=c.current)!=null&&K.contains(ln(document))||u()}):u()}),[C,A,j]=mC(l,E),w=b.useRef(null),k=Ln(w,c),_=Ln(k,C),I=M=>{M.key==="Escape"&&(M.stopPropagation(),u())},D=(s==null?void 0:s.desktopTransition)??d?Uc:lS,B=(s==null?void 0:s.desktopTrapFocus)??cS,R=(s==null?void 0:s.desktopPaper)??fC,Y=(s==null?void 0:s.popper)??uC,P=zt({elementType:Y,externalSlotProps:i==null?void 0:i.popper,additionalProps:{transition:!0,role:m??void 0,open:l,placement:n,anchorEl:x,onKeyDown:I},className:p.root,ownerState:v});return a.jsx(Y,je({},P,{children:({TransitionProps:M})=>a.jsx(B,je({open:l,disableAutoFocus:!0,disableRestoreFocus:!0,disableEnforceFocus:m==="tooltip",isEnabled:()=>!0},i==null?void 0:i.desktopTrapFocus,{children:a.jsx(D,je({},M,i==null?void 0:i.desktopTransition,{onExited:K=>{var L,ae,Z;h==null||h(),(ae=(L=i==null?void 0:i.desktopTransition)==null?void 0:L.onExited)==null||ae.call(L,K),(Z=M==null?void 0:M.onExited)==null||Z.call(M)},children:a.jsx(pC,{PaperComponent:R,ownerState:v,ref:_,onPaperClick:A,onPaperTouchStart:j,paperClasses:p.paper,paperSlotProps:i==null?void 0:i.desktopPaper,children:t})}))}))}))}function Sm(){return typeof window>"u"?"portrait":window.screen&&window.screen.orientation&&window.screen.orientation.angle?Math.abs(window.screen.orientation.angle)===90?"landscape":"portrait":window.orientation&&Math.abs(Number(window.orientation))===90?"landscape":"portrait"}function gC(e,r){const[t,n]=b.useState(Sm);return Pa(()=>{const s=()=>{n(Sm())};return window.addEventListener("orientationchange",s),()=>{window.removeEventListener("orientationchange",s)}},[]),lk(e,["hours","minutes","seconds"])?"portrait":r??t}function yC(e){const{props:r,valueManager:t,validator:n}=e,{value:s,defaultValue:i,onChange:o,referenceDate:l,timezone:c,onAccept:d,closeOnSelect:u,open:f,onOpen:h,onClose:x}=r,{current:m}=b.useRef(i),{current:g}=b.useRef(s!==void 0),{current:p}=b.useRef(f!==void 0),y=ur(),{timezone:S,value:v,handleValueChange:E}=pl({name:"a picker component",timezone:c,value:s,defaultValue:m,referenceDate:l,onChange:o,valueManager:t}),[C,A]=b.useState(()=>({open:!1,lastExternalValue:v,clockShallowValue:void 0,lastCommittedValue:v,hasBeenModifiedSinceMount:!1})),{getValidationErrorForNewValue:j}=ry({props:r,validator:n,timezone:S,value:v,onError:r.onError}),w=Ze(D=>{const B=typeof D=="function"?D(C.open):D;p||A(R=>je({},R,{open:B})),B&&h&&h(),B||x==null||x()}),k=Ze((D,B)=>{const{changeImportance:R="accept",skipPublicationIfPristine:Y=!1,validationError:P,shortcut:M,shouldClose:K=R==="accept"}=B??{};let L,ae;!Y&&!g&&!C.hasBeenModifiedSinceMount?(L=!0,ae=R==="accept"):(L=!t.areValuesEqual(y,D,v),ae=R==="accept"&&!t.areValuesEqual(y,D,C.lastCommittedValue)),A(N=>je({},N,{clockShallowValue:L?void 0:N.clockShallowValue,lastCommittedValue:ae?v:N.lastCommittedValue,hasBeenModifiedSinceMount:!0}));let Z=null;const T=()=>(Z||(Z={validationError:P??j(D)},M&&(Z.shortcut=M)),Z);L&&E(D,T()),ae&&d&&d(D,T()),K&&w(!1)});v!==C.lastExternalValue&&A(D=>je({},D,{lastExternalValue:v,clockShallowValue:void 0,hasBeenModifiedSinceMount:!0}));const _=Ze((D,B="partial")=>{if(B==="shallow"){A(R=>je({},R,{clockShallowValue:D,hasBeenModifiedSinceMount:!0}));return}k(D,{changeImportance:B==="finish"&&u?"accept":"set"})});b.useEffect(()=>{if(p){if(f===void 0)throw new Error("You must not mix controlling and uncontrolled mode for `open` prop");A(D=>je({},D,{open:f}))}},[p,f]);const I=b.useMemo(()=>t.cleanValue(y,C.clockShallowValue===void 0?v:C.clockShallowValue),[y,t,C.clockShallowValue,v]);return{timezone:S,state:C,setValue:k,setValueFromView:_,setOpen:w,value:v,viewValue:I}}const vC=["className","sx"],Ay=({ref:e,props:r,valueManager:t,valueType:n,variant:s,validator:i,onPopperExited:o,autoFocusView:l,rendererInterceptor:c,localeText:d,viewContainerRole:u,getStepNavigation:f})=>{const{views:h,view:x,openTo:m,onViewChange:g,viewRenderers:p,reduceAnimations:y,orientation:S,disableOpenPicker:v,closeOnSelect:E,disabled:C,readOnly:A,formatDensity:j,enableAccessibleFieldDOMStructure:w,selectedSections:k,onSelectedSectionsChange:_,format:I,label:D,autoFocus:B,name:R}=r,{className:Y,sx:P}=r,M=ht(r,vC),K=td(),L=ur(),ae=ci(),Z=wy(y),T=gC(h,S),{current:N}=b.useRef(m??null),[H,G]=b.useState(null),q=b.useRef(null),oe=b.useRef(null),de=b.useRef(null),z=Ln(e,de),{timezone:O,state:W,setOpen:F,setValue:U,setValueFromView:te,value:he,viewValue:ie}=yC({props:r,valueManager:t,validator:i}),{view:be,setView:xe,defaultView:Fe,focusedView:me,setFocusedView:ve,setValueAndGoToNextView:ne,goToNextStep:we,hasNextStep:Ee,hasSeveralSteps:pe}=Wg({view:x,views:h,openTo:m,onChange:te,onViewChange:g,autoFocus:l,getStepNavigation:f}),Ce=Ze(()=>U(t.emptyValue)),ue=Ze(()=>U(t.getTodayValue(L,O,n))),Me=Ze(()=>U(he)),ke=Ze(()=>U(W.lastCommittedValue,{skipPublicationIfPristine:!0})),Ae=Ze(()=>{U(he,{skipPublicationIfPristine:!0})}),{hasUIView:Ue,viewModeLookup:Ye,timeViewsCount:Ve}=b.useMemo(()=>h.reduce((ir,xn)=>{const ji=p[xn]==null?"field":"UI";return ir.viewModeLookup[xn]=ji,ji==="UI"&&(ir.hasUIView=!0,OE(xn)&&(ir.timeViewsCount+=1)),ir},{hasUIView:!1,viewModeLookup:{},timeViewsCount:0}),[p,h]),Xe=Ye[be],_t=Ze(()=>Xe),[ct,dt]=b.useState(Xe==="UI"?be:null);ct!==be&&Ye[be]==="UI"&&dt(be),Pa(()=>{Xe==="field"&&W.open&&(F(!1),setTimeout(()=>{var ir,xn;(ir=oe==null?void 0:oe.current)==null||ir.setSelectedSections(be),(xn=oe==null?void 0:oe.current)==null||xn.focusField(be)}))},[be]),Pa(()=>{if(!W.open)return;let ir=be;Xe==="field"&&ct!=null&&(ir=ct),ir!==Fe&&Ye[ir]==="UI"&&Ye[Fe]==="UI"&&(ir=Fe),ir!==be&&xe(ir),ve(ir,!0)},[W.open]);const qt=b.useMemo(()=>({isPickerValueEmpty:t.areValuesEqual(L,he,t.emptyValue),isPickerOpen:W.open,isPickerDisabled:r.disabled??!1,isPickerReadOnly:r.readOnly??!1,pickerOrientation:T,pickerVariant:s}),[L,t,he,W.open,T,s,r.disabled,r.readOnly]),jr=b.useMemo(()=>v||!Ue?"hidden":C||A?"disabled":"enabled",[v,Ue,C,A]),Zt=Ze(we),as=b.useMemo(()=>E&&!pe?[]:["cancel","nextOrAccept"],[E,pe]),Er=b.useMemo(()=>({setValue:U,setOpen:F,clearValue:Ce,setValueToToday:ue,acceptValueChanges:Me,cancelValueChanges:ke,setView:xe,goToNextStep:Zt}),[U,F,Ce,ue,Me,ke,xe,Zt]),Kn=b.useMemo(()=>je({},Er,{value:he,timezone:O,open:W.open,views:h,view:ct,initialView:N,disabled:C??!1,readOnly:A??!1,autoFocus:B??!1,variant:s,orientation:T,popupRef:q,reduceAnimations:Z,triggerRef:G,triggerStatus:jr,hasNextStep:Ee,fieldFormat:I??"",name:R,label:D,rootSx:P,rootRef:z,rootClassName:Y}),[Er,he,z,s,T,Z,C,A,I,Y,R,D,P,jr,Ee,O,W.open,ct,h,N,B]),ss=b.useMemo(()=>({dismissViews:Ae,ownerState:qt,hasUIView:Ue,getCurrentViewMode:_t,rootRefObject:de,labelId:K,triggerElement:H,viewContainerRole:u,defaultActionBarActions:as,onPopperExited:o}),[Ae,qt,Ue,_t,K,H,u,as,o]),oo=b.useMemo(()=>({formatDensity:j,enableAccessibleFieldDOMStructure:w,selectedSections:k,onSelectedSectionsChange:_,fieldRef:oe}),[j,w,k,_,oe]);return{providerProps:{localeText:d,contextValue:Kn,privateContextValue:ss,actionsContextValue:Er,fieldPrivateContextValue:oo,isValidContextValue:ir=>{const xn=i({adapter:ae,value:ir,timezone:O,props:r});return!t.hasError(xn)}},renderCurrentView:()=>{if(ct==null)return null;const ir=p[ct];if(ir==null)return null;const xn=je({},M,{views:h,timezone:O,value:ie,onChange:ne,view:ct,onViewChange:xe,showViewSwitcher:Ve>1,timeViewsCount:Ve},u==="tooltip"?{focusedView:null,onFocusedViewChange:()=>{}}:{focusedView:me,onFocusedViewChange:ve});return c?a.jsx(c,{viewRenderers:p,popperView:ct,rendererProps:xn}):ir(xn)},ownerState:qt}};function Ty(e){return Pr("MuiPickersLayout",e)}const $s=Ur("MuiPickersLayout",["root","landscape","contentWrapper","toolbar","actionBar","tabs","shortcuts"]),bC=["actions"],SC=nt(Ct,{name:"MuiPickersLayout",slot:"ActionBar"})({});function wC(e){const{actions:r}=e,t=ht(e,bC),n=_s(),{clearValue:s,setValueToToday:i,acceptValueChanges:o,cancelValueChanges:l,goToNextStep:c,hasNextStep:d}=ro();if(r==null||r.length===0)return null;const u=r==null?void 0:r.map(f=>{switch(f){case"clear":return a.jsx(ye,{onClick:s,children:n.clearButtonLabel},f);case"cancel":return a.jsx(ye,{onClick:l,children:n.cancelButtonLabel},f);case"accept":return a.jsx(ye,{onClick:o,children:n.okButtonLabel},f);case"today":return a.jsx(ye,{onClick:i,children:n.todayButtonLabel},f);case"next":return a.jsx(ye,{onClick:c,children:n.nextStepButtonLabel},f);case"nextOrAccept":return d?a.jsx(ye,{onClick:c,children:n.nextStepButtonLabel},f):a.jsx(ye,{onClick:o,children:n.okButtonLabel},f);default:return null}});return a.jsx(SC,je({},t,{children:u}))}const jC=b.memo(wC),EC=["items","changeImportance"],kC=["getValue"],AC=nt(Gn,{name:"MuiPickersLayout",slot:"Shortcuts"})({});function TC(e){const{items:r,changeImportance:t="accept"}=e,n=ht(e,EC),{setValue:s}=Ak(),i=TE();if(r==null||r.length===0)return null;const o=r.map(l=>{let{getValue:c}=l,d=ht(l,kC);const u=c({isValid:i});return je({},d,{label:d.label,onClick:()=>{s(u,{changeImportance:t,shortcut:d})},disabled:!i(u)})});return a.jsx(AC,je({dense:!0,sx:[{maxHeight:zf,maxWidth:200,overflow:"auto"},...Array.isArray(n.sx)?n.sx:[n.sx]]},n,{children:o.map(l=>a.jsx(Gr,{children:a.jsx(at,je({},l))},l.id??l.label))}))}const CC=["ownerState"];function DC(e){return e.view!==null}const _C=(e,r)=>{const{pickerOrientation:t}=r;return wr({root:["root",t==="landscape"&&"landscape"],contentWrapper:["contentWrapper"],toolbar:["toolbar"],actionBar:["actionBar"],tabs:["tabs"],landscape:["landscape"],shortcuts:["shortcuts"]},Ty,e)},IC=e=>{const{ownerState:r,defaultActionBarActions:t}=tn(),{view:n}=ro(),s=Qa(),{children:i,slots:o,slotProps:l,classes:c}=e,d=b.useMemo(()=>je({},r,{layoutDirection:s?"rtl":"ltr"}),[r,s]),u=_C(c,d),f=(o==null?void 0:o.actionBar)??jC,h=zt({elementType:f,externalSlotProps:l==null?void 0:l.actionBar,additionalProps:{actions:t},className:u.actionBar,ownerState:d}),x=ht(h,CC),m=a.jsx(f,je({},x)),g=o==null?void 0:o.toolbar,p=zt({elementType:g,externalSlotProps:l==null?void 0:l.toolbar,className:u.toolbar,ownerState:d}),y=DC(p)&&g?a.jsx(g,je({},p)):null,S=i,v=o==null?void 0:o.tabs,E=n&&v?a.jsx(v,je({className:u.tabs},l==null?void 0:l.tabs)):null,C=(o==null?void 0:o.shortcuts)??TC,A=zt({elementType:C,externalSlotProps:l==null?void 0:l.shortcuts,className:u.shortcuts,ownerState:d}),j=n&&C?a.jsx(C,je({},A)):null;return{toolbar:y,content:S,tabs:E,actionBar:m,shortcuts:j,ownerState:d}},FC=IC,MC=(e,r)=>{const{pickerOrientation:t}=r;return wr({root:["root",t==="landscape"&&"landscape"],contentWrapper:["contentWrapper"]},Ty,e)},PC=nt("div",{name:"MuiPickersLayout",slot:"Root"})({display:"grid",gridAutoColumns:"max-content auto max-content",gridAutoRows:"max-content auto max-content",[`& .${$s.actionBar}`]:{gridColumn:"1 / 4",gridRow:3},variants:[{props:{pickerOrientation:"landscape"},style:{[`& .${$s.toolbar}`]:{gridColumn:1,gridRow:"2 / 3"},[`.${$s.shortcuts}`]:{gridColumn:"2 / 4",gridRow:1}}},{props:{pickerOrientation:"landscape",layoutDirection:"rtl"},style:{[`& .${$s.toolbar}`]:{gridColumn:3}}},{props:{pickerOrientation:"portrait"},style:{[`& .${$s.toolbar}`]:{gridColumn:"2 / 4",gridRow:1},[`& .${$s.shortcuts}`]:{gridColumn:1,gridRow:"2 / 3"}}},{props:{pickerOrientation:"portrait",layoutDirection:"rtl"},style:{[`& .${$s.shortcuts}`]:{gridColumn:3}}}]}),NC=nt("div",{name:"MuiPickersLayout",slot:"ContentWrapper"})({gridColumn:"2 / 4",gridRow:2,display:"flex",flexDirection:"column"}),Cy=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiPickersLayout"}),{toolbar:s,content:i,tabs:o,actionBar:l,shortcuts:c,ownerState:d}=FC(n),{orientation:u,variant:f}=ro(),{sx:h,className:x,classes:m}=n,g=MC(m,d);return a.jsxs(PC,{ref:t,sx:h,className:$r(g.root,x),ownerState:d,children:[u==="landscape"?c:s,u==="landscape"?s:c,a.jsx(NC,{className:g.contentWrapper,ownerState:d,children:f==="desktop"?a.jsxs(b.Fragment,{children:[i,o]}):a.jsxs(b.Fragment,{children:[o,i]})}),l]})});function Dy(e){const{steps:r}=e;return $E({steps:r,isViewMatchingStep:(t,n)=>n.views==null||n.views.includes(t),onStepChange:({step:t,defaultView:n,setView:s,view:i,views:o})=>{const l=t.views==null?n:t.views.find(c=>o.includes(c));l!==i&&s(l)}})}const RC=["props","steps"],OC=["ownerState"],LC=e=>{var A;let{props:r,steps:t}=e,n=ht(e,RC);const{slots:s,slotProps:i,label:o,inputRef:l,localeText:c}=r,d=Dy({steps:t}),{providerProps:u,renderCurrentView:f,ownerState:h}=Ay(je({},n,{props:r,localeText:c,autoFocusView:!0,viewContainerRole:"dialog",variant:"desktop",getStepNavigation:d})),x=u.privateContextValue.labelId,m=((A=i==null?void 0:i.toolbar)==null?void 0:A.hidden)??!1,g=s.field,p=zt({elementType:g,externalSlotProps:i==null?void 0:i.field,additionalProps:je({},m&&{id:x}),ownerState:h}),y=ht(p,OC),S=s.layout??Cy;let v=x;m&&(o?v=`${x}-label`:v=void 0);const E=je({},i,{toolbar:je({},i==null?void 0:i.toolbar,{titleId:x}),popper:je({"aria-labelledby":v},i==null?void 0:i.popper)});return{renderPicker:()=>a.jsx(Ug,je({},u,{children:a.jsxs(py,{slots:s,slotProps:E,inputRef:l,children:[a.jsx(g,je({},y)),a.jsx(xC,{slots:s,slotProps:E,children:a.jsx(S,je({},E==null?void 0:E.layout,{slots:s,slotProps:E,children:f()}))})]})}))}},Oi=({view:e,onViewChange:r,views:t,focusedView:n,onFocusedViewChange:s,value:i,defaultValue:o,referenceDate:l,onChange:c,className:d,classes:u,disableFuture:f,disablePast:h,minDate:x,maxDate:m,shouldDisableDate:g,shouldDisableMonth:p,shouldDisableYear:y,reduceAnimations:S,onMonthChange:v,monthsPerRow:E,onYearChange:C,yearsOrder:A,yearsPerRow:j,slots:w,slotProps:k,loading:_,renderLoading:I,disableHighlightToday:D,readOnly:B,disabled:R,showDaysOutsideCurrentMonth:Y,dayOfWeekFormatter:P,sx:M,autoFocus:K,fixedWeekNumber:L,displayWeekNumber:ae,timezone:Z})=>a.jsx(jy,{view:e,onViewChange:r,views:t.filter(om),focusedView:n&&om(n)?n:null,onFocusedViewChange:s,value:i,defaultValue:o,referenceDate:l,onChange:c,className:d,classes:u,disableFuture:f,disablePast:h,minDate:x,maxDate:m,shouldDisableDate:g,shouldDisableMonth:p,shouldDisableYear:y,reduceAnimations:S,onMonthChange:v,monthsPerRow:E,onYearChange:C,yearsOrder:A,yearsPerRow:j,slots:w,slotProps:k,loading:_,renderLoading:I,disableHighlightToday:D,readOnly:B,disabled:R,showDaysOutsideCurrentMonth:Y,dayOfWeekFormatter:P,sx:M,autoFocus:K,fixedWeekNumber:L,displayWeekNumber:ae,timezone:Z}),_y=b.forwardRef(function(r,t){var c;const n=ur(),s=ky(r,"MuiDesktopDatePicker"),i=je({day:Oi,month:Oi,year:Oi},s.viewRenderers),o=je({},s,{closeOnSelect:s.closeOnSelect??!0,viewRenderers:i,format:qf(n,s,!1),yearsPerRow:s.yearsPerRow??4,slots:je({field:xy},s.slots),slotProps:je({},s.slotProps,{field:d=>{var u;return je({},Ko((u=s.slotProps)==null?void 0:u.field,d),Zg(s))},toolbar:je({hidden:!0},(c=s.slotProps)==null?void 0:c.toolbar)})}),{renderPicker:l}=LC({ref:t,props:o,valueManager:Na,valueType:"date",validator:xl,steps:null});return l()});_y.propTypes={autoFocus:Oe.bool,className:Oe.string,closeOnSelect:Oe.bool,dayOfWeekFormatter:Oe.func,defaultValue:Oe.object,disabled:Oe.bool,disableFuture:Oe.bool,disableHighlightToday:Oe.bool,disableOpenPicker:Oe.bool,disablePast:Oe.bool,displayWeekNumber:Oe.bool,enableAccessibleFieldDOMStructure:Oe.any,fixedWeekNumber:Oe.number,format:Oe.string,formatDensity:Oe.oneOf(["dense","spacious"]),inputRef:Pg,label:Oe.node,loading:Oe.bool,localeText:Oe.object,maxDate:Oe.object,minDate:Oe.object,monthsPerRow:Oe.oneOf([3,4]),name:Oe.string,onAccept:Oe.func,onChange:Oe.func,onClose:Oe.func,onError:Oe.func,onMonthChange:Oe.func,onOpen:Oe.func,onSelectedSectionsChange:Oe.func,onViewChange:Oe.func,onYearChange:Oe.func,open:Oe.bool,openTo:Oe.oneOf(["day","month","year"]),orientation:Oe.oneOf(["landscape","portrait"]),readOnly:Oe.bool,reduceAnimations:Oe.bool,referenceDate:Oe.object,renderLoading:Oe.func,selectedSections:Oe.oneOfType([Oe.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),Oe.number]),shouldDisableDate:Oe.func,shouldDisableMonth:Oe.func,shouldDisableYear:Oe.func,showDaysOutsideCurrentMonth:Oe.bool,slotProps:Oe.object,slots:Oe.object,sx:Oe.oneOfType([Oe.arrayOf(Oe.oneOfType([Oe.func,Oe.object,Oe.bool])),Oe.func,Oe.object]),timezone:Oe.string,value:Oe.object,view:Oe.oneOf(["day","month","year"]),viewRenderers:Oe.shape({day:Oe.func,month:Oe.func,year:Oe.func}),views:Oe.arrayOf(Oe.oneOf(["day","month","year"]).isRequired),yearsOrder:Oe.oneOf(["asc","desc"]),yearsPerRow:Oe.oneOf([3,4])};const $C=nt(At)({[`& .${T0.container}`]:{outline:0},[`& .${T0.paper}`]:{outline:0,minWidth:ad}}),BC=nt(Tt)({"&:first-of-type":{padding:0}});function UC(e){const{children:r,slots:t,slotProps:n}=e,{open:s}=ro(),{dismissViews:i,onPopperExited:o}=tn(),l=(t==null?void 0:t.dialog)??$C,c=(t==null?void 0:t.mobileTransition)??Uc;return a.jsx(l,je({open:s,onClose:()=>{i(),o==null||o()}},n==null?void 0:n.dialog,{TransitionComponent:c,TransitionProps:n==null?void 0:n.mobileTransition,PaperComponent:t==null?void 0:t.mobilePaper,PaperProps:n==null?void 0:n.mobilePaper,children:a.jsx(BC,{children:r})}))}const VC=["props","steps"],WC=["ownerState"],HC=e=>{var A;let{props:r,steps:t}=e,n=ht(e,VC);const{slots:s,slotProps:i,label:o,inputRef:l,localeText:c}=r,d=Dy({steps:t}),{providerProps:u,renderCurrentView:f,ownerState:h}=Ay(je({},n,{props:r,localeText:c,autoFocusView:!0,viewContainerRole:"dialog",variant:"mobile",getStepNavigation:d})),x=u.privateContextValue.labelId,m=((A=i==null?void 0:i.toolbar)==null?void 0:A.hidden)??!1,g=s.field,p=zt({elementType:g,externalSlotProps:i==null?void 0:i.field,additionalProps:je({},m&&{id:x}),ownerState:h}),y=ht(p,WC),S=s.layout??Cy;let v=x;m&&(o?v=`${x}-label`:v=void 0);const E=je({},i,{toolbar:je({},i==null?void 0:i.toolbar,{titleId:x}),mobilePaper:je({"aria-labelledby":v},i==null?void 0:i.mobilePaper)});return{renderPicker:()=>a.jsx(Ug,je({},u,{children:a.jsxs(py,{slots:s,slotProps:E,inputRef:l,children:[a.jsx(g,je({},y)),a.jsx(UC,{slots:s,slotProps:E,children:a.jsx(S,je({},E==null?void 0:E.layout,{slots:s,slotProps:E,children:f()}))})]})}))}},Iy=b.forwardRef(function(r,t){var c;const n=ur(),s=ky(r,"MuiMobileDatePicker"),i=je({day:Oi,month:Oi,year:Oi},s.viewRenderers),o=je({},s,{viewRenderers:i,format:qf(n,s,!1),slots:je({field:xy},s.slots),slotProps:je({},s.slotProps,{field:d=>{var u;return je({},Ko((u=s.slotProps)==null?void 0:u.field,d),Zg(s))},toolbar:je({hidden:!1},(c=s.slotProps)==null?void 0:c.toolbar)})}),{renderPicker:l}=HC({ref:t,props:o,valueManager:Na,valueType:"date",validator:xl,steps:null});return l()});Iy.propTypes={autoFocus:Oe.bool,className:Oe.string,closeOnSelect:Oe.bool,dayOfWeekFormatter:Oe.func,defaultValue:Oe.object,disabled:Oe.bool,disableFuture:Oe.bool,disableHighlightToday:Oe.bool,disableOpenPicker:Oe.bool,disablePast:Oe.bool,displayWeekNumber:Oe.bool,enableAccessibleFieldDOMStructure:Oe.any,fixedWeekNumber:Oe.number,format:Oe.string,formatDensity:Oe.oneOf(["dense","spacious"]),inputRef:Pg,label:Oe.node,loading:Oe.bool,localeText:Oe.object,maxDate:Oe.object,minDate:Oe.object,monthsPerRow:Oe.oneOf([3,4]),name:Oe.string,onAccept:Oe.func,onChange:Oe.func,onClose:Oe.func,onError:Oe.func,onMonthChange:Oe.func,onOpen:Oe.func,onSelectedSectionsChange:Oe.func,onViewChange:Oe.func,onYearChange:Oe.func,open:Oe.bool,openTo:Oe.oneOf(["day","month","year"]),orientation:Oe.oneOf(["landscape","portrait"]),readOnly:Oe.bool,reduceAnimations:Oe.bool,referenceDate:Oe.object,renderLoading:Oe.func,selectedSections:Oe.oneOfType([Oe.oneOf(["all","day","empty","hours","meridiem","minutes","month","seconds","weekDay","year"]),Oe.number]),shouldDisableDate:Oe.func,shouldDisableMonth:Oe.func,shouldDisableYear:Oe.func,showDaysOutsideCurrentMonth:Oe.bool,slotProps:Oe.object,slots:Oe.object,sx:Oe.oneOfType([Oe.arrayOf(Oe.oneOfType([Oe.func,Oe.object,Oe.bool])),Oe.func,Oe.object]),timezone:Oe.string,value:Oe.object,view:Oe.oneOf(["day","month","year"]),viewRenderers:Oe.shape({day:Oe.func,month:Oe.func,year:Oe.func}),views:Oe.arrayOf(Oe.oneOf(["day","month","year"]).isRequired),yearsOrder:Oe.oneOf(["asc","desc"]),yearsPerRow:Oe.oneOf([3,4])};const YC=["desktopModeMediaQuery"],un=b.forwardRef(function(r,t){const n=gr({props:r,name:"MuiDatePicker"}),{desktopModeMediaQuery:s=dk}=n,i=ht(n,YC);return sf(s,{defaultMatches:!0})?a.jsx(_y,je({ref:t},i)):a.jsx(Iy,je({ref:t},i))}),Fy=6048e5,zC=864e5,ld=6e4,cd=36e5,GC=1e3,wm=Symbol.for("constructDateFrom");function cr(e,r){return typeof e=="function"?e(r):e&&typeof e=="object"&&wm in e?e[wm](r):e instanceof Date?new e.constructor(r):new Date(r)}function lt(e,r){return cr(r||e,e)}function dd(e,r,t){const n=lt(e,t==null?void 0:t.in);return isNaN(r)?cr((t==null?void 0:t.in)||e,NaN):(r&&n.setDate(n.getDate()+r),n)}function My(e,r,t){return cr((t==null?void 0:t.in)||e,+lt(e)+r)}function qC(e,r,t){return My(e,r*1e3,t)}function XC(e,r,t){const n=lt(e,t==null?void 0:t.in);return n.setTime(n.getTime()+r*ld),n}function KC(e,r,t){return My(e,r*cd,t)}function JC(e,r,t){return dd(e,r*7,t)}function Py(e,r,t){const n=lt(e,t==null?void 0:t.in);if(isNaN(r))return cr((t==null?void 0:t.in)||e,NaN);if(!r)return n;const s=n.getDate(),i=cr((t==null?void 0:t.in)||e,n.getTime());i.setMonth(n.getMonth()+r+1,0);const o=i.getDate();return s>=o?i:(n.setFullYear(i.getFullYear(),i.getMonth(),s),n)}function QC(e,r,t){return Py(e,r*12,t)}function jm(e,r){const t=lt(e,r==null?void 0:r.in);return t.setHours(23,59,59,999),t}let ZC={};function di(){return ZC}function eD(e,r){var l,c,d,u;const t=di(),n=(r==null?void 0:r.weekStartsOn)??((c=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((u=(d=t.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,s=lt(e,r==null?void 0:r.in),i=s.getDay(),o=(i<n?-7:0)+6-(i-n);return s.setDate(s.getDate()+o),s.setHours(23,59,59,999),s}function Em(e,r){const t=lt(e,r==null?void 0:r.in),n=t.getFullYear();return t.setFullYear(n+1,0,0),t.setHours(23,59,59,999),t}const tD={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},rD=(e,r,t)=>{let n;const s=tD[e];return typeof s=="string"?n=s:r===1?n=s.one:n=s.other.replace("{{count}}",r.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function Wd(e){return(r={})=>{const t=r.width?String(r.width):e.defaultWidth;return e.formats[t]||e.formats[e.defaultWidth]}}const nD={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},aD={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},sD={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},iD={date:Wd({formats:nD,defaultWidth:"full"}),time:Wd({formats:aD,defaultWidth:"full"}),dateTime:Wd({formats:sD,defaultWidth:"full"})},oD={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},lD=(e,r,t,n)=>oD[e];function vo(e){return(r,t)=>{const n=t!=null&&t.context?String(t.context):"standalone";let s;if(n==="formatting"&&e.formattingValues){const o=e.defaultFormattingWidth||e.defaultWidth,l=t!=null&&t.width?String(t.width):o;s=e.formattingValues[l]||e.formattingValues[o]}else{const o=e.defaultWidth,l=t!=null&&t.width?String(t.width):e.defaultWidth;s=e.values[l]||e.values[o]}const i=e.argumentCallback?e.argumentCallback(r):r;return s[i]}}const cD={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},dD={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},uD={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},fD={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},hD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},mD={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},pD=(e,r)=>{const t=Number(e),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},xD={ordinalNumber:pD,era:vo({values:cD,defaultWidth:"wide"}),quarter:vo({values:dD,defaultWidth:"wide",argumentCallback:e=>e-1}),month:vo({values:uD,defaultWidth:"wide"}),day:vo({values:fD,defaultWidth:"wide"}),dayPeriod:vo({values:hD,defaultWidth:"wide",formattingValues:mD,defaultFormattingWidth:"wide"})};function bo(e){return(r,t={})=>{const n=t.width,s=n&&e.matchPatterns[n]||e.matchPatterns[e.defaultMatchWidth],i=r.match(s);if(!i)return null;const o=i[0],l=n&&e.parsePatterns[n]||e.parsePatterns[e.defaultParseWidth],c=Array.isArray(l)?yD(l,f=>f.test(o)):gD(l,f=>f.test(o));let d;d=e.valueCallback?e.valueCallback(c):c,d=t.valueCallback?t.valueCallback(d):d;const u=r.slice(o.length);return{value:d,rest:u}}}function gD(e,r){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&r(e[t]))return t}function yD(e,r){for(let t=0;t<e.length;t++)if(r(e[t]))return t}function vD(e){return(r,t={})=>{const n=r.match(e.matchPattern);if(!n)return null;const s=n[0],i=r.match(e.parsePattern);if(!i)return null;let o=e.valueCallback?e.valueCallback(i[0]):i[0];o=t.valueCallback?t.valueCallback(o):o;const l=r.slice(s.length);return{value:o,rest:l}}}const bD=/^(\d+)(th|st|nd|rd)?/i,SD=/\d+/i,wD={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},jD={any:[/^b/i,/^(a|c)/i]},ED={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},kD={any:[/1/i,/2/i,/3/i,/4/i]},AD={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},TD={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},CD={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},DD={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},_D={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ID={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},FD={ordinalNumber:vD({matchPattern:bD,parsePattern:SD,valueCallback:e=>parseInt(e,10)}),era:bo({matchPatterns:wD,defaultMatchWidth:"wide",parsePatterns:jD,defaultParseWidth:"any"}),quarter:bo({matchPatterns:ED,defaultMatchWidth:"wide",parsePatterns:kD,defaultParseWidth:"any",valueCallback:e=>e+1}),month:bo({matchPatterns:AD,defaultMatchWidth:"wide",parsePatterns:TD,defaultParseWidth:"any"}),day:bo({matchPatterns:CD,defaultMatchWidth:"wide",parsePatterns:DD,defaultParseWidth:"any"}),dayPeriod:bo({matchPatterns:_D,defaultMatchWidth:"any",parsePatterns:ID,defaultParseWidth:"any"})},ah={code:"en-US",formatDistance:rD,formatLong:iD,formatRelative:lD,localize:xD,match:FD,options:{weekStartsOn:0,firstWeekContainsDate:1}};function bc(e){const r=lt(e),t=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return t.setUTCFullYear(r.getFullYear()),+e-+t}function yl(e,...r){const t=cr.bind(null,e||r.find(n=>typeof n=="object"));return r.map(t)}function Zo(e,r){const t=lt(e,r==null?void 0:r.in);return t.setHours(0,0,0,0),t}function MD(e,r,t){const[n,s]=yl(t==null?void 0:t.in,e,r),i=Zo(n),o=Zo(s),l=+i-bc(i),c=+o-bc(o);return Math.round((l-c)/zC)}function Ny(e,r){const t=lt(e,r==null?void 0:r.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}function PD(e,r){const t=lt(e,r==null?void 0:r.in);return MD(t,Ny(t))+1}function Ka(e,r){var l,c,d,u;const t=di(),n=(r==null?void 0:r.weekStartsOn)??((c=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((u=(d=t.locale)==null?void 0:d.options)==null?void 0:u.weekStartsOn)??0,s=lt(e,r==null?void 0:r.in),i=s.getDay(),o=(i<n?7:0)+i-n;return s.setDate(s.getDate()-o),s.setHours(0,0,0,0),s}function Xi(e,r){return Ka(e,{...r,weekStartsOn:1})}function Ry(e,r){const t=lt(e,r==null?void 0:r.in),n=t.getFullYear(),s=cr(t,0);s.setFullYear(n+1,0,4),s.setHours(0,0,0,0);const i=Xi(s),o=cr(t,0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);const l=Xi(o);return t.getTime()>=i.getTime()?n+1:t.getTime()>=l.getTime()?n:n-1}function ND(e,r){const t=Ry(e,r),n=cr((r==null?void 0:r.in)||e,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),Xi(n)}function Oy(e,r){const t=lt(e,r==null?void 0:r.in),n=+Xi(t)-+ND(t);return Math.round(n/Fy)+1}function sh(e,r){var u,f,h,x;const t=lt(e,r==null?void 0:r.in),n=t.getFullYear(),s=di(),i=(r==null?void 0:r.firstWeekContainsDate)??((f=(u=r==null?void 0:r.locale)==null?void 0:u.options)==null?void 0:f.firstWeekContainsDate)??s.firstWeekContainsDate??((x=(h=s.locale)==null?void 0:h.options)==null?void 0:x.firstWeekContainsDate)??1,o=cr((r==null?void 0:r.in)||e,0);o.setFullYear(n+1,0,i),o.setHours(0,0,0,0);const l=Ka(o,r),c=cr((r==null?void 0:r.in)||e,0);c.setFullYear(n,0,i),c.setHours(0,0,0,0);const d=Ka(c,r);return+t>=+l?n+1:+t>=+d?n:n-1}function RD(e,r){var l,c,d,u;const t=di(),n=(r==null?void 0:r.firstWeekContainsDate)??((c=(l=r==null?void 0:r.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??t.firstWeekContainsDate??((u=(d=t.locale)==null?void 0:d.options)==null?void 0:u.firstWeekContainsDate)??1,s=sh(e,r),i=cr((r==null?void 0:r.in)||e,0);return i.setFullYear(s,0,n),i.setHours(0,0,0,0),Ka(i,r)}function ih(e,r){const t=lt(e,r==null?void 0:r.in),n=+Ka(t,r)-+RD(t,r);return Math.round(n/Fy)+1}function Xt(e,r){const t=e<0?"-":"",n=Math.abs(e).toString().padStart(r,"0");return t+n}const os={y(e,r){const t=e.getFullYear(),n=t>0?t:1-t;return Xt(r==="yy"?n%100:n,r.length)},M(e,r){const t=e.getMonth();return r==="M"?String(t+1):Xt(t+1,2)},d(e,r){return Xt(e.getDate(),r.length)},a(e,r){const t=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(e,r){return Xt(e.getHours()%12||12,r.length)},H(e,r){return Xt(e.getHours(),r.length)},m(e,r){return Xt(e.getMinutes(),r.length)},s(e,r){return Xt(e.getSeconds(),r.length)},S(e,r){const t=r.length,n=e.getMilliseconds(),s=Math.trunc(n*Math.pow(10,t-3));return Xt(s,r.length)}},Ti={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},km={G:function(e,r,t){const n=e.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return t.era(n,{width:"abbreviated"});case"GGGGG":return t.era(n,{width:"narrow"});case"GGGG":default:return t.era(n,{width:"wide"})}},y:function(e,r,t){if(r==="yo"){const n=e.getFullYear(),s=n>0?n:1-n;return t.ordinalNumber(s,{unit:"year"})}return os.y(e,r)},Y:function(e,r,t,n){const s=sh(e,n),i=s>0?s:1-s;if(r==="YY"){const o=i%100;return Xt(o,2)}return r==="Yo"?t.ordinalNumber(i,{unit:"year"}):Xt(i,r.length)},R:function(e,r){const t=Ry(e);return Xt(t,r.length)},u:function(e,r){const t=e.getFullYear();return Xt(t,r.length)},Q:function(e,r,t){const n=Math.ceil((e.getMonth()+1)/3);switch(r){case"Q":return String(n);case"QQ":return Xt(n,2);case"Qo":return t.ordinalNumber(n,{unit:"quarter"});case"QQQ":return t.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(n,{width:"wide",context:"formatting"})}},q:function(e,r,t){const n=Math.ceil((e.getMonth()+1)/3);switch(r){case"q":return String(n);case"qq":return Xt(n,2);case"qo":return t.ordinalNumber(n,{unit:"quarter"});case"qqq":return t.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(n,{width:"wide",context:"standalone"})}},M:function(e,r,t){const n=e.getMonth();switch(r){case"M":case"MM":return os.M(e,r);case"Mo":return t.ordinalNumber(n+1,{unit:"month"});case"MMM":return t.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(n,{width:"wide",context:"formatting"})}},L:function(e,r,t){const n=e.getMonth();switch(r){case"L":return String(n+1);case"LL":return Xt(n+1,2);case"Lo":return t.ordinalNumber(n+1,{unit:"month"});case"LLL":return t.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(n,{width:"wide",context:"standalone"})}},w:function(e,r,t,n){const s=ih(e,n);return r==="wo"?t.ordinalNumber(s,{unit:"week"}):Xt(s,r.length)},I:function(e,r,t){const n=Oy(e);return r==="Io"?t.ordinalNumber(n,{unit:"week"}):Xt(n,r.length)},d:function(e,r,t){return r==="do"?t.ordinalNumber(e.getDate(),{unit:"date"}):os.d(e,r)},D:function(e,r,t){const n=PD(e);return r==="Do"?t.ordinalNumber(n,{unit:"dayOfYear"}):Xt(n,r.length)},E:function(e,r,t){const n=e.getDay();switch(r){case"E":case"EE":case"EEE":return t.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(n,{width:"short",context:"formatting"});case"EEEE":default:return t.day(n,{width:"wide",context:"formatting"})}},e:function(e,r,t,n){const s=e.getDay(),i=(s-n.weekStartsOn+8)%7||7;switch(r){case"e":return String(i);case"ee":return Xt(i,2);case"eo":return t.ordinalNumber(i,{unit:"day"});case"eee":return t.day(s,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(s,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(s,{width:"short",context:"formatting"});case"eeee":default:return t.day(s,{width:"wide",context:"formatting"})}},c:function(e,r,t,n){const s=e.getDay(),i=(s-n.weekStartsOn+8)%7||7;switch(r){case"c":return String(i);case"cc":return Xt(i,r.length);case"co":return t.ordinalNumber(i,{unit:"day"});case"ccc":return t.day(s,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(s,{width:"narrow",context:"standalone"});case"cccccc":return t.day(s,{width:"short",context:"standalone"});case"cccc":default:return t.day(s,{width:"wide",context:"standalone"})}},i:function(e,r,t){const n=e.getDay(),s=n===0?7:n;switch(r){case"i":return String(s);case"ii":return Xt(s,r.length);case"io":return t.ordinalNumber(s,{unit:"day"});case"iii":return t.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(n,{width:"short",context:"formatting"});case"iiii":default:return t.day(n,{width:"wide",context:"formatting"})}},a:function(e,r,t){const s=e.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},b:function(e,r,t){const n=e.getHours();let s;switch(n===12?s=Ti.noon:n===0?s=Ti.midnight:s=n/12>=1?"pm":"am",r){case"b":case"bb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},B:function(e,r,t){const n=e.getHours();let s;switch(n>=17?s=Ti.evening:n>=12?s=Ti.afternoon:n>=4?s=Ti.morning:s=Ti.night,r){case"B":case"BB":case"BBB":return t.dayPeriod(s,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(s,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(s,{width:"wide",context:"formatting"})}},h:function(e,r,t){if(r==="ho"){let n=e.getHours()%12;return n===0&&(n=12),t.ordinalNumber(n,{unit:"hour"})}return os.h(e,r)},H:function(e,r,t){return r==="Ho"?t.ordinalNumber(e.getHours(),{unit:"hour"}):os.H(e,r)},K:function(e,r,t){const n=e.getHours()%12;return r==="Ko"?t.ordinalNumber(n,{unit:"hour"}):Xt(n,r.length)},k:function(e,r,t){let n=e.getHours();return n===0&&(n=24),r==="ko"?t.ordinalNumber(n,{unit:"hour"}):Xt(n,r.length)},m:function(e,r,t){return r==="mo"?t.ordinalNumber(e.getMinutes(),{unit:"minute"}):os.m(e,r)},s:function(e,r,t){return r==="so"?t.ordinalNumber(e.getSeconds(),{unit:"second"}):os.s(e,r)},S:function(e,r){return os.S(e,r)},X:function(e,r,t){const n=e.getTimezoneOffset();if(n===0)return"Z";switch(r){case"X":return Tm(n);case"XXXX":case"XX":return Ws(n);case"XXXXX":case"XXX":default:return Ws(n,":")}},x:function(e,r,t){const n=e.getTimezoneOffset();switch(r){case"x":return Tm(n);case"xxxx":case"xx":return Ws(n);case"xxxxx":case"xxx":default:return Ws(n,":")}},O:function(e,r,t){const n=e.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Am(n,":");case"OOOO":default:return"GMT"+Ws(n,":")}},z:function(e,r,t){const n=e.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Am(n,":");case"zzzz":default:return"GMT"+Ws(n,":")}},t:function(e,r,t){const n=Math.trunc(+e/1e3);return Xt(n,r.length)},T:function(e,r,t){return Xt(+e,r.length)}};function Am(e,r=""){const t=e>0?"-":"+",n=Math.abs(e),s=Math.trunc(n/60),i=n%60;return i===0?t+String(s):t+String(s)+r+Xt(i,2)}function Tm(e,r){return e%60===0?(e>0?"-":"+")+Xt(Math.abs(e)/60,2):Ws(e,r)}function Ws(e,r=""){const t=e>0?"-":"+",n=Math.abs(e),s=Xt(Math.trunc(n/60),2),i=Xt(n%60,2);return t+s+r+i}const Cm=(e,r)=>{switch(e){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},Ly=(e,r)=>{switch(e){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},OD=(e,r)=>{const t=e.match(/(P+)(p+)?/)||[],n=t[1],s=t[2];if(!s)return Cm(e,r);let i;switch(n){case"P":i=r.dateTime({width:"short"});break;case"PP":i=r.dateTime({width:"medium"});break;case"PPP":i=r.dateTime({width:"long"});break;case"PPPP":default:i=r.dateTime({width:"full"});break}return i.replace("{{date}}",Cm(n,r)).replace("{{time}}",Ly(s,r))},Sc={p:Ly,P:OD},LD=/^D+$/,$D=/^Y+$/,BD=["D","DD","YY","YYYY"];function $y(e){return LD.test(e)}function By(e){return $D.test(e)}function _u(e,r,t){const n=UD(e,r,t);if(console.warn(n),BD.includes(e))throw new RangeError(n)}function UD(e,r,t){const n=e[0]==="Y"?"years":"days of the month";return`Use \`${e.toLowerCase()}\` instead of \`${e}\` (in \`${r}\`) for formatting ${n} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function VD(e){return e instanceof Date||typeof e=="object"&&Object.prototype.toString.call(e)==="[object Date]"}function Uy(e){return!(!VD(e)&&typeof e!="number"||isNaN(+lt(e)))}const WD=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,HD=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,YD=/^'([^]*?)'?$/,zD=/''/g,GD=/[a-zA-Z]/;function xs(e,r,t){var u,f,h,x,m,g,p,y;const n=di(),s=(t==null?void 0:t.locale)??n.locale??ah,i=(t==null?void 0:t.firstWeekContainsDate)??((f=(u=t==null?void 0:t.locale)==null?void 0:u.options)==null?void 0:f.firstWeekContainsDate)??n.firstWeekContainsDate??((x=(h=n.locale)==null?void 0:h.options)==null?void 0:x.firstWeekContainsDate)??1,o=(t==null?void 0:t.weekStartsOn)??((g=(m=t==null?void 0:t.locale)==null?void 0:m.options)==null?void 0:g.weekStartsOn)??n.weekStartsOn??((y=(p=n.locale)==null?void 0:p.options)==null?void 0:y.weekStartsOn)??0,l=lt(e,t==null?void 0:t.in);if(!Uy(l))throw new RangeError("Invalid time value");let c=r.match(HD).map(S=>{const v=S[0];if(v==="p"||v==="P"){const E=Sc[v];return E(S,s.formatLong)}return S}).join("").match(WD).map(S=>{if(S==="''")return{isToken:!1,value:"'"};const v=S[0];if(v==="'")return{isToken:!1,value:qD(S)};if(km[v])return{isToken:!0,value:S};if(v.match(GD))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:S}});s.localize.preprocessor&&(c=s.localize.preprocessor(l,c));const d={firstWeekContainsDate:i,weekStartsOn:o,locale:s};return c.map(S=>{if(!S.isToken)return S.value;const v=S.value;(!(t!=null&&t.useAdditionalWeekYearTokens)&&By(v)||!(t!=null&&t.useAdditionalDayOfYearTokens)&&$y(v))&&_u(v,r,String(e));const E=km[v[0]];return E(l,v,s.localize,d)}).join("")}function qD(e){const r=e.match(YD);return r?r[1].replace(zD,"'"):e}function XD(e,r){return lt(e,r==null?void 0:r.in).getDate()}function Vy(e,r){const t=lt(e,r==null?void 0:r.in),n=t.getFullYear(),s=t.getMonth(),i=cr(t,0);return i.setFullYear(n,s+1,0),i.setHours(0,0,0,0),i.getDate()}function KD(e,r){return lt(e,r==null?void 0:r.in).getHours()}function JD(e,r){return lt(e,r==null?void 0:r.in).getMinutes()}function QD(e,r){return lt(e,r==null?void 0:r.in).getMonth()}function ZD(e){return lt(e).getSeconds()}function e_(e){return lt(e).getMilliseconds()}function t_(e,r){return lt(e,r==null?void 0:r.in).getFullYear()}function Hd(e,r){return+lt(e)>+lt(r)}function Yd(e,r){return+lt(e)<+lt(r)}function r_(e,r){return+lt(e)==+lt(r)}function n_(e,r,t){const[n,s]=yl(t==null?void 0:t.in,e,r);return+Zo(n)==+Zo(s)}function a_(e,r,t){const[n,s]=yl(t==null?void 0:t.in,e,r);return n.getFullYear()===s.getFullYear()}function s_(e,r,t){const[n,s]=yl(t==null?void 0:t.in,e,r);return n.getFullYear()===s.getFullYear()&&n.getMonth()===s.getMonth()}function Dm(e,r){const t=lt(e,r==null?void 0:r.in);return t.setMinutes(0,0,0),t}function i_(e,r,t){const[n,s]=yl(t==null?void 0:t.in,e,r);return+Dm(n)==+Dm(s)}function o_(){return Object.assign({},di())}function l_(e,r){const t=c_(r)?new r(0):cr(r,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t.setHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),t}function c_(e){var r;return typeof e=="function"&&((r=e.prototype)==null?void 0:r.constructor)===e}const d_=10;class Wy{constructor(){Qe(this,"subPriority",0)}validate(r,t){return!0}}class u_ extends Wy{constructor(r,t,n,s,i){super(),this.value=r,this.validateValue=t,this.setValue=n,this.priority=s,i&&(this.subPriority=i)}validate(r,t){return this.validateValue(r,this.value,t)}set(r,t,n){return this.setValue(r,t,this.value,n)}}class f_ extends Wy{constructor(t,n){super();Qe(this,"priority",d_);Qe(this,"subPriority",-1);this.context=t||(s=>cr(n,s))}set(t,n){return n.timestampIsSet?t:cr(t,l_(t,this.context))}}class Yt{run(r,t,n,s){const i=this.parse(r,t,n,s);return i?{setter:new u_(i.value,this.validate,this.set,this.priority,this.subPriority),rest:i.rest}:null}validate(r,t,n){return!0}}class h_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",140);Qe(this,"incompatibleTokens",["R","u","t","T"])}parse(t,n,s){switch(n){case"G":case"GG":case"GGG":return s.era(t,{width:"abbreviated"})||s.era(t,{width:"narrow"});case"GGGGG":return s.era(t,{width:"narrow"});case"GGGG":default:return s.era(t,{width:"wide"})||s.era(t,{width:"abbreviated"})||s.era(t,{width:"narrow"})}}set(t,n,s){return n.era=s,t.setFullYear(s,0,1),t.setHours(0,0,0,0),t}}const Tr={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},_a={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Cr(e,r){return e&&{value:r(e.value),rest:e.rest}}function xr(e,r){const t=r.match(e);return t?{value:parseInt(t[0],10),rest:r.slice(t[0].length)}:null}function Ia(e,r){const t=r.match(e);if(!t)return null;if(t[0]==="Z")return{value:0,rest:r.slice(1)};const n=t[1]==="+"?1:-1,s=t[2]?parseInt(t[2],10):0,i=t[3]?parseInt(t[3],10):0,o=t[5]?parseInt(t[5],10):0;return{value:n*(s*cd+i*ld+o*GC),rest:r.slice(t[0].length)}}function Hy(e){return xr(Tr.anyDigitsSigned,e)}function br(e,r){switch(e){case 1:return xr(Tr.singleDigit,r);case 2:return xr(Tr.twoDigits,r);case 3:return xr(Tr.threeDigits,r);case 4:return xr(Tr.fourDigits,r);default:return xr(new RegExp("^\\d{1,"+e+"}"),r)}}function wc(e,r){switch(e){case 1:return xr(Tr.singleDigitSigned,r);case 2:return xr(Tr.twoDigitsSigned,r);case 3:return xr(Tr.threeDigitsSigned,r);case 4:return xr(Tr.fourDigitsSigned,r);default:return xr(new RegExp("^-?\\d{1,"+e+"}"),r)}}function oh(e){switch(e){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function Yy(e,r){const t=r>0,n=t?r:1-r;let s;if(n<=50)s=e||100;else{const i=n+50,o=Math.trunc(i/100)*100,l=e>=i%100;s=e+o-(l?100:0)}return t?s:1-s}function zy(e){return e%400===0||e%4===0&&e%100!==0}class m_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",130);Qe(this,"incompatibleTokens",["Y","R","u","w","I","i","e","c","t","T"])}parse(t,n,s){const i=o=>({year:o,isTwoDigitYear:n==="yy"});switch(n){case"y":return Cr(br(4,t),i);case"yo":return Cr(s.ordinalNumber(t,{unit:"year"}),i);default:return Cr(br(n.length,t),i)}}validate(t,n){return n.isTwoDigitYear||n.year>0}set(t,n,s){const i=t.getFullYear();if(s.isTwoDigitYear){const l=Yy(s.year,i);return t.setFullYear(l,0,1),t.setHours(0,0,0,0),t}const o=!("era"in n)||n.era===1?s.year:1-s.year;return t.setFullYear(o,0,1),t.setHours(0,0,0,0),t}}class p_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",130);Qe(this,"incompatibleTokens",["y","R","u","Q","q","M","L","I","d","D","i","t","T"])}parse(t,n,s){const i=o=>({year:o,isTwoDigitYear:n==="YY"});switch(n){case"Y":return Cr(br(4,t),i);case"Yo":return Cr(s.ordinalNumber(t,{unit:"year"}),i);default:return Cr(br(n.length,t),i)}}validate(t,n){return n.isTwoDigitYear||n.year>0}set(t,n,s,i){const o=sh(t,i);if(s.isTwoDigitYear){const c=Yy(s.year,o);return t.setFullYear(c,0,i.firstWeekContainsDate),t.setHours(0,0,0,0),Ka(t,i)}const l=!("era"in n)||n.era===1?s.year:1-s.year;return t.setFullYear(l,0,i.firstWeekContainsDate),t.setHours(0,0,0,0),Ka(t,i)}}class x_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",130);Qe(this,"incompatibleTokens",["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"])}parse(t,n){return wc(n==="R"?4:n.length,t)}set(t,n,s){const i=cr(t,0);return i.setFullYear(s,0,4),i.setHours(0,0,0,0),Xi(i)}}class g_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",130);Qe(this,"incompatibleTokens",["G","y","Y","R","w","I","i","e","c","t","T"])}parse(t,n){return wc(n==="u"?4:n.length,t)}set(t,n,s){return t.setFullYear(s,0,1),t.setHours(0,0,0,0),t}}class y_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",120);Qe(this,"incompatibleTokens",["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"])}parse(t,n,s){switch(n){case"Q":case"QQ":return br(n.length,t);case"Qo":return s.ordinalNumber(t,{unit:"quarter"});case"QQQ":return s.quarter(t,{width:"abbreviated",context:"formatting"})||s.quarter(t,{width:"narrow",context:"formatting"});case"QQQQQ":return s.quarter(t,{width:"narrow",context:"formatting"});case"QQQQ":default:return s.quarter(t,{width:"wide",context:"formatting"})||s.quarter(t,{width:"abbreviated",context:"formatting"})||s.quarter(t,{width:"narrow",context:"formatting"})}}validate(t,n){return n>=1&&n<=4}set(t,n,s){return t.setMonth((s-1)*3,1),t.setHours(0,0,0,0),t}}class v_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",120);Qe(this,"incompatibleTokens",["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"])}parse(t,n,s){switch(n){case"q":case"qq":return br(n.length,t);case"qo":return s.ordinalNumber(t,{unit:"quarter"});case"qqq":return s.quarter(t,{width:"abbreviated",context:"standalone"})||s.quarter(t,{width:"narrow",context:"standalone"});case"qqqqq":return s.quarter(t,{width:"narrow",context:"standalone"});case"qqqq":default:return s.quarter(t,{width:"wide",context:"standalone"})||s.quarter(t,{width:"abbreviated",context:"standalone"})||s.quarter(t,{width:"narrow",context:"standalone"})}}validate(t,n){return n>=1&&n<=4}set(t,n,s){return t.setMonth((s-1)*3,1),t.setHours(0,0,0,0),t}}class b_ extends Yt{constructor(){super(...arguments);Qe(this,"incompatibleTokens",["Y","R","q","Q","L","w","I","D","i","e","c","t","T"]);Qe(this,"priority",110)}parse(t,n,s){const i=o=>o-1;switch(n){case"M":return Cr(xr(Tr.month,t),i);case"MM":return Cr(br(2,t),i);case"Mo":return Cr(s.ordinalNumber(t,{unit:"month"}),i);case"MMM":return s.month(t,{width:"abbreviated",context:"formatting"})||s.month(t,{width:"narrow",context:"formatting"});case"MMMMM":return s.month(t,{width:"narrow",context:"formatting"});case"MMMM":default:return s.month(t,{width:"wide",context:"formatting"})||s.month(t,{width:"abbreviated",context:"formatting"})||s.month(t,{width:"narrow",context:"formatting"})}}validate(t,n){return n>=0&&n<=11}set(t,n,s){return t.setMonth(s,1),t.setHours(0,0,0,0),t}}class S_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",110);Qe(this,"incompatibleTokens",["Y","R","q","Q","M","w","I","D","i","e","c","t","T"])}parse(t,n,s){const i=o=>o-1;switch(n){case"L":return Cr(xr(Tr.month,t),i);case"LL":return Cr(br(2,t),i);case"Lo":return Cr(s.ordinalNumber(t,{unit:"month"}),i);case"LLL":return s.month(t,{width:"abbreviated",context:"standalone"})||s.month(t,{width:"narrow",context:"standalone"});case"LLLLL":return s.month(t,{width:"narrow",context:"standalone"});case"LLLL":default:return s.month(t,{width:"wide",context:"standalone"})||s.month(t,{width:"abbreviated",context:"standalone"})||s.month(t,{width:"narrow",context:"standalone"})}}validate(t,n){return n>=0&&n<=11}set(t,n,s){return t.setMonth(s,1),t.setHours(0,0,0,0),t}}function w_(e,r,t){const n=lt(e,t==null?void 0:t.in),s=ih(n,t)-r;return n.setDate(n.getDate()-s*7),lt(n,t==null?void 0:t.in)}class j_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",100);Qe(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","i","t","T"])}parse(t,n,s){switch(n){case"w":return xr(Tr.week,t);case"wo":return s.ordinalNumber(t,{unit:"week"});default:return br(n.length,t)}}validate(t,n){return n>=1&&n<=53}set(t,n,s,i){return Ka(w_(t,s,i),i)}}function E_(e,r,t){const n=lt(e,t==null?void 0:t.in),s=Oy(n,t)-r;return n.setDate(n.getDate()-s*7),n}class k_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",100);Qe(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"])}parse(t,n,s){switch(n){case"I":return xr(Tr.week,t);case"Io":return s.ordinalNumber(t,{unit:"week"});default:return br(n.length,t)}}validate(t,n){return n>=1&&n<=53}set(t,n,s){return Xi(E_(t,s))}}const A_=[31,28,31,30,31,30,31,31,30,31,30,31],T_=[31,29,31,30,31,30,31,31,30,31,30,31];class C_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",90);Qe(this,"subPriority",1);Qe(this,"incompatibleTokens",["Y","R","q","Q","w","I","D","i","e","c","t","T"])}parse(t,n,s){switch(n){case"d":return xr(Tr.date,t);case"do":return s.ordinalNumber(t,{unit:"date"});default:return br(n.length,t)}}validate(t,n){const s=t.getFullYear(),i=zy(s),o=t.getMonth();return i?n>=1&&n<=T_[o]:n>=1&&n<=A_[o]}set(t,n,s){return t.setDate(s),t.setHours(0,0,0,0),t}}class D_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",90);Qe(this,"subpriority",1);Qe(this,"incompatibleTokens",["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"])}parse(t,n,s){switch(n){case"D":case"DD":return xr(Tr.dayOfYear,t);case"Do":return s.ordinalNumber(t,{unit:"date"});default:return br(n.length,t)}}validate(t,n){const s=t.getFullYear();return zy(s)?n>=1&&n<=366:n>=1&&n<=365}set(t,n,s){return t.setMonth(0,s),t.setHours(0,0,0,0),t}}function lh(e,r,t){var f,h,x,m;const n=di(),s=(t==null?void 0:t.weekStartsOn)??((h=(f=t==null?void 0:t.locale)==null?void 0:f.options)==null?void 0:h.weekStartsOn)??n.weekStartsOn??((m=(x=n.locale)==null?void 0:x.options)==null?void 0:m.weekStartsOn)??0,i=lt(e,t==null?void 0:t.in),o=i.getDay(),c=(r%7+7)%7,d=7-s,u=r<0||r>6?r-(o+d)%7:(c+d)%7-(o+d)%7;return dd(i,u,t)}class __ extends Yt{constructor(){super(...arguments);Qe(this,"priority",90);Qe(this,"incompatibleTokens",["D","i","e","c","t","T"])}parse(t,n,s){switch(n){case"E":case"EE":case"EEE":return s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"EEEEE":return s.day(t,{width:"narrow",context:"formatting"});case"EEEEEE":return s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"EEEE":default:return s.day(t,{width:"wide",context:"formatting"})||s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"})}}validate(t,n){return n>=0&&n<=6}set(t,n,s,i){return t=lh(t,s,i),t.setHours(0,0,0,0),t}}class I_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",90);Qe(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"])}parse(t,n,s,i){const o=l=>{const c=Math.floor((l-1)/7)*7;return(l+i.weekStartsOn+6)%7+c};switch(n){case"e":case"ee":return Cr(br(n.length,t),o);case"eo":return Cr(s.ordinalNumber(t,{unit:"day"}),o);case"eee":return s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"eeeee":return s.day(t,{width:"narrow",context:"formatting"});case"eeeeee":return s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"});case"eeee":default:return s.day(t,{width:"wide",context:"formatting"})||s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"})}}validate(t,n){return n>=0&&n<=6}set(t,n,s,i){return t=lh(t,s,i),t.setHours(0,0,0,0),t}}class F_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",90);Qe(this,"incompatibleTokens",["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"])}parse(t,n,s,i){const o=l=>{const c=Math.floor((l-1)/7)*7;return(l+i.weekStartsOn+6)%7+c};switch(n){case"c":case"cc":return Cr(br(n.length,t),o);case"co":return Cr(s.ordinalNumber(t,{unit:"day"}),o);case"ccc":return s.day(t,{width:"abbreviated",context:"standalone"})||s.day(t,{width:"short",context:"standalone"})||s.day(t,{width:"narrow",context:"standalone"});case"ccccc":return s.day(t,{width:"narrow",context:"standalone"});case"cccccc":return s.day(t,{width:"short",context:"standalone"})||s.day(t,{width:"narrow",context:"standalone"});case"cccc":default:return s.day(t,{width:"wide",context:"standalone"})||s.day(t,{width:"abbreviated",context:"standalone"})||s.day(t,{width:"short",context:"standalone"})||s.day(t,{width:"narrow",context:"standalone"})}}validate(t,n){return n>=0&&n<=6}set(t,n,s,i){return t=lh(t,s,i),t.setHours(0,0,0,0),t}}function M_(e,r){const t=lt(e,r==null?void 0:r.in).getDay();return t===0?7:t}function P_(e,r,t){const n=lt(e,t==null?void 0:t.in),s=M_(n,t),i=r-s;return dd(n,i,t)}class N_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",90);Qe(this,"incompatibleTokens",["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"])}parse(t,n,s){const i=o=>o===0?7:o;switch(n){case"i":case"ii":return br(n.length,t);case"io":return s.ordinalNumber(t,{unit:"day"});case"iii":return Cr(s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"}),i);case"iiiii":return Cr(s.day(t,{width:"narrow",context:"formatting"}),i);case"iiiiii":return Cr(s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"}),i);case"iiii":default:return Cr(s.day(t,{width:"wide",context:"formatting"})||s.day(t,{width:"abbreviated",context:"formatting"})||s.day(t,{width:"short",context:"formatting"})||s.day(t,{width:"narrow",context:"formatting"}),i)}}validate(t,n){return n>=1&&n<=7}set(t,n,s){return t=P_(t,s),t.setHours(0,0,0,0),t}}class R_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",80);Qe(this,"incompatibleTokens",["b","B","H","k","t","T"])}parse(t,n,s){switch(n){case"a":case"aa":case"aaa":return s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaaa":return s.dayPeriod(t,{width:"narrow",context:"formatting"});case"aaaa":default:return s.dayPeriod(t,{width:"wide",context:"formatting"})||s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,n,s){return t.setHours(oh(s),0,0,0),t}}class O_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",80);Qe(this,"incompatibleTokens",["a","B","H","k","t","T"])}parse(t,n,s){switch(n){case"b":case"bb":case"bbb":return s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbbb":return s.dayPeriod(t,{width:"narrow",context:"formatting"});case"bbbb":default:return s.dayPeriod(t,{width:"wide",context:"formatting"})||s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,n,s){return t.setHours(oh(s),0,0,0),t}}class L_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",80);Qe(this,"incompatibleTokens",["a","b","t","T"])}parse(t,n,s){switch(n){case"B":case"BB":case"BBB":return s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBBB":return s.dayPeriod(t,{width:"narrow",context:"formatting"});case"BBBB":default:return s.dayPeriod(t,{width:"wide",context:"formatting"})||s.dayPeriod(t,{width:"abbreviated",context:"formatting"})||s.dayPeriod(t,{width:"narrow",context:"formatting"})}}set(t,n,s){return t.setHours(oh(s),0,0,0),t}}class $_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",70);Qe(this,"incompatibleTokens",["H","K","k","t","T"])}parse(t,n,s){switch(n){case"h":return xr(Tr.hour12h,t);case"ho":return s.ordinalNumber(t,{unit:"hour"});default:return br(n.length,t)}}validate(t,n){return n>=1&&n<=12}set(t,n,s){const i=t.getHours()>=12;return i&&s<12?t.setHours(s+12,0,0,0):!i&&s===12?t.setHours(0,0,0,0):t.setHours(s,0,0,0),t}}class B_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",70);Qe(this,"incompatibleTokens",["a","b","h","K","k","t","T"])}parse(t,n,s){switch(n){case"H":return xr(Tr.hour23h,t);case"Ho":return s.ordinalNumber(t,{unit:"hour"});default:return br(n.length,t)}}validate(t,n){return n>=0&&n<=23}set(t,n,s){return t.setHours(s,0,0,0),t}}class U_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",70);Qe(this,"incompatibleTokens",["h","H","k","t","T"])}parse(t,n,s){switch(n){case"K":return xr(Tr.hour11h,t);case"Ko":return s.ordinalNumber(t,{unit:"hour"});default:return br(n.length,t)}}validate(t,n){return n>=0&&n<=11}set(t,n,s){return t.getHours()>=12&&s<12?t.setHours(s+12,0,0,0):t.setHours(s,0,0,0),t}}class V_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",70);Qe(this,"incompatibleTokens",["a","b","h","H","K","t","T"])}parse(t,n,s){switch(n){case"k":return xr(Tr.hour24h,t);case"ko":return s.ordinalNumber(t,{unit:"hour"});default:return br(n.length,t)}}validate(t,n){return n>=1&&n<=24}set(t,n,s){const i=s<=24?s%24:s;return t.setHours(i,0,0,0),t}}class W_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",60);Qe(this,"incompatibleTokens",["t","T"])}parse(t,n,s){switch(n){case"m":return xr(Tr.minute,t);case"mo":return s.ordinalNumber(t,{unit:"minute"});default:return br(n.length,t)}}validate(t,n){return n>=0&&n<=59}set(t,n,s){return t.setMinutes(s,0,0),t}}class H_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",50);Qe(this,"incompatibleTokens",["t","T"])}parse(t,n,s){switch(n){case"s":return xr(Tr.second,t);case"so":return s.ordinalNumber(t,{unit:"second"});default:return br(n.length,t)}}validate(t,n){return n>=0&&n<=59}set(t,n,s){return t.setSeconds(s,0),t}}class Y_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",30);Qe(this,"incompatibleTokens",["t","T"])}parse(t,n){const s=i=>Math.trunc(i*Math.pow(10,-n.length+3));return Cr(br(n.length,t),s)}set(t,n,s){return t.setMilliseconds(s),t}}class z_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",10);Qe(this,"incompatibleTokens",["t","T","x"])}parse(t,n){switch(n){case"X":return Ia(_a.basicOptionalMinutes,t);case"XX":return Ia(_a.basic,t);case"XXXX":return Ia(_a.basicOptionalSeconds,t);case"XXXXX":return Ia(_a.extendedOptionalSeconds,t);case"XXX":default:return Ia(_a.extended,t)}}set(t,n,s){return n.timestampIsSet?t:cr(t,t.getTime()-bc(t)-s)}}class G_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",10);Qe(this,"incompatibleTokens",["t","T","X"])}parse(t,n){switch(n){case"x":return Ia(_a.basicOptionalMinutes,t);case"xx":return Ia(_a.basic,t);case"xxxx":return Ia(_a.basicOptionalSeconds,t);case"xxxxx":return Ia(_a.extendedOptionalSeconds,t);case"xxx":default:return Ia(_a.extended,t)}}set(t,n,s){return n.timestampIsSet?t:cr(t,t.getTime()-bc(t)-s)}}class q_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",40);Qe(this,"incompatibleTokens","*")}parse(t){return Hy(t)}set(t,n,s){return[cr(t,s*1e3),{timestampIsSet:!0}]}}class X_ extends Yt{constructor(){super(...arguments);Qe(this,"priority",20);Qe(this,"incompatibleTokens","*")}parse(t){return Hy(t)}set(t,n,s){return[cr(t,s),{timestampIsSet:!0}]}}const K_={G:new h_,y:new m_,Y:new p_,R:new x_,u:new g_,Q:new y_,q:new v_,M:new b_,L:new S_,w:new j_,I:new k_,d:new C_,D:new D_,E:new __,e:new I_,c:new F_,i:new N_,a:new R_,b:new O_,B:new L_,h:new $_,H:new B_,K:new U_,k:new V_,m:new W_,s:new H_,S:new Y_,X:new z_,x:new G_,t:new q_,T:new X_},J_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Q_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Z_=/^'([^]*?)'?$/,eI=/''/g,tI=/\S/,rI=/[a-zA-Z]/;function nI(e,r,t,n){var p,y,S,v,E,C,A,j;const s=()=>cr((n==null?void 0:n.in)||t,NaN),i=o_(),o=(n==null?void 0:n.locale)??i.locale??ah,l=(n==null?void 0:n.firstWeekContainsDate)??((y=(p=n==null?void 0:n.locale)==null?void 0:p.options)==null?void 0:y.firstWeekContainsDate)??i.firstWeekContainsDate??((v=(S=i.locale)==null?void 0:S.options)==null?void 0:v.firstWeekContainsDate)??1,c=(n==null?void 0:n.weekStartsOn)??((C=(E=n==null?void 0:n.locale)==null?void 0:E.options)==null?void 0:C.weekStartsOn)??i.weekStartsOn??((j=(A=i.locale)==null?void 0:A.options)==null?void 0:j.weekStartsOn)??0;if(!r)return e?s():lt(t,n==null?void 0:n.in);const d={firstWeekContainsDate:l,weekStartsOn:c,locale:o},u=[new f_(n==null?void 0:n.in,t)],f=r.match(Q_).map(w=>{const k=w[0];if(k in Sc){const _=Sc[k];return _(w,o.formatLong)}return w}).join("").match(J_),h=[];for(let w of f){!(n!=null&&n.useAdditionalWeekYearTokens)&&By(w)&&_u(w,r,e),!(n!=null&&n.useAdditionalDayOfYearTokens)&&$y(w)&&_u(w,r,e);const k=w[0],_=K_[k];if(_){const{incompatibleTokens:I}=_;if(Array.isArray(I)){const B=h.find(R=>I.includes(R.token)||R.token===k);if(B)throw new RangeError(`The format string mustn't contain \`${B.fullToken}\` and \`${w}\` at the same time`)}else if(_.incompatibleTokens==="*"&&h.length>0)throw new RangeError(`The format string mustn't contain \`${w}\` and any other token at the same time`);h.push({token:k,fullToken:w});const D=_.run(e,w,o.match,d);if(!D)return s();u.push(D.setter),e=D.rest}else{if(k.match(rI))throw new RangeError("Format string contains an unescaped latin alphabet character `"+k+"`");if(w==="''"?w="'":k==="'"&&(w=aI(w)),e.indexOf(w)===0)e=e.slice(w.length);else return s()}}if(e.length>0&&tI.test(e))return s();const x=u.map(w=>w.priority).sort((w,k)=>k-w).filter((w,k,_)=>_.indexOf(w)===k).map(w=>u.filter(k=>k.priority===w).sort((k,_)=>_.subPriority-k.subPriority)).map(w=>w[0]);let m=lt(t,n==null?void 0:n.in);if(isNaN(+m))return s();const g={};for(const w of x){if(!w.validate(m,d))return s();const k=w.set(m,g,d);Array.isArray(k)?(m=k[0],Object.assign(g,k[1])):m=k}return m}function aI(e){return e.match(Z_)[1].replace(eI,"'")}function sI(e,r,t){const n=lt(e,t==null?void 0:t.in);return n.setDate(r),n}function iI(e,r,t){const n=lt(e,t==null?void 0:t.in);return n.setHours(r),n}function oI(e,r,t){const n=lt(e,t==null?void 0:t.in);return n.setMinutes(r),n}function lI(e,r,t){const n=lt(e,t==null?void 0:t.in),s=n.getFullYear(),i=n.getDate(),o=cr((t==null?void 0:t.in)||e,0);o.setFullYear(s,r,15),o.setHours(0,0,0,0);const l=Vy(o);return n.setMonth(r,Math.min(i,l)),n}function cI(e,r,t){const n=lt(e,t==null?void 0:t.in);return n.setSeconds(r),n}function dI(e,r,t){const n=lt(e,t==null?void 0:t.in);return n.setMilliseconds(r),n}function uI(e,r,t){const n=lt(e,t==null?void 0:t.in);return isNaN(+n)?cr((t==null?void 0:t.in)||e,NaN):(n.setFullYear(r),n)}function fI(e,r){const t=lt(e,r==null?void 0:r.in);return t.setDate(1),t.setHours(0,0,0,0),t}function hI(e,r){const t=lt(e,r==null?void 0:r.in),n=t.getMonth();return t.setFullYear(t.getFullYear(),n+1,0),t.setHours(23,59,59,999),t}function mI(e,r,t){const n=+lt(e,t==null?void 0:t.in),[s,i]=[+lt(r.start,t==null?void 0:t.in),+lt(r.end,t==null?void 0:t.in)].sort((o,l)=>o-l);return n>=s&&n<=i}const pI={y:{sectionType:"year",contentType:"digit",maxLength:4},yy:"year",yyy:{sectionType:"year",contentType:"digit",maxLength:4},yyyy:"year",M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMMM:{sectionType:"month",contentType:"letter"},MMM:{sectionType:"month",contentType:"letter"},L:{sectionType:"month",contentType:"digit",maxLength:2},LL:"month",LLL:{sectionType:"month",contentType:"letter"},LLLL:{sectionType:"month",contentType:"letter"},d:{sectionType:"day",contentType:"digit",maxLength:2},dd:"day",do:{sectionType:"day",contentType:"digit-with-letter"},E:{sectionType:"weekDay",contentType:"letter"},EE:{sectionType:"weekDay",contentType:"letter"},EEE:{sectionType:"weekDay",contentType:"letter"},EEEE:{sectionType:"weekDay",contentType:"letter"},EEEEE:{sectionType:"weekDay",contentType:"letter"},i:{sectionType:"weekDay",contentType:"digit",maxLength:1},ii:"weekDay",iii:{sectionType:"weekDay",contentType:"letter"},iiii:{sectionType:"weekDay",contentType:"letter"},e:{sectionType:"weekDay",contentType:"digit",maxLength:1},ee:"weekDay",eee:{sectionType:"weekDay",contentType:"letter"},eeee:{sectionType:"weekDay",contentType:"letter"},eeeee:{sectionType:"weekDay",contentType:"letter"},eeeeee:{sectionType:"weekDay",contentType:"letter"},c:{sectionType:"weekDay",contentType:"digit",maxLength:1},cc:"weekDay",ccc:{sectionType:"weekDay",contentType:"letter"},cccc:{sectionType:"weekDay",contentType:"letter"},ccccc:{sectionType:"weekDay",contentType:"letter"},cccccc:{sectionType:"weekDay",contentType:"letter"},a:"meridiem",aa:"meridiem",aaa:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},xI={year:"yyyy",month:"LLLL",monthShort:"MMM",dayOfMonth:"d",dayOfMonthFull:"do",weekday:"EEEE",weekdayShort:"EEEEEE",hours24h:"HH",hours12h:"hh",meridiem:"aa",minutes:"mm",seconds:"ss",fullDate:"PP",keyboardDate:"P",shortDate:"MMM d",normalDate:"d MMMM",normalDateWithWeekday:"EEE, MMM d",fullTime12h:"hh:mm aa",fullTime24h:"HH:mm",keyboardDateTime12h:"P hh:mm aa",keyboardDateTime24h:"P HH:mm"};class gI{constructor(r){this.isMUIAdapter=!0,this.isTimezoneCompatible=!1,this.lib=void 0,this.locale=void 0,this.formats=void 0,this.formatTokenMap=pI,this.escapedCharacters={start:"'",end:"'"},this.longFormatters=void 0,this.date=o=>typeof o>"u"?new Date:o===null?null:new Date(o),this.getInvalidDate=()=>new Date("Invalid Date"),this.getTimezone=()=>"default",this.setTimezone=o=>o,this.toJsDate=o=>o,this.getCurrentLocaleCode=()=>this.locale.code,this.is12HourCycleInCurrentLocale=()=>/a/.test(this.locale.formatLong.time({width:"short"})),this.expandFormat=o=>{const l=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g;return o.match(l).map(c=>{const d=c[0];if(d==="p"||d==="P"){const u=this.longFormatters[d];return u(c,this.locale.formatLong)}return c}).join("")},this.formatNumber=o=>o,this.getDayOfWeek=o=>o.getDay()+1;const{locale:t,formats:n,longFormatters:s,lib:i}=r;this.locale=t,this.formats=je({},xI,n),this.longFormatters=s,this.lib=i||"date-fns"}}class yI extends gI{constructor({locale:r,formats:t}={}){super({locale:r??ah,formats:t,longFormatters:Sc}),this.parse=(n,s)=>n===""?null:nI(n,s,new Date,{locale:this.locale}),this.isValid=n=>n==null?!1:Uy(n),this.format=(n,s)=>this.formatByString(n,this.formats[s]),this.formatByString=(n,s)=>xs(n,s,{locale:this.locale}),this.isEqual=(n,s)=>n===null&&s===null?!0:n===null||s===null?!1:r_(n,s),this.isSameYear=(n,s)=>a_(n,s),this.isSameMonth=(n,s)=>s_(n,s),this.isSameDay=(n,s)=>n_(n,s),this.isSameHour=(n,s)=>i_(n,s),this.isAfter=(n,s)=>Hd(n,s),this.isAfterYear=(n,s)=>Hd(n,Em(s)),this.isAfterDay=(n,s)=>Hd(n,jm(s)),this.isBefore=(n,s)=>Yd(n,s),this.isBeforeYear=(n,s)=>Yd(n,this.startOfYear(s)),this.isBeforeDay=(n,s)=>Yd(n,this.startOfDay(s)),this.isWithinRange=(n,[s,i])=>mI(n,{start:s,end:i}),this.startOfYear=n=>Ny(n),this.startOfMonth=n=>fI(n),this.startOfWeek=n=>Ka(n,{locale:this.locale}),this.startOfDay=n=>Zo(n),this.endOfYear=n=>Em(n),this.endOfMonth=n=>hI(n),this.endOfWeek=n=>eD(n,{locale:this.locale}),this.endOfDay=n=>jm(n),this.addYears=(n,s)=>QC(n,s),this.addMonths=(n,s)=>Py(n,s),this.addWeeks=(n,s)=>JC(n,s),this.addDays=(n,s)=>dd(n,s),this.addHours=(n,s)=>KC(n,s),this.addMinutes=(n,s)=>XC(n,s),this.addSeconds=(n,s)=>qC(n,s),this.getYear=n=>t_(n),this.getMonth=n=>QD(n),this.getDate=n=>XD(n),this.getHours=n=>KD(n),this.getMinutes=n=>JD(n),this.getSeconds=n=>ZD(n),this.getMilliseconds=n=>e_(n),this.setYear=(n,s)=>uI(n,s),this.setMonth=(n,s)=>lI(n,s),this.setDate=(n,s)=>sI(n,s),this.setHours=(n,s)=>iI(n,s),this.setMinutes=(n,s)=>oI(n,s),this.setSeconds=(n,s)=>cI(n,s),this.setMilliseconds=(n,s)=>dI(n,s),this.getDaysInMonth=n=>Vy(n),this.getWeekArray=n=>{const s=this.startOfWeek(this.startOfMonth(n)),i=this.endOfWeek(this.endOfMonth(n));let o=0,l=s;const c=[];for(;this.isBefore(l,i);){const d=Math.floor(o/7);c[d]=c[d]||[],c[d].push(l),l=this.addDays(l,1),o+=1}return c},this.getWeekNumber=n=>ih(n,{locale:this.locale}),this.getYearRange=([n,s])=>{const i=this.startOfYear(n),o=this.endOfYear(s),l=[];let c=i;for(;this.isBefore(c,o);)l.push(c),c=this.addYears(c,1);return l}}}var vI=function(r){return bI(r)&&!SI(r)};function bI(e){return!!e&&typeof e=="object"}function SI(e){var r=Object.prototype.toString.call(e);return r==="[object RegExp]"||r==="[object Date]"||EI(e)}var wI=typeof Symbol=="function"&&Symbol.for,jI=wI?Symbol.for("react.element"):60103;function EI(e){return e.$$typeof===jI}function kI(e){return Array.isArray(e)?[]:{}}function jc(e,r){return r.clone!==!1&&r.isMergeableObject(e)?el(kI(e),e,r):e}function AI(e,r,t){return e.concat(r).map(function(n){return jc(n,t)})}function TI(e,r,t){var n={};return t.isMergeableObject(e)&&Object.keys(e).forEach(function(s){n[s]=jc(e[s],t)}),Object.keys(r).forEach(function(s){!t.isMergeableObject(r[s])||!e[s]?n[s]=jc(r[s],t):n[s]=el(e[s],r[s],t)}),n}function el(e,r,t){t=t||{},t.arrayMerge=t.arrayMerge||AI,t.isMergeableObject=t.isMergeableObject||vI;var n=Array.isArray(r),s=Array.isArray(e),i=n===s;return i?n?t.arrayMerge(e,r,t):TI(e,r,t):jc(r,t)}el.all=function(r,t){if(!Array.isArray(r))throw new Error("first argument should be an array");return r.reduce(function(n,s){return el(n,s,t)},{})};var Iu=el,CI=typeof global=="object"&&global&&global.Object===Object&&global;const Gy=CI;var DI=typeof self=="object"&&self&&self.Object===Object&&self,_I=Gy||DI||Function("return this")();const Oa=_I;var II=Oa.Symbol;const ks=II;var qy=Object.prototype,FI=qy.hasOwnProperty,MI=qy.toString,So=ks?ks.toStringTag:void 0;function PI(e){var r=FI.call(e,So),t=e[So];try{e[So]=void 0;var n=!0}catch{}var s=MI.call(e);return n&&(r?e[So]=t:delete e[So]),s}var NI=Object.prototype,RI=NI.toString;function OI(e){return RI.call(e)}var LI="[object Null]",$I="[object Undefined]",_m=ks?ks.toStringTag:void 0;function ui(e){return e==null?e===void 0?$I:LI:_m&&_m in Object(e)?PI(e):OI(e)}function Xy(e,r){return function(t){return e(r(t))}}var BI=Xy(Object.getPrototypeOf,Object);const ch=BI;function fi(e){return e!=null&&typeof e=="object"}var UI="[object Object]",VI=Function.prototype,WI=Object.prototype,Ky=VI.toString,HI=WI.hasOwnProperty,YI=Ky.call(Object);function Im(e){if(!fi(e)||ui(e)!=UI)return!1;var r=ch(e);if(r===null)return!0;var t=HI.call(r,"constructor")&&r.constructor;return typeof t=="function"&&t instanceof t&&Ky.call(t)==YI}function zI(){this.__data__=[],this.size=0}function Jy(e,r){return e===r||e!==e&&r!==r}function ud(e,r){for(var t=e.length;t--;)if(Jy(e[t][0],r))return t;return-1}var GI=Array.prototype,qI=GI.splice;function XI(e){var r=this.__data__,t=ud(r,e);if(t<0)return!1;var n=r.length-1;return t==n?r.pop():qI.call(r,t,1),--this.size,!0}function KI(e){var r=this.__data__,t=ud(r,e);return t<0?void 0:r[t][1]}function JI(e){return ud(this.__data__,e)>-1}function QI(e,r){var t=this.__data__,n=ud(t,e);return n<0?(++this.size,t.push([e,r])):t[n][1]=r,this}function rs(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}rs.prototype.clear=zI;rs.prototype.delete=XI;rs.prototype.get=KI;rs.prototype.has=JI;rs.prototype.set=QI;function ZI(){this.__data__=new rs,this.size=0}function eF(e){var r=this.__data__,t=r.delete(e);return this.size=r.size,t}function tF(e){return this.__data__.get(e)}function rF(e){return this.__data__.has(e)}function vl(e){var r=typeof e;return e!=null&&(r=="object"||r=="function")}var nF="[object AsyncFunction]",aF="[object Function]",sF="[object GeneratorFunction]",iF="[object Proxy]";function Qy(e){if(!vl(e))return!1;var r=ui(e);return r==aF||r==sF||r==nF||r==iF}var oF=Oa["__core-js_shared__"];const zd=oF;var Fm=function(){var e=/[^.]+$/.exec(zd&&zd.keys&&zd.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function lF(e){return!!Fm&&Fm in e}var cF=Function.prototype,dF=cF.toString;function hi(e){if(e!=null){try{return dF.call(e)}catch{}try{return e+""}catch{}}return""}var uF=/[\\^$.*+?()[\]{}|]/g,fF=/^\[object .+?Constructor\]$/,hF=Function.prototype,mF=Object.prototype,pF=hF.toString,xF=mF.hasOwnProperty,gF=RegExp("^"+pF.call(xF).replace(uF,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function yF(e){if(!vl(e)||lF(e))return!1;var r=Qy(e)?gF:fF;return r.test(hi(e))}function vF(e,r){return e==null?void 0:e[r]}function mi(e,r){var t=vF(e,r);return yF(t)?t:void 0}var bF=mi(Oa,"Map");const tl=bF;var SF=mi(Object,"create");const rl=SF;function wF(){this.__data__=rl?rl(null):{},this.size=0}function jF(e){var r=this.has(e)&&delete this.__data__[e];return this.size-=r?1:0,r}var EF="__lodash_hash_undefined__",kF=Object.prototype,AF=kF.hasOwnProperty;function TF(e){var r=this.__data__;if(rl){var t=r[e];return t===EF?void 0:t}return AF.call(r,e)?r[e]:void 0}var CF=Object.prototype,DF=CF.hasOwnProperty;function _F(e){var r=this.__data__;return rl?r[e]!==void 0:DF.call(r,e)}var IF="__lodash_hash_undefined__";function FF(e,r){var t=this.__data__;return this.size+=this.has(e)?0:1,t[e]=rl&&r===void 0?IF:r,this}function ni(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}ni.prototype.clear=wF;ni.prototype.delete=jF;ni.prototype.get=TF;ni.prototype.has=_F;ni.prototype.set=FF;function MF(){this.size=0,this.__data__={hash:new ni,map:new(tl||rs),string:new ni}}function PF(e){var r=typeof e;return r=="string"||r=="number"||r=="symbol"||r=="boolean"?e!=="__proto__":e===null}function fd(e,r){var t=e.__data__;return PF(r)?t[typeof r=="string"?"string":"hash"]:t.map}function NF(e){var r=fd(this,e).delete(e);return this.size-=r?1:0,r}function RF(e){return fd(this,e).get(e)}function OF(e){return fd(this,e).has(e)}function LF(e,r){var t=fd(this,e),n=t.size;return t.set(e,r),this.size+=t.size==n?0:1,this}function Is(e){var r=-1,t=e==null?0:e.length;for(this.clear();++r<t;){var n=e[r];this.set(n[0],n[1])}}Is.prototype.clear=MF;Is.prototype.delete=NF;Is.prototype.get=RF;Is.prototype.has=OF;Is.prototype.set=LF;var $F=200;function BF(e,r){var t=this.__data__;if(t instanceof rs){var n=t.__data__;if(!tl||n.length<$F-1)return n.push([e,r]),this.size=++t.size,this;t=this.__data__=new Is(n)}return t.set(e,r),this.size=t.size,this}function no(e){var r=this.__data__=new rs(e);this.size=r.size}no.prototype.clear=ZI;no.prototype.delete=eF;no.prototype.get=tF;no.prototype.has=rF;no.prototype.set=BF;function UF(e,r){for(var t=-1,n=e==null?0:e.length;++t<n&&r(e[t],t,e)!==!1;);return e}var VF=function(){try{var e=mi(Object,"defineProperty");return e({},"",{}),e}catch{}}();const Mm=VF;function Zy(e,r,t){r=="__proto__"&&Mm?Mm(e,r,{configurable:!0,enumerable:!0,value:t,writable:!0}):e[r]=t}var WF=Object.prototype,HF=WF.hasOwnProperty;function e1(e,r,t){var n=e[r];(!(HF.call(e,r)&&Jy(n,t))||t===void 0&&!(r in e))&&Zy(e,r,t)}function hd(e,r,t,n){var s=!t;t||(t={});for(var i=-1,o=r.length;++i<o;){var l=r[i],c=n?n(t[l],e[l],l,t,e):void 0;c===void 0&&(c=e[l]),s?Zy(t,l,c):e1(t,l,c)}return t}function YF(e,r){for(var t=-1,n=Array(e);++t<e;)n[t]=r(t);return n}var zF="[object Arguments]";function Pm(e){return fi(e)&&ui(e)==zF}var t1=Object.prototype,GF=t1.hasOwnProperty,qF=t1.propertyIsEnumerable,XF=Pm(function(){return arguments}())?Pm:function(e){return fi(e)&&GF.call(e,"callee")&&!qF.call(e,"callee")};const KF=XF;var JF=Array.isArray;const bl=JF;function QF(){return!1}var r1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Nm=r1&&typeof module=="object"&&module&&!module.nodeType&&module,ZF=Nm&&Nm.exports===r1,Rm=ZF?Oa.Buffer:void 0,eM=Rm?Rm.isBuffer:void 0,tM=eM||QF;const n1=tM;var rM=9007199254740991,nM=/^(?:0|[1-9]\d*)$/;function aM(e,r){var t=typeof e;return r=r??rM,!!r&&(t=="number"||t!="symbol"&&nM.test(e))&&e>-1&&e%1==0&&e<r}var sM=9007199254740991;function a1(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=sM}var iM="[object Arguments]",oM="[object Array]",lM="[object Boolean]",cM="[object Date]",dM="[object Error]",uM="[object Function]",fM="[object Map]",hM="[object Number]",mM="[object Object]",pM="[object RegExp]",xM="[object Set]",gM="[object String]",yM="[object WeakMap]",vM="[object ArrayBuffer]",bM="[object DataView]",SM="[object Float32Array]",wM="[object Float64Array]",jM="[object Int8Array]",EM="[object Int16Array]",kM="[object Int32Array]",AM="[object Uint8Array]",TM="[object Uint8ClampedArray]",CM="[object Uint16Array]",DM="[object Uint32Array]",lr={};lr[SM]=lr[wM]=lr[jM]=lr[EM]=lr[kM]=lr[AM]=lr[TM]=lr[CM]=lr[DM]=!0;lr[iM]=lr[oM]=lr[vM]=lr[lM]=lr[bM]=lr[cM]=lr[dM]=lr[uM]=lr[fM]=lr[hM]=lr[mM]=lr[pM]=lr[xM]=lr[gM]=lr[yM]=!1;function _M(e){return fi(e)&&a1(e.length)&&!!lr[ui(e)]}function dh(e){return function(r){return e(r)}}var s1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,No=s1&&typeof module=="object"&&module&&!module.nodeType&&module,IM=No&&No.exports===s1,Gd=IM&&Gy.process,FM=function(){try{var e=No&&No.require&&No.require("util").types;return e||Gd&&Gd.binding&&Gd.binding("util")}catch{}}();const Ki=FM;var Om=Ki&&Ki.isTypedArray,MM=Om?dh(Om):_M;const PM=MM;var NM=Object.prototype,RM=NM.hasOwnProperty;function i1(e,r){var t=bl(e),n=!t&&KF(e),s=!t&&!n&&n1(e),i=!t&&!n&&!s&&PM(e),o=t||n||s||i,l=o?YF(e.length,String):[],c=l.length;for(var d in e)(r||RM.call(e,d))&&!(o&&(d=="length"||s&&(d=="offset"||d=="parent")||i&&(d=="buffer"||d=="byteLength"||d=="byteOffset")||aM(d,c)))&&l.push(d);return l}var OM=Object.prototype;function uh(e){var r=e&&e.constructor,t=typeof r=="function"&&r.prototype||OM;return e===t}var LM=Xy(Object.keys,Object);const $M=LM;var BM=Object.prototype,UM=BM.hasOwnProperty;function VM(e){if(!uh(e))return $M(e);var r=[];for(var t in Object(e))UM.call(e,t)&&t!="constructor"&&r.push(t);return r}function o1(e){return e!=null&&a1(e.length)&&!Qy(e)}function fh(e){return o1(e)?i1(e):VM(e)}function WM(e,r){return e&&hd(r,fh(r),e)}function HM(e){var r=[];if(e!=null)for(var t in Object(e))r.push(t);return r}var YM=Object.prototype,zM=YM.hasOwnProperty;function GM(e){if(!vl(e))return HM(e);var r=uh(e),t=[];for(var n in e)n=="constructor"&&(r||!zM.call(e,n))||t.push(n);return t}function hh(e){return o1(e)?i1(e,!0):GM(e)}function qM(e,r){return e&&hd(r,hh(r),e)}var l1=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Lm=l1&&typeof module=="object"&&module&&!module.nodeType&&module,XM=Lm&&Lm.exports===l1,$m=XM?Oa.Buffer:void 0,Bm=$m?$m.allocUnsafe:void 0;function KM(e,r){if(r)return e.slice();var t=e.length,n=Bm?Bm(t):new e.constructor(t);return e.copy(n),n}function c1(e,r){var t=-1,n=e.length;for(r||(r=Array(n));++t<n;)r[t]=e[t];return r}function JM(e,r){for(var t=-1,n=e==null?0:e.length,s=0,i=[];++t<n;){var o=e[t];r(o,t,e)&&(i[s++]=o)}return i}function d1(){return[]}var QM=Object.prototype,ZM=QM.propertyIsEnumerable,Um=Object.getOwnPropertySymbols,eP=Um?function(e){return e==null?[]:(e=Object(e),JM(Um(e),function(r){return ZM.call(e,r)}))}:d1;const mh=eP;function tP(e,r){return hd(e,mh(e),r)}function u1(e,r){for(var t=-1,n=r.length,s=e.length;++t<n;)e[s+t]=r[t];return e}var rP=Object.getOwnPropertySymbols,nP=rP?function(e){for(var r=[];e;)u1(r,mh(e)),e=ch(e);return r}:d1;const f1=nP;function aP(e,r){return hd(e,f1(e),r)}function h1(e,r,t){var n=r(e);return bl(e)?n:u1(n,t(e))}function sP(e){return h1(e,fh,mh)}function iP(e){return h1(e,hh,f1)}var oP=mi(Oa,"DataView");const Fu=oP;var lP=mi(Oa,"Promise");const Mu=lP;var cP=mi(Oa,"Set");const Pu=cP;var dP=mi(Oa,"WeakMap");const Nu=dP;var Vm="[object Map]",uP="[object Object]",Wm="[object Promise]",Hm="[object Set]",Ym="[object WeakMap]",zm="[object DataView]",fP=hi(Fu),hP=hi(tl),mP=hi(Mu),pP=hi(Pu),xP=hi(Nu),Hs=ui;(Fu&&Hs(new Fu(new ArrayBuffer(1)))!=zm||tl&&Hs(new tl)!=Vm||Mu&&Hs(Mu.resolve())!=Wm||Pu&&Hs(new Pu)!=Hm||Nu&&Hs(new Nu)!=Ym)&&(Hs=function(e){var r=ui(e),t=r==uP?e.constructor:void 0,n=t?hi(t):"";if(n)switch(n){case fP:return zm;case hP:return Vm;case mP:return Wm;case pP:return Hm;case xP:return Ym}return r});const ph=Hs;var gP=Object.prototype,yP=gP.hasOwnProperty;function vP(e){var r=e.length,t=new e.constructor(r);return r&&typeof e[0]=="string"&&yP.call(e,"index")&&(t.index=e.index,t.input=e.input),t}var bP=Oa.Uint8Array;const Gm=bP;function xh(e){var r=new e.constructor(e.byteLength);return new Gm(r).set(new Gm(e)),r}function SP(e,r){var t=r?xh(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.byteLength)}var wP=/\w*$/;function jP(e){var r=new e.constructor(e.source,wP.exec(e));return r.lastIndex=e.lastIndex,r}var qm=ks?ks.prototype:void 0,Xm=qm?qm.valueOf:void 0;function EP(e){return Xm?Object(Xm.call(e)):{}}function kP(e,r){var t=r?xh(e.buffer):e.buffer;return new e.constructor(t,e.byteOffset,e.length)}var AP="[object Boolean]",TP="[object Date]",CP="[object Map]",DP="[object Number]",_P="[object RegExp]",IP="[object Set]",FP="[object String]",MP="[object Symbol]",PP="[object ArrayBuffer]",NP="[object DataView]",RP="[object Float32Array]",OP="[object Float64Array]",LP="[object Int8Array]",$P="[object Int16Array]",BP="[object Int32Array]",UP="[object Uint8Array]",VP="[object Uint8ClampedArray]",WP="[object Uint16Array]",HP="[object Uint32Array]";function YP(e,r,t){var n=e.constructor;switch(r){case PP:return xh(e);case AP:case TP:return new n(+e);case NP:return SP(e,t);case RP:case OP:case LP:case $P:case BP:case UP:case VP:case WP:case HP:return kP(e,t);case CP:return new n;case DP:case FP:return new n(e);case _P:return jP(e);case IP:return new n;case MP:return EP(e)}}var Km=Object.create,zP=function(){function e(){}return function(r){if(!vl(r))return{};if(Km)return Km(r);e.prototype=r;var t=new e;return e.prototype=void 0,t}}();const GP=zP;function qP(e){return typeof e.constructor=="function"&&!uh(e)?GP(ch(e)):{}}var XP="[object Map]";function KP(e){return fi(e)&&ph(e)==XP}var Jm=Ki&&Ki.isMap,JP=Jm?dh(Jm):KP;const QP=JP;var ZP="[object Set]";function eN(e){return fi(e)&&ph(e)==ZP}var Qm=Ki&&Ki.isSet,tN=Qm?dh(Qm):eN;const rN=tN;var nN=1,aN=2,sN=4,m1="[object Arguments]",iN="[object Array]",oN="[object Boolean]",lN="[object Date]",cN="[object Error]",p1="[object Function]",dN="[object GeneratorFunction]",uN="[object Map]",fN="[object Number]",x1="[object Object]",hN="[object RegExp]",mN="[object Set]",pN="[object String]",xN="[object Symbol]",gN="[object WeakMap]",yN="[object ArrayBuffer]",vN="[object DataView]",bN="[object Float32Array]",SN="[object Float64Array]",wN="[object Int8Array]",jN="[object Int16Array]",EN="[object Int32Array]",kN="[object Uint8Array]",AN="[object Uint8ClampedArray]",TN="[object Uint16Array]",CN="[object Uint32Array]",nr={};nr[m1]=nr[iN]=nr[yN]=nr[vN]=nr[oN]=nr[lN]=nr[bN]=nr[SN]=nr[wN]=nr[jN]=nr[EN]=nr[uN]=nr[fN]=nr[x1]=nr[hN]=nr[mN]=nr[pN]=nr[xN]=nr[kN]=nr[AN]=nr[TN]=nr[CN]=!0;nr[cN]=nr[p1]=nr[gN]=!1;function Ro(e,r,t,n,s,i){var o,l=r&nN,c=r&aN,d=r&sN;if(t&&(o=s?t(e,n,s,i):t(e)),o!==void 0)return o;if(!vl(e))return e;var u=bl(e);if(u){if(o=vP(e),!l)return c1(e,o)}else{var f=ph(e),h=f==p1||f==dN;if(n1(e))return KM(e,l);if(f==x1||f==m1||h&&!s){if(o=c||h?{}:qP(e),!l)return c?aP(e,qM(o,e)):tP(e,WM(o,e))}else{if(!nr[f])return s?e:{};o=YP(e,f,l)}}i||(i=new no);var x=i.get(e);if(x)return x;i.set(e,o),rN(e)?e.forEach(function(p){o.add(Ro(p,r,t,p,e,i))}):QP(e)&&e.forEach(function(p,y){o.set(y,Ro(p,r,t,y,e,i))});var m=d?c?iP:sP:c?hh:fh,g=u?void 0:m(e);return UF(g||e,function(p,y){g&&(y=p,p=e[y]),e1(o,y,Ro(p,r,t,y,e,i))}),o}var DN=1,_N=4;function Ll(e){return Ro(e,DN|_N)}var Zm=Array.isArray,ep=Object.keys,IN=Object.prototype.hasOwnProperty,FN=typeof Element<"u";function Ru(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){var t=Zm(e),n=Zm(r),s,i,o;if(t&&n){if(i=e.length,i!=r.length)return!1;for(s=i;s--!==0;)if(!Ru(e[s],r[s]))return!1;return!0}if(t!=n)return!1;var l=e instanceof Date,c=r instanceof Date;if(l!=c)return!1;if(l&&c)return e.getTime()==r.getTime();var d=e instanceof RegExp,u=r instanceof RegExp;if(d!=u)return!1;if(d&&u)return e.toString()==r.toString();var f=ep(e);if(i=f.length,i!==ep(r).length)return!1;for(s=i;s--!==0;)if(!IN.call(r,f[s]))return!1;if(FN&&e instanceof Element&&r instanceof Element)return e===r;for(s=i;s--!==0;)if(o=f[s],!(o==="_owner"&&e.$$typeof)&&!Ru(e[o],r[o]))return!1;return!0}return e!==e&&r!==r}var MN=function(r,t){try{return Ru(r,t)}catch(n){if(n.message&&n.message.match(/stack|recursion/i)||n.number===-2146828260)return console.warn("Warning: react-fast-compare does not handle circular references.",n.name,n.message),!1;throw n}};const Ys=ts(MN);var PN=!0;function NN(e,r){if(!PN){if(e)return;var t="Warning: "+r;typeof console<"u"&&console.warn(t);try{throw Error(t)}catch{}}}var RN=4;function tp(e){return Ro(e,RN)}function g1(e,r){for(var t=-1,n=e==null?0:e.length,s=Array(n);++t<n;)s[t]=r(e[t],t,e);return s}var ON="[object Symbol]";function gh(e){return typeof e=="symbol"||fi(e)&&ui(e)==ON}var LN="Expected a function";function yh(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new TypeError(LN);var t=function(){var n=arguments,s=r?r.apply(this,n):n[0],i=t.cache;if(i.has(s))return i.get(s);var o=e.apply(this,n);return t.cache=i.set(s,o)||i,o};return t.cache=new(yh.Cache||Is),t}yh.Cache=Is;var $N=500;function BN(e){var r=yh(e,function(n){return t.size===$N&&t.clear(),n}),t=r.cache;return r}var UN=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,VN=/\\(\\)?/g,WN=BN(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(UN,function(t,n,s,i){r.push(s?i.replace(VN,"$1"):n||t)}),r});const HN=WN;var YN=1/0;function zN(e){if(typeof e=="string"||gh(e))return e;var r=e+"";return r=="0"&&1/e==-YN?"-0":r}var GN=1/0,rp=ks?ks.prototype:void 0,np=rp?rp.toString:void 0;function y1(e){if(typeof e=="string")return e;if(bl(e))return g1(e,y1)+"";if(gh(e))return np?np.call(e):"";var r=e+"";return r=="0"&&1/e==-GN?"-0":r}function qN(e){return e==null?"":y1(e)}function v1(e){return bl(e)?g1(e,zN):gh(e)?[e]:c1(HN(qN(e)))}function Hr(){return Hr=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},Hr.apply(this,arguments)}function b1(e,r){if(e==null)return{};var t={},n=Object.keys(e),s,i;for(i=0;i<n.length;i++)s=n[i],!(r.indexOf(s)>=0)&&(t[s]=e[s]);return t}var md=b.createContext(void 0);md.displayName="FormikContext";md.Provider;md.Consumer;function XN(){var e=b.useContext(md);return e||NN(!1),e}var fa=function(r){return typeof r=="function"},pd=function(r){return r!==null&&typeof r=="object"},KN=function(r){return String(Math.floor(Number(r)))===r},qd=function(r){return Object.prototype.toString.call(r)==="[object String]"},Xd=function(r){return pd(r)&&fa(r.then)};function Vn(e,r,t,n){n===void 0&&(n=0);for(var s=v1(r);e&&n<s.length;)e=e[s[n++]];return n!==s.length&&!e||e===void 0?t:e}function Xs(e,r,t){for(var n=tp(e),s=n,i=0,o=v1(r);i<o.length-1;i++){var l=o[i],c=Vn(e,o.slice(0,i+1));if(c&&(pd(c)||Array.isArray(c)))s=s[l]=tp(c);else{var d=o[i+1];s=s[l]=KN(d)&&Number(d)>=0?[]:{}}}return(i===0?e:s)[o[i]]===t?e:(t===void 0?delete s[o[i]]:s[o[i]]=t,i===0&&t===void 0&&delete n[o[i]],n)}function S1(e,r,t,n){t===void 0&&(t=new WeakMap),n===void 0&&(n={});for(var s=0,i=Object.keys(e);s<i.length;s++){var o=i[s],l=e[o];pd(l)?t.get(l)||(t.set(l,!0),n[o]=Array.isArray(l)?[]:{},S1(l,r,t,n[o])):n[o]=r}return n}function JN(e,r){switch(r.type){case"SET_VALUES":return Hr({},e,{values:r.payload});case"SET_TOUCHED":return Hr({},e,{touched:r.payload});case"SET_ERRORS":return Ys(e.errors,r.payload)?e:Hr({},e,{errors:r.payload});case"SET_STATUS":return Hr({},e,{status:r.payload});case"SET_ISSUBMITTING":return Hr({},e,{isSubmitting:r.payload});case"SET_ISVALIDATING":return Hr({},e,{isValidating:r.payload});case"SET_FIELD_VALUE":return Hr({},e,{values:Xs(e.values,r.payload.field,r.payload.value)});case"SET_FIELD_TOUCHED":return Hr({},e,{touched:Xs(e.touched,r.payload.field,r.payload.value)});case"SET_FIELD_ERROR":return Hr({},e,{errors:Xs(e.errors,r.payload.field,r.payload.value)});case"RESET_FORM":return Hr({},e,r.payload);case"SET_FORMIK_STATE":return r.payload(e);case"SUBMIT_ATTEMPT":return Hr({},e,{touched:S1(e.values,!0),isSubmitting:!0,submitCount:e.submitCount+1});case"SUBMIT_FAILURE":return Hr({},e,{isSubmitting:!1});case"SUBMIT_SUCCESS":return Hr({},e,{isSubmitting:!1});default:return e}}var Bs={},$l={};function QN(e){var r=e.validateOnChange,t=r===void 0?!0:r,n=e.validateOnBlur,s=n===void 0?!0:n,i=e.validateOnMount,o=i===void 0?!1:i,l=e.isInitialValid,c=e.enableReinitialize,d=c===void 0?!1:c,u=e.onSubmit,f=b1(e,["validateOnChange","validateOnBlur","validateOnMount","isInitialValid","enableReinitialize","onSubmit"]),h=Hr({validateOnChange:t,validateOnBlur:s,validateOnMount:o,onSubmit:u},f),x=b.useRef(h.initialValues),m=b.useRef(h.initialErrors||Bs),g=b.useRef(h.initialTouched||$l),p=b.useRef(h.initialStatus),y=b.useRef(!1),S=b.useRef({});b.useEffect(function(){return y.current=!0,function(){y.current=!1}},[]);var v=b.useState(0),E=v[1],C=b.useRef({values:Ll(h.initialValues),errors:Ll(h.initialErrors)||Bs,touched:Ll(h.initialTouched)||$l,status:Ll(h.initialStatus),isSubmitting:!1,isValidating:!1,submitCount:0}),A=C.current,j=b.useCallback(function(ne){var we=C.current;C.current=JN(we,ne),we!==C.current&&E(function(Ee){return Ee+1})},[]),w=b.useCallback(function(ne,we){return new Promise(function(Ee,pe){var Ce=h.validate(ne,we);Ce==null?Ee(Bs):Xd(Ce)?Ce.then(function(ue){Ee(ue||Bs)},function(ue){pe(ue)}):Ee(Ce)})},[h.validate]),k=b.useCallback(function(ne,we){var Ee=h.validationSchema,pe=fa(Ee)?Ee(we):Ee,Ce=we&&pe.validateAt?pe.validateAt(we,ne):eR(ne,pe);return new Promise(function(ue,Me){Ce.then(function(){ue(Bs)},function(ke){ke.name==="ValidationError"?ue(ZN(ke)):Me(ke)})})},[h.validationSchema]),_=b.useCallback(function(ne,we){return new Promise(function(Ee){return Ee(S.current[ne].validate(we))})},[]),I=b.useCallback(function(ne){var we=Object.keys(S.current).filter(function(pe){return fa(S.current[pe].validate)}),Ee=we.length>0?we.map(function(pe){return _(pe,Vn(ne,pe))}):[Promise.resolve("DO_NOT_DELETE_YOU_WILL_BE_FIRED")];return Promise.all(Ee).then(function(pe){return pe.reduce(function(Ce,ue,Me){return ue==="DO_NOT_DELETE_YOU_WILL_BE_FIRED"||ue&&(Ce=Xs(Ce,we[Me],ue)),Ce},{})})},[_]),D=b.useCallback(function(ne){return Promise.all([I(ne),h.validationSchema?k(ne):{},h.validate?w(ne):{}]).then(function(we){var Ee=we[0],pe=we[1],Ce=we[2],ue=Iu.all([Ee,pe,Ce],{arrayMerge:tR});return ue})},[h.validate,h.validationSchema,I,w,k]),B=Qn(function(ne){return ne===void 0&&(ne=A.values),j({type:"SET_ISVALIDATING",payload:!0}),D(ne).then(function(we){return y.current&&(j({type:"SET_ISVALIDATING",payload:!1}),j({type:"SET_ERRORS",payload:we})),we})});b.useEffect(function(){o&&y.current===!0&&Ys(x.current,h.initialValues)&&B(x.current)},[o,B]);var R=b.useCallback(function(ne){var we=ne&&ne.values?ne.values:x.current,Ee=ne&&ne.errors?ne.errors:m.current?m.current:h.initialErrors||{},pe=ne&&ne.touched?ne.touched:g.current?g.current:h.initialTouched||{},Ce=ne&&ne.status?ne.status:p.current?p.current:h.initialStatus;x.current=we,m.current=Ee,g.current=pe,p.current=Ce;var ue=function(){j({type:"RESET_FORM",payload:{isSubmitting:!!ne&&!!ne.isSubmitting,errors:Ee,touched:pe,status:Ce,values:we,isValidating:!!ne&&!!ne.isValidating,submitCount:ne&&ne.submitCount&&typeof ne.submitCount=="number"?ne.submitCount:0}})};if(h.onReset){var Me=h.onReset(A.values,U);Xd(Me)?Me.then(ue):ue()}else ue()},[h.initialErrors,h.initialStatus,h.initialTouched,h.onReset]);b.useEffect(function(){y.current===!0&&!Ys(x.current,h.initialValues)&&d&&(x.current=h.initialValues,R(),o&&B(x.current))},[d,h.initialValues,R,o,B]),b.useEffect(function(){d&&y.current===!0&&!Ys(m.current,h.initialErrors)&&(m.current=h.initialErrors||Bs,j({type:"SET_ERRORS",payload:h.initialErrors||Bs}))},[d,h.initialErrors]),b.useEffect(function(){d&&y.current===!0&&!Ys(g.current,h.initialTouched)&&(g.current=h.initialTouched||$l,j({type:"SET_TOUCHED",payload:h.initialTouched||$l}))},[d,h.initialTouched]),b.useEffect(function(){d&&y.current===!0&&!Ys(p.current,h.initialStatus)&&(p.current=h.initialStatus,j({type:"SET_STATUS",payload:h.initialStatus}))},[d,h.initialStatus,h.initialTouched]);var Y=Qn(function(ne){if(S.current[ne]&&fa(S.current[ne].validate)){var we=Vn(A.values,ne),Ee=S.current[ne].validate(we);return Xd(Ee)?(j({type:"SET_ISVALIDATING",payload:!0}),Ee.then(function(pe){return pe}).then(function(pe){j({type:"SET_FIELD_ERROR",payload:{field:ne,value:pe}}),j({type:"SET_ISVALIDATING",payload:!1})})):(j({type:"SET_FIELD_ERROR",payload:{field:ne,value:Ee}}),Promise.resolve(Ee))}else if(h.validationSchema)return j({type:"SET_ISVALIDATING",payload:!0}),k(A.values,ne).then(function(pe){return pe}).then(function(pe){j({type:"SET_FIELD_ERROR",payload:{field:ne,value:Vn(pe,ne)}}),j({type:"SET_ISVALIDATING",payload:!1})});return Promise.resolve()}),P=b.useCallback(function(ne,we){var Ee=we.validate;S.current[ne]={validate:Ee}},[]),M=b.useCallback(function(ne){delete S.current[ne]},[]),K=Qn(function(ne,we){j({type:"SET_TOUCHED",payload:ne});var Ee=we===void 0?s:we;return Ee?B(A.values):Promise.resolve()}),L=b.useCallback(function(ne){j({type:"SET_ERRORS",payload:ne})},[]),ae=Qn(function(ne,we){var Ee=fa(ne)?ne(A.values):ne;j({type:"SET_VALUES",payload:Ee});var pe=we===void 0?t:we;return pe?B(Ee):Promise.resolve()}),Z=b.useCallback(function(ne,we){j({type:"SET_FIELD_ERROR",payload:{field:ne,value:we}})},[]),T=Qn(function(ne,we,Ee){j({type:"SET_FIELD_VALUE",payload:{field:ne,value:we}});var pe=Ee===void 0?t:Ee;return pe?B(Xs(A.values,ne,we)):Promise.resolve()}),N=b.useCallback(function(ne,we){var Ee=we,pe=ne,Ce;if(!qd(ne)){ne.persist&&ne.persist();var ue=ne.target?ne.target:ne.currentTarget,Me=ue.type,ke=ue.name,Ae=ue.id,Ue=ue.value,Ye=ue.checked,Ve=ue.outerHTML,Xe=ue.options,_t=ue.multiple;Ee=we||ke||Ae,pe=/number|range/.test(Me)?(Ce=parseFloat(Ue),isNaN(Ce)?"":Ce):/checkbox/.test(Me)?nR(Vn(A.values,Ee),Ye,Ue):Xe&&_t?rR(Xe):Ue}Ee&&T(Ee,pe)},[T,A.values]),H=Qn(function(ne){if(qd(ne))return function(we){return N(we,ne)};N(ne)}),G=Qn(function(ne,we,Ee){we===void 0&&(we=!0),j({type:"SET_FIELD_TOUCHED",payload:{field:ne,value:we}});var pe=Ee===void 0?s:Ee;return pe?B(A.values):Promise.resolve()}),q=b.useCallback(function(ne,we){ne.persist&&ne.persist();var Ee=ne.target,pe=Ee.name,Ce=Ee.id,ue=Ee.outerHTML,Me=we||pe||Ce;G(Me,!0)},[G]),oe=Qn(function(ne){if(qd(ne))return function(we){return q(we,ne)};q(ne)}),de=b.useCallback(function(ne){fa(ne)?j({type:"SET_FORMIK_STATE",payload:ne}):j({type:"SET_FORMIK_STATE",payload:function(){return ne}})},[]),z=b.useCallback(function(ne){j({type:"SET_STATUS",payload:ne})},[]),O=b.useCallback(function(ne){j({type:"SET_ISSUBMITTING",payload:ne})},[]),W=Qn(function(){return j({type:"SUBMIT_ATTEMPT"}),B().then(function(ne){var we=ne instanceof Error,Ee=!we&&Object.keys(ne).length===0;if(Ee){var pe;try{if(pe=te(),pe===void 0)return}catch(Ce){throw Ce}return Promise.resolve(pe).then(function(Ce){return y.current&&j({type:"SUBMIT_SUCCESS"}),Ce}).catch(function(Ce){if(y.current)throw j({type:"SUBMIT_FAILURE"}),Ce})}else if(y.current&&(j({type:"SUBMIT_FAILURE"}),we))throw ne})}),F=Qn(function(ne){ne&&ne.preventDefault&&fa(ne.preventDefault)&&ne.preventDefault(),ne&&ne.stopPropagation&&fa(ne.stopPropagation)&&ne.stopPropagation(),W().catch(function(we){console.warn("Warning: An unhandled error was caught from submitForm()",we)})}),U={resetForm:R,validateForm:B,validateField:Y,setErrors:L,setFieldError:Z,setFieldTouched:G,setFieldValue:T,setStatus:z,setSubmitting:O,setTouched:K,setValues:ae,setFormikState:de,submitForm:W},te=Qn(function(){return u(A.values,U)}),he=Qn(function(ne){ne&&ne.preventDefault&&fa(ne.preventDefault)&&ne.preventDefault(),ne&&ne.stopPropagation&&fa(ne.stopPropagation)&&ne.stopPropagation(),R()}),ie=b.useCallback(function(ne){return{value:Vn(A.values,ne),error:Vn(A.errors,ne),touched:!!Vn(A.touched,ne),initialValue:Vn(x.current,ne),initialTouched:!!Vn(g.current,ne),initialError:Vn(m.current,ne)}},[A.errors,A.touched,A.values]),be=b.useCallback(function(ne){return{setValue:function(Ee,pe){return T(ne,Ee,pe)},setTouched:function(Ee,pe){return G(ne,Ee,pe)},setError:function(Ee){return Z(ne,Ee)}}},[T,G,Z]),xe=b.useCallback(function(ne){var we=pd(ne),Ee=we?ne.name:ne,pe=Vn(A.values,Ee),Ce={name:Ee,value:pe,onChange:H,onBlur:oe};if(we){var ue=ne.type,Me=ne.value,ke=ne.as,Ae=ne.multiple;ue==="checkbox"?Me===void 0?Ce.checked=!!pe:(Ce.checked=!!(Array.isArray(pe)&&~pe.indexOf(Me)),Ce.value=Me):ue==="radio"?(Ce.checked=pe===Me,Ce.value=Me):ke==="select"&&Ae&&(Ce.value=Ce.value||[],Ce.multiple=!0)}return Ce},[oe,H,A.values]),Fe=b.useMemo(function(){return!Ys(x.current,A.values)},[x.current,A.values]),me=b.useMemo(function(){return typeof l<"u"?Fe?A.errors&&Object.keys(A.errors).length===0:l!==!1&&fa(l)?l(h):l:A.errors&&Object.keys(A.errors).length===0},[l,Fe,A.errors,h]),ve=Hr({},A,{initialValues:x.current,initialErrors:m.current,initialTouched:g.current,initialStatus:p.current,handleBlur:oe,handleChange:H,handleReset:he,handleSubmit:F,resetForm:R,setErrors:L,setFormikState:de,setFieldTouched:G,setFieldValue:T,setFieldError:Z,setStatus:z,setSubmitting:O,setTouched:K,setValues:ae,submitForm:W,validateForm:B,validateField:Y,isValid:me,dirty:Fe,unregisterField:M,registerField:P,getFieldProps:xe,getFieldMeta:ie,getFieldHelpers:be,validateOnBlur:s,validateOnChange:t,validateOnMount:o});return ve}function ZN(e){var r={};if(e.inner){if(e.inner.length===0)return Xs(r,e.path,e.message);for(var s=e.inner,t=Array.isArray(s),n=0,s=t?s:s[Symbol.iterator]();;){var i;if(t){if(n>=s.length)break;i=s[n++]}else{if(n=s.next(),n.done)break;i=n.value}var o=i;Vn(r,o.path)||(r=Xs(r,o.path,o.message))}}return r}function eR(e,r,t,n){t===void 0&&(t=!1);var s=Ou(e);return r[t?"validateSync":"validate"](s,{abortEarly:!1,context:n||s})}function Ou(e){var r=Array.isArray(e)?[]:{};for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=String(t);Array.isArray(e[n])===!0?r[n]=e[n].map(function(s){return Array.isArray(s)===!0||Im(s)?Ou(s):s!==""?s:void 0}):Im(e[n])?r[n]=Ou(e[n]):r[n]=e[n]!==""?e[n]:void 0}return r}function tR(e,r,t){var n=e.slice();return r.forEach(function(i,o){if(typeof n[o]>"u"){var l=t.clone!==!1,c=l&&t.isMergeableObject(i);n[o]=c?Iu(Array.isArray(i)?[]:{},i,t):i}else t.isMergeableObject(i)?n[o]=Iu(e[o],i,t):e.indexOf(i)===-1&&n.push(i)}),n}function rR(e){return Array.from(e).filter(function(r){return r.selected}).map(function(r){return r.value})}function nR(e,r,t){if(typeof e=="boolean")return!!r;var n=[],s=!1,i=-1;if(Array.isArray(e))n=e,i=e.indexOf(t),s=i>=0;else if(!t||t=="true"||t=="false")return!!r;return r&&t&&!s?n.concat(t):s?n.slice(0,i).concat(n.slice(i+1)):n}var aR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u"?b.useLayoutEffect:b.useEffect;function Qn(e){var r=b.useRef(e);return aR(function(){r.current=e}),b.useCallback(function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return r.current.apply(void 0,n)},[])}var sR=b.forwardRef(function(e,r){var t=e.action,n=b1(e,["action"]),s=t??"#",i=XN(),o=i.handleReset,l=i.handleSubmit;return b.createElement("form",Hr({onSubmit:l,ref:r,onReset:o,action:s},n))});sR.displayName="Form";function pi(e){this._maxSize=e,this.clear()}pi.prototype.clear=function(){this._size=0,this._values=Object.create(null)};pi.prototype.get=function(e){return this._values[e]};pi.prototype.set=function(e,r){return this._size>=this._maxSize&&this.clear(),e in this._values||this._size++,this._values[e]=r};var iR=/[^.^\]^[]+|(?=\[\]|\.\.)/g,w1=/^\d+$/,oR=/^\d/,lR=/[~`!#$%\^&*+=\-\[\]\\';,/{}|\\":<>\?]/g,cR=/^\s*(['"]?)(.*?)(\1)\s*$/,vh=512,ap=new pi(vh),sp=new pi(vh),ip=new pi(vh),Ks={Cache:pi,split:Lu,normalizePath:Kd,setter:function(e){var r=Kd(e);return sp.get(e)||sp.set(e,function(n,s){for(var i=0,o=r.length,l=n;i<o-1;){var c=r[i];if(c==="__proto__"||c==="constructor"||c==="prototype")return n;l=l[r[i++]]}l[r[i]]=s})},getter:function(e,r){var t=Kd(e);return ip.get(e)||ip.set(e,function(s){for(var i=0,o=t.length;i<o;)if(s!=null||!r)s=s[t[i++]];else return;return s})},join:function(e){return e.reduce(function(r,t){return r+(bh(t)||w1.test(t)?"["+t+"]":(r?".":"")+t)},"")},forEach:function(e,r,t){dR(Array.isArray(e)?e:Lu(e),r,t)}};function Kd(e){return ap.get(e)||ap.set(e,Lu(e).map(function(r){return r.replace(cR,"$2")}))}function Lu(e){return e.match(iR)||[""]}function dR(e,r,t){var n=e.length,s,i,o,l;for(i=0;i<n;i++)s=e[i],s&&(hR(s)&&(s='"'+s+'"'),l=bh(s),o=!l&&/^\d+$/.test(s),r.call(t,s,l,o,i,e))}function bh(e){return typeof e=="string"&&e&&["'",'"'].indexOf(e.charAt(0))!==-1}function uR(e){return e.match(oR)&&!e.match(w1)}function fR(e){return lR.test(e)}function hR(e){return!bh(e)&&(uR(e)||fR(e))}const mR=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['‚Äô](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['‚Äô](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['‚Äô](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['‚Äô](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,xd=e=>e.match(mR)||[],gd=e=>e[0].toUpperCase()+e.slice(1),Sh=(e,r)=>xd(e).join(r).toLowerCase(),j1=e=>xd(e).reduce((r,t)=>`${r}${r?t[0].toUpperCase()+t.slice(1).toLowerCase():t.toLowerCase()}`,""),pR=e=>gd(j1(e)),xR=e=>Sh(e,"_"),gR=e=>Sh(e,"-"),yR=e=>gd(Sh(e," ")),vR=e=>xd(e).map(gd).join(" ");var Jd={words:xd,upperFirst:gd,camelCase:j1,pascalCase:pR,snakeCase:xR,kebabCase:gR,sentenceCase:yR,titleCase:vR},wh={exports:{}};wh.exports=function(e){return E1(bR(e),e)};wh.exports.array=E1;function E1(e,r){var t=e.length,n=new Array(t),s={},i=t,o=SR(r),l=wR(e);for(r.forEach(function(d){if(!l.has(d[0])||!l.has(d[1]))throw new Error("Unknown node. There is an unknown node in the supplied edges.")});i--;)s[i]||c(e[i],i,new Set);return n;function c(d,u,f){if(f.has(d)){var h;try{h=", node was:"+JSON.stringify(d)}catch{h=""}throw new Error("Cyclic dependency"+h)}if(!l.has(d))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(d));if(!s[u]){s[u]=!0;var x=o.get(d)||new Set;if(x=Array.from(x),u=x.length){f.add(d);do{var m=x[--u];c(m,l.get(m),f)}while(u);f.delete(d)}n[--t]=d}}}function bR(e){for(var r=new Set,t=0,n=e.length;t<n;t++){var s=e[t];r.add(s[0]),r.add(s[1])}return Array.from(r)}function SR(e){for(var r=new Map,t=0,n=e.length;t<n;t++){var s=e[t];r.has(s[0])||r.set(s[0],new Set),r.has(s[1])||r.set(s[1],new Set),r.get(s[0]).add(s[1])}return r}function wR(e){for(var r=new Map,t=0,n=e.length;t<n;t++)r.set(e[t],t);return r}var jR=wh.exports;const ER=ts(jR),kR=Object.prototype.toString,AR=Error.prototype.toString,TR=RegExp.prototype.toString,CR=typeof Symbol<"u"?Symbol.prototype.toString:()=>"",DR=/^Symbol\((.*)\)(.*)$/;function _R(e){return e!=+e?"NaN":e===0&&1/e<0?"-0":""+e}function op(e,r=!1){if(e==null||e===!0||e===!1)return""+e;const t=typeof e;if(t==="number")return _R(e);if(t==="string")return r?`"${e}"`:e;if(t==="function")return"[Function "+(e.name||"anonymous")+"]";if(t==="symbol")return CR.call(e).replace(DR,"Symbol($1)");const n=kR.call(e).slice(8,-1);return n==="Date"?isNaN(e.getTime())?""+e:e.toISOString(e):n==="Error"||e instanceof Error?"["+AR.call(e)+"]":n==="RegExp"?TR.call(e):null}function bs(e,r){let t=op(e,r);return t!==null?t:JSON.stringify(e,function(n,s){let i=op(this[n],r);return i!==null?i:s},2)}function k1(e){return e==null?[]:[].concat(e)}let A1,T1,C1,IR=/\$\{\s*(\w+)\s*\}/g;A1=Symbol.toStringTag;class lp{constructor(r,t,n,s){this.name=void 0,this.message=void 0,this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=void 0,this.inner=void 0,this[A1]="Error",this.name="ValidationError",this.value=t,this.path=n,this.type=s,this.errors=[],this.inner=[],k1(r).forEach(i=>{if(Fn.isError(i)){this.errors.push(...i.errors);const o=i.inner.length?i.inner:[i];this.inner.push(...o)}else this.errors.push(i)}),this.message=this.errors.length>1?`${this.errors.length} errors occurred`:this.errors[0]}}T1=Symbol.hasInstance;C1=Symbol.toStringTag;class Fn extends Error{static formatError(r,t){const n=t.label||t.path||"this";return t=Object.assign({},t,{path:n,originalPath:t.path}),typeof r=="string"?r.replace(IR,(s,i)=>bs(t[i])):typeof r=="function"?r(t):r}static isError(r){return r&&r.name==="ValidationError"}constructor(r,t,n,s,i){const o=new lp(r,t,n,s);if(i)return o;super(),this.value=void 0,this.path=void 0,this.type=void 0,this.params=void 0,this.errors=[],this.inner=[],this[C1]="Error",this.name=o.name,this.message=o.message,this.type=o.type,this.value=o.value,this.path=o.path,this.errors=o.errors,this.inner=o.inner,Error.captureStackTrace&&Error.captureStackTrace(this,Fn)}static[T1](r){return lp[Symbol.hasInstance](r)||super[Symbol.hasInstance](r)}}let Ta={default:"${path} is invalid",required:"${path} is a required field",defined:"${path} must be defined",notNull:"${path} cannot be null",oneOf:"${path} must be one of the following values: ${values}",notOneOf:"${path} must not be one of the following values: ${values}",notType:({path:e,type:r,value:t,originalValue:n})=>{const s=n!=null&&n!==t?` (cast from the value \`${bs(n,!0)}\`).`:".";return r!=="mixed"?`${e} must be a \`${r}\` type, but the final value was: \`${bs(t,!0)}\``+s:`${e} must match the configured type. The validated value was: \`${bs(t,!0)}\``+s}},Cn={length:"${path} must be exactly ${length} characters",min:"${path} must be at least ${min} characters",max:"${path} must be at most ${max} characters",matches:'${path} must match the following: "${regex}"',email:"${path} must be a valid email",url:"${path} must be a valid URL",uuid:"${path} must be a valid UUID",datetime:"${path} must be a valid ISO date-time",datetime_precision:"${path} must be a valid ISO date-time with a sub-second precision of exactly ${precision} digits",datetime_offset:'${path} must be a valid ISO date-time with UTC "Z" timezone',trim:"${path} must be a trimmed string",lowercase:"${path} must be a lowercase string",uppercase:"${path} must be a upper case string"},cs={min:"${path} must be greater than or equal to ${min}",max:"${path} must be less than or equal to ${max}",lessThan:"${path} must be less than ${less}",moreThan:"${path} must be greater than ${more}",positive:"${path} must be a positive number",negative:"${path} must be a negative number",integer:"${path} must be an integer"},$u={min:"${path} field must be later than ${min}",max:"${path} field must be at earlier than ${max}"},FR={isValue:"${path} field must be ${value}"},oc={noUnknown:"${path} field has unspecified keys: ${unknown}",exact:"${path} object contains unknown properties: ${properties}"},MR={min:"${path} field must have at least ${min} items",max:"${path} field must have less than or equal to ${max} items",length:"${path} must have ${length} items"},PR={notType:e=>{const{path:r,value:t,spec:n}=e,s=n.types.length;if(Array.isArray(t)){if(t.length<s)return`${r} tuple value has too few items, expected a length of ${s} but got ${t.length} for value: \`${bs(t,!0)}\``;if(t.length>s)return`${r} tuple value has too many items, expected a length of ${s} but got ${t.length} for value: \`${bs(t,!0)}\``}return Fn.formatError(Ta.notType,e)}};Object.assign(Object.create(null),{mixed:Ta,string:Cn,number:cs,date:$u,object:oc,array:MR,boolean:FR,tuple:PR});const jh=e=>e&&e.__isYupSchema__;class Ec{static fromOptions(r,t){if(!t.then&&!t.otherwise)throw new TypeError("either `then:` or `otherwise:` is required for `when()` conditions");let{is:n,then:s,otherwise:i}=t,o=typeof n=="function"?n:(...l)=>l.every(c=>c===n);return new Ec(r,(l,c)=>{var d;let u=o(...l)?s:i;return(d=u==null?void 0:u(c))!=null?d:c})}constructor(r,t){this.fn=void 0,this.refs=r,this.refs=r,this.fn=t}resolve(r,t){let n=this.refs.map(i=>i.getValue(t==null?void 0:t.value,t==null?void 0:t.parent,t==null?void 0:t.context)),s=this.fn(n,r,t);if(s===void 0||s===r)return r;if(!jh(s))throw new TypeError("conditions must return a schema object");return s.resolve(t)}}const Bl={context:"$",value:"."};class xi{constructor(r,t={}){if(this.key=void 0,this.isContext=void 0,this.isValue=void 0,this.isSibling=void 0,this.path=void 0,this.getter=void 0,this.map=void 0,typeof r!="string")throw new TypeError("ref must be a string, got: "+r);if(this.key=r.trim(),r==="")throw new TypeError("ref must be a non-empty string");this.isContext=this.key[0]===Bl.context,this.isValue=this.key[0]===Bl.value,this.isSibling=!this.isContext&&!this.isValue;let n=this.isContext?Bl.context:this.isValue?Bl.value:"";this.path=this.key.slice(n.length),this.getter=this.path&&Ks.getter(this.path,!0),this.map=t.map}getValue(r,t,n){let s=this.isContext?n:this.isValue?r:t;return this.getter&&(s=this.getter(s||{})),this.map&&(s=this.map(s)),s}cast(r,t){return this.getValue(r,t==null?void 0:t.parent,t==null?void 0:t.context)}resolve(){return this}describe(){return{type:"ref",key:this.key}}toString(){return`Ref(${this.key})`}static isRef(r){return r&&r.__isYupRef}}xi.prototype.__isYupRef=!0;const Ha=e=>e==null;function Ci(e){function r({value:t,path:n="",options:s,originalValue:i,schema:o},l,c){const{name:d,test:u,params:f,message:h,skipAbsent:x}=e;let{parent:m,context:g,abortEarly:p=o.spec.abortEarly,disableStackTrace:y=o.spec.disableStackTrace}=s;function S(I){return xi.isRef(I)?I.getValue(t,m,g):I}function v(I={}){const D=Object.assign({value:t,originalValue:i,label:o.spec.label,path:I.path||n,spec:o.spec,disableStackTrace:I.disableStackTrace||y},f,I.params);for(const R of Object.keys(D))D[R]=S(D[R]);const B=new Fn(Fn.formatError(I.message||h,D),t,D.path,I.type||d,D.disableStackTrace);return B.params=D,B}const E=p?l:c;let C={path:n,parent:m,type:d,from:s.from,createError:v,resolve:S,options:s,originalValue:i,schema:o};const A=I=>{Fn.isError(I)?E(I):I?c(null):E(v())},j=I=>{Fn.isError(I)?E(I):l(I)};if(x&&Ha(t))return A(!0);let k;try{var _;if(k=u.call(C,t,C),typeof((_=k)==null?void 0:_.then)=="function"){if(s.sync)throw new Error(`Validation test of type: "${C.type}" returned a Promise during a synchronous validate. This test will finish after the validate call has returned`);return Promise.resolve(k).then(A,j)}}catch(I){j(I);return}A(k)}return r.OPTIONS=e,r}function NR(e,r,t,n=t){let s,i,o;return r?(Ks.forEach(r,(l,c,d)=>{let u=c?l.slice(1,l.length-1):l;e=e.resolve({context:n,parent:s,value:t});let f=e.type==="tuple",h=d?parseInt(u,10):0;if(e.innerType||f){if(f&&!d)throw new Error(`Yup.reach cannot implicitly index into a tuple type. the path part "${o}" must contain an index to the tuple element, e.g. "${o}[0]"`);if(t&&h>=t.length)throw new Error(`Yup.reach cannot resolve an array item at index: ${l}, in the path: ${r}. because there is no value at that index. `);s=t,t=t&&t[h],e=f?e.spec.types[h]:e.innerType}if(!d){if(!e.fields||!e.fields[u])throw new Error(`The schema does not contain the path: ${r}. (failed at: ${o} which is a type: "${e.type}")`);s=t,t=t&&t[u],e=e.fields[u]}i=u,o=c?"["+l+"]":"."+l}),{schema:e,parent:s,parentPath:i}):{parent:s,parentPath:r,schema:e}}class kc extends Set{describe(){const r=[];for(const t of this.values())r.push(xi.isRef(t)?t.describe():t);return r}resolveAll(r){let t=[];for(const n of this.values())t.push(r(n));return t}clone(){return new kc(this.values())}merge(r,t){const n=this.clone();return r.forEach(s=>n.add(s)),t.forEach(s=>n.delete(s)),n}}function Fi(e,r=new Map){if(jh(e)||!e||typeof e!="object")return e;if(r.has(e))return r.get(e);let t;if(e instanceof Date)t=new Date(e.getTime()),r.set(e,t);else if(e instanceof RegExp)t=new RegExp(e),r.set(e,t);else if(Array.isArray(e)){t=new Array(e.length),r.set(e,t);for(let n=0;n<e.length;n++)t[n]=Fi(e[n],r)}else if(e instanceof Map){t=new Map,r.set(e,t);for(const[n,s]of e.entries())t.set(n,Fi(s,r))}else if(e instanceof Set){t=new Set,r.set(e,t);for(const n of e)t.add(Fi(n,r))}else if(e instanceof Object){t={},r.set(e,t);for(const[n,s]of Object.entries(e))t[n]=Fi(s,r)}else throw Error(`Unable to clone ${e}`);return t}class va{constructor(r){this.type=void 0,this.deps=[],this.tests=void 0,this.transforms=void 0,this.conditions=[],this._mutate=void 0,this.internalTests={},this._whitelist=new kc,this._blacklist=new kc,this.exclusiveTests=Object.create(null),this._typeCheck=void 0,this.spec=void 0,this.tests=[],this.transforms=[],this.withMutation(()=>{this.typeError(Ta.notType)}),this.type=r.type,this._typeCheck=r.check,this.spec=Object.assign({strip:!1,strict:!1,abortEarly:!0,recursive:!0,disableStackTrace:!1,nullable:!1,optional:!0,coerce:!0},r==null?void 0:r.spec),this.withMutation(t=>{t.nonNullable()})}get _type(){return this.type}clone(r){if(this._mutate)return r&&Object.assign(this.spec,r),this;const t=Object.create(Object.getPrototypeOf(this));return t.type=this.type,t._typeCheck=this._typeCheck,t._whitelist=this._whitelist.clone(),t._blacklist=this._blacklist.clone(),t.internalTests=Object.assign({},this.internalTests),t.exclusiveTests=Object.assign({},this.exclusiveTests),t.deps=[...this.deps],t.conditions=[...this.conditions],t.tests=[...this.tests],t.transforms=[...this.transforms],t.spec=Fi(Object.assign({},this.spec,r)),t}label(r){let t=this.clone();return t.spec.label=r,t}meta(...r){if(r.length===0)return this.spec.meta;let t=this.clone();return t.spec.meta=Object.assign(t.spec.meta||{},r[0]),t}withMutation(r){let t=this._mutate;this._mutate=!0;let n=r(this);return this._mutate=t,n}concat(r){if(!r||r===this)return this;if(r.type!==this.type&&this.type!=="mixed")throw new TypeError(`You cannot \`concat()\` schema's of different types: ${this.type} and ${r.type}`);let t=this,n=r.clone();const s=Object.assign({},t.spec,n.spec);return n.spec=s,n.internalTests=Object.assign({},t.internalTests,n.internalTests),n._whitelist=t._whitelist.merge(r._whitelist,r._blacklist),n._blacklist=t._blacklist.merge(r._blacklist,r._whitelist),n.tests=t.tests,n.exclusiveTests=t.exclusiveTests,n.withMutation(i=>{r.tests.forEach(o=>{i.test(o.OPTIONS)})}),n.transforms=[...t.transforms,...n.transforms],n}isType(r){return r==null?!!(this.spec.nullable&&r===null||this.spec.optional&&r===void 0):this._typeCheck(r)}resolve(r){let t=this;if(t.conditions.length){let n=t.conditions;t=t.clone(),t.conditions=[],t=n.reduce((s,i)=>i.resolve(s,r),t),t=t.resolve(r)}return t}resolveOptions(r){var t,n,s,i;return Object.assign({},r,{from:r.from||[],strict:(t=r.strict)!=null?t:this.spec.strict,abortEarly:(n=r.abortEarly)!=null?n:this.spec.abortEarly,recursive:(s=r.recursive)!=null?s:this.spec.recursive,disableStackTrace:(i=r.disableStackTrace)!=null?i:this.spec.disableStackTrace})}cast(r,t={}){let n=this.resolve(Object.assign({value:r},t)),s=t.assert==="ignore-optionality",i=n._cast(r,t);if(t.assert!==!1&&!n.isType(i)){if(s&&Ha(i))return i;let o=bs(r),l=bs(i);throw new TypeError(`The value of ${t.path||"field"} could not be cast to a value that satisfies the schema type: "${n.type}". 

attempted value: ${o} 
`+(l!==o?`result of cast: ${l}`:""))}return i}_cast(r,t){let n=r===void 0?r:this.transforms.reduce((s,i)=>i.call(this,s,r,this),r);return n===void 0&&(n=this.getDefault(t)),n}_validate(r,t={},n,s){let{path:i,originalValue:o=r,strict:l=this.spec.strict}=t,c=r;l||(c=this._cast(c,Object.assign({assert:!1},t)));let d=[];for(let u of Object.values(this.internalTests))u&&d.push(u);this.runTests({path:i,value:c,originalValue:o,options:t,tests:d},n,u=>{if(u.length)return s(u,c);this.runTests({path:i,value:c,originalValue:o,options:t,tests:this.tests},n,s)})}runTests(r,t,n){let s=!1,{tests:i,value:o,originalValue:l,path:c,options:d}=r,u=g=>{s||(s=!0,t(g,o))},f=g=>{s||(s=!0,n(g,o))},h=i.length,x=[];if(!h)return f([]);let m={value:o,originalValue:l,path:c,options:d,schema:this};for(let g=0;g<i.length;g++){const p=i[g];p(m,u,function(S){S&&(Array.isArray(S)?x.push(...S):x.push(S)),--h<=0&&f(x)})}}asNestedTest({key:r,index:t,parent:n,parentPath:s,originalParent:i,options:o}){const l=r??t;if(l==null)throw TypeError("Must include `key` or `index` for nested validations");const c=typeof l=="number";let d=n[l];const u=Object.assign({},o,{strict:!0,parent:n,value:d,originalValue:i[l],key:void 0,[c?"index":"key"]:l,path:c||l.includes(".")?`${s||""}[${c?l:`"${l}"`}]`:(s?`${s}.`:"")+r});return(f,h,x)=>this.resolve(u)._validate(d,u,h,x)}validate(r,t){var n;let s=this.resolve(Object.assign({},t,{value:r})),i=(n=t==null?void 0:t.disableStackTrace)!=null?n:s.spec.disableStackTrace;return new Promise((o,l)=>s._validate(r,t,(c,d)=>{Fn.isError(c)&&(c.value=d),l(c)},(c,d)=>{c.length?l(new Fn(c,d,void 0,void 0,i)):o(d)}))}validateSync(r,t){var n;let s=this.resolve(Object.assign({},t,{value:r})),i,o=(n=t==null?void 0:t.disableStackTrace)!=null?n:s.spec.disableStackTrace;return s._validate(r,Object.assign({},t,{sync:!0}),(l,c)=>{throw Fn.isError(l)&&(l.value=c),l},(l,c)=>{if(l.length)throw new Fn(l,r,void 0,void 0,o);i=c}),i}isValid(r,t){return this.validate(r,t).then(()=>!0,n=>{if(Fn.isError(n))return!1;throw n})}isValidSync(r,t){try{return this.validateSync(r,t),!0}catch(n){if(Fn.isError(n))return!1;throw n}}_getDefault(r){let t=this.spec.default;return t==null?t:typeof t=="function"?t.call(this,r):Fi(t)}getDefault(r){return this.resolve(r||{})._getDefault(r)}default(r){return arguments.length===0?this._getDefault():this.clone({default:r})}strict(r=!0){return this.clone({strict:r})}nullability(r,t){const n=this.clone({nullable:r});return n.internalTests.nullable=Ci({message:t,name:"nullable",test(s){return s===null?this.schema.spec.nullable:!0}}),n}optionality(r,t){const n=this.clone({optional:r});return n.internalTests.optionality=Ci({message:t,name:"optionality",test(s){return s===void 0?this.schema.spec.optional:!0}}),n}optional(){return this.optionality(!0)}defined(r=Ta.defined){return this.optionality(!1,r)}nullable(){return this.nullability(!0)}nonNullable(r=Ta.notNull){return this.nullability(!1,r)}required(r=Ta.required){return this.clone().withMutation(t=>t.nonNullable(r).defined(r))}notRequired(){return this.clone().withMutation(r=>r.nullable().optional())}transform(r){let t=this.clone();return t.transforms.push(r),t}test(...r){let t;if(r.length===1?typeof r[0]=="function"?t={test:r[0]}:t=r[0]:r.length===2?t={name:r[0],test:r[1]}:t={name:r[0],message:r[1],test:r[2]},t.message===void 0&&(t.message=Ta.default),typeof t.test!="function")throw new TypeError("`test` is a required parameters");let n=this.clone(),s=Ci(t),i=t.exclusive||t.name&&n.exclusiveTests[t.name]===!0;if(t.exclusive&&!t.name)throw new TypeError("Exclusive tests must provide a unique `name` identifying the test");return t.name&&(n.exclusiveTests[t.name]=!!t.exclusive),n.tests=n.tests.filter(o=>!(o.OPTIONS.name===t.name&&(i||o.OPTIONS.test===s.OPTIONS.test))),n.tests.push(s),n}when(r,t){!Array.isArray(r)&&typeof r!="string"&&(t=r,r=".");let n=this.clone(),s=k1(r).map(i=>new xi(i));return s.forEach(i=>{i.isSibling&&n.deps.push(i.key)}),n.conditions.push(typeof t=="function"?new Ec(s,t):Ec.fromOptions(s,t)),n}typeError(r){let t=this.clone();return t.internalTests.typeError=Ci({message:r,name:"typeError",skipAbsent:!0,test(n){return this.schema._typeCheck(n)?!0:this.createError({params:{type:this.schema.type}})}}),t}oneOf(r,t=Ta.oneOf){let n=this.clone();return r.forEach(s=>{n._whitelist.add(s),n._blacklist.delete(s)}),n.internalTests.whiteList=Ci({message:t,name:"oneOf",skipAbsent:!0,test(s){let i=this.schema._whitelist,o=i.resolveAll(this.resolve);return o.includes(s)?!0:this.createError({params:{values:Array.from(i).join(", "),resolved:o}})}}),n}notOneOf(r,t=Ta.notOneOf){let n=this.clone();return r.forEach(s=>{n._blacklist.add(s),n._whitelist.delete(s)}),n.internalTests.blacklist=Ci({message:t,name:"notOneOf",test(s){let i=this.schema._blacklist,o=i.resolveAll(this.resolve);return o.includes(s)?this.createError({params:{values:Array.from(i).join(", "),resolved:o}}):!0}}),n}strip(r=!0){let t=this.clone();return t.spec.strip=r,t}describe(r){const t=(r?this.resolve(r):this).clone(),{label:n,meta:s,optional:i,nullable:o}=t.spec;return{meta:s,label:n,optional:i,nullable:o,default:t.getDefault(r),type:t.type,oneOf:t._whitelist.describe(),notOneOf:t._blacklist.describe(),tests:t.tests.map(c=>({name:c.OPTIONS.name,params:c.OPTIONS.params})).filter((c,d,u)=>u.findIndex(f=>f.name===c.name)===d)}}}va.prototype.__isYupSchema__=!0;for(const e of["validate","validateSync"])va.prototype[`${e}At`]=function(r,t,n={}){const{parent:s,parentPath:i,schema:o}=NR(this,r,t,n.context);return o[e](s&&s[i],Object.assign({},n,{parent:s,path:r}))};for(const e of["equals","is"])va.prototype[e]=va.prototype.oneOf;for(const e of["not","nope"])va.prototype[e]=va.prototype.notOneOf;const RR=/^(\d{4}|[+-]\d{6})(?:-?(\d{2})(?:-?(\d{2}))?)?(?:[ T]?(\d{2}):?(\d{2})(?::?(\d{2})(?:[,.](\d{1,}))?)?(?:(Z)|([+-])(\d{2})(?::?(\d{2}))?)?)?$/;function OR(e){const r=Bu(e);if(!r)return Date.parse?Date.parse(e):Number.NaN;if(r.z===void 0&&r.plusMinus===void 0)return new Date(r.year,r.month,r.day,r.hour,r.minute,r.second,r.millisecond).valueOf();let t=0;return r.z!=="Z"&&r.plusMinus!==void 0&&(t=r.hourOffset*60+r.minuteOffset,r.plusMinus==="+"&&(t=0-t)),Date.UTC(r.year,r.month,r.day,r.hour,r.minute+t,r.second,r.millisecond)}function Bu(e){var r,t;const n=RR.exec(e);return n?{year:Va(n[1]),month:Va(n[2],1)-1,day:Va(n[3],1),hour:Va(n[4]),minute:Va(n[5]),second:Va(n[6]),millisecond:n[7]?Va(n[7].substring(0,3)):0,precision:(r=(t=n[7])==null?void 0:t.length)!=null?r:void 0,z:n[8]||void 0,plusMinus:n[9]||void 0,hourOffset:Va(n[10]),minuteOffset:Va(n[11])}:null}function Va(e,r=0){return Number(e)||r}let LR=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,$R=/^((https?|ftp):)?\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i,BR=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,UR="^\\d{4}-\\d{2}-\\d{2}",VR="\\d{2}:\\d{2}:\\d{2}",WR="(([+-]\\d{2}(:?\\d{2})?)|Z)",HR=new RegExp(`${UR}T${VR}(\\.\\d+)?${WR}$`),YR=e=>Ha(e)||e===e.trim(),zR={}.toString();function Ao(){return new D1}class D1 extends va{constructor(){super({type:"string",check(r){return r instanceof String&&(r=r.valueOf()),typeof r=="string"}}),this.withMutation(()=>{this.transform((r,t,n)=>{if(!n.spec.coerce||n.isType(r)||Array.isArray(r))return r;const s=r!=null&&r.toString?r.toString():r;return s===zR?r:s})})}required(r){return super.required(r).withMutation(t=>t.test({message:r||Ta.required,name:"required",skipAbsent:!0,test:n=>!!n.length}))}notRequired(){return super.notRequired().withMutation(r=>(r.tests=r.tests.filter(t=>t.OPTIONS.name!=="required"),r))}length(r,t=Cn.length){return this.test({message:t,name:"length",exclusive:!0,params:{length:r},skipAbsent:!0,test(n){return n.length===this.resolve(r)}})}min(r,t=Cn.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:r},skipAbsent:!0,test(n){return n.length>=this.resolve(r)}})}max(r,t=Cn.max){return this.test({name:"max",exclusive:!0,message:t,params:{max:r},skipAbsent:!0,test(n){return n.length<=this.resolve(r)}})}matches(r,t){let n=!1,s,i;return t&&(typeof t=="object"?{excludeEmptyString:n=!1,message:s,name:i}=t:s=t),this.test({name:i||"matches",message:s||Cn.matches,params:{regex:r},skipAbsent:!0,test:o=>o===""&&n||o.search(r)!==-1})}email(r=Cn.email){return this.matches(LR,{name:"email",message:r,excludeEmptyString:!0})}url(r=Cn.url){return this.matches($R,{name:"url",message:r,excludeEmptyString:!0})}uuid(r=Cn.uuid){return this.matches(BR,{name:"uuid",message:r,excludeEmptyString:!1})}datetime(r){let t="",n,s;return r&&(typeof r=="object"?{message:t="",allowOffset:n=!1,precision:s=void 0}=r:t=r),this.matches(HR,{name:"datetime",message:t||Cn.datetime,excludeEmptyString:!0}).test({name:"datetime_offset",message:t||Cn.datetime_offset,params:{allowOffset:n},skipAbsent:!0,test:i=>{if(!i||n)return!0;const o=Bu(i);return o?!!o.z:!1}}).test({name:"datetime_precision",message:t||Cn.datetime_precision,params:{precision:s},skipAbsent:!0,test:i=>{if(!i||s==null)return!0;const o=Bu(i);return o?o.precision===s:!1}})}ensure(){return this.default("").transform(r=>r===null?"":r)}trim(r=Cn.trim){return this.transform(t=>t!=null?t.trim():t).test({message:r,name:"trim",test:YR})}lowercase(r=Cn.lowercase){return this.transform(t=>Ha(t)?t:t.toLowerCase()).test({message:r,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>Ha(t)||t===t.toLowerCase()})}uppercase(r=Cn.uppercase){return this.transform(t=>Ha(t)?t:t.toUpperCase()).test({message:r,name:"string_case",exclusive:!0,skipAbsent:!0,test:t=>Ha(t)||t===t.toUpperCase()})}}Ao.prototype=D1.prototype;let GR=e=>e!=+e;function _1(){return new I1}class I1 extends va{constructor(){super({type:"number",check(r){return r instanceof Number&&(r=r.valueOf()),typeof r=="number"&&!GR(r)}}),this.withMutation(()=>{this.transform((r,t,n)=>{if(!n.spec.coerce)return r;let s=r;if(typeof s=="string"){if(s=s.replace(/\s/g,""),s==="")return NaN;s=+s}return n.isType(s)||s===null?s:parseFloat(s)})})}min(r,t=cs.min){return this.test({message:t,name:"min",exclusive:!0,params:{min:r},skipAbsent:!0,test(n){return n>=this.resolve(r)}})}max(r,t=cs.max){return this.test({message:t,name:"max",exclusive:!0,params:{max:r},skipAbsent:!0,test(n){return n<=this.resolve(r)}})}lessThan(r,t=cs.lessThan){return this.test({message:t,name:"max",exclusive:!0,params:{less:r},skipAbsent:!0,test(n){return n<this.resolve(r)}})}moreThan(r,t=cs.moreThan){return this.test({message:t,name:"min",exclusive:!0,params:{more:r},skipAbsent:!0,test(n){return n>this.resolve(r)}})}positive(r=cs.positive){return this.moreThan(0,r)}negative(r=cs.negative){return this.lessThan(0,r)}integer(r=cs.integer){return this.test({name:"integer",message:r,skipAbsent:!0,test:t=>Number.isInteger(t)})}truncate(){return this.transform(r=>Ha(r)?r:r|0)}round(r){var t;let n=["ceil","floor","round","trunc"];if(r=((t=r)==null?void 0:t.toLowerCase())||"round",r==="trunc")return this.truncate();if(n.indexOf(r.toLowerCase())===-1)throw new TypeError("Only valid options for round() are: "+n.join(", "));return this.transform(s=>Ha(s)?s:Math[r](s))}}_1.prototype=I1.prototype;let F1=new Date(""),qR=e=>Object.prototype.toString.call(e)==="[object Date]";function Eh(){return new Sl}class Sl extends va{constructor(){super({type:"date",check(r){return qR(r)&&!isNaN(r.getTime())}}),this.withMutation(()=>{this.transform((r,t,n)=>!n.spec.coerce||n.isType(r)||r===null?r:(r=OR(r),isNaN(r)?Sl.INVALID_DATE:new Date(r)))})}prepareParam(r,t){let n;if(xi.isRef(r))n=r;else{let s=this.cast(r);if(!this._typeCheck(s))throw new TypeError(`\`${t}\` must be a Date or a value that can be \`cast()\` to a Date`);n=s}return n}min(r,t=$u.min){let n=this.prepareParam(r,"min");return this.test({message:t,name:"min",exclusive:!0,params:{min:r},skipAbsent:!0,test(s){return s>=this.resolve(n)}})}max(r,t=$u.max){let n=this.prepareParam(r,"max");return this.test({message:t,name:"max",exclusive:!0,params:{max:r},skipAbsent:!0,test(s){return s<=this.resolve(n)}})}}Sl.INVALID_DATE=F1;Eh.prototype=Sl.prototype;Eh.INVALID_DATE=F1;function XR(e,r=[]){let t=[],n=new Set,s=new Set(r.map(([o,l])=>`${o}-${l}`));function i(o,l){let c=Ks.split(o)[0];n.add(c),s.has(`${l}-${c}`)||t.push([l,c])}for(const o of Object.keys(e)){let l=e[o];n.add(o),xi.isRef(l)&&l.isSibling?i(l.path,o):jh(l)&&"deps"in l&&l.deps.forEach(c=>i(c,o))}return ER.array(Array.from(n),t).reverse()}function cp(e,r){let t=1/0;return e.some((n,s)=>{var i;if((i=r.path)!=null&&i.includes(n))return t=s,!0}),t}function M1(e){return(r,t)=>cp(e,r)-cp(e,t)}const KR=(e,r,t)=>{if(typeof e!="string")return e;let n=e;try{n=JSON.parse(e)}catch{}return t.isType(n)?n:e};function lc(e){if("fields"in e){const r={};for(const[t,n]of Object.entries(e.fields))r[t]=lc(n);return e.setFields(r)}if(e.type==="array"){const r=e.optional();return r.innerType&&(r.innerType=lc(r.innerType)),r}return e.type==="tuple"?e.optional().clone({types:e.spec.types.map(lc)}):"optional"in e?e.optional():e}const JR=(e,r)=>{const t=[...Ks.normalizePath(r)];if(t.length===1)return t[0]in e;let n=t.pop(),s=Ks.getter(Ks.join(t),!0)(e);return!!(s&&n in s)};let dp=e=>Object.prototype.toString.call(e)==="[object Object]";function up(e,r){let t=Object.keys(e.fields);return Object.keys(r).filter(n=>t.indexOf(n)===-1)}const QR=M1([]);function P1(e){return new N1(e)}class N1 extends va{constructor(r){super({type:"object",check(t){return dp(t)||typeof t=="function"}}),this.fields=Object.create(null),this._sortErrors=QR,this._nodes=[],this._excludedEdges=[],this.withMutation(()=>{r&&this.shape(r)})}_cast(r,t={}){var n;let s=super._cast(r,t);if(s===void 0)return this.getDefault(t);if(!this._typeCheck(s))return s;let i=this.fields,o=(n=t.stripUnknown)!=null?n:this.spec.noUnknown,l=[].concat(this._nodes,Object.keys(s).filter(f=>!this._nodes.includes(f))),c={},d=Object.assign({},t,{parent:c,__validating:t.__validating||!1}),u=!1;for(const f of l){let h=i[f],x=f in s;if(h){let m,g=s[f];d.path=(t.path?`${t.path}.`:"")+f,h=h.resolve({value:g,context:t.context,parent:c});let p=h instanceof va?h.spec:void 0,y=p==null?void 0:p.strict;if(p!=null&&p.strip){u=u||f in s;continue}m=!t.__validating||!y?h.cast(s[f],d):s[f],m!==void 0&&(c[f]=m)}else x&&!o&&(c[f]=s[f]);(x!==f in c||c[f]!==s[f])&&(u=!0)}return u?c:s}_validate(r,t={},n,s){let{from:i=[],originalValue:o=r,recursive:l=this.spec.recursive}=t;t.from=[{schema:this,value:o},...i],t.__validating=!0,t.originalValue=o,super._validate(r,t,n,(c,d)=>{if(!l||!dp(d)){s(c,d);return}o=o||d;let u=[];for(let f of this._nodes){let h=this.fields[f];!h||xi.isRef(h)||u.push(h.asNestedTest({options:t,key:f,parent:d,parentPath:t.path,originalParent:o}))}this.runTests({tests:u,value:d,originalValue:o,options:t},n,f=>{s(f.sort(this._sortErrors).concat(c),d)})})}clone(r){const t=super.clone(r);return t.fields=Object.assign({},this.fields),t._nodes=this._nodes,t._excludedEdges=this._excludedEdges,t._sortErrors=this._sortErrors,t}concat(r){let t=super.concat(r),n=t.fields;for(let[s,i]of Object.entries(this.fields)){const o=n[s];n[s]=o===void 0?i:o}return t.withMutation(s=>s.setFields(n,[...this._excludedEdges,...r._excludedEdges]))}_getDefault(r){if("default"in this.spec)return super._getDefault(r);if(!this._nodes.length)return;let t={};return this._nodes.forEach(n=>{var s;const i=this.fields[n];let o=r;(s=o)!=null&&s.value&&(o=Object.assign({},o,{parent:o.value,value:o.value[n]})),t[n]=i&&"getDefault"in i?i.getDefault(o):void 0}),t}setFields(r,t){let n=this.clone();return n.fields=r,n._nodes=XR(r,t),n._sortErrors=M1(Object.keys(r)),t&&(n._excludedEdges=t),n}shape(r,t=[]){return this.clone().withMutation(n=>{let s=n._excludedEdges;return t.length&&(Array.isArray(t[0])||(t=[t]),s=[...n._excludedEdges,...t]),n.setFields(Object.assign(n.fields,r),s)})}partial(){const r={};for(const[t,n]of Object.entries(this.fields))r[t]="optional"in n&&n.optional instanceof Function?n.optional():n;return this.setFields(r)}deepPartial(){return lc(this)}pick(r){const t={};for(const n of r)this.fields[n]&&(t[n]=this.fields[n]);return this.setFields(t,this._excludedEdges.filter(([n,s])=>r.includes(n)&&r.includes(s)))}omit(r){const t=[];for(const n of Object.keys(this.fields))r.includes(n)||t.push(n);return this.pick(t)}from(r,t,n){let s=Ks.getter(r,!0);return this.transform(i=>{if(!i)return i;let o=i;return JR(i,r)&&(o=Object.assign({},i),n||delete o[r],o[t]=s(i)),o})}json(){return this.transform(KR)}exact(r){return this.test({name:"exact",exclusive:!0,message:r||oc.exact,test(t){if(t==null)return!0;const n=up(this.schema,t);return n.length===0||this.createError({params:{properties:n.join(", ")}})}})}stripUnknown(){return this.clone({noUnknown:!0})}noUnknown(r=!0,t=oc.noUnknown){typeof r!="boolean"&&(t=r,r=!0);let n=this.test({name:"noUnknown",exclusive:!0,message:t,test(s){if(s==null)return!0;const i=up(this.schema,s);return!r||i.length===0||this.createError({params:{unknown:i.join(", ")}})}});return n.spec.noUnknown=r,n}unknown(r=!0,t=oc.noUnknown){return this.noUnknown(!r,t)}transformKeys(r){return this.transform(t=>{if(!t)return t;const n={};for(const s of Object.keys(t))n[r(s)]=t[s];return n})}camelCase(){return this.transformKeys(Jd.camelCase)}snakeCase(){return this.transformKeys(Jd.snakeCase)}constantCase(){return this.transformKeys(r=>Jd.snakeCase(r).toUpperCase())}describe(r){const t=(r?this.resolve(r):this).clone(),n=super.describe(r);n.fields={};for(const[i,o]of Object.entries(t.fields)){var s;let l=r;(s=l)!=null&&s.value&&(l=Object.assign({},l,{parent:l.value,value:l.value[i]})),n.fields[i]=o.describe(l)}return n}}P1.prototype=N1.prototype;function ZR(e,r){const t=()=>cr(r==null?void 0:r.in,NaN),n=(r==null?void 0:r.additionalDigits)??2,s=nO(e);let i;if(s.date){const d=aO(s.date,n);i=sO(d.restDateString,d.year)}if(!i||isNaN(+i))return t();const o=+i;let l=0,c;if(s.time&&(l=iO(s.time),isNaN(l)))return t();if(s.timezone){if(c=oO(s.timezone),isNaN(c))return t()}else{const d=new Date(o+l),u=lt(0,r==null?void 0:r.in);return u.setFullYear(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()),u.setHours(d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()),u}return lt(o+l+c,r==null?void 0:r.in)}const Ul={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},eO=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,tO=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,rO=/^([+-])(\d{2})(?::?(\d{2}))?$/;function nO(e){const r={},t=e.split(Ul.dateTimeDelimiter);let n;if(t.length>2)return r;if(/:/.test(t[0])?n=t[0]:(r.date=t[0],n=t[1],Ul.timeZoneDelimiter.test(r.date)&&(r.date=e.split(Ul.timeZoneDelimiter)[0],n=e.substr(r.date.length,e.length))),n){const s=Ul.timezone.exec(n);s?(r.time=n.replace(s[1],""),r.timezone=s[1]):r.time=n}return r}function aO(e,r){const t=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),n=e.match(t);if(!n)return{year:NaN,restDateString:""};const s=n[1]?parseInt(n[1]):null,i=n[2]?parseInt(n[2]):null;return{year:i===null?s:i*100,restDateString:e.slice((n[1]||n[2]).length)}}function sO(e,r){if(r===null)return new Date(NaN);const t=e.match(eO);if(!t)return new Date(NaN);const n=!!t[4],s=wo(t[1]),i=wo(t[2])-1,o=wo(t[3]),l=wo(t[4]),c=wo(t[5])-1;if(n)return fO(r,l,c)?lO(r,l,c):new Date(NaN);{const d=new Date(0);return!dO(r,i,o)||!uO(r,s)?new Date(NaN):(d.setUTCFullYear(r,i,Math.max(s,o)),d)}}function wo(e){return e?parseInt(e):1}function iO(e){const r=e.match(tO);if(!r)return NaN;const t=Qd(r[1]),n=Qd(r[2]),s=Qd(r[3]);return hO(t,n,s)?t*cd+n*ld+s*1e3:NaN}function Qd(e){return e&&parseFloat(e.replace(",","."))||0}function oO(e){if(e==="Z")return 0;const r=e.match(rO);if(!r)return 0;const t=r[1]==="+"?-1:1,n=parseInt(r[2]),s=r[3]&&parseInt(r[3])||0;return mO(n,s)?t*(n*cd+s*ld):NaN}function lO(e,r,t){const n=new Date(0);n.setUTCFullYear(e,0,4);const s=n.getUTCDay()||7,i=(r-1)*7+t+1-s;return n.setUTCDate(n.getUTCDate()+i),n}const cO=[31,null,31,30,31,30,31,31,30,31,30,31];function R1(e){return e%400===0||e%4===0&&e%100!==0}function dO(e,r,t){return r>=0&&r<=11&&t>=1&&t<=(cO[r]||(R1(e)?29:28))}function uO(e,r){return r>=1&&r<=(R1(e)?366:365)}function fO(e,r,t){return r>=1&&r<=53&&t>=0&&t<=6}function hO(e,r,t){return e===24?r===0&&t===0:t>=0&&t<60&&r>=0&&r<60&&e>=0&&e<25}function mO(e,r){return r>=0&&r<=59}var Un=(e=>(e.CASH="CASH",e.CHEQUE="CHEQUE",e.CHECK="CHECK",e.BANK_TRANSFER="BANK_TRANSFER",e.UPI="UPI",e.CREDIT_CARD="CREDIT_CARD",e.ONLINE="ONLINE",e))(Un||{}),ha=(e=>(e.MONTHLY="MONTHLY",e.QUARTERLY="QUARTERLY",e.HALF_YEARLY="HALF_YEARLY",e.YEARLY="YEARLY",e))(ha||{});const O1=({open:e,studentId:r,onClose:t,onSubmit:n,loading:s,initialData:i})=>{const[o,l]=b.useState((i==null?void 0:i.frequency)||ha.MONTHLY),{data:c,loading:d,error:u,refetch:f}=Gt(()=>r?Bt.getStudentFeeDetails(r):Promise.reject("No student selected"),{dependencies:[r],skip:!r}),{data:h,loading:x}=Gt(()=>r?Bt.getStudentPaymentHistory(r):Promise.reject("No student selected"),{dependencies:[r],skip:!r}),m=(E,C)=>{if(!E)return 0;const A=E.totalFees||E.annualFees||0;switch(C){case ha.MONTHLY:return A/12;case ha.QUARTERLY:return A/4;case ha.HALF_YEARLY:return A/2;case ha.YEARLY:return A;default:return A/12}},p=(()=>{if(!(c!=null&&c.feeStructure)||!h)return{paid:0,remaining:0,totalAnnualFee:0};const E=c.feeStructure.totalFees||c.feeStructure.annualFees||0,C=Array.isArray(h)?h.reduce((j,w)=>j+(w.amount||0),0):0,A=E-C;return{paid:C,remaining:A,totalAnnualFee:E}})(),y=P1({amount:_1().positive("Amount must be positive").required("Amount is required").test("not-exceeding-pending","Amount exceeds remaining fees",function(E){return i!=null&&i.id?!0:E<=p.remaining}),paymentMethod:Ao().required("Payment method is required"),paymentDate:Eh().required("Payment date is required").max(new Date,"Payment date cannot be in the future"),frequency:Ao().required("Payment frequency is required"),reference:Ao().when("paymentMethod",{is:E=>E!==Un.CASH,then:E=>E.required("Reference number is required for non-cash payments")}),notes:Ao().max(200,"Notes must be less than 200 characters")}),S=QN({initialValues:{amount:(i==null?void 0:i.amount)??m(c==null?void 0:c.feeStructure,o),paymentMethod:(i==null?void 0:i.paymentMethod)??Un.CASH,paymentDate:(i==null?void 0:i.paymentDate)??xs(new Date,"yyyy-MM-dd"),frequency:(i==null?void 0:i.frequency)??ha.MONTHLY,reference:(i==null?void 0:i.reference)??"",notes:(i==null?void 0:i.notes)??""},validationSchema:y,enableReinitialize:!0,onSubmit:E=>{if(r){const C={studentId:r,id:i==null?void 0:i.id,paymentDate:typeof E.paymentDate=="string"?E.paymentDate:xs(E.paymentDate,"yyyy-MM-dd"),amount:E.amount,amountPaid:E.amount,paymentMethod:E.paymentMethod,frequency:E.frequency,transactionReference:E.reference||"",remarks:E.notes||"",paymentStatus:"PAID",academicYear:new Date().getFullYear().toString(),academicTerm:"CURRENT",payerName:"Parent/Guardian",payerContactInfo:"",payerRelationToStudent:"PARENT",receiptNumber:`RCPT-${Date.now().toString().slice(-8)}`};n(C)}}});b.useEffect(()=>{if(!(i!=null&&i.id)){const E=m(c==null?void 0:c.feeStructure,S.values.frequency);S.setFieldValue("amount",E)}},[S.values.frequency,c==null?void 0:c.feeStructure]);const v=E=>{const C=E.target.value;l(C),S.setFieldValue("frequency",C)};return a.jsxs(At,{open:e,onClose:t,maxWidth:"md",fullWidth:!0,children:[a.jsxs(Dt,{sx:{display:"flex",alignItems:"center",mb:1},children:[a.jsx(Vc,{sx:{mr:1}}),i!=null&&i.id?"Edit Payment":"Record New Payment"]}),a.jsxs("form",{onSubmit:S.handleSubmit,children:[a.jsxs(Tt,{children:[u&&a.jsx(Kr,{message:"Error loading student fees information"}),!d&&c&&a.jsxs(ee,{sx:{mb:3,p:2,bgcolor:"#f8f9fa",borderRadius:1},children:[a.jsx(V,{variant:"subtitle1",gutterBottom:!0,children:"Fee Status"}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsxs(X,{item:!0,xs:4,children:[a.jsx(V,{variant:"body2",color:"textSecondary",children:"Total Annual Fee"}),a.jsxs(V,{variant:"h6",children:["‚Çπ",p.totalAnnualFee.toLocaleString()]})]}),a.jsxs(X,{item:!0,xs:4,children:[a.jsx(V,{variant:"body2",color:"textSecondary",children:"Paid"}),a.jsxs(V,{variant:"h6",color:"success.main",children:["‚Çπ",p.paid.toLocaleString()]})]}),a.jsxs(X,{item:!0,xs:4,children:[a.jsx(V,{variant:"body2",color:"textSecondary",children:"Remaining"}),a.jsxs(V,{variant:"h6",color:"error.main",children:["‚Çπ",p.remaining.toLocaleString()]})]})]})]}),a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,error:S.touched.frequency&&!!S.errors.frequency,children:[a.jsx(ot,{id:"frequency-label",children:"Payment Frequency"}),a.jsxs(tt,{labelId:"frequency-label",id:"frequency",name:"frequency",value:S.values.frequency,onChange:v,label:"Payment Frequency",children:[a.jsx(Te,{value:ha.MONTHLY,children:"Monthly"}),a.jsx(Te,{value:ha.QUARTERLY,children:"Quarterly"}),a.jsx(Te,{value:ha.HALF_YEARLY,children:"Half Yearly"}),a.jsx(Te,{value:ha.YEARLY,children:"Yearly"})]}),S.touched.frequency&&S.errors.frequency&&a.jsx(Ma,{children:S.errors.frequency})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,id:"amount",name:"amount",label:"Amount",type:"number",value:S.values.amount,onChange:S.handleChange,onBlur:S.handleBlur,error:S.touched.amount&&!!S.errors.amount,helperText:S.touched.amount&&S.errors.amount,InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:"‚Çπ"})}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,error:S.touched.paymentMethod&&!!S.errors.paymentMethod,children:[a.jsx(ot,{id:"payment-method-label",children:"Payment Method"}),a.jsxs(tt,{labelId:"payment-method-label",id:"paymentMethod",name:"paymentMethod",value:S.values.paymentMethod,onChange:S.handleChange,label:"Payment Method",children:[a.jsx(Te,{value:Un.CASH,children:"Cash"}),a.jsx(Te,{value:Un.CHEQUE,children:"Cheque"}),a.jsx(Te,{value:Un.BANK_TRANSFER,children:"Bank Transfer"}),a.jsx(Te,{value:Un.UPI,children:"UPI"}),a.jsx(Te,{value:Un.CREDIT_CARD,children:"Credit Card"})]}),S.touched.paymentMethod&&S.errors.paymentMethod&&a.jsx(Ma,{children:S.errors.paymentMethod})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(jn,{dateAdapter:yI,children:["                ",a.jsx(un,{label:"Payment Date",value:S.values.paymentDate?typeof S.values.paymentDate=="string"?ZR(S.values.paymentDate):S.values.paymentDate:null,onChange:E=>{S.setFieldValue("paymentDate",E)},slotProps:{textField:{fullWidth:!0,error:S.touched.paymentDate&&!!S.errors.paymentDate,helperText:S.touched.paymentDate&&S.errors.paymentDate}}})]})}),S.values.paymentMethod!==Un.CASH&&a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,id:"reference",name:"reference",label:S.values.paymentMethod===Un.CHEQUE?"Cheque Number":S.values.paymentMethod===Un.BANK_TRANSFER?"Transaction Reference":S.values.paymentMethod===Un.UPI?"UPI Reference ID":S.values.paymentMethod===Un.CREDIT_CARD?"Transaction ID":"Reference Number",value:S.values.reference,onChange:S.handleChange,onBlur:S.handleBlur,error:S.touched.reference&&!!S.errors.reference,helperText:S.touched.reference&&S.errors.reference})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,id:"notes",name:"notes",label:"Notes",multiline:!0,rows:2,value:S.values.notes,onChange:S.handleChange,onBlur:S.handleBlur,error:S.touched.notes&&!!S.errors.notes,helperText:S.touched.notes&&S.errors.notes||`${S.values.notes.length}/200 characters`})})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:t,children:"Cancel"}),a.jsx(ye,{type:"submit",variant:"contained",color:"primary",disabled:s||!S.isValid,startIcon:s?a.jsx(vr,{size:20}):a.jsx(dS,{}),children:i!=null&&i.id?"Update Payment":"Complete Payment"})]})]})]})},gs=({title:e,value:r,icon:t,color:n,onClick:s})=>a.jsx(jt,{sx:{height:"100%",display:"flex",flexDirection:"column",cursor:s?"pointer":"default",transition:"transform 0.2s","&:hover":s?{transform:"translateY(-4px)",boxShadow:4}:{}},onClick:s,children:a.jsxs(Ut,{sx:{flexGrow:1},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center",mb:2},children:[a.jsx(t,{sx:{color:n}}),a.jsx(V,{variant:"h6",component:"div",sx:{ml:1},children:e})]}),a.jsx(V,{variant:"h4",color:n,children:r})]})}),pO=()=>{const e=es(),{user:r}=$n(),{showNotification:t}=dr(),[n,s]=b.useState({studentInfo:null,enrolledCourses:[],upcomingAssignments:[],attendance:{present:0,absent:0,late:0,percentage:0},feePaymentSummary:void 0}),[i,o]=b.useState(!0),[l,c]=b.useState(null),[d,u]=b.useState(!1),[f,h]=b.useState(!1),x=async()=>{try{const y=localStorage.getItem("token");if(!y)return console.error("No token available"),!1;const v=y.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),C=JSON.parse(window.atob(v)).exp*1e3,A=Date.now(),j=Math.round((C-A)/1e3/60);if(A>C){console.log("Token is expired, attempting refresh");try{return await Es(),Po("dashboard",!0,"Token refreshed successfully"),!0}catch(w){return console.error("Failed to refresh token:",w),Po("dashboard",!1,"Token refresh failed"),!1}}else if(j<5){console.log(`Token will expire soon (${j} minutes), refreshing`);try{return await Es(),Po("dashboard",!0,"Token proactively refreshed"),!0}catch(w){return console.warn("Failed to proactively refresh token:",w),!0}}return!0}catch(y){return console.error("Error validating token:",y),!1}},m=async()=>{if(!i)try{if(o(!0),c(null),!await x()){console.error("Invalid authentication token"),t({type:"error",message:"Your session has expired. Please log in again."}),e("/login");return}const S=r==null?void 0:r.id;if(!S)throw new Error("User ID not found");const[v,E,C,A]=await Promise.all([ge.get(`/students/${S}`),ge.get(`/students/${S}/courses`),ge.get(`/students/${S}/assignments`),ge.get(`/students/${S}/attendance`)]);let j;try{j=await Bt.getPaymentSummaryByStudent(S)}catch(w){console.error("Error loading fee payment summary:",w),j={studentId:S,studentName:(v==null?void 0:v.name)||"",totalDue:25e3,totalPaid:15e3,balance:1e4,paymentStatus:"PARTIALLY_PAID",lastPaymentDate:"2025-04-15",nextDueDate:"2025-05-15"}}s({studentInfo:v||null,enrolledCourses:Array.isArray(E)?E:[],upcomingAssignments:Array.isArray(C)?C:[],attendance:A||{present:0,absent:0,late:0,percentage:0},feePaymentSummary:j})}catch(y){console.error("Error loading student dashboard data:",y),c("Failed to load student data from database. Please ensure the backend server is running."),t({type:"error",message:"Failed to load your dashboard data from database. Please try again later."})}finally{o(!1)}};b.useEffect(()=>{async function y(){try{if(!await x()){console.error("Invalid authentication token during dashboard initialization"),t({type:"error",message:"Your session has expired. Please log in again."}),e("/login");return}m()}catch(v){console.error("Error initializing dashboard:",v)}}y();const S=setInterval(async()=>{await x()&&m()},5*60*1e3);return()=>clearInterval(S)},[]),b.useEffect(()=>{const y=()=>{m()};return window.addEventListener("dashboard:refresh",y),()=>window.removeEventListener("dashboard:refresh",y)},[m]);const g=async y=>{try{h(!0),await Bt.createPayment(y),t({type:"success",message:"Payment recorded successfully!"}),u(!1),m()}catch(S){console.error("Error creating payment:",S),t({type:"error",message:"Failed to record payment. Please try again later."})}finally{h(!1)}};if(i)return a.jsx(Ar,{message:"Loading your dashboard..."});if(l&&(l.includes("ERR_CONNECTION_REFUSED")||l.includes("Failed to fetch")))return a.jsx(Q0,{error:l,onRetry:m});if(l)return a.jsx(Kr,{message:l,onRetry:m});const p=b.useCallback(()=>{m()},[m]);return l&&l.toString().includes("ERR_CONNECTION_REFUSED")?a.jsx(Q0,{error:l,onRetry:p}):a.jsx(Mg,{onReset:p,children:a.jsxs(ee,{children:[a.jsxs(V,{variant:"h4",sx:{mb:4},children:["Student Dashboard",r&&a.jsxs(V,{variant:"subtitle1",color:"text.secondary",children:["Welcome, ",r.name||r.email]})]}),a.jsxs(X,{container:!0,spacing:3,children:[a.jsxs(X,{item:!0,xs:12,sm:6,md:3,children:["          ",a.jsx(gs,{title:"Enrolled Courses",value:n.enrolledCourses.length,icon:Go,color:"primary.main"})]}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(gs,{title:"Upcoming Assignments",value:n.upcomingAssignments.length,icon:mu,color:"secondary.main"})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(gs,{title:"Attendance Rate",value:`${n.attendance.percentage}%`,icon:uS,color:"success.main"})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(gs,{title:"GPA",value:"3.5",icon:Xa,color:"info.main"})}),n.feePaymentSummary&&a.jsx(X,{item:!0,xs:12,children:a.jsxs(Ke,{sx:{p:2,mb:3},children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsxs(V,{variant:"h6",sx:{display:"flex",alignItems:"center"},children:[a.jsx(pu,{sx:{mr:1}}),"Fee Payment Summary"]}),a.jsx(ye,{variant:"contained",color:"primary",onClick:()=>u(!0),startIcon:a.jsx(pu,{}),disabled:n.feePaymentSummary.balance<=0,children:"Make Payment"})]}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(ee,{sx:{p:2,textAlign:"center",bgcolor:"#f5f5f5",borderRadius:1},children:[a.jsx(V,{variant:"body2",color:"text.secondary",children:"Total Fee"}),a.jsxs(V,{variant:"h5",children:["‚Çπ",n.feePaymentSummary.totalDue.toLocaleString()]})]})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(ee,{sx:{p:2,textAlign:"center",bgcolor:"#e8f5e9",borderRadius:1},children:[a.jsx(V,{variant:"body2",color:"text.secondary",children:"Paid Amount"}),a.jsxs(V,{variant:"h5",color:"success.main",children:["‚Çπ",n.feePaymentSummary.totalPaid.toLocaleString()]})]})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(ee,{sx:{p:2,textAlign:"center",bgcolor:n.feePaymentSummary.balance>0?"#ffebee":"#e8f5e9",borderRadius:1},children:[a.jsx(V,{variant:"body2",color:"text.secondary",children:"Balance"}),a.jsxs(V,{variant:"h5",color:n.feePaymentSummary.balance>0?"error.main":"success.main",children:["‚Çπ",n.feePaymentSummary.balance.toLocaleString()]})]})})]}),a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",mt:2,alignItems:"center"},children:[a.jsxs(ee,{children:[a.jsxs(V,{variant:"body2",color:"text.secondary",children:["Status:"," ",a.jsx(at,{label:n.feePaymentSummary.paymentStatus,color:n.feePaymentSummary.paymentStatus==="PAID"?"success":n.feePaymentSummary.paymentStatus==="PARTIALLY_PAID"?"warning":"error",size:"small",sx:{ml:1}})]}),n.feePaymentSummary.lastPaymentDate&&a.jsxs(V,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Last Payment:"," ",new Date(n.feePaymentSummary.lastPaymentDate).toLocaleDateString()]})]}),n.feePaymentSummary.nextDueDate&&a.jsxs(ee,{sx:{textAlign:"right"},children:[a.jsx(V,{variant:"body2",color:"text.secondary",children:"Next Due Date:"}),a.jsx(V,{variant:"body1",color:"error.main",fontWeight:"bold",children:new Date(n.feePaymentSummary.nextDueDate).toLocaleDateString()})]})]})]})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(Ke,{sx:{p:2,height:"100%"},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Your Courses"}),a.jsx(Gn,{children:n.enrolledCourses.map((y,S)=>a.jsxs(it.Fragment,{children:[S>0&&a.jsx(Qt,{}),a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(Go,{color:"primary"})}),a.jsx(Fr,{primary:y.name,secondary:a.jsxs(a.Fragment,{children:[y.teacher," ‚Ä¢ ",y.schedule,y.grade&&a.jsxs(V,{component:"span",color:"text.secondary",children:[" ","‚Ä¢ Grade:"," ",a.jsx(V,{component:"span",color:"primary.main",fontWeight:"bold",children:y.grade})]})]})})]})]},y.id))}),a.jsx(ee,{sx:{mt:2,display:"flex",justifyContent:"flex-end"}})]})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(Ke,{sx:{p:2,height:"100%"},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Upcoming Assignments"}),a.jsx(Gn,{children:n.upcomingAssignments.map((y,S)=>a.jsxs(it.Fragment,{children:[S>0&&a.jsx(Qt,{}),a.jsxs(Gr,{children:["                    ",a.jsx(In,{children:a.jsx(mu,{color:"secondary"})}),a.jsx(Fr,{primary:y.title,secondary:a.jsxs(a.Fragment,{children:["Due: ",y.dueDate," ‚Ä¢ ",y.course]})})]})]},y.id))})]})}),a.jsx(X,{item:!0,xs:12,children:a.jsxs(Ke,{sx:{p:2},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Attendance Summary"}),a.jsxs(X,{container:!0,spacing:3,sx:{mt:1},children:[a.jsx(X,{item:!0,xs:12,sm:4,children:a.jsxs(ee,{sx:{textAlign:"center",p:2},children:[a.jsx(V,{variant:"h2",color:"primary.main",children:n.attendance.present}),a.jsx(V,{variant:"body1",children:"Days Present"})]})}),a.jsx(X,{item:!0,xs:6,sm:4,children:a.jsxs(ee,{sx:{textAlign:"center",p:2},children:[a.jsx(V,{variant:"h2",color:"error.main",children:n.attendance.absent}),a.jsx(V,{variant:"body1",children:"Days Absent"})]})}),a.jsx(X,{item:!0,xs:6,sm:4,children:a.jsxs(ee,{sx:{textAlign:"center",p:2},children:[a.jsx(V,{variant:"h2",color:"warning.main",children:n.attendance.late}),a.jsx(V,{variant:"body1",children:"Days Late"})]})})]})]})})]}),"      ",d&&r&&n.studentInfo&&a.jsx(O1,{open:d,studentId:r.id,onClose:()=>u(!1),onSubmit:g,loading:f})]})})},fp=()=>{const e=es(),{showNotification:r}=dr(),[t,n]=b.useState({totalStudents:0,totalTeachers:0,totalCourses:0,activeEnrollments:0,averageClassSize:0,coursesAtCapacity:0,recentActivity:[]}),[s,i]=b.useState(!0),[o,l]=b.useState(null),c=async()=>{try{i(!0),l(null),console.log("üìä Loading dashboard statistics..."),await(async(v=0)=>{if(!localStorage.getItem("token"))if(v<2)try{return console.log("No token found, attempting to refresh..."),await Es(),console.log("Token refreshed successfully"),!0}catch(C){return console.error("Token refresh failed:",C),!1}else return console.warn("Multiple token refresh attempts failed"),!1;return!0})()||console.warn("Token validation failed, but will attempt to load data anyway"),console.log("Loading admin dashboard statistics...");let f=[],h=[],x=[];const m=async(v,E=2,C=1e3)=>{var j,w,k,_;let A;for(let I=0;I<=E;I++)try{return I>0&&console.log(`Retry attempt ${I} after delay...`),await v()}catch(D){if(A=D,console.warn(`API call failed, attempt ${I+1}/${E+1}:`,D),!((j=D.message)!=null&&j.includes("Network Error")||((w=D.response)==null?void 0:w.status)===401||((k=D.response)==null?void 0:k.status)===403))break;if(I<E){if(((_=D.response)==null?void 0:_.status)===401)try{await Es()}catch(B){console.warn("Token refresh during retry failed:",B)}await new Promise(B=>setTimeout(B,C*Math.pow(2,I)))}}throw A};try{const v=await m(()=>zr.getAll());f=Array.isArray(v)?v:[],console.log(`‚úÖ Loaded ${f.length} students`)}catch(v){console.error("Error loading students after retries:",v)}try{const v=await m(()=>J2.getAll());h=Array.isArray(v)?v:[],console.log(`‚úÖ Loaded ${h.length} teachers`)}catch(v){console.error("Error loading teachers after retries:",v)}x=[];const g=0,p=0;let y=0;try{if(f.length>0){const v=new Map;for(const A of f){const j=(A.grade??"").toString().trim()||"N/A",w=(A.section??"").toString().trim()||"A",k=`${j}__${w}`;v.set(k,(v.get(k)||0)+1)}const E=v.size||1,C=f.length;y=Math.round(C/E*10)/10}}catch(v){console.warn("Failed to compute average class size, defaulting to 0",v),y=0}const S=[...f.slice(0,3).map(v=>({id:v.id,type:"student",description:`Student ${v.name} - Grade ${v.grade||"N/A"}`,timestamp:new Date(Date.now()-36e5).toISOString()}))].sort((v,E)=>new Date(E.timestamp).getTime()-new Date(v.timestamp).getTime());n({totalStudents:f.length,totalTeachers:h.length,totalCourses:x.length,activeEnrollments:g,averageClassSize:Math.round(y*10)/10,coursesAtCapacity:p,recentActivity:S})}catch(d){console.error("Error loading dashboard stats:",d),d.message&&d.message.includes("Network Error")?l("Cannot connect to the server. Please check if the backend service is running."):l("Failed to load dashboard data. Please try again later."),r({type:"error",message:"Failed to load dashboard statistics. Please try refreshing the page."})}finally{i(!1)}};return b.useEffect(()=>{const d=async()=>{try{const{checkServerHealth:f}=await qr(()=>Promise.resolve().then(()=>Sj),void 0);await f()?c():(l("Cannot connect to backend server. Please ensure the server is running."),i(!1))}catch(f){console.error("Error checking server health:",f),c()}};d();const u=setInterval(d,5*60*1e3);return()=>clearInterval(u)},[]),b.useEffect(()=>{const d=()=>{c()};return window.addEventListener("dashboard:refresh",d),()=>window.removeEventListener("dashboard:refresh",d)},[]),s?a.jsx(Ar,{message:"Loading dashboard statistics..."}):o?a.jsx(Kr,{message:o,onRetry:c}):a.jsxs(ee,{children:[a.jsx(V,{variant:"h4",sx:{mb:4},children:"Admin Dashboard"}),a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(gs,{title:"Total Students",value:t.totalStudents,icon:zo,color:"primary.main",onClick:()=>e("/students")})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(gs,{title:"Total Teachers",value:t.totalTeachers,icon:Xa,color:"secondary.main",onClick:()=>e("/teachers")})}),a.jsxs(X,{item:!0,xs:12,sm:6,md:3,children:["          ",a.jsx(gs,{title:"Total Courses",value:t.totalCourses,icon:Go,color:"success.main"})]}),a.jsx(X,{item:!0,xs:12,sm:6,md:3}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(gs,{title:"Average Class Size",value:t.averageClassSize,icon:fS,color:"warning.main"})}),a.jsx(X,{item:!0,xs:12,children:a.jsxs(Ke,{sx:{p:2,mt:2},children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(V,{variant:"h6",children:"Recent Activity"}),a.jsx(ye,{size:"small",startIcon:a.jsx(On,{}),onClick:c,children:"Refresh"})]}),a.jsx(Gn,{children:t.recentActivity.map((d,u)=>a.jsxs(it.Fragment,{children:[u>0&&a.jsx(Qt,{}),a.jsxs(Gr,{children:[a.jsxs(In,{children:[d.type==="enrollment"&&a.jsx(zo,{color:"primary"}),d.type==="course"&&a.jsx(Go,{color:"secondary"}),d.type==="student"&&a.jsx(Xa,{color:"success"}),d.type==="teacher"&&a.jsx(za,{color:"info"})]}),a.jsx(Fr,{primary:d.description,secondary:new Date(d.timestamp).toLocaleString()})]})]},d.id||u))})]})})]})]})},xO=()=>{var o;const{user:e,currentUser:r,logout:t}=$n(),n=es();b.useEffect(()=>{(()=>{const c=window.location.pathname,d=sessionStorage.getItem("dashboard_redirected");c==="/"&&!d&&e&&(console.log("üîÑ Detected incorrect redirect to homepage, redirecting back to dashboard"),sessionStorage.setItem("dashboard_redirected","true"),n("/dashboard"),setTimeout(()=>{sessionStorage.removeItem("dashboard_redirected")},5e3))})()},[n,e]),console.log("üè† Dashboard component rendering with:",{userFromContext:e,currentUser:r,userRole:e==null?void 0:e.role,userRoles:(e==null?void 0:e.roles)||[],isAdmin:(e==null?void 0:e.role)===He.ADMIN,isTeacher:(e==null?void 0:e.role)===He.TEACHER,isStudent:(e==null?void 0:e.role)===He.STUDENT,isStaff:(e==null?void 0:e.role)===He.STAFF}),b.useEffect(()=>{const l=async()=>{try{const d=window.location.pathname;if(console.log("üîÑ Starting dashboard token validation check on path:",d),d==="/dashboard"){console.log("‚úÖ Bypassing token validation for dashboard path to prevent redirect loops");return}const{validateAdminToken:u}=await qr(()=>import("./tokenValidationService-048cc784.js"),["assets/tokenValidationService-048cc784.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]);try{const f=localStorage.getItem("token");if(!f){console.warn("‚ö†Ô∏è No token found in localStorage, but will not logout from dashboard"),window.location.pathname!=="/login"&&!window.location.pathname.includes("/dashboard")&&setTimeout(()=>t("expired"),100);return}try{const x=JSON.parse(atob(f.split(".")[1])).exp*1e3,m=Date.now(),g=Math.floor((x-m)/1e3/60);if(console.log(`Token expiry check: ${g} minutes until expiry`),g>5){console.log("‚úÖ Token appears valid for the next 5+ minutes, skipping full validation");return}if(g<=5){console.log("‚ö†Ô∏è Token expires soon, attempting background refresh...");try{await Es(),console.log("‚úÖ Token refreshed successfully")}catch(p){console.warn("Token refresh failed, but continuing anyway:",p)}return}}catch(h){console.warn("Token parse error, but will continue:",h)}}catch(f){console.error("Error checking token, but will NOT logout user:",f)}}catch(d){console.error("‚ùó Critical error in validation function, ignoring:",d)}},c=setTimeout(()=>{l()},1500);return()=>clearTimeout(c)},[t]);const s=(o=e==null?void 0:e.role)==null?void 0:o.toUpperCase(),i=Array.isArray(e==null?void 0:e.roles)?e==null?void 0:e.roles.map(l=>l.toUpperCase()):s?[s]:[];return s===He.STUDENT||i.includes(He.STUDENT)?(console.log("üéì Rendering Student Dashboard"),a.jsx(pO,{})):s===He.TEACHER||i.includes(He.TEACHER)?(console.log("üë®‚Äçüè´ Rendering Teacher Dashboard"),a.jsx(fp,{})):s===He.ADMIN||s===He.STAFF||s===He.PRINCIPAL||i.includes(He.ADMIN)||i.includes(He.STAFF)||i.includes(He.PRINCIPAL)?(console.log("üëë Rendering Admin Dashboard"),a.jsx(fp,{})):(console.warn("‚ö†Ô∏è No matching dashboard for user role:",s),a.jsxs(ee,{sx:{textAlign:"center",py:5},children:[a.jsx(V,{variant:"h5",color:"text.secondary",children:"Dashboard not available for your role."}),a.jsx(V,{variant:"body1",sx:{mt:2},children:"Please contact the system administrator if you believe this is an error."}),a.jsxs(V,{variant:"body2",color:"text.disabled",sx:{mt:1},children:["Role: ",s||"Unknown"," | Available Roles: ",i.join(", ")||"None"]})]}))},gO=({transportRoutes:e,onEdit:r,onDelete:t,onRefresh:n})=>!e||e.length===0?a.jsxs(ee,{sx:{p:2,textAlign:"center"},children:[a.jsx(V,{variant:"body1",color:"text.secondary",children:"No transport routes available."}),a.jsx(st,{onClick:n,sx:{mt:1},color:"primary",children:a.jsx(On,{})})]}):a.jsxs(Ke,{sx:{width:"100%",overflow:"hidden"},children:[a.jsx(ee,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:a.jsx(xt,{title:"Refresh",children:a.jsx(st,{onClick:n,children:a.jsx(On,{})})})}),a.jsx(Jt,{sx:{maxHeight:440},children:a.jsxs(Vt,{stickyHeader:!0,"aria-label":"transport routes table",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"ID"}),a.jsx(Q,{children:"Route Name"}),a.jsx(Q,{children:"Description"}),a.jsx(Q,{children:"Fee Amount"}),a.jsx(Q,{children:"Actions"})]})}),a.jsx(Ht,{children:e.map(s=>{var i;return a.jsxs(Ge,{children:[a.jsx(Q,{children:s.id}),a.jsx(Q,{children:s.routeName}),a.jsx(Q,{children:s.routeDescription}),a.jsxs(Q,{children:["‚Çπ",(i=s.feeAmount)==null?void 0:i.toFixed(2)]}),a.jsxs(Q,{children:[a.jsx(xt,{title:"Edit",children:a.jsx(st,{size:"small",onClick:()=>s.id&&r(s.id),children:a.jsx(Za,{fontSize:"small"})})}),a.jsx(xt,{title:"Delete",children:a.jsx(st,{size:"small",onClick:()=>s.id&&t(s.id),children:a.jsx(ws,{fontSize:"small"})})})]})]},s.id)})})]})})]}),yO=({feeStructures:e,onEdit:r,onDelete:t,onRefresh:n})=>!e||e.length===0?a.jsxs(ee,{sx:{p:2,textAlign:"center"},children:[a.jsx(V,{variant:"body1",color:"text.secondary",children:"No fee structures available."}),a.jsx(st,{onClick:n,sx:{mt:1},color:"primary",children:a.jsx(On,{})})]}):a.jsxs(Ke,{sx:{width:"100%",overflow:"hidden"},children:[a.jsx(ee,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:a.jsx(xt,{title:"Refresh",children:a.jsx(st,{onClick:n,children:a.jsx(On,{})})})}),a.jsx(Jt,{sx:{maxHeight:440},children:a.jsxs(Vt,{stickyHeader:!0,"aria-label":"fee structures table",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"ID"}),a.jsx(Q,{children:"Class Grade"}),a.jsx(Q,{children:"Annual Fees"}),a.jsx(Q,{children:"Building Fees"}),a.jsx(Q,{children:"Lab Fees"}),a.jsx(Q,{children:"Total Fees"}),a.jsx(Q,{children:"Actions"})]})}),a.jsx(Ht,{children:e.map(s=>{var i,o,l,c;return a.jsxs(Ge,{children:[a.jsx(Q,{children:s.id}),a.jsx(Q,{children:s.classGrade}),a.jsxs(Q,{children:["‚Çπ",(i=s.annualFees)==null?void 0:i.toFixed(2)]}),a.jsxs(Q,{children:["‚Çπ",(o=s.buildingFees)==null?void 0:o.toFixed(2)]}),a.jsxs(Q,{children:["‚Çπ",(l=s.labFees)==null?void 0:l.toFixed(2)]}),a.jsxs(Q,{children:["‚Çπ",(c=s.totalFees)==null?void 0:c.toFixed(2)]}),a.jsxs(Q,{children:[a.jsx(xt,{title:"Edit",children:a.jsx(st,{size:"small",onClick:()=>s.id&&r(s.id),children:a.jsx(Za,{fontSize:"small"})})}),a.jsx(xt,{title:"Delete",children:a.jsx(st,{size:"small",onClick:()=>s.id&&t(s.id),children:a.jsx(ws,{fontSize:"small"})})})]})]},s.id)})})]})})]});function hp(e){const{children:r,value:t,index:n,...s}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`fee-dialog-tabpanel-${n}`,"aria-labelledby":`fee-dialog-tab-${n}`,...s,children:t===n&&a.jsx(ee,{sx:{pt:2},children:r})})}const vO=({open:e,onClose:r,onSubmit:t,initialData:n,loading:s})=>{const i=!!(n!=null&&n.id),[o,l]=b.useState(0),[c,d]=b.useState({classGrade:0,annualFees:0,buildingFees:0,labFees:0,paymentSchedules:[],lateFees:[]}),[u,f]=b.useState({});b.useEffect(()=>{d(n?{id:n.id,classGrade:n.classGrade,annualFees:n.annualFees,buildingFees:n.buildingFees,labFees:n.labFees,paymentSchedules:n.paymentSchedules||[],lateFees:n.lateFees||[],totalFees:n.totalFees}:{classGrade:1,annualFees:0,buildingFees:0,labFees:0,paymentSchedules:[{scheduleType:"MONTHLY",amount:0,isEnabled:!0},{scheduleType:"QUARTERLY",amount:0,isEnabled:!0},{scheduleType:"YEARLY",amount:0,isEnabled:!0}],lateFees:[]}),l(0)},[n,e]);const h=(v,E)=>{l(E)},x=v=>E=>{const C=E.target.type==="number"?Number(E.target.value):E.target.value;d(A=>({...A,[v]:C})),u[v]&&f(A=>({...A,[v]:""}))},m=(v,E,C)=>{const A=[...c.paymentSchedules];A[v]={...A[v],[E]:C},d(j=>({...j,paymentSchedules:A}))},g=v=>{const E=c.paymentSchedules.map(C=>{let A=0;switch(C.scheduleType){case"MONTHLY":A=parseFloat((v/12).toFixed(2));break;case"QUARTERLY":A=parseFloat((v/4).toFixed(2));break;case"YEARLY":A=v;break}return{...C,amount:A}});d(C=>({...C,paymentSchedules:E}))},p=v=>{const E=Number(v.target.value);d(C=>({...C,annualFees:E})),g(E)},y=()=>{const v={};return c.classGrade||(v.classGrade="Class/Grade is required"),c.annualFees<0&&(v.annualFees="Annual fees cannot be negative"),c.buildingFees<0&&(v.buildingFees="Building fees cannot be negative"),c.labFees<0&&(v.labFees="Lab fees cannot be negative"),c.paymentSchedules.some(E=>E.isEnabled)||(v.paymentSchedules="At least one payment schedule must be enabled"),f(v),Object.keys(v).length===0},S=()=>{y()&&t(c)};return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"md","aria-labelledby":"fee-structure-dialog-title",children:[a.jsx(Dt,{id:"fee-structure-dialog-title",children:n?"Edit Fee Structure":"Create Fee Structure"}),a.jsxs(Tt,{children:[a.jsx(ee,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:a.jsxs(aa,{value:o,onChange:h,"aria-label":"fee structure tabs",children:[a.jsx(kt,{label:"Basic Information"}),a.jsx(kt,{label:"Payment Schedules"})]})}),a.jsx(hp,{value:o,index:0,children:a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,sm:4,children:a.jsx(Se,{fullWidth:!0,required:!0,label:"Class/Grade",type:"number",value:c.classGrade,onChange:x("classGrade"),InputProps:{inputProps:{min:1,max:12}},disabled:i,error:!!u.classGrade,helperText:u.classGrade})}),a.jsx(X,{item:!0,xs:12,sm:8,children:a.jsx(Se,{fullWidth:!0,required:!0,label:"Annual Fees",type:"number",value:c.annualFees,onChange:p,InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:"‚Çπ"}),inputProps:{min:0}},error:!!u.annualFees,helperText:u.annualFees})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Building Fees",type:"number",value:c.buildingFees,onChange:x("buildingFees"),InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:"‚Çπ"}),inputProps:{min:0}},error:!!u.buildingFees,helperText:u.buildingFees})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Lab Fees",type:"number",value:c.labFees,onChange:x("labFees"),InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:"‚Çπ"}),inputProps:{min:0}},error:!!u.labFees,helperText:u.labFees})}),a.jsx(X,{item:!0,xs:12,children:a.jsxs(V,{variant:"subtitle1",color:"text.secondary",children:["Total Fees: ‚Çπ",(Number(c.annualFees)+Number(c.buildingFees)+Number(c.labFees)).toLocaleString()]})})]})}),a.jsxs(hp,{value:o,index:1,children:[a.jsx(V,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:"Configure payment schedules and amounts. Enable or disable payment options as needed."}),u.paymentSchedules&&a.jsx(Ma,{error:!0,children:u.paymentSchedules}),a.jsx(X,{container:!0,spacing:3,sx:{mt:1},children:c.paymentSchedules.map((v,E)=>a.jsx(X,{item:!0,xs:12,children:a.jsx(jt,{variant:"outlined",children:a.jsx(Ut,{children:a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,xs:12,sm:3,children:a.jsxs(V,{variant:"subtitle1",children:[v.scheduleType.charAt(0)+v.scheduleType.slice(1).toLowerCase()," Payment"]})}),a.jsx(X,{item:!0,xs:12,sm:5,children:a.jsx(Se,{fullWidth:!0,label:"Amount",type:"number",value:v.amount,onChange:C=>m(E,"amount",Number(C.target.value)),InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:"‚Çπ"}),inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:4,children:a.jsx(Wi,{control:a.jsx(xu,{checked:v.isEnabled,onChange:C=>m(E,"isEnabled",C.target.checked),color:"primary"}),label:"Enable this payment option"})})]})})})},E))})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,children:"Cancel"}),a.jsx(ye,{onClick:S,variant:"contained",color:"primary",disabled:s,children:s?"Saving...":i?"Update":"Create"})]})]})},bO=({open:e,onClose:r,onSubmit:t,initialData:n,loading:s})=>{const i=!!(n!=null&&n.id),[o,l]=b.useState({routeName:"",routeDescription:"",feeAmount:0}),[c,d]=b.useState({});b.useEffect(()=>{l(n?{id:n.id,routeName:n.routeName,routeDescription:n.routeDescription,feeAmount:n.feeAmount}:{routeName:"",routeDescription:"",feeAmount:0})},[n,e]);const u=x=>m=>{const g=x==="feeAmount"?Number(m.target.value):m.target.value;l(p=>({...p,[x]:g})),c[x]&&d(p=>({...p,[x]:""}))},f=()=>{const x={};return o.routeName.trim()||(x.routeName="Route name is required"),o.feeAmount<0&&(x.feeAmount="Fee amount cannot be negative"),d(x),Object.keys(x).length===0},h=()=>{f()&&t(o)};return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"sm","aria-labelledby":"transport-route-dialog-title",children:[a.jsx(Dt,{id:"transport-route-dialog-title",children:n?"Edit Transport Route":"Create Transport Route"}),a.jsx(Tt,{children:a.jsxs(X,{container:!0,spacing:3,sx:{mt:.5},children:[a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,required:!0,label:"Route Name",value:o.routeName,onChange:u("routeName"),error:!!c.routeName,helperText:c.routeName})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,label:"Route Description",multiline:!0,rows:2,value:o.routeDescription,onChange:u("routeDescription")})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,required:!0,label:"Fee Amount",type:"number",value:o.feeAmount,onChange:u("feeAmount"),InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:"‚Çπ"}),inputProps:{min:0}},error:!!c.feeAmount,helperText:c.feeAmount})})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,children:"Cancel"}),a.jsx(ye,{onClick:h,variant:"contained",color:"primary",disabled:s,children:s?"Saving...":i?"Update":"Create"})]})]})},cc=({payments:e,onViewReceipt:r,onDownloadReceipt:t,onVoidPayment:n,isAdmin:s=!1,showStudentDetails:i=!1,showClassSection:o=!0})=>{var C;const[l,c]=b.useState(0),[d,u]=b.useState(10),[f,h]=b.useState(!1),[x,m]=b.useState(null),g=(A,j)=>{c(j)},p=A=>{u(parseInt(A.target.value,10)),c(0)},y=()=>{h(!1),m(null)},S=A=>{let j="default";switch(A){case"COMPLETED":case"PAID":j="success";break;case"PENDING":case"PARTIAL":j="warning";break;case"FAILED":case"OVERDUE":case"CANCELLED":j="error";break;case"VOID":j="default";break}return a.jsx(at,{size:"small",label:A,color:j})},v=e.slice(l*d,l*d+d),E=e.length===0;return a.jsxs(a.Fragment,{children:[a.jsxs(Jt,{component:Ke,elevation:1,children:[a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Receipt #"}),i&&a.jsx(Q,{children:"Student"}),i&&o&&a.jsxs(a.Fragment,{children:[a.jsx(Q,{children:"Class"}),a.jsx(Q,{children:"Section"})]}),a.jsx(Q,{children:"Date"}),a.jsx(Q,{children:"Amount"}),a.jsx(Q,{children:"Method"}),a.jsx(Q,{children:"Void Date"}),a.jsx(Q,{children:"Status"}),a.jsx(Q,{align:"right",children:"Actions"})]})}),a.jsx(Ht,{children:E?a.jsx(Ge,{children:a.jsx(Q,{colSpan:i?o?10:8:7,align:"center",children:a.jsx(V,{variant:"body2",color:"textSecondary",children:"No payment records found"})})}):v.map(A=>{var j;return a.jsxs(Ge,{children:[a.jsx(Q,{children:A.receiptNumber||"-"}),i&&a.jsx(Q,{children:A.studentName||((j=A==null?void 0:A.student)==null?void 0:j.name)||"-"}),i&&o&&a.jsxs(a.Fragment,{children:[a.jsx(Q,{children:A.studentGrade||"-"}),a.jsx(Q,{children:A.studentSection||"-"})]}),a.jsx(Q,{children:A.paymentDate?xs(new Date(A.paymentDate),"dd MMM yyyy"):"-"}),a.jsxs(Q,{children:["‚Çπ",Number(A.amountPaid??A.amount??0).toLocaleString()]}),a.jsx(Q,{children:A.paymentMethod}),a.jsx(Q,{children:A.paymentStatus==="VOID"&&A.voidedAt?xs(new Date(A.voidedAt),"dd MMM yyyy HH:mm"):"-"}),a.jsx(Q,{children:S(A.paymentStatus)}),a.jsxs(Q,{align:"right",children:[a.jsx(xt,{title:"View Receipt",children:a.jsx(st,{size:"small",onClick:()=>r(A.id),children:a.jsx(Vc,{fontSize:"small"})})}),a.jsx(xt,{title:"Download Receipt",children:a.jsx(st,{size:"small",onClick:()=>t(A.id),children:a.jsx(Hi,{fontSize:"small"})})}),s&&n&&A.paymentStatus!=="VOID"&&a.jsx(xt,{title:"Void Payment",children:a.jsx(st,{size:"small",onClick:()=>n(A.id),color:"error",children:a.jsx(dc,{fontSize:"small"})})})]})]},A.id)})})]}),e.length>0&&a.jsx(rf,{rowsPerPageOptions:[5,10,25],component:"div",count:e.length,rowsPerPage:d,page:l,onPageChange:g,onRowsPerPageChange:p})]}),a.jsx(At,{open:f,onClose:y,maxWidth:"sm",fullWidth:!0,children:x&&a.jsxs(a.Fragment,{children:[a.jsxs(ee,{sx:{p:3},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Payment Details"}),a.jsxs(ee,{sx:{mt:2},children:[a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Receipt Number"}),a.jsx(V,{variant:"body1",gutterBottom:!0,children:x.receiptNumber||"N/A"}),a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Academic Year/Term"}),a.jsxs(V,{variant:"body1",gutterBottom:!0,children:[x.academicYear," (",x.academicTerm,")"]}),a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Payment Date"}),a.jsx(V,{variant:"body1",gutterBottom:!0,children:x.paymentDate?xs(new Date(x.paymentDate),"dd MMMM yyyy"):"-"}),a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Payment Method"}),a.jsxs(V,{variant:"body1",gutterBottom:!0,children:[x.paymentMethod,x.transactionReference&&` (Ref: ${x.transactionReference})`]}),a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Amount Paid"}),a.jsxs(V,{variant:"h6",color:"primary",gutterBottom:!0,children:["‚Çπ",Number(x.amountPaid??x.amount??0).toLocaleString()]}),x.paymentStatus==="VOID"&&a.jsxs(a.Fragment,{children:[a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Date of Payment Void"}),a.jsx(V,{variant:"body1",gutterBottom:!0,children:x.voidedAt?xs(new Date(x.voidedAt),"dd MMM yyyy HH:mm"):"-"}),a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Reason"}),a.jsx(V,{variant:"body2",gutterBottom:!0,children:x.voidReason||x.remarks||"-"})]}),x.notes&&a.jsxs(a.Fragment,{children:[a.jsx(V,{variant:"subtitle2",color:"textSecondary",children:"Notes"}),a.jsx(V,{variant:"body2",gutterBottom:!0,children:x.notes})]}),a.jsx(V,{variant:"subtitle2",color:"textSecondary",sx:{mt:2},children:"Fee Breakdown"}),a.jsxs(Vt,{size:"small",sx:{mt:1},children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Fee Type"}),a.jsx(Q,{children:"Description"}),a.jsx(Q,{align:"right",children:"Amount"})]})}),a.jsx(Ht,{children:(C=x.feeBreakdown)==null?void 0:C.map((A,j)=>a.jsxs(Ge,{children:[a.jsx(Q,{children:A.feeType}),a.jsx(Q,{children:A.description||"-"}),a.jsxs(Q,{align:"right",children:["‚Çπ",A.amount.toLocaleString()]})]},j))})]})]})]}),a.jsxs(ee,{sx:{display:"flex",justifyContent:"flex-end",p:2},children:[a.jsx(ye,{onClick:y,children:"Close"}),a.jsx(ye,{startIcon:a.jsx(Hi,{}),onClick:()=>t(x.id),sx:{ml:1},children:"Download Receipt"})]})]})})]})},L1=({feeDetails:e})=>{var t,n,s,i;if(!e||!e.feeStructure)return a.jsx(V,{children:"No fee details available"});const{feeStructure:r}=e;return a.jsx(ee,{children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(Ke,{elevation:0,sx:{p:2,bgcolor:"background.paper"},children:[a.jsx(V,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Fee Structure Details"}),a.jsx(Qt,{sx:{my:1}}),a.jsxs(X,{container:!0,spacing:1,children:[a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"Class Grade:"})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",children:r.classGrade})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"Annual Fees:"})}),"              ",a.jsx(X,{item:!0,xs:6,children:a.jsxs(V,{variant:"body2",children:["‚Çπ",(t=r.annualFees)==null?void 0:t.toFixed(2)]})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"Building Fees:"})}),a.jsx(X,{item:!0,xs:6,children:a.jsxs(V,{variant:"body2",children:["‚Çπ",(n=r.buildingFees)==null?void 0:n.toFixed(2)]})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"Lab Fees:"})}),a.jsx(X,{item:!0,xs:6,children:a.jsxs(V,{variant:"body2",children:["‚Çπ",(s=r.labFees)==null?void 0:s.toFixed(2)]})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",color:"text.secondary",fontWeight:"bold",children:"Total Fees:"})}),a.jsx(X,{item:!0,xs:6,children:a.jsxs(V,{variant:"body2",fontWeight:"bold",children:["‚Çπ",(i=r.totalFees)==null?void 0:i.toFixed(2)]})})]})]})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(Ke,{elevation:0,sx:{p:2,bgcolor:"background.paper"},children:[a.jsx(V,{variant:"subtitle1",fontWeight:"bold",gutterBottom:!0,children:"Student Fee Assignment"}),a.jsx(Qt,{sx:{my:1}}),a.jsxs(X,{container:!0,spacing:1,children:[a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"Student ID:"})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",children:e.studentId})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"Student Fee ID:"})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(V,{variant:"body2",children:e.studentFeeId||"N/A"})})]})]})})]})})};var $1={exports:{}};(function(e,r){(function(t,n){e.exports=n(b)})(typeof self<"u"?self:Ds,function(t){return function(){var n={155:function(y){y.exports=t}},s={};function i(y){var S=s[y];if(S!==void 0)return S.exports;var v=s[y]={exports:{}};return n[y](v,v.exports,i),v.exports}i.d=function(y,S){for(var v in S)i.o(S,v)&&!i.o(y,v)&&Object.defineProperty(y,v,{enumerable:!0,get:S[v]})},i.o=function(y,S){return Object.prototype.hasOwnProperty.call(y,S)},i.r=function(y){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(y,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(y,"__esModule",{value:!0})};var o={};i.r(o),i.d(o,{useReactToPrint:function(){return p}});var l=i(155);function c({level:y="error",messages:S,suppressErrors:v=!1}){v||(y==="error"?console.error(S):y==="warning"?console.warn(S):console.debug(S))}function d(y,S){if(S||!y){const v=document.getElementById("printWindow");v&&document.body.removeChild(v)}}function u(y){return y instanceof Error?y:new Error("Unknown Error")}function f(y,S){const{documentTitle:v,onAfterPrint:E,onPrintError:C,preserveAfterPrint:A,print:j,suppressErrors:w}=S;setTimeout(()=>{var k,_;if(y.contentWindow){let I=function(){E==null||E(),d(A)};if(y.contentWindow.focus(),j)j(y).then(I).catch(D=>{C?C("print",u(D)):c({messages:["An error was thrown by the specified `print` function"],suppressErrors:w})});else{if(y.contentWindow.print){const D=(_=(k=y.contentDocument)===null||k===void 0?void 0:k.title)!==null&&_!==void 0?_:"",B=y.ownerDocument.title;v&&(y.ownerDocument.title=v,y.contentDocument&&(y.contentDocument.title=v)),y.contentWindow.print(),v&&(y.ownerDocument.title=B,y.contentDocument&&(y.contentDocument.title=D))}else c({messages:["Printing for this browser is not currently possible: the browser does not have a `print` method available for iframes."],suppressErrors:w});[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i].some(D=>{var B,R;return((R=(B=navigator.userAgent)!==null&&B!==void 0?B:navigator.vendor)!==null&&R!==void 0?R:"opera"in window&&window.opera).match(D)})?setTimeout(I,500):I()}}else c({messages:["Printing failed because the `contentWindow` of the print iframe did not load. This is possibly an error with `react-to-print`. Please file an issue: https://github.com/MatthewHerbst/react-to-print/issues/"],suppressErrors:w})},500)}function h(y){const S=[],v=document.createTreeWalker(y,NodeFilter.SHOW_ELEMENT,null);let E=v.nextNode();for(;E;)S.push(E),E=v.nextNode();return S}function x(y,S,v){const E=h(y),C=h(S);if(E.length===C.length)for(let A=0;A<E.length;A++){const j=E[A],w=C[A],k=j.shadowRoot;if(k!==null){const _=w.attachShadow({mode:k.mode});_.innerHTML=k.innerHTML,x(k,_,v)}}else c({messages:["When cloning shadow root content, source and target elements have different size. `onBeforePrint` likely resolved too early.",y,S],suppressErrors:v})}const m=`
    @page {
        /* Remove browser default header (title) and footer (url) */
        margin: 0;
    }
    @media print {
        body {
            /* Tell browsers to print background colors */
            color-adjust: exact; /* Firefox. This is an older version of "print-color-adjust" */
            print-color-adjust: exact; /* Firefox/Safari */
            -webkit-print-color-adjust: exact; /* Chrome/Safari/Edge/Opera */
        }
    }
`;function g(y,S,v,E){var C,A,j,w,k;const{contentNode:_,clonedContentNode:I,clonedImgNodes:D,clonedVideoNodes:B,numResourcesToLoad:R,originalCanvasNodes:Y}=v,{bodyClass:P,fonts:M,ignoreGlobalStyles:K,pageStyle:L,nonce:ae,suppressErrors:Z,copyShadowRoots:T}=E;y.onload=null;const N=(C=y.contentDocument)!==null&&C!==void 0?C:(A=y.contentWindow)===null||A===void 0?void 0:A.document;if(N){const H=N.body.appendChild(I);T&&x(_,H,!!Z),M&&(!((j=y.contentDocument)===null||j===void 0)&&j.fonts&&(!((w=y.contentWindow)===null||w===void 0)&&w.FontFace)?M.forEach(W=>{const F=new FontFace(W.family,W.source,{weight:W.weight,style:W.style});y.contentDocument.fonts.add(F),F.loaded.then(()=>{S(F)}).catch(U=>{S(F,["Failed loading the font:",F,"Load error:",u(U)])})}):(M.forEach(W=>{S(W)}),c({messages:['"react-to-print" is not able to load custom fonts because the browser does not support the FontFace API but will continue attempting to print the page'],suppressErrors:Z})));const G=L??m,q=N.createElement("style");ae&&(q.setAttribute("nonce",ae),N.head.setAttribute("nonce",ae)),q.appendChild(N.createTextNode(G)),N.head.appendChild(q),P&&N.body.classList.add(...P.split(" "));const oe=N.querySelectorAll("canvas");for(let W=0;W<Y.length;++W){const F=Y[W],U=oe[W];if(U===void 0){c({messages:["A canvas element could not be copied for printing, has it loaded? `onBeforePrint` likely resolved too early.",F],suppressErrors:Z});continue}const te=U.getContext("2d");te&&te.drawImage(F,0,0)}for(let W=0;W<D.length;W++){const F=D[W],U=F.getAttribute("src");if(U){const te=new Image;te.onload=()=>{S(F)},te.onerror=(he,ie,be,xe,Fe)=>{S(F,["Error loading <img>",F,"Error",Fe])},te.src=U}else S(F,['Found an <img> tag with an empty "src" attribute. This prevents pre-loading it.',F])}for(let W=0;W<B.length;W++){const F=B[W];F.preload="auto";const U=F.getAttribute("poster");if(U){const te=new Image;te.onload=()=>{S(F)},te.onerror=(he,ie,be,xe,Fe)=>{S(F,["Error loading video poster",U,"for video",F,"Error:",Fe])},te.src=U}else F.readyState>=2?S(F):F.src?(F.onloadeddata=()=>{S(F)},F.onerror=(te,he,ie,be,xe)=>{S(F,["Error loading video",F,"Error",xe])},F.onstalled=()=>{S(F,["Loading video stalled, skipping",F])}):S(F,["Error loading video, `src` is empty",F])}const de="select",z=_.querySelectorAll(de),O=N.querySelectorAll(de);for(let W=0;W<z.length;W++)O[W].value=z[W].value;if(!K){const W=document.querySelectorAll("style, link[rel~='stylesheet'], link[as='style']");for(let F=0,U=W.length;F<U;++F){const te=W[F];if(te.tagName.toLowerCase()==="style"){const he=N.createElement(te.tagName),ie=te.sheet;if(ie){let be="";try{const xe=ie.cssRules.length;for(let Fe=0;Fe<xe;++Fe)typeof ie.cssRules[Fe].cssText=="string"&&(be+=`${ie.cssRules[Fe].cssText}\r
`)}catch(xe){c({messages:["A stylesheet could not be accessed. This is likely due to the stylesheet having cross-origin imports, and many browsers block script access to cross-origin stylesheets. See https://github.com/MatthewHerbst/react-to-print/issues/429 for details. You may be able to load the sheet by both marking the stylesheet with the cross `crossorigin` attribute, and setting the `Access-Control-Allow-Origin` header on the server serving the stylesheet. Alternatively, host the stylesheet on your domain to avoid this issue entirely.",te,`Original error: ${u(xe).message}`],level:"warning"})}he.setAttribute("id",`react-to-print-${F}`),ae&&he.setAttribute("nonce",ae),he.appendChild(N.createTextNode(be)),N.head.appendChild(he)}}else if(te.getAttribute("href"))if(te.hasAttribute("disabled"))c({messages:["`react-to-print` encountered a <link> tag with a `disabled` attribute and will ignore it. Note that the `disabled` attribute is deprecated, and some browsers ignore it. You should stop using it. https://developer.mozilla.org/en-US/docs/Web/HTML/Element/link#attr-disabled. The <link> is:",te],level:"warning"}),S(te);else{const he=N.createElement(te.tagName);for(let ie=0,be=te.attributes.length;ie<be;++ie){const xe=te.attributes[ie];xe&&he.setAttribute(xe.nodeName,(k=xe.nodeValue)!==null&&k!==void 0?k:"")}he.onload=()=>{S(he)},he.onerror=(ie,be,xe,Fe,me)=>{S(he,["Failed to load",he,"Error:",me])},ae&&he.setAttribute("nonce",ae),N.head.appendChild(he)}else c({messages:["`react-to-print` encountered a <link> tag with an empty `href` attribute. In addition to being invalid HTML, this can cause problems in many browsers, and so the <link> was not loaded. The <link> is:",te],level:"warning"}),S(te)}}}R===0&&f(y,E)}function p({bodyClass:y,contentRef:S,copyShadowRoots:v,documentTitle:E,fonts:C,ignoreGlobalStyles:A,nonce:j,onAfterPrint:w,onBeforePrint:k,onPrintError:_,pageStyle:I,preserveAfterPrint:D,print:B,suppressErrors:R}){return(0,l.useCallback)(Y=>{function P(){const M={bodyClass:y,contentRef:S,copyShadowRoots:v,documentTitle:E,fonts:C,ignoreGlobalStyles:A,nonce:j,onAfterPrint:w,onBeforePrint:k,onPrintError:_,pageStyle:I,preserveAfterPrint:D,print:B,suppressErrors:R},K=function(){const Z=document.createElement("iframe");return Z.width=`${document.documentElement.clientWidth}px`,Z.height=`${document.documentElement.clientHeight}px`,Z.style.position="absolute",Z.style.top=`-${document.documentElement.clientHeight+100}px`,Z.style.left=`-${document.documentElement.clientWidth+100}px`,Z.id="printWindow",Z.srcdoc="<!DOCTYPE html>",Z}(),L=function(Z,T){const{contentRef:N,fonts:H,ignoreGlobalStyles:G,suppressErrors:q}=T,oe=function({contentRef:U,optionalContent:te,suppressErrors:he}){return!te||te instanceof Event||(U&&c({level:"warning",messages:['"react-to-print" received a `contentRef` option and a optional-content param passed to its callback. The `contentRef` option will be ignored.']}),typeof te!="function")?U?U.current:void c({messages:['"react-to-print" did not receive a `contentRef` option or a optional-content param pass to its callback.'],suppressErrors:he}):te()}({contentRef:N,optionalContent:Z,suppressErrors:q});if(!oe)return;const de=oe.cloneNode(!0),z=document.querySelectorAll("link[rel~='stylesheet'], link[as='style']"),O=de.querySelectorAll("img"),W=de.querySelectorAll("video"),F=H?H.length:0;return{contentNode:oe,clonedContentNode:de,clonedImgNodes:O,clonedVideoNodes:W,numResourcesToLoad:(G?0:z.length)+O.length+W.length+F,originalCanvasNodes:oe.querySelectorAll("canvas")}}(Y,M);if(!L)return void c({messages:["There is nothing to print"],suppressErrors:R});const ae=function(Z,T,N){const{suppressErrors:H}=Z,G=[],q=[];return function(oe,de){G.includes(oe)?c({level:"debug",messages:["Tried to mark a resource that has already been handled",oe],suppressErrors:H}):(de?(c({messages:['"react-to-print" was unable to load a resource but will continue attempting to print the page',...de],suppressErrors:H}),q.push(oe)):G.push(oe),G.length+q.length===T&&f(N,Z))}}(M,L.numResourcesToLoad,K);(function(Z,T,N,H){Z.onload=()=>{g(Z,T,N,H)},document.body.appendChild(Z)})(K,ae,L,M)}d(D,!0),k?k().then(()=>{P()}).catch(M=>{_==null||_("onBeforePrint",u(M))}):P()},[y,S,v,E,C,A,j,w,k,_,I,D,B,R])}return o}()})})($1);var SO=$1.exports;const wO={sendEmail:async e=>{try{return(await Pn.post("/api/notifications/email",e)).data}catch(r){throw console.error("Failed to send email notification:",r),r}},sendFeeReceiptEmail:async(e,r,t)=>{try{return(await Pn.post(`/api/notifications/fee-receipt/${r}`,{studentId:e,recipientEmail:t})).data}catch(n){throw console.error("Failed to send fee receipt email:",n),n}},getNotificationSettings:async()=>{try{return(await Pn.get("/api/notifications/settings")).data}catch(e){throw console.error("Failed to fetch notification settings:",e),e}},updateNotificationSettings:async e=>{try{return(await Pn.put("/api/notifications/settings",e)).data}catch(r){throw console.error("Failed to update notification settings:",r),r}},sendPaymentReminders:async()=>{try{return(await Pn.post("/api/notifications/payment-reminders")).data}catch(e){throw console.error("Failed to send payment reminders:",e),e}}},Uu={async getSchoolSettings(){return await ge.get("/api/settings/school")},async updateSchoolSettings(e){return await ge.put("/api/settings/school",e)}},mp={CASH:"Cash",CHEQUE:"Cheque",CHECK:"Check",BANK_TRANSFER:"Bank Transfer",UPI:"UPI",ONLINE:"Online",CREDIT_CARD:"Credit Card"},Vl={MONTHLY:"Monthly",QUARTERLY:"Quarterly",HALF_YEARLY:"Half-Yearly",YEARLY:"Annual"},jO=({open:e,onClose:r,payment:t,onDownload:n,studentName:s,className:i,studentId:o,parentEmail:l=""})=>{const c=b.useRef(null),[d,u]=b.useState(null),[f,h]=b.useState(l),[x,m]=b.useState(!1),[g,p]=b.useState(!1),[y,S]=b.useState({open:!1,message:"",severity:"success"});b.useEffect(()=>{(async()=>{try{const w=await Uu.getSchoolSettings();u(w)}catch{}})()},[]);const v=SO.useReactToPrint({documentTitle:`Receipt_${(t==null?void 0:t.id)||"Unknown"}_${(s==null?void 0:s.replace(/\s+/g,"_"))||"Student"}`,content:()=>c.current}),E=async()=>{if(!(!t||!o))try{p(!0),await wO.sendFeeReceiptEmail(o,t.id,f),S({open:!0,message:"Receipt has been sent successfully to "+f,severity:"success"}),m(!1)}catch(w){console.error("Failed to send receipt email:",w),S({open:!0,message:"Failed to send email. Please try again.",severity:"error"})}finally{p(!1)}},C=()=>S({...y,open:!1});if(!t)return null;const A=t.receiptNumber||`R${String(t.id??"").padStart(6,"0")}`,j=Number(t.amountPaid??t.amount??0);return a.jsxs(At,{open:e,onClose:r,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{minHeight:"60vh"}},children:[a.jsxs(Dt,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(Vc,{sx:{mr:1}}),"Payment Receipt"]}),a.jsxs(Tt,{children:[a.jsx(ee,{ref:c,sx:{p:2},children:a.jsx(Ke,{elevation:0,sx:{p:3,border:"1px dashed #ccc"},children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsxs(X,{item:!0,xs:12,sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsxs(ee,{children:[a.jsx(V,{variant:"h5",gutterBottom:!0,children:(d==null?void 0:d.schoolName)||"School"}),a.jsx(V,{variant:"body2",color:"textSecondary",children:[d==null?void 0:d.addressLine1,d==null?void 0:d.addressLine2,d==null?void 0:d.city,d==null?void 0:d.state,d==null?void 0:d.postalCode,d==null?void 0:d.country].filter(Boolean).join(", ")||"Address not set"}),(d==null?void 0:d.phone)&&a.jsxs(V,{variant:"body2",color:"textSecondary",children:["Phone: ",d.phone]}),(d==null?void 0:d.email)&&a.jsxs(V,{variant:"body2",color:"textSecondary",children:["Email: ",d.email]})]}),a.jsxs(ee,{sx:{textAlign:"right"},children:[a.jsx(V,{variant:"h6",children:"RECEIPT"}),a.jsx(V,{variant:"body1",children:A}),a.jsxs(V,{variant:"body2",children:["Date: ",xs(new Date(t.paymentDate),"dd MMM yyyy")]})]})]}),a.jsx(X,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end"},children:a.jsxs(V,{variant:"h6",children:["TOTAL PAID: ‚Çπ",j.toLocaleString()]})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Qt,{})}),a.jsxs(X,{item:!0,xs:12,sm:6,children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"STUDENT DETAILS"}),a.jsx(V,{variant:"body1",children:s}),a.jsxs(V,{variant:"body2",children:["Class: ",i]}),a.jsxs(V,{variant:"body2",children:["Student ID: ",t.studentId]})]}),a.jsxs(X,{item:!0,xs:12,sm:6,children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"PAYMENT DETAILS"}),a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"Payment Type:"})," ",t.frequency&&Vl[t.frequency]?Vl[t.frequency]:t.frequency," ","Fee"]}),a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"Payment Method:"})," ",t.paymentMethod&&mp[t.paymentMethod]?mp[t.paymentMethod]:t.paymentMethod]}),t.reference&&a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"Reference:"})," ",t.reference]})]}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Qt,{})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(ee,{sx:{backgroundColor:"#f5f5f5",p:2,borderRadius:1,mt:2},children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsxs(X,{item:!0,xs:8,children:[a.jsxs(V,{variant:"subtitle1",children:[t.frequency&&Vl[t.frequency]?Vl[t.frequency]:t.frequency," ","Fee Payment"]}),t.notes&&a.jsxs(V,{variant:"body2",color:"textSecondary",sx:{mt:1},children:["Notes: ",t.notes]})]}),a.jsx(X,{item:!0,xs:4,sx:{textAlign:"right"},children:a.jsxs(V,{variant:"subtitle1",children:["‚Çπ",j.toLocaleString()]})})]})})}),a.jsx(X,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-end",mt:2},children:a.jsx(ee,{children:a.jsxs(V,{variant:"h6",children:["TOTAL PAID: ‚Çπ",j.toLocaleString()]})})}),a.jsxs(X,{item:!0,xs:12,sx:{mt:4},children:[a.jsx(Qt,{}),a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",mt:3,alignItems:"flex-end"},children:[a.jsxs(ee,{sx:{maxWidth:"50%"},children:[a.jsx(V,{variant:"body2",gutterBottom:!0,children:a.jsx("strong",{children:"Received with thanks"})}),a.jsx(V,{variant:"caption",color:"textSecondary",children:"This is a computer generated receipt and doesn't require a signature."})]}),a.jsx(ee,{sx:{textAlign:"center",borderTop:"1px solid #000",pt:1,minWidth:"150px"},children:a.jsx(V,{variant:"body2",children:"Authorized Signature"})})]})]})]})})}),x&&a.jsxs(ee,{sx:{mt:2,p:2,border:"1px solid #eee",borderRadius:1},children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"Send Receipt via Email"}),a.jsx(Se,{fullWidth:!0,size:"small",label:"Email Address",variant:"outlined",value:f,onChange:w=>h(w.target.value),placeholder:"parent@example.com",sx:{mb:2}}),a.jsxs(ee,{sx:{display:"flex",justifyContent:"flex-end"},children:[a.jsx(ye,{size:"small",onClick:()=>m(!1),sx:{mr:1},children:"Cancel"}),a.jsx(ye,{size:"small",variant:"contained",onClick:E,disabled:!f||g,children:g?"Sending...":"Send"})]})]})]}),a.jsxs(Ct,{sx:{justifyContent:"space-between",p:2},children:[a.jsx(ye,{onClick:r,children:"Close"}),a.jsxs(ee,{children:[!x&&o&&a.jsx(ye,{startIcon:a.jsx(hS,{}),onClick:()=>m(!0),sx:{mr:1},children:"Email Receipt"}),a.jsx(ye,{startIcon:a.jsx(Wc,{}),variant:"contained",onClick:v,children:"Print Receipt"})]})]}),a.jsx(Fa,{open:y.open,autoHideDuration:6e3,onClose:C,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:a.jsx(pt,{onClose:C,severity:y.severity,variant:"filled",children:y.message})})]})},EO=({selectedClass:e,selectedSection:r,filterStudentName:t,availableClasses:n,availableSections:s,startDate:i,endDate:o,paymentStatus:l,paymentMethod:c,minAmount:d,maxAmount:u,activeFilters:f,onClassChange:h,onSectionChange:x,onStudentNameChange:m,onStartDateChange:g,onEndDateChange:p,onPaymentStatusChange:y,onPaymentMethodChange:S,onMinAmountChange:v,onMaxAmountChange:E,onClearFilter:C,onResetFilters:A,onApplyFilters:j,onSwitchToStudentView:w})=>{const[k,_]=b.useState(!1),I=()=>{_(!k)};return a.jsxs(ee,{children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsxs(ee,{children:[a.jsx(Fx,{badgeContent:f.length,color:"primary",overlap:"circular",sx:{mr:1},children:a.jsx(ye,{variant:"outlined",color:"primary",startIcon:a.jsx(C0,{}),onClick:I,sx:{mr:1},children:k?"Hide Filters":"Show Filters"})}),a.jsx(ye,{variant:"outlined",color:"secondary",onClick:A,disabled:f.length===0,startIcon:a.jsx(On,{}),children:"Reset"})]}),a.jsx(ye,{variant:"outlined",color:"primary",onClick:w,children:"Back to Student Search"})]}),f.length>0&&a.jsx(ee,{sx:{mb:2},children:a.jsx(tr,{direction:"row",spacing:1,flexWrap:"wrap",gap:1,children:f.map(D=>{const[B,R]=D.split(":"),Y=`${B.charAt(0).toUpperCase()+B.slice(1)}: ${R}`;return a.jsx(at,{label:Y,onDelete:()=>C(B),color:"primary",variant:"outlined",size:"small"},D)})})}),a.jsx(nf,{in:k,children:a.jsx(jt,{variant:"outlined",sx:{mb:2},children:a.jsxs(Ut,{children:[a.jsxs(V,{variant:"h6",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[a.jsx(C0,{sx:{mr:1}})," Payment Filters"]}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsxs(X,{item:!0,xs:12,children:[a.jsxs(V,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[a.jsx(za,{sx:{mr:1,fontSize:"1rem"}})," Student Information"]}),a.jsx(Qt,{sx:{mb:1}})]}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsxs(Se,{select:!0,fullWidth:!0,label:"Class/Grade",value:e,onChange:h,variant:"outlined",size:"small",InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:a.jsx(mS,{color:"action",fontSize:"small"})})},children:[a.jsx(Te,{value:"",children:"All Classes"}),n.map(D=>a.jsx(Te,{value:D,children:D},D))]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsxs(Se,{select:!0,fullWidth:!0,label:"Section",value:r,onChange:x,variant:"outlined",size:"small",disabled:!e,InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:a.jsx(Xa,{color:"action",fontSize:"small"})})},children:[a.jsx(Te,{value:"",children:"All Sections"}),s.map(D=>a.jsx(Te,{value:D,children:D},D))]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsx(Se,{fullWidth:!0,label:"Student Name",value:t,onChange:m,variant:"outlined",size:"small",InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:a.jsx(za,{color:"action",fontSize:"small"})}),endAdornment:a.jsx(Nn,{position:"end",children:a.jsx(st,{onClick:j,edge:"end",size:"small",children:a.jsx(qo,{fontSize:"small"})})})},onKeyPress:D=>{D.key==="Enter"&&(D.preventDefault(),j())}})}),a.jsxs(X,{item:!0,xs:12,sx:{mt:1},children:[a.jsxs(V,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[a.jsx(pS,{sx:{mr:1,fontSize:"1rem"}})," Payment Date Range"]}),a.jsx(Qt,{sx:{mb:1}})]}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"From Date",type:"date",value:i,onChange:g,variant:"outlined",size:"small",InputLabelProps:{shrink:!0}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"To Date",type:"date",value:o,onChange:p,variant:"outlined",size:"small",InputLabelProps:{shrink:!0}})}),a.jsxs(X,{item:!0,xs:12,sx:{mt:1},children:[a.jsxs(V,{variant:"subtitle2",gutterBottom:!0,sx:{display:"flex",alignItems:"center"},children:[a.jsx(xS,{sx:{mr:1,fontSize:"1rem"}})," Payment Details"]}),a.jsx(Qt,{sx:{mb:1}})]}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsxs(Se,{select:!0,fullWidth:!0,label:"Payment Status",value:l,onChange:y,variant:"outlined",size:"small",children:[a.jsx(Te,{value:"",children:"All Statuses"}),a.jsx(Te,{value:"COMPLETED",children:"Completed"}),a.jsx(Te,{value:"PENDING",children:"Pending"}),a.jsx(Te,{value:"FAILED",children:"Failed"}),a.jsx(Te,{value:"REFUNDED",children:"Refunded"})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsxs(Se,{select:!0,fullWidth:!0,label:"Payment Method",value:c,onChange:S,variant:"outlined",size:"small",children:[a.jsx(Te,{value:"",children:"All Methods"}),a.jsx(Te,{value:"CASH",children:"Cash"}),a.jsx(Te,{value:"CREDIT_CARD",children:"Credit Card"}),a.jsx(Te,{value:"DEBIT_CARD",children:"Debit Card"}),a.jsx(Te,{value:"BANK_TRANSFER",children:"Bank Transfer"}),a.jsx(Te,{value:"CHEQUE",children:"Cheque"}),a.jsx(Te,{value:"ONLINE",children:"Online"})]})}),a.jsxs(X,{item:!0,container:!0,xs:12,sm:6,md:4,spacing:1,children:[a.jsx(X,{item:!0,xs:6,children:a.jsx(Se,{fullWidth:!0,label:"Min Amount",type:"number",value:d,onChange:v,variant:"outlined",size:"small",InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(Se,{fullWidth:!0,label:"Max Amount",type:"number",value:u,onChange:E,variant:"outlined",size:"small",InputProps:{inputProps:{min:0}}})})]})]}),a.jsx(ee,{sx:{mt:2,display:"flex",justifyContent:"flex-end"},children:a.jsx(ye,{variant:"contained",color:"primary",onClick:j,startIcon:a.jsx(qo,{}),children:"Apply Filters"})})]})})})]})},kO=["A","B","C","D","E","F"],Wl=e=>{const{children:r,value:t,index:n,...s}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`fee-tabpanel-${n}`,"aria-labelledby":`fee-tab-${n}`,...s,children:t===n&&a.jsx(ee,{sx:{p:3},children:r})})},AO=()=>{var j0;const[e,r]=b.useState(0),[t,n]=b.useState(!1),[s,i]=b.useState(!1),[o,l]=b.useState(!1),[c,d]=b.useState(!1),[u,f]=b.useState(null),[h,x]=b.useState(null),[m,g]=b.useState(""),[p,y]=b.useState(null),[S,v]=b.useState(null),[E,C]=b.useState([]),[A,j]=b.useState({open:!1,message:"",severity:"success"}),[w,k]=b.useState(""),[_,I]=b.useState(""),[D,B]=b.useState([]),[R,Y]=b.useState([]),[P,M]=b.useState([]),[K,L]=b.useState(!1),[ae,Z]=b.useState(""),[T,N]=b.useState(!1),[H,G]=b.useState(!1),[q,oe]=b.useState(!1),[de,z]=b.useState([]),[O,W]=b.useState(""),[F,U]=b.useState(""),[te,he]=b.useState(""),[ie,be]=b.useState(""),[xe,Fe]=b.useState(""),[me,ve]=b.useState(""),[ne,we]=b.useState(""),[Ee,pe]=b.useState(""),[Ce,ue]=b.useState(String(new Date().getMonth()+1)),[Me,ke]=b.useState(String(new Date().getFullYear())),[Ae,Ue]=b.useState(null),[Ye,Ve]=b.useState([]),[Xe,_t]=b.useState(!1),{data:ct,loading:dt}=Gt(()=>zr.getAll()),qt=(Ie,Le)=>{var wa;const yt=Mt=>{const Ba=Mt==null?"":String(Mt),ja=/[",\n]/.test(Ba),la=Ba.replace(/"/g,'""');return ja?`"${la}"`:la},Rt=["Receipt Number","Payment Date","Student Name","Student ID","Grade","Section","Amount","Method","Status"],vt=Ie.map(Mt=>{var Ba,ja;return[Mt.receiptNumber||"",Mt.paymentDate?new Date(Mt.paymentDate).toISOString().slice(0,10):"",Mt.studentName||((Ba=Mt.student)==null?void 0:Ba.name)||"",Mt.studentId||((ja=Mt.student)==null?void 0:ja.id)||"",Mt.studentGrade||Mt.grade||"",Mt.studentSection||Mt.section||"",Mt.amountPaid??Mt.amount??0,Mt.paymentMethod||"",Mt.paymentStatus||""].map(yt).join(",")}),Sa=[Rt.map(yt).join(","),...vt].join(`
`),fr=new Blob([Sa],{type:"text/csv;charset=utf-8"}),Vr=window.URL.createObjectURL(fr),An=document.createElement("a");An.href=Vr,An.setAttribute("download",Le),document.body.appendChild(An),An.click(),(wa=An.parentNode)==null||wa.removeChild(An)},jr=[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],Zt=160,as=async()=>{var Ie;try{if(Ae!=null&&Ae.id){await Bt.downloadStudentReportCsv({studentId:Number(Ae.id),month:Ce?Number(Ce):void 0,year:Me?Number(Me):void 0});return}if(ne){await Bt.downloadClassSectionReportCsv({grade:Number(ne),section:Ee||void 0,month:Ce?Number(Ce):void 0,year:Me?Number(Me):void 0});return}const Le=Me||new Date().getFullYear(),yt=Ce?((Ie=jr.find(vt=>vt.value===Ce))==null?void 0:Ie.label)||Ce:"ALL",Rt=Ae!=null&&Ae.id?"StudentReport":ne?"ClassReport":"Report";qt(Ye,`${Rt}-${yt}-${Le}.csv`)}catch{j({open:!0,message:"Failed to download CSV",severity:"error"})}};b.useEffect(()=>{(async()=>{try{_t(!0);let Le=[];Ae!=null&&Ae.id?Le=await Bt.getPaymentsByStudentId(Number(Ae.id)):ne?Le=await Bt.getFilteredPayments({grade:ne,section:Ee||void 0}):Le=await Bt.getAllPayments();const yt=Le.map(fr=>{var An;const Vr=(ct||[]).find(wa=>Number(wa.id??wa.studentId)===Number(fr.studentId));return{...fr,studentName:fr.studentName||((An=fr==null?void 0:fr.student)==null?void 0:An.name)||(Vr?Vr.name:""),studentGrade:fr.studentGrade||(fr==null?void 0:fr.grade)||(Vr&&Vr.grade?String(Vr.grade):""),studentSection:fr.studentSection||(fr==null?void 0:fr.section)||(Vr==null?void 0:Vr.section)||""}}),Rt=Ce?parseInt(Ce,10):void 0,vt=Me?parseInt(Me,10):void 0,Sa=yt.filter(fr=>{if(!Rt&&!vt)return!0;const Vr=fr.paymentDate?new Date(fr.paymentDate):null;if(!Vr||isNaN(Vr.getTime()))return!1;const An=Rt?Vr.getMonth()+1===Rt:!0,wa=vt?Vr.getFullYear()===vt:!0;return An&&wa});Ve(Sa)}catch(Le){console.error("Failed to load report payments",Le),Ve([])}finally{_t(!1)}})()},[ne,Ee,Ae==null?void 0:Ae.id,Ce,Me,ct]);const{user:Er}=$n(),Kn=(Er==null?void 0:Er.role)==="ADMIN"||(Er==null?void 0:Er.role)==="ACCOUNTS",{data:ss,loading:oo,error:Cl,refetch:lo}=Gt(()=>Bt.getAllFeeStructures()),{data:ir,loading:xn,error:ji,refetch:Dl}=Gt(()=>Bt.getAllTransportRoutes()),co=it.useMemo(()=>{const Ie=new Set;return(ct||[]).forEach(Le=>{Le.grade&&Ie.add(String(Le.grade))}),Array.from(Ie).sort((Le,yt)=>Number(Le)-Number(yt))},[ct]),jd=it.useMemo(()=>{const Ie=new Set;return(ct||[]).filter(Le=>ne?String(Le.grade)===String(ne):!0).forEach(Le=>{Le.section&&Ie.add(Le.section)}),Array.from(Ie).sort()},[ct,ne]),Ed=it.useMemo(()=>(ct||[]).filter(Ie=>(ne?String(Ie.grade)===String(ne):!0)&&(Ee?Ie.section===Ee:!0)),[ct,ne,Ee]),kd=it.useMemo(()=>{const Ie=new Set;return(ct||[]).forEach(Le=>{Le.grade!=null&&Ie.add(String(Le.grade))}),(ss||[]).forEach(Le=>{(Le==null?void 0:Le.classGrade)!=null&&Ie.add(String(Le.classGrade))}),Array.from(Ie).sort((Le,yt)=>Number(Le)-Number(yt))},[ct,ss]),J=it.useMemo(()=>{const Ie=new Set,Le=new Set;(ct||[]).forEach(Rt=>{Rt.section&&Le.add(Rt.section)}),(ct||[]).filter(Rt=>w?String(Rt.grade)===String(w):!0).forEach(Rt=>{Rt.section&&Ie.add(Rt.section)});let yt=w&&Ie.size===0?Array.from(Le):Array.from(Ie);return yt.length===0&&(yt=kO.slice()),yt.sort()},[ct,w]),le=it.useMemo(()=>(ct||[]).filter(Ie=>(w?String(Ie.grade)===String(w):!0)&&(_?Ie.section===_:!0)),[ct,w,_]),re=(Ie,Le)=>{r(Le)},se=async()=>{if(m.trim())try{const Ie=await zr.search(m);if(Ie){const Le=Array.isArray(Ie)?Ie[0]:Ie;if(Le&&Le.id){y(Le),console.log("Selected student:",Le);const yt=await ce(Le.id);!yt||!yt.studentFeeId?console.warn("No fee details found for student. Payments may not work correctly."):console.log("Successfully loaded fee details:",yt),await fe(Le.id)}else throw new Error("Invalid student data returned")}else j({open:!0,message:"Student not found",severity:"error"}),y(null)}catch{j({open:!0,message:"Error searching for student",severity:"error"})}},ce=async Ie=>{try{const Le=await Bt.getStudentFeeDetails(Ie);return v(Le),console.log("Fetched student fee details:",Le),Le}catch(Le){return console.error("Error fetching student fee details:",Le),j({open:!0,message:"Error fetching student fee details",severity:"error"}),null}},fe=async Ie=>{try{const Le=await Bt.getPaymentsByStudentId(Ie);C(Le)}catch{j({open:!0,message:"Error fetching student payments",severity:"error"})}},De=b.useCallback(async()=>{G(!0);try{const Ie={grade:w,section:_,studentName:ae},Le=await Bt.getFilteredPayments(Object.values(Ie).some(vt=>vt)?Ie:void 0);M(Le),L(!0);const yt=new Set,Rt=new Set;(ct||[]).forEach(vt=>{vt.grade!=null&&yt.add(String(vt.grade)),vt.section&&Rt.add(vt.section)}),Le.forEach(vt=>{vt.studentGrade&&yt.add(String(vt.studentGrade)),vt.studentSection&&Rt.add(String(vt.studentSection))}),B(Array.from(yt).sort((vt,Sa)=>Number(vt)-Number(Sa))),Y(Array.from(Rt).sort())}catch(Ie){console.error("Error fetching all payments:",Ie),j({open:!0,message:"Failed to load all payments",severity:"error"})}finally{G(!1)}},[]),$e=Ie=>{const Le=Ie.target.value;k(Le),Ft("class",Le),I(""),Ft("section","")},_e=Ie=>{const Le=Ie.target.value;I(Le),Ft("section",Le)},Pe=Ie=>{const Le=Ie.target.value;Z(Le),Ft("student",Le)},Ne=Ie=>{const Le=Ie.target.value;W(Le),qe(Le,F)},We=Ie=>{const Le=Ie.target.value;U(Le),qe(O,Le)},qe=(Ie,Le)=>{if(Ie||Le){const yt=`${Ie||"Any"} to ${Le||"Latest"}`;Ft("dateRange",yt)}else Ft("dateRange","")},et=Ie=>{const Le=Ie.target.value;he(Le),Ft("status",Le)},ze=Ie=>{const Le=Ie.target.value;be(Le),Ft("method",Le)},Je=Ie=>{const Le=Ie.target.value;Fe(Le),rr(Le,me)},mt=Ie=>{const Le=Ie.target.value;ve(Le),rr(xe,Le)},rr=(Ie,Le)=>{if(Ie||Le){const yt=`${Ie||"0"} - ${Le||"Any"}`;Ft("amount",yt)}else Ft("amount","")},or=Ie=>{switch(Ie){case"class":k(""),Ft("class","");break;case"section":I(""),Ft("section","");break;case"student":Z(""),Ft("student","");break;case"dateRange":W(""),U(""),Ft("dateRange","");break;case"amount":Fe(""),ve(""),Ft("amount","");break;case"status":he(""),Ft("status","");break;case"method":be(""),Ft("method","");break}setTimeout(()=>De(),0)},Ft=(Ie,Le)=>{if(!Le)z(yt=>yt.filter(Rt=>!Rt.startsWith(Ie)));else{const yt=`${Ie}:${Le}`;de.includes(yt)||z(Rt=>[...Rt.filter(vt=>!vt.startsWith(Ie)),yt])}},Ms=()=>{L(!1),w0(),M([]),B([]),Y([])},Ps=async()=>{S0(),oe(!0),await De(),j({open:!0,message:"Showing all payments. Use filters to narrow results.",severity:"success"})},Ns=async()=>{l(!1),j({open:!0,message:"Payment processed successfully",severity:"success"}),p!=null&&p.id&&(await ce(p.id),await fe(p.id))},oa=async Ie=>{var Rt;f(Ie);const Le=[...E||[],...P||[]].find(vt=>vt.id===Ie),yt=(vt,Sa)=>{x(vt),d(!0)};try{if(Le!=null&&Le.receiptNumber){const vt=await Bt.getPaymentByReceipt(Le.receiptNumber);return yt(vt)}}catch{}try{const vt=await Bt.getPaymentById(Ie);return yt(vt)}catch(vt){if(Le)return yt(Le);const fr=((vt==null?void 0:vt.status)||((Rt=vt==null?void 0:vt.response)==null?void 0:Rt.status))===404?"Payment not found. It may have been deleted.":"Unable to load payment details for receipt";j({open:!0,message:fr,severity:"error"})}},is=async Ie=>{try{await Bt.downloadReceipt(Ie),j({open:!0,message:"Receipt downloaded successfully",severity:"success"})}catch{j({open:!0,message:"Error downloading receipt",severity:"error"})}},Bn=async Ie=>{if(!window.confirm("Are you sure you want to void this payment? This action cannot be undone."))return;const Le=window.prompt("Please enter a reason for voiding this payment:","Voided by admin")||"";if(!Le.trim()){j({open:!0,message:"Void reason is required.",severity:"error"});return}try{await Bt.voidPayment(Ie,Le),j({open:!0,message:"Payment voided successfully",severity:"success"}),p!=null&&p.id&&(await ce(p.id),await fe(p.id))}catch{j({open:!0,message:"Error voiding payment",severity:"error"})}},S0=()=>{y(null),g(""),v(null),C([])},w0=()=>{k(""),I(""),Z(""),z([]),W(""),U(""),he(""),be(""),Fe(""),ve(""),N(!1),K&&setTimeout(()=>De(),0)};return a.jsxs(ee,{sx:{width:"100%"},children:[a.jsx(ee,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(aa,{value:e,onChange:re,"aria-label":"fee management tabs",children:[a.jsx(kt,{label:"Fee Structures"}),a.jsx(kt,{label:"Transport Routes"}),a.jsx(kt,{label:"Payments"}),a.jsx(kt,{label:"Reports"})]})}),a.jsxs(Wl,{value:e,index:0,children:[a.jsxs(ee,{sx:{mb:2,display:"flex",justifyContent:"space-between"},children:[a.jsx(V,{variant:"h6",children:"Fee Structures"}),"          ",a.jsx(ps,{permissions:["MANAGE_FEES"],children:a.jsx(ye,{variant:"contained",startIcon:a.jsx(js,{}),onClick:()=>n(!0),children:"Add Fee Structure"})})]}),oo?a.jsx(Ar,{}):Cl?a.jsx(Kr,{message:"Error loading fee structures"}):ss?a.jsx(yO,{feeStructures:ss,onEdit:Ie=>console.log("Edit fee structure:",Ie),onDelete:Ie=>console.log("Delete fee structure:",Ie),onRefresh:lo}):null]}),a.jsxs(Wl,{value:e,index:1,children:[a.jsxs(ee,{sx:{mb:2,display:"flex",justifyContent:"space-between"},children:[a.jsx(V,{variant:"h6",children:"Transport Routes"}),"          ",a.jsx(ps,{permissions:["MANAGE_FEES"],children:a.jsx(ye,{variant:"contained",startIcon:a.jsx(js,{}),onClick:()=>i(!0),children:"Add Transport Route"})})]}),xn?a.jsx(Ar,{}):ji?a.jsx(Kr,{message:"Error loading transport routes"}):ir?a.jsx(gO,{transportRoutes:ir,onEdit:Ie=>console.log("Edit route:",Ie),onDelete:Ie=>console.log("Delete route:",Ie),onRefresh:Dl}):null]}),"      ",a.jsxs(Wl,{value:e,index:2,children:[a.jsxs(ee,{sx:{mb:3},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:K?"All Payments":"Student Fee Management"}),a.jsx(Ke,{sx:{p:2},children:K?a.jsx(EO,{selectedClass:w,selectedSection:_,filterStudentName:ae,availableClasses:D,availableSections:R,startDate:O,endDate:F,paymentStatus:te,paymentMethod:ie,minAmount:xe,maxAmount:me,activeFilters:de,onClassChange:$e,onSectionChange:_e,onStudentNameChange:Pe,onStartDateChange:Ne,onEndDateChange:We,onPaymentStatusChange:et,onPaymentMethodChange:ze,onMinAmountChange:Je,onMaxAmountChange:mt,onClearFilter:or,onResetFilters:w0,onApplyFilters:De,onSwitchToStudentView:Ms}):a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsxs(Se,{select:!0,label:"Class",value:w,onChange:Ie=>{const Le=Ie.target.value;k(Le),I("")},fullWidth:!0,children:[a.jsx(Te,{value:"",children:"All"}),kd.map(Ie=>a.jsx(Te,{value:Ie,children:Ie},Ie))]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsxs(Se,{select:!0,label:"Section",value:_,onChange:Ie=>I(Ie.target.value),fullWidth:!0,disabled:!w,children:[a.jsx(Te,{value:"",children:"All"}),J.map(Ie=>a.jsx(Te,{value:Ie,children:Ie},Ie))]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsx(Yi,{options:le,getOptionLabel:Ie=>`${Ie.name} (${Ie.studentId||Ie.id})`,value:p,onChange:(Ie,Le)=>{y(Le),Le!=null&&Le.id&&(ce(Le.id),fe(Le.id))},onInputChange:(Ie,Le)=>g(Le),filterOptions:(Ie,Le)=>{const yt=(Le.inputValue||"").toLowerCase();return yt?Ie.filter(Rt=>(Rt.name||"").toLowerCase().includes(yt)||String(Rt.studentId||Rt.id||"").toLowerCase().includes(yt)):Ie},renderInput:Ie=>a.jsx(Se,{...Ie,label:"Search Student",variant:"outlined",fullWidth:!0,InputProps:{...Ie.InputProps,endAdornment:a.jsx(a.Fragment,{children:dt?a.jsx(Ar,{size:20}):Ie.InputProps.endAdornment})}})})}),a.jsx(X,{item:!0,children:a.jsx(ye,{variant:"contained",startIcon:a.jsx(qo,{}),onClick:se,children:"Search"})}),a.jsx(X,{item:!0,children:a.jsx(xt,{title:"Reset",children:a.jsx(st,{onClick:S0,children:a.jsx(On,{})})})}),a.jsxs(X,{item:!0,children:[a.jsx(ye,{variant:"outlined",color:"primary",onClick:Ps,children:"View All Payments"}),"                "]})]})})]}),p&&a.jsxs(a.Fragment,{children:[a.jsx(ee,{sx:{mt:3},children:a.jsxs(Ke,{sx:{p:2,mb:3},children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsxs(V,{variant:"h6",children:[p.name,"'s Fee Details"]}),a.jsx(ps,{permissions:["MANAGE_FEES"],children:a.jsx(ye,{variant:"contained",startIcon:a.jsx(Vc,{}),onClick:()=>l(!0),disabled:!S,children:"Record Payment"})})]}),S?a.jsx(L1,{feeDetails:S}):a.jsx(V,{children:"No fee details available for this student"})]})}),a.jsxs(ee,{sx:{mt:3},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Payment History"}),a.jsx(cc,{payments:E,onViewReceipt:oa,onDownloadReceipt:is,onVoidPayment:Bn,isAdmin:Kn})]})]}),"        ",K&&a.jsxs(ee,{sx:{mt:3},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"All Payments"}),a.jsx(cc,{payments:P,onViewReceipt:oa,onDownloadReceipt:is,onVoidPayment:Kn?Bn:void 0,isAdmin:Kn,showStudentDetails:!0})]})]}),a.jsx(Wl,{value:e,index:3,children:a.jsxs(X,{container:!0,spacing:3,alignItems:"flex-start",children:[a.jsx(X,{item:!0,xs:12,children:a.jsx(jt,{elevation:2,children:a.jsxs(Ut,{sx:{p:2.5,overflow:"visible"},children:[a.jsxs(tr,{direction:"row",spacing:1,alignItems:"center",sx:{flexWrap:"nowrap",columnGap:1,overflowX:"auto",overflowY:"visible",minHeight:64},children:[a.jsxs(Se,{select:!0,label:"Class",size:"small",value:ne,onChange:Ie=>{we(Ie.target.value),pe("")},sx:{width:Zt,minWidth:Zt,"& .MuiInputBase-input":{fontSize:"0.9rem"}},children:[a.jsx(Te,{value:"",children:"Select"}),co.map(Ie=>a.jsx(Te,{value:Ie,children:Ie},Ie))]}),a.jsxs(Se,{select:!0,label:"Section (optional)",size:"small",value:Ee,onChange:Ie=>pe(Ie.target.value),disabled:!ne,sx:{width:Zt,minWidth:Zt,"& .MuiInputBase-input":{fontSize:"0.9rem"}},children:[a.jsx(Te,{value:"",children:"All"}),jd.map(Ie=>a.jsx(Te,{value:Ie,children:Ie},Ie))]}),a.jsx(Yi,{size:"small",sx:{width:Zt,minWidth:Zt,"& .MuiInputBase-input":{fontSize:"0.9rem",py:.5}},options:Ed,getOptionLabel:Ie=>`${Ie.name} (${Ie.studentId||Ie.id})`,value:Ae,onChange:(Ie,Le)=>Ue(Le),renderInput:Ie=>a.jsx(Se,{...Ie,label:"Student (optional)",placeholder:"Search name/ID",variant:"outlined",size:"small",sx:{"& .MuiInputBase-input":{fontSize:"0.9rem"}}})}),a.jsxs(Se,{select:!0,label:"Month",size:"small",value:Ce,onChange:Ie=>ue(Ie.target.value),InputLabelProps:{shrink:!0},sx:{width:Zt,minWidth:Zt,mt:.25,overflow:"visible","& .MuiOutlinedInput-root":{overflow:"visible"},"& .MuiInputBase-input":{fontSize:"0.9rem"},"& .MuiInputLabel-root":{bgcolor:"background.paper",px:.5,zIndex:1},"& .MuiOutlinedInput-notchedOutline legend":{width:"auto"}},InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:a.jsx(Bx,{fontSize:"small",color:"action"})})},children:[a.jsx(Te,{value:"",children:"All"}),jr.map(Ie=>a.jsx(Te,{value:Ie.value,children:Ie.label},Ie.value))]}),a.jsx(Se,{label:"Year",type:"number",size:"small",value:Me,onChange:Ie=>ke(Ie.target.value),InputLabelProps:{shrink:!0},sx:{width:Zt,minWidth:Zt,mt:.25,overflow:"visible","& .MuiOutlinedInput-root":{overflow:"visible"},"& input":{fontSize:"0.9rem"},"& .MuiInputLabel-root":{bgcolor:"background.paper",px:.5,zIndex:1},"& .MuiOutlinedInput-notchedOutline legend":{width:"auto"}},inputProps:{min:2e3,max:new Date().getFullYear()+1}})]}),a.jsx(ee,{sx:{mt:1,display:"flex"},children:a.jsx(ye,{size:"small",variant:"contained",startIcon:a.jsx(gS,{}),onClick:as,sx:{whiteSpace:"nowrap",px:1,minWidth:Zt,width:Zt,height:32},children:"Download CSV"})})]})})}),a.jsx(X,{item:!0,xs:12,children:Xe?a.jsx(Ar,{}):a.jsx(cc,{payments:Ye,onViewReceipt:oa,onDownloadReceipt:is,onVoidPayment:Kn?Bn:void 0,isAdmin:Kn,showStudentDetails:!0,showClassSection:!1})})]})}),"      ",t&&a.jsx(vO,{open:t,onClose:()=>n(!1),onSubmit:async Ie=>{try{const{createFeeStructure:Le}=await qr(()=>import("./createFeeStructure-d8575312.js"),["assets/createFeeStructure-d8575312.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]);await Le(Ie),n(!1),lo(),j({open:!0,message:"Fee structure created successfully",severity:"success"})}catch(Le){console.error("Error creating fee structure:",Le),j({open:!0,message:`Failed to create fee structure: ${Le instanceof Error?Le.message:"Unknown error"}`,severity:"error"})}}}),s&&a.jsx(bO,{open:s,onClose:()=>i(!1),onSubmit:async Ie=>{await Bt.createTransportRoute(Ie),i(!1),Dl(),j({open:!0,message:"Transport route created successfully",severity:"success"})}}),"      ",o&&p&&S&&a.jsx(O1,{open:o,onClose:()=>l(!1),studentId:p.id??null,onSubmit:async Ie=>{var Le,yt,Rt,vt,Sa,fr,Vr,An,wa;try{const{debugPayment:Mt}=await qr(()=>import("./debugUtils-86d8ca2d.js"),["assets/debugUtils-86d8ca2d.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]),{processPayment:Ba}=await qr(()=>import("./paymentHandler-6ff93e22.js"),["assets/paymentHandler-6ff93e22.js","assets/errorReporting-2d2ad2d5.js","assets/corsHelper-66efeb43.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js"]);if(Mt("Payment Submission Start",Ie),!Ie.studentId||!Ie.amount||!Ie.paymentDate){const la=new Error("Missing required payment information");throw Mt("Payment Validation Failed",Ie,la),la}!Ie.feeId&&!Ie.studentFeeId&&S&&(Ie.feeId=S.studentFeeId||((Le=S.feeStructure)==null?void 0:Le.id),Mt("Added missing feeId to payment",Ie));const ja=await Ba(Ie);Mt("Payment Created Successfully",ja),Ns()}catch(Mt){const{reportPaymentError:Ba}=await qr(()=>import("./errorReporting-2d2ad2d5.js"),[]),ja=Ba(Mt,Ie);console.error("Payment processing error diagnostics:",ja);let la="Error processing payment";if(ja.corsRelated)la="Network error processing payment. This appears to be a CORS-related issue.";else if(ja.validationRelated){const E0=Mt.validationErrors||((Rt=(yt=Mt.response)==null?void 0:yt.data)==null?void 0:Rt.validationErrors)||((Sa=(vt=Mt.response)==null?void 0:vt.data)==null?void 0:Sa.errors)||((Vr=(fr=Mt.response)==null?void 0:fr.data)==null?void 0:Vr.fieldErrors);E0?la=`Validation error with fields: ${Object.keys(E0).join(", ")}`:(wa=(An=Mt.response)==null?void 0:An.data)!=null&&wa.message&&(la=`Validation error: ${Mt.response.data.message}`)}else Mt.message&&(la=`Error: ${Mt.message}`);j({open:!0,message:la,severity:"error"})}},loading:!1}),"      ",c&&u!==null&&h&&a.jsx(jO,{open:c,payment:h,studentName:(p==null?void 0:p.name)||"Student",className:`Grade ${((j0=S==null?void 0:S.feeStructure)==null?void 0:j0.classGrade)||"N/A"}`,onClose:()=>{d(!1),f(null),x(null)},onDownload:()=>{u!==null&&is(u)}}),a.jsx(Fa,{open:A.open,autoHideDuration:6e3,onClose:()=>j({...A,open:!1}),children:a.jsx(pt,{onClose:()=>j({...A,open:!1}),severity:A.severity,sx:{width:"100%"},children:A.message})})]})};var kh={},TO=Lt;Object.defineProperty(kh,"__esModule",{value:!0});var B1=kh.default=void 0,CO=TO($t()),DO=a;B1=kh.default=(0,CO.default)((0,DO.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School");var Ah={},_O=Lt;Object.defineProperty(Ah,"__esModule",{value:!0});var Th=Ah.default=void 0,IO=_O($t()),FO=a;Th=Ah.default=(0,IO.default)((0,FO.jsx)("path",{d:"M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3m-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3m0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5m8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5"}),"People");var Ch={},MO=Lt;Object.defineProperty(Ch,"__esModule",{value:!0});var U1=Ch.default=void 0,PO=MO($t()),pp=a;U1=Ch.default=(0,PO.default)([(0,pp.jsx)("path",{d:"M21 5c-1.11-.35-2.33-.5-3.5-.5-1.95 0-4.05.4-5.5 1.5-1.45-1.1-3.55-1.5-5.5-1.5S2.45 4.9 1 6v14.65c0 .25.25.5.5.5.1 0 .15-.05.25-.05C3.1 20.45 5.05 20 6.5 20c1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.3 4.75 1.05.1.05.15.05.25.05.25 0 .5-.25.5-.5V6c-.6-.45-1.25-.75-2-1m0 13.5c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V8c1.35-.85 3.8-1.5 5.5-1.5 1.2 0 2.4.15 3.5.5z"},"0"),(0,pp.jsx)("path",{d:"M17.5 10.5c.88 0 1.73.09 2.5.26V9.24c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99M13 12.49v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26V11.9c-.79-.15-1.64-.24-2.5-.24-1.7 0-3.24.3-4.5.83m4.5 1.84c-1.7 0-3.24.29-4.5.83v1.66c1.13-.64 2.7-.99 4.5-.99.88 0 1.73.09 2.5.26v-1.52c-.79-.16-1.64-.24-2.5-.24"},"1")],"MenuBook");var Dh={},NO=Lt;Object.defineProperty(Dh,"__esModule",{value:!0});var _h=Dh.default=void 0,RO=NO($t()),OO=a;_h=Dh.default=(0,RO.default)((0,OO.jsx)("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2M9 17H7v-7h2zm4 0h-2V7h2zm4 0h-2v-4h2z"}),"Assessment");var Ih={},LO=Lt;Object.defineProperty(Ih,"__esModule",{value:!0});var V1=Ih.default=void 0,$O=LO($t()),BO=a;V1=Ih.default=(0,$O.default)((0,BO.jsx)("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard");var Fh={},UO=Lt;Object.defineProperty(Fh,"__esModule",{value:!0});var Wa=Fh.default=void 0,VO=UO($t()),WO=a;Wa=Fh.default=(0,VO.default)((0,WO.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");var Mh={},HO=Lt;Object.defineProperty(Mh,"__esModule",{value:!0});var W1=Mh.default=void 0,YO=HO($t()),zO=a;W1=Mh.default=(0,YO.default)((0,zO.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"}),"FormatQuote");var Ph={},GO=Lt;Object.defineProperty(Ph,"__esModule",{value:!0});var H1=Ph.default=void 0,qO=GO($t()),XO=a;H1=Ph.default=(0,qO.default)((0,XO.jsx)("path",{d:"M17 10H7v2h10zm2-7h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 16H5V8h14zm-5-5H7v2h7z"}),"EventNote");var Nh={},KO=Lt;Object.defineProperty(Nh,"__esModule",{value:!0});var Y1=Nh.default=void 0,JO=KO($t()),QO=a;Y1=Nh.default=(0,JO.default)((0,QO.jsx)("path",{d:"M14.06 9.94 12 9l2.06-.94L15 6l.94 2.06L18 9l-2.06.94L15 12zM4 14l.94-2.06L7 11l-2.06-.94L4 8l-.94 2.06L1 11l2.06.94zm4.5-5 1.09-2.41L12 5.5 9.59 4.41 8.5 2 7.41 4.41 5 5.5l2.41 1.09zm-4 11.5 6-6.01 4 4L23 8.93l-1.41-1.41-7.09 7.97-4-4L3 19z"}),"AutoGraph");var Rh={},ZO=Lt;Object.defineProperty(Rh,"__esModule",{value:!0});var z1=Rh.default=void 0,e4=ZO($t()),t4=a;z1=Rh.default=(0,e4.default)((0,t4.jsx)("path",{d:"M19 5h-2V3H7v2H5c-1.1 0-2 .9-2 2v1c0 2.55 1.92 4.63 4.39 4.94.63 1.5 1.98 2.63 3.61 2.96V19H7v2h10v-2h-4v-3.1c1.63-.33 2.98-1.46 3.61-2.96C19.08 12.63 21 10.55 21 8V7c0-1.1-.9-2-2-2M5 8V7h2v3.82C5.84 10.4 5 9.3 5 8m14 0c0 1.3-.84 2.4-2 2.82V7h2z"}),"EmojiEvents");const r4=[{icon:a.jsx(V1,{fontSize:"large",color:"primary"}),title:"Interactive Dashboard",description:"Get a comprehensive view of school performance with our intuitive dashboard"},{icon:a.jsx(Th,{fontSize:"large",color:"primary"}),title:"Student Management",description:"Manage student profiles, attendance, performance and more in one place"},{icon:a.jsx(B1,{fontSize:"large",color:"primary"}),title:"Teacher Management",description:"Streamline teacher scheduling, performance tracking, and professional development"},{icon:a.jsx(U1,{fontSize:"large",color:"primary"}),title:"Course Management",description:"Create and manage courses, curriculum planning and resource allocation"},{icon:a.jsx(_h,{fontSize:"large",color:"primary"}),title:"Detailed Reports",description:"Generate insightful reports on attendance, grades, and overall performance"},{icon:a.jsx(Cf,{fontSize:"large",color:"primary"}),title:"Admissions",description:"Simplify the admission process with online applications and tracking"}],n4=[{name:"Sarah Johnson",position:"Principal, Westfield Academy",comment:"Implementing this School Management System has transformed our administrative processes. We've reduced paperwork by 80% and our staff can focus more on what matters - the students.",rating:5},{name:"Michael Chen",position:"IT Director, Riverdale High School",comment:"After evaluating several systems, this platform stood out for its intuitive interface and comprehensive feature set. The support team has been exceptional throughout our onboarding.",rating:5},{name:"Dr. Amelia Patel",position:"Superintendent, Springfield District",comment:"The analytics and reporting capabilities have given us unprecedented insights into student performance trends. It's helping us make data-driven decisions to improve educational outcomes.",rating:4.5}],a4=[{question:"How easy is it to migrate from our current system?",answer:"Our team provides comprehensive migration support. We have experience integrating with most popular school management systems and can transfer your data seamlessly with minimal disruption to your operations."},{question:"Is the platform secure for handling student data?",answer:"Absolutely. We prioritize data security with end-to-end encryption, regular security audits, and full compliance with educational data protection regulations including FERPA and GDPR."},{question:"Can we customize the platform for our school's specific needs?",answer:"Yes, our system is highly customizable. You can configure user roles, permission sets, and workflows to match your institution's processes. For more specialized needs, our development team can build custom modules."},{question:"What kind of training and support do you provide?",answer:"We offer comprehensive onboarding training for administrators, teachers, and staff. Our support team is available via email, chat, and phone. We also provide an extensive knowledge base with tutorials and best practices."},{question:"Do you offer mobile access for parents and students?",answer:"Yes, our platform is fully mobile-responsive and we offer dedicated mobile apps for both iOS and Android. Parents and students can access grades, attendance, announcements, and more on the go."}],s4=[{icon:a.jsx(Y1,{fontSize:"large",color:"primary"}),value:"95%",label:"Administrative Efficiency Increase"},{icon:a.jsx(Th,{fontSize:"large",color:"primary"}),value:"250+",label:"Schools Onboarded"},{icon:a.jsx(H1,{fontSize:"large",color:"primary"}),value:"68%",label:"Reduction in Paperwork"},{icon:a.jsx(z1,{fontSize:"large",color:"primary"}),value:"4.8/5",label:"Customer Satisfaction"}],i4=()=>{const e=af();sf(e.breakpoints.down("sm"));const[r,t]=b.useState(!1),n=s=>(i,o)=>{t(o?s:!1)};return a.jsxs(ee,{sx:{minHeight:"100vh"},children:[a.jsx(Ke,{sx:{position:"relative",backgroundColor:e.palette.primary.main,color:e.palette.primary.contrastText,pt:8,pb:12},elevation:0,children:a.jsx(Rs,{maxWidth:"lg",children:a.jsxs(X,{container:!0,spacing:4,alignItems:"center",children:[a.jsxs(X,{item:!0,md:7,xs:12,children:[a.jsx(V,{variant:"h1",gutterBottom:!0,sx:{fontWeight:700,fontSize:{xs:"2.5rem",md:"3.5rem"}},children:"Modern School Management System"}),a.jsx(V,{variant:"h5",paragraph:!0,sx:{mb:4,opacity:.9},children:"Streamline educational administration with our comprehensive, user-friendly platform designed for modern schools."}),a.jsxs(tr,{direction:{xs:"column",sm:"row"},spacing:2,children:[a.jsx(ye,{component:na,to:"/login",variant:"contained",size:"large",color:"secondary",sx:{px:4,py:1.5},children:"Sign In"}),a.jsx(ye,{component:na,to:"/register",variant:"outlined",size:"large",sx:{px:4,py:1.5,color:"white",borderColor:"white","&:hover":{borderColor:"white",backgroundColor:"rgba(255,255,255,0.1)"}},children:"Register"})]})]}),a.jsx(X,{item:!0,md:5,xs:12,sx:{display:{xs:"none",md:"block"}},children:a.jsx(ee,{component:"img",src:"/school-illustration.svg",alt:"School Management",sx:{width:"100%",maxHeight:400,objectFit:"contain",filter:"drop-shadow(0px 4px 8px rgba(0,0,0,0.2))"}})})]})})}),a.jsxs(Rs,{maxWidth:"lg",sx:{py:8},children:[a.jsx(V,{variant:"h3",align:"center",gutterBottom:!0,sx:{mb:6,fontWeight:700},children:"Transforming Education Administration"}),a.jsx(X,{container:!0,spacing:4,justifyContent:"center",children:s4.map((s,i)=>a.jsx(X,{item:!0,xs:6,md:3,children:a.jsxs(Ke,{elevation:3,sx:{p:3,textAlign:"center",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",transition:"0.3s","&:hover":{transform:"translateY(-5px)",boxShadow:e.shadows[8]}},children:[a.jsx(ee,{sx:{mb:2},children:s.icon}),a.jsx(V,{variant:"h3",component:"div",sx:{fontWeight:"bold",mb:1},children:s.value}),a.jsx(V,{variant:"body1",color:"text.secondary",children:s.label})]})},i))})]}),a.jsxs(Rs,{maxWidth:"lg",sx:{py:8},children:[a.jsx(V,{variant:"h3",align:"center",gutterBottom:!0,sx:{mb:6,fontWeight:700},children:"Features that Transform Education Management"}),a.jsx(X,{container:!0,spacing:4,children:r4.map((s,i)=>a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsx(jt,{sx:{height:"100%",display:"flex",flexDirection:"column",transition:"0.3s","&:hover":{transform:"translateY(-5px)",boxShadow:e.shadows[10]}},elevation:2,children:a.jsxs(Ut,{sx:{flexGrow:1,textAlign:"center",p:3},children:[a.jsx(ee,{sx:{mb:2},children:s.icon}),a.jsx(V,{variant:"h5",component:"h2",gutterBottom:!0,fontWeight:"bold",children:s.title}),a.jsx(V,{variant:"body1",color:"text.secondary",children:s.description})]})})},i))})]}),a.jsx(ee,{sx:{py:8,bgcolor:"background.default"},children:a.jsxs(Rs,{maxWidth:"lg",children:[a.jsx(V,{variant:"h3",align:"center",gutterBottom:!0,sx:{mb:6,fontWeight:700},children:"Trusted by Educational Leaders"}),a.jsx(X,{container:!0,spacing:4,children:n4.map((s,i)=>a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(jt,{elevation:3,sx:{height:"100%",display:"flex",flexDirection:"column",position:"relative",pt:6,pb:3,px:3},children:[a.jsx(ee,{sx:{position:"absolute",top:-20,left:"calc(50% - 25px)",width:50,height:50,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:e.palette.primary.main,color:"white"},children:a.jsx(W1,{})}),a.jsxs(Ut,{sx:{textAlign:"center",flexGrow:1},children:[a.jsxs(V,{variant:"body1",sx:{mb:3,fontStyle:"italic"},children:['"',s.comment,'"']}),a.jsxs(ee,{sx:{mt:"auto"},children:[a.jsx(V,{variant:"h6",component:"div",fontWeight:"bold",children:s.name}),a.jsx(V,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:s.position}),a.jsx(yS,{value:s.rating,precision:.5,readOnly:!0,sx:{mt:1}})]})]})]})},i))})]})}),a.jsxs(Rs,{maxWidth:"md",sx:{py:8},children:[a.jsx(V,{variant:"h3",align:"center",gutterBottom:!0,sx:{mb:6,fontWeight:700},children:"Frequently Asked Questions"}),a.jsx(Ke,{elevation:2,sx:{p:{xs:2,md:4},borderRadius:2},children:a4.map((s,i)=>a.jsxs(ds,{expanded:r===`panel${i}`,onChange:n(`panel${i}`),disableGutters:!0,elevation:0,sx:{border:0,"&:not(:last-child)":{borderBottom:1,borderColor:"divider"},"&:before":{display:"none"}},children:[a.jsx(us,{expandIcon:a.jsx(Wa,{}),"aria-controls":`panel${i}-content`,id:`panel${i}-header`,sx:{py:2},children:a.jsx(V,{variant:"h6",fontWeight:"medium",children:s.question})}),a.jsx(fs,{children:a.jsx(V,{variant:"body1",color:"text.secondary",children:s.answer})})]},i))})]}),a.jsx(ee,{sx:{py:8,bgcolor:"background.default"},children:a.jsx(Rs,{maxWidth:"md",children:a.jsxs(Ke,{elevation:4,sx:{p:{xs:4,md:6},textAlign:"center",borderRadius:4,backgroundColor:e.palette.background.paper,backgroundImage:"linear-gradient(rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.9))"},children:[a.jsx(V,{variant:"h4",gutterBottom:!0,fontWeight:"bold",children:"Ready to Transform Your School's Administration?"}),a.jsx(V,{variant:"body1",paragraph:!0,sx:{mb:4,maxWidth:"80%",mx:"auto"},children:"Join thousands of educational institutions that have streamlined their operations with our comprehensive School Management System."}),a.jsx(ye,{component:na,to:"/register",variant:"contained",color:"primary",size:"large",sx:{px:5,py:1.5},children:"Get Started Today"})]})})}),a.jsx(ee,{component:"footer",sx:{py:6,bgcolor:"background.paper",borderTop:`1px solid ${e.palette.divider}`},children:a.jsx(Rs,{maxWidth:"lg",children:a.jsxs(X,{container:!0,spacing:4,justifyContent:"space-between",children:[a.jsxs(X,{item:!0,xs:12,sm:6,md:3,children:[a.jsx(V,{variant:"h6",color:"text.primary",gutterBottom:!0,children:"School MS"}),a.jsx(V,{variant:"body2",color:"text.secondary",children:"Simplifying education management for a better learning experience."}),a.jsx(ee,{sx:{mt:2},children:a.jsxs(V,{variant:"body2",color:"text.secondary",children:["¬© ",new Date().getFullYear()," School Management System"]})})]}),a.jsxs(X,{item:!0,xs:12,sm:6,md:3,children:[a.jsx(V,{variant:"h6",color:"text.primary",gutterBottom:!0,children:"Features"}),a.jsx(Wn,{component:na,to:"/login",color:"text.secondary",display:"block",sx:{mb:1},children:"Dashboard"}),a.jsx(Wn,{component:na,to:"/login",color:"text.secondary",display:"block",sx:{mb:1},children:"Student Management"}),a.jsx(Wn,{component:na,to:"/login",color:"text.secondary",display:"block",sx:{mb:1},children:"Teacher Management"}),a.jsx(Wn,{component:na,to:"/login",color:"text.secondary",display:"block",children:"Reports"})]}),a.jsxs(X,{item:!0,xs:12,sm:6,md:3,children:[a.jsx(V,{variant:"h6",color:"text.primary",gutterBottom:!0,children:"Resources"}),a.jsx(Wn,{href:"#",color:"text.secondary",display:"block",sx:{mb:1},children:"Documentation"}),a.jsx(Wn,{href:"#",color:"text.secondary",display:"block",sx:{mb:1},children:"Support"}),a.jsx(Wn,{href:"#",color:"text.secondary",display:"block",children:"Blog"})]}),a.jsxs(X,{item:!0,xs:12,sm:6,md:3,children:[a.jsx(V,{variant:"h6",color:"text.primary",gutterBottom:!0,children:"Company"}),a.jsx(Wn,{href:"#",color:"text.secondary",display:"block",sx:{mb:1},children:"About Us"}),a.jsx(Wn,{href:"#",color:"text.secondary",display:"block",sx:{mb:1},children:"Contact"}),a.jsx(Wn,{href:"#",color:"text.secondary",display:"block",children:"Privacy Policy"})]})]})})})]})},o4=()=>{const{login:e}=$n(),[r,t]=b.useState(""),[n,s]=b.useState(""),[i,o]=b.useState(!1),[l,c]=b.useState(null),[d,u]=b.useState(null),[f,h]=b.useState(!1),[x,m]=b.useState(!1),[g,p]=b.useState(null);b.useEffect(()=>{try{console.log("üîç Login component mounted"),console.log("‚öôÔ∏è API URL from environment config:",{}.VITE_API_URL||"https://api.schoolms.com");const C=new URLSearchParams(window.location.search).get("reason");C&&(console.log("Login reason parameter found:",C),C==="expired"?c("Your session has expired. Please log in again."):C==="invalid"?c("Authentication error. Please log in again with valid credentials."):C==="permission"?c("You do not have permission to access that resource. Please log in with an account that has the required permissions."):C==="timeout"&&c("You have been logged out due to inactivity."))}catch(E){console.error("Error in debug collection:",E)}},[]);const y=async E=>{E.preventDefault(),c(null),u(null),p(null);try{if(o(!0),console.log(`üîê Attempting login with username: ${r}`),f){console.log("üß™ Debug mode: Making direct API call instead of using auth context");try{const C=await Gi.login({username:r,password:n});console.log("‚úÖ Direct login API call successful:",C),p("Direct API call successful! Proceeding with normal login flow...")}catch(C){throw console.error("‚ùå Direct login API call failed:",C),u(C),p(`Direct API call failed: ${(C==null?void 0:C.message)||JSON.stringify(C)}`),C}}await e(r,n),console.log("‚úÖ Login successful through auth context")}catch(C){console.error("‚ùå Login error:",C),c(C.message||"Login failed. Please try again."),u(C)}finally{o(!1)}},S=async()=>{try{o(!0),p(null);const E={}.VITE_API_URL||"https://api.schoolms.com";console.log(`üß™ Testing server connection to ${E}/health`);const C=await fetch(`${E}/health`,{method:"GET"});if(C.ok){const A=`Server connection successful: ${await C.text()}`;p(A),console.log("‚úÖ",A)}else{const A=`Server returned status: ${C.status} ${C.statusText}`;p(A),console.warn("‚ö†Ô∏è",A)}}catch(E){const C=`Server connection failed: ${E.message}`;p(C),console.error("‚ùå",C)}finally{o(!1)}},v=async()=>{if(!r||!n){p("Please enter username and password before testing");return}o(!0),c(null),u(null),p("Testing login with /api/auth/login endpoint...");try{const E={}.VITE_API_URL||"https://api.schoolms.com";console.log(`üß™ Testing login with ${E}/api/auth/login`);const C=await Gi.login({username:r,password:n});C&&C.data&&(p("Login successful! Received token and user details."),console.log("‚úÖ Test login successful:",C.data))}catch(E){const C=`Login test failed: ${E.message||JSON.stringify(E)}`;p(C),console.error("‚ùå",C),u(E)}finally{o(!1)}};return a.jsx(ee,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",bgcolor:"background.default",py:4},children:a.jsx(jt,{sx:{width:"100%",maxWidth:450,boxShadow:3},children:a.jsxs(Ut,{sx:{p:4},children:[a.jsx(V,{variant:"h4",component:"h1",gutterBottom:!0,textAlign:"center",children:"Login"}),l&&a.jsx(pt,{severity:"error",sx:{mb:2},children:l}),g&&a.jsx(pt,{severity:"info",sx:{mb:2,whiteSpace:"pre-line"},children:g}),a.jsxs(ee,{component:"form",onSubmit:y,noValidate:!0,sx:{mt:1},children:[a.jsx(Se,{margin:"normal",required:!0,fullWidth:!0,id:"username",label:"Username",name:"username",autoComplete:"username",autoFocus:!0,value:r,onChange:E=>t(E.target.value),disabled:i}),a.jsx(Se,{margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Password",type:"password",id:"password",autoComplete:"current-password",value:n,onChange:E=>s(E.target.value),disabled:i}),a.jsx(ye,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2},disabled:i||!r||!n,children:i?a.jsx(vr,{size:24}):"Sign In"}),a.jsx(ee,{sx:{mt:2},children:a.jsx(Wi,{control:a.jsx(xu,{checked:x,onChange:()=>m(!x)}),label:"Show debugging tools"})}),a.jsx(nf,{in:x,children:a.jsxs(Ke,{variant:"outlined",sx:{p:2,mt:2},children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"Debugging Tools"}),a.jsx(Wi,{control:a.jsx(xu,{checked:f,onChange:()=>h(!f),disabled:i}),label:"Debug mode (direct API calls)"}),a.jsx(Qt,{sx:{my:2}}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:6,children:a.jsx(ye,{fullWidth:!0,variant:"outlined",disabled:i,onClick:S,children:"Test Server Connection"})}),a.jsx(X,{item:!0,xs:6,children:a.jsx(ye,{fullWidth:!0,variant:"outlined",disabled:i||!r||!n,onClick:v,children:"Test Login"})})]}),d&&a.jsxs(ee,{sx:{mt:2,overflow:"auto"},children:[a.jsx(V,{variant:"subtitle2",color:"error",children:"Detailed Error:"}),a.jsx(Ke,{variant:"outlined",sx:{p:1,bgcolor:"grey.100"},children:a.jsx("pre",{style:{margin:0,whiteSpace:"pre-wrap",fontSize:12},children:JSON.stringify(d,null,2)})})]})]})}),a.jsx(ee,{sx:{mt:3,textAlign:"center"},children:a.jsx(Wn,{component:na,to:"/register",variant:"body2",children:"Don't have an account? Sign Up"})})]})]})})})};var Oh={},l4=Lt;Object.defineProperty(Oh,"__esModule",{value:!0});var Vu=Oh.default=void 0,c4=l4($t()),d4=a;Vu=Oh.default=(0,c4.default)((0,d4.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save");function xp(e){const{children:r,value:t,index:n,...s}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`simple-tabpanel-${n}`,"aria-labelledby":`simple-tab-${n}`,...s,children:t===n&&a.jsx(ee,{sx:{p:3},children:r})})}const u4=()=>{var we,Ee;const[i,o]=b.useState(!1),[l,c]=b.useState(null),[d,u]=b.useState(null),[f,h]=b.useState(0),[x,m]=b.useState([]),[g,p]=b.useState(0),[y,S]=b.useState([]),[v,E]=b.useState(0),[C,A]=b.useState([]),[j,w]=b.useState(-1),[k,_]=b.useState([]),[I,D]=b.useState(0),[B,R]=b.useState([]),[Y,P]=b.useState(0),[M,K]=b.useState(null),[L,ae]=b.useState([]),[Z,T]=b.useState([]),[N,H]=b.useState(!1),[G,q]=b.useState(!1);b.useState(!1),b.useState(null),b.useState("");const[oe,de]=b.useState(!1);b.useEffect(()=>{(async()=>{try{o(!0);const Ce=await ge.get("/api/exams");m(Ce)}catch(Ce){c(Ce.message||"Failed to load exams")}finally{o(!1)}})()},[]),b.useEffect(()=>{g?(async()=>{try{o(!0);const Ce=await ge.get("/api/exam-configs/classes");S(Ce)}catch(Ce){c(Ce.message||"Failed to load classes")}finally{o(!1)}})():(S([]),E(0)),E(0),w(-1),D(0),P(0),A([]),_([]),R([])},[g]),b.useEffect(()=>{if(v){const pe=async()=>{try{o(!0);const ue=await ge.get("/api/exam-configs/subjects",{classId:v});A(ue)}catch(ue){c(ue.message||"Failed to load subjects")}finally{o(!1)}},Ce=async()=>{try{o(!0);const Me=(await ge.get(`/api/classes/${v}/sections`)||[]).map((ke,Ae)=>({id:Ae+1,name:ke}));_(Me)}catch(ue){c(ue.message||"Failed to load sections")}finally{o(!1)}};pe(),Ce()}else A([]),_([]),w(-1),D(0),P(0),R([])},[v]),b.useEffect(()=>{v&&I?(async()=>{var Ce;try{o(!0);const ue=y.find(Ve=>Ve.id===v),Me=(Ce=ue==null?void 0:ue.name)==null?void 0:Ce.match(/\d+/),ke=Me?parseInt(Me[0],10):void 0,Ae=k.find(Ve=>Ve.id===I),Ue=Ae==null?void 0:Ae.name;if(!ke||!Ue){R([]);return}const Ye=await ge.get(`/api/students/grade/${ke}/section/${encodeURIComponent(Ue)}`);R(Ye)}catch(ue){c(ue.message||"Failed to load students")}finally{o(!1)}})():(R([]),P(0))},[I,v,y,k]),b.useEffect(()=>{const pe=Y===-1&&j===-1,Ce=g>0&&v>0&&I>0;if(!pe||!Ce){ae([]),T([]);return}(async()=>{var Me;try{H(!0);const ke=y.find(ct=>ct.id===v),Ae=(Me=ke==null?void 0:ke.name)==null?void 0:Me.match(/\d+/),Ue=Ae?parseInt(Ae[0],10):void 0,Ye=k.find(ct=>ct.id===I),Ve=Ye==null?void 0:Ye.name;if(!Ue||!Ve)return;const Xe=await ge.get("/api/exams/marks/matrix",{examId:g,classId:v,grade:Ue,section:Ve});ae(Xe.subjects||[]);const _t=(Xe.students||[]).map(ct=>({...ct,cells:(ct.cells||[]).map(dt=>({...dt,theoryMarks:dt.theoryMarks??0,practicalMarks:dt.practicalMarks??0}))}));T(_t)}catch(ke){c(ke.message||"Failed to load marks matrix")}finally{H(!1)}})()},[Y,j,g,v,I,y,k]),b.useEffect(()=>{if(!(g>0&&j>0&&Y>0)){K(null);return}(async()=>{try{o(!0);const ue=await ge.get(`/api/exams/marks?examId=${g}&classId=${v}&subjectId=${j}&studentId=${Y}`);K(ue||null),de(!1)}catch(ue){K(null),c(ue.message||"Failed to load marks")}finally{o(!1)}})()},[g,j,Y]);const z=(pe,Ce)=>{h(Ce)},O=(pe,Ce)=>{if(!M||oe)return;const ue={...M},Me=ue.questionMarks.findIndex(ke=>ke.questionId===pe);if(Me>=0){const Ae=ue.questionMarks[Me].maxMarks,Ue=Math.min(Math.max(0,Ce),Ae);ue.questionMarks[Me].obtainedMarks=Ue;const Ye=ue.questionMarks.filter(Xe=>Xe.questionType==="THEORY").reduce((Xe,_t)=>Xe+_t.obtainedMarks,0),Ve=ue.questionMarks.filter(Xe=>Xe.questionType==="PRACTICAL").reduce((Xe,_t)=>Xe+_t.obtainedMarks,0);ue.totalTheoryMarks=Ye,ue.totalPracticalMarks=Ve,K(ue)}},W=(pe,Ce)=>{if(!M||oe)return;const ue={...M},Me=ue.questionMarks.findIndex(ke=>ke.questionId===pe);Me>=0&&(ue.questionMarks[Me].evaluatorComments=Ce,K(ue))},F=pe=>{if(!M)return;pe.target.checked?q(!0):K({...M,isAbsent:!1,absenceReason:""})},U=pe=>{pe&&M&&K({...M,isAbsent:!0,questionMarks:M.questionMarks.map(Ce=>({...Ce,obtainedMarks:0})),totalTheoryMarks:0,totalPracticalMarks:0}),q(!1)},te=async()=>{if(M)try{o(!0),await ge.post("/api/exams/marks",M),u("Marks saved successfully")}catch(pe){c(pe.message||"Failed to save marks")}finally{o(!1)}},he=()=>{c(null)},ie=()=>{u(null)},[be,xe]=b.useState(!1),[Fe,me]=b.useState(`studentId,questionId,obtainedMarks
`),ve=()=>xe(!1),ne=async()=>{c("Please confirm preferred bulk upload format (CSV with columns: studentId,questionId,obtainedMarks)"),xe(!1)};return a.jsxs(ee,{sx:{flexGrow:1,p:3},children:[a.jsx(V,{variant:"h4",gutterBottom:!0,children:"Exam Marks Entry"}),a.jsx(Fa,{open:!!l,autoHideDuration:6e3,onClose:he,children:a.jsx(pt,{onClose:he,severity:"error",sx:{width:"100%"},children:l})}),a.jsx(Fa,{open:!!d,autoHideDuration:6e3,onClose:ie,children:a.jsx(pt,{onClose:ie,severity:"success",sx:{width:"100%"},children:d})}),a.jsx(Ke,{sx:{p:3,mb:3},children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{id:"exam-select-label",children:"Exam"}),a.jsxs(tt,{labelId:"exam-select-label",id:"exam-select",value:g,label:"Exam",onChange:pe=>p(Number(pe.target.value)),children:[a.jsx(Te,{value:0,children:"Select Exam"}),x.map(pe=>a.jsx(Te,{value:pe.id,children:pe.name},pe.id))]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,disabled:!g,children:[a.jsx(ot,{id:"class-select-label",children:"Class"}),a.jsxs(tt,{labelId:"class-select-label",id:"class-select",value:v,label:"Class",onChange:pe=>E(Number(pe.target.value)),children:[a.jsx(Te,{value:0,children:"Select Class"}),y.map(pe=>a.jsx(Te,{value:pe.id,children:pe.name},pe.id))]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,disabled:!v,children:[a.jsx(ot,{id:"section-select-label",children:"Section"}),a.jsxs(tt,{labelId:"section-select-label",id:"section-select",value:I,label:"Section",onChange:pe=>D(Number(pe.target.value)),children:[a.jsx(Te,{value:0,children:"Select Section"}),k.map(pe=>a.jsx(Te,{value:pe.id,children:pe.name},pe.id))]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,disabled:!v,children:[a.jsx(ot,{id:"subject-select-label",children:"Subject"}),a.jsxs(tt,{labelId:"subject-select-label",id:"subject-select",value:j,label:"Subject",onChange:pe=>w(Number(pe.target.value)),children:[a.jsx(Te,{value:-1,children:"All Subjects"}),C.map(pe=>a.jsx(Te,{value:pe.id,children:pe.name},pe.id))]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsxs(rt,{fullWidth:!0,disabled:!I,children:[a.jsx(ot,{id:"student-select-label",children:"Student"}),a.jsxs(tt,{labelId:"student-select-label",id:"student-select",value:Y,label:"Student",onChange:pe=>P(Number(pe.target.value)),children:[a.jsx(Te,{value:0,children:"Select Student"}),a.jsx(Te,{value:-1,children:"All Students"}),B.map(pe=>a.jsxs(Te,{value:pe.id,children:[pe.firstName," ",pe.lastName]},pe.id))]})]})})]})}),i?a.jsx(Ar,{}):Y===-1?a.jsxs(a.Fragment,{children:[a.jsx(Ke,{sx:{p:2,mb:2},children:a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,xs:!0,children:a.jsxs(V,{variant:"h6",children:["All Students - ",Z.length||B.length," found"]})}),a.jsx(X,{item:!0,children:a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(Vu,{}),disabled:Z.length===0,onClick:async()=>{try{o(!0);const pe=Z.map(Ce=>({studentId:Ce.studentId,subjects:L.map(ue=>{const Me=Ce.cells.find(Ue=>Ue.subjectId===ue.subjectId)||{subjectId:ue.subjectId},ke=Me.theoryMarks??0,Ae=Me.practicalMarks??0;if(ke+Ae>(ue.totalMaxMarks||0))throw new Error(`Marks exceed total for ${ue.subjectName} for ${Ce.studentName}`);return{subjectId:ue.subjectId,theoryMarks:ke,practicalMarks:Ae}})}));await ge.post("/api/exams/marks/matrix",{examId:g,classId:v,rows:pe}),u("All marks saved")}catch(pe){c(pe.message||"Failed to save matrix")}finally{o(!1)}},children:"Save All"})})]})}),a.jsx(Ke,{children:N?a.jsx(Ar,{}):L.length===0?a.jsx(ee,{p:3,children:a.jsx(V,{color:"text.secondary",align:"center",children:"No subjects found with Question Paper Format for this exam and class."})}):a.jsxs(a.Fragment,{children:[(()=>{const pe=new Set(L.map(ue=>ue.subjectId)),Ce=C.filter(ue=>!pe.has(ue.id));return Ce.length>0?a.jsx(pt,{severity:"info",sx:{mb:2},children:`Hidden ${Ce.length} subject(s) without Question Paper Format for this exam and class: ${Ce.map(ue=>ue.name).join(", ")}`}):null})(),a.jsx(Jt,{sx:{overflowX:"auto"},children:a.jsxs(Vt,{size:"small",stickyHeader:!0,sx:{minWidth:240+120+L.length*2*80},children:[a.jsxs(Wt,{children:[a.jsxs(Ge,{children:[a.jsx(Q,{rowSpan:2,sx:{fontWeight:600,position:"sticky",left:0,zIndex:3,minWidth:240,width:240,backgroundColor:"background.paper"},children:"Student"}),a.jsx(Q,{rowSpan:2,sx:{fontWeight:600,position:"sticky",left:240,zIndex:3,minWidth:120,width:120,backgroundColor:"background.paper"},children:"Roll"}),L.map(pe=>a.jsxs(Q,{align:"center",colSpan:2,sx:{fontWeight:600},children:[pe.subjectName," ",pe.totalMaxMarks?`(Max ${pe.totalMaxMarks})`:""]},pe.subjectId))]}),a.jsx(Ge,{children:L.map(pe=>a.jsxs(it.Fragment,{children:[a.jsx(Q,{align:"center",children:"Th"}),a.jsx(Q,{align:"center",children:"Pr"})]},`hdr-${pe.subjectId}`))})]}),a.jsx(Ht,{children:Z.map((pe,Ce)=>a.jsxs(Ge,{hover:!0,children:[a.jsx(Q,{sx:{position:"sticky",left:0,zIndex:2,minWidth:240,width:240,backgroundColor:"background.paper"},children:pe.studentName}),a.jsx(Q,{sx:{position:"sticky",left:240,zIndex:2,minWidth:120,width:120,backgroundColor:"background.paper"},children:pe.rollNumber||""}),L.map((ue,Me)=>{const ke=pe.cells.find(Ve=>Ve.subjectId===ue.subjectId)||{subjectId:ue.subjectId},Ue=(ke.theoryMarks??0)+(ke.practicalMarks??0)>(ue.totalMaxMarks||0),Ye=Ve=>{T(Xe=>Xe.map((_t,ct)=>ct===Ce?{..._t,cells:(()=>_t.cells.find(qt=>qt.subjectId===ue.subjectId)?_t.cells.map(qt=>qt.subjectId===ue.subjectId?{...qt,...Ve}:qt):[..._t.cells,{subjectId:ue.subjectId,theoryMarks:0,practicalMarks:0,...Ve}])()}:_t))};return a.jsxs(it.Fragment,{children:[a.jsx(Q,{align:"center",sx:{minWidth:80,width:80},children:a.jsx(Se,{type:"number",inputProps:{min:0,step:.5,style:{textAlign:"center"}},value:ke.theoryMarks??0,error:Ue,onChange:Ve=>{const Xe=parseFloat(Ve.target.value);Ye({theoryMarks:isNaN(Xe)?0:Xe})},variant:"outlined",size:"small",sx:{width:72}})}),a.jsx(Q,{align:"center",sx:{minWidth:80,width:80},children:a.jsx(Se,{type:"number",inputProps:{min:0,step:.5,style:{textAlign:"center"}},value:ke.practicalMarks??0,error:Ue,onChange:Ve=>{const Xe=parseFloat(Ve.target.value);Ye({practicalMarks:isNaN(Xe)?0:Xe})},variant:"outlined",size:"small",sx:{width:72}})})]},`${pe.studentId}-${ue.subjectId}`)})]},pe.studentId))})]})})]})}),a.jsxs(At,{open:be,onClose:ve,maxWidth:"sm",fullWidth:!0,children:[a.jsx(Dt,{children:"Bulk Upload Marks"}),a.jsxs(Tt,{children:[a.jsxs(zi,{sx:{mb:2},children:["Paste CSV with columns: studentId,questionId,obtainedMarks for Exam ",g,", Class ",v,"."]}),a.jsx(Se,{label:"CSV",fullWidth:!0,multiline:!0,rows:8,value:Fe,onChange:pe=>me(pe.target.value)})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:ve,children:"Cancel"}),a.jsx(ye,{variant:"contained",onClick:ne,children:"Upload"})]})]})]}):M?a.jsxs(a.Fragment,{children:[a.jsxs(Ke,{sx:{mb:3,position:"relative"},children:[a.jsxs(aa,{value:f,onChange:z,"aria-label":"marks entry tabs",sx:{borderBottom:1,borderColor:"divider"},children:[a.jsx(kt,{label:"Theory Marks"}),((we=C.find(pe=>pe.id===j))==null?void 0:we.hasPractical)&&a.jsx(kt,{label:"Practical Marks"})]}),a.jsxs(ee,{sx:{p:3},children:[a.jsxs(X,{container:!0,spacing:2,sx:{mb:2},children:[a.jsx(X,{item:!0,children:a.jsx(Wi,{control:a.jsx(Zs,{checked:M.isAbsent,onChange:F,disabled:oe}),label:"Student Absent"})}),M.isAbsent&&a.jsx(X,{item:!0,xs:!0,children:a.jsxs(V,{variant:"body2",color:"text.secondary",children:["Reason: ",M.absenceReason||"Not specified"]})})]}),a.jsx(xp,{value:f,index:0,children:!M.isAbsent&&a.jsx(Jt,{children:a.jsxs(Vt,{sx:{minWidth:650},size:"small","aria-label":"theory marks table",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Q. No"}),a.jsx(Q,{children:"Chapter"}),a.jsx(Q,{align:"center",children:"Max Marks"}),a.jsx(Q,{align:"center",children:"Marks Obtained"}),a.jsx(Q,{children:"Comments"})]})}),a.jsxs(Ht,{children:[M.questionMarks.filter(pe=>pe.questionType==="THEORY").map(pe=>a.jsxs(Ge,{children:[a.jsx(Q,{children:pe.questionNumber}),a.jsx(Q,{children:pe.chapterName}),a.jsx(Q,{align:"center",children:pe.maxMarks}),a.jsx(Q,{align:"center",children:a.jsx(Se,{type:"number",inputProps:{min:0,max:pe.maxMarks,step:.5,style:{textAlign:"center"}},value:pe.obtainedMarks,onChange:Ce=>O(pe.questionId,parseFloat(Ce.target.value)),variant:"outlined",size:"small",sx:{width:"80px"}})}),a.jsx(Q,{children:a.jsx(Se,{value:pe.evaluatorComments,onChange:Ce=>W(pe.questionId,Ce.target.value),variant:"outlined",size:"small",fullWidth:!0})})]},pe.questionId)),a.jsxs(Ge,{sx:{"& td, & th":{fontWeight:"bold"}},children:[a.jsx(Q,{colSpan:2,children:"Total"}),a.jsx(Q,{align:"center",children:M.maxTheoryMarks}),a.jsx(Q,{align:"center",children:M.totalTheoryMarks}),a.jsxs(Q,{children:[(M.totalTheoryMarks/M.maxTheoryMarks*100).toFixed(2),"%"]})]})]})]})})}),((Ee=C.find(pe=>pe.id===j))==null?void 0:Ee.hasPractical)&&a.jsx(xp,{value:f,index:1,children:!M.isAbsent&&a.jsx(Jt,{children:a.jsxs(Vt,{sx:{minWidth:650},size:"small","aria-label":"practical marks table",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Q. No"}),a.jsx(Q,{children:"Description"}),a.jsx(Q,{align:"center",children:"Max Marks"}),a.jsx(Q,{align:"center",children:"Marks Obtained"}),a.jsx(Q,{children:"Comments"})]})}),a.jsxs(Ht,{children:[M.questionMarks.filter(pe=>pe.questionType==="PRACTICAL").map(pe=>a.jsxs(Ge,{children:[a.jsx(Q,{children:pe.questionNumber}),a.jsx(Q,{children:pe.chapterName}),a.jsx(Q,{align:"center",children:pe.maxMarks}),a.jsx(Q,{align:"center",children:a.jsx(Se,{type:"number",inputProps:{min:0,max:pe.maxMarks,step:.5,style:{textAlign:"center"}},value:pe.obtainedMarks,onChange:Ce=>O(pe.questionId,parseFloat(Ce.target.value)),variant:"outlined",size:"small",sx:{width:"80px"}})}),a.jsx(Q,{children:a.jsx(Se,{value:pe.evaluatorComments,onChange:Ce=>W(pe.questionId,Ce.target.value),variant:"outlined",size:"small",fullWidth:!0})})]},pe.questionId)),a.jsxs(Ge,{sx:{"& td, & th":{fontWeight:"bold"}},children:[a.jsx(Q,{colSpan:2,children:"Total"}),a.jsx(Q,{align:"center",children:M.maxPracticalMarks}),a.jsx(Q,{align:"center",children:M.totalPracticalMarks}),a.jsxs(Q,{children:[(M.totalPracticalMarks/M.maxPracticalMarks*100).toFixed(2),"%"]})]})]})]})})}),a.jsx(X,{container:!0,spacing:2,sx:{mt:2,justifyContent:"flex-end"},children:a.jsx(X,{item:!0,children:a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(Vu,{}),onClick:te,children:"Save Marks"})})})]})]}),a.jsxs(At,{open:G,onClose:()=>U(!1),children:[a.jsx(Dt,{children:"Student Absence"}),a.jsxs(Tt,{children:[a.jsx(zi,{sx:{mb:2},children:"Please provide a reason for the student's absence."}),a.jsx(Se,{autoFocus:!0,margin:"dense",label:"Reason",fullWidth:!0,variant:"outlined",multiline:!0,rows:3,value:M.absenceReason,onChange:pe=>{M&&K({...M,absenceReason:pe.target.value})}})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>U(!1),children:"Cancel"}),a.jsx(ye,{onClick:()=>U(!0),variant:"contained",children:"Confirm Absence"})]})]})]}):Y>0&&g>0&&j>0?a.jsx(Ke,{sx:{p:3},children:a.jsx(V,{align:"center",color:"textSecondary",sx:{py:4},children:"No marks data found. Please enter marks for this student."})}):a.jsx(Ke,{sx:{p:3},children:a.jsx(V,{align:"center",color:"textSecondary",sx:{py:4},children:"Please select a class, exam, subject and student to enter marks."})})]})},f4=[{value:"ADMIN",label:"ADMIN - Full system administrative access"},{value:"TEACHER",label:"TEACHER - Access to teaching-related functions"},{value:"STUDENT",label:"STUDENT - Access to student-specific features"},{value:"STAFF",label:"STAFF - General staff access"},{value:"PARENT",label:"PARENT - Parent/guardian access"}],h4=()=>{const e=es(),{showNotification:r}=dr(),[t,n]=b.useState({username:"",password:"",email:"",role:"",fullName:""}),[s,i]=b.useState(!1),[o,l]=b.useState(null),c=u=>f=>{n(h=>({...h,[u]:f.target.value})),o&&l(null)},d=async u=>{u.preventDefault();try{i(!0),l(null),await Gi.register(t),r({type:"success",message:"Registration successful! Please login."}),e("/login")}catch(f){console.error("Registration error:",f);let h="Registration failed. Please try again.";f.message&&typeof f.message=="string"?h=f.message:f.response&&(f.response.data&&f.response.data.message?h=f.response.data.message:f.response.data&&typeof f.response.data=="string"&&(h=f.response.data)),l(h),r({type:"error",message:h})}finally{i(!1)}};return a.jsx(ee,{sx:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",bgcolor:"background.default"},children:a.jsx(jt,{sx:{maxWidth:400,width:"100%",mx:2},children:a.jsx(Ut,{sx:{p:4},children:a.jsxs(ee,{component:"form",onSubmit:d,children:[a.jsx(V,{variant:"h4",align:"center",gutterBottom:!0,children:"Create Account"}),a.jsx(V,{variant:"h6",align:"center",color:"textSecondary",sx:{mb:4},children:"Register for a new account"}),o&&a.jsx(pt,{severity:"error",sx:{mb:2},children:o}),a.jsx(Se,{fullWidth:!0,label:"Full Name",value:t.fullName,onChange:c("fullName"),margin:"normal",required:!0,disabled:s}),a.jsx(Se,{fullWidth:!0,label:"Username",value:t.username,onChange:c("username"),margin:"normal",required:!0,disabled:s,error:!!o&&o.toLowerCase().includes("username"),helperText:o&&o.toLowerCase().includes("username")?o:""}),a.jsx(Se,{fullWidth:!0,type:"email",label:"Email",value:t.email,onChange:c("email"),margin:"normal",required:!0,disabled:s,error:!!o&&o.toLowerCase().includes("email"),helperText:o&&o.toLowerCase().includes("email")?o:""}),a.jsx(Se,{fullWidth:!0,select:!0,label:"Role",value:t.role,onChange:c("role"),margin:"normal",required:!0,disabled:s,children:f4.map(u=>a.jsx(Te,{value:u.value,children:u.label},u.value))}),a.jsx(Se,{fullWidth:!0,type:"password",label:"Password",value:t.password,onChange:c("password"),margin:"normal",required:!0,disabled:s,error:!!o&&o.toLowerCase().includes("password"),helperText:o&&o.toLowerCase().includes("password")?o:""}),a.jsx(ye,{fullWidth:!0,variant:"contained",color:"primary",size:"large",type:"submit",disabled:s,sx:{mt:3},children:s?a.jsx(vr,{size:24}):"Register"}),a.jsx(ee,{sx:{mt:2,textAlign:"center"},children:a.jsxs(V,{variant:"body2",color:"textSecondary",children:["Already have an account?"," ",a.jsx(Wn,{component:na,to:"/login",children:"Sign in"})]})})]})})})})};var Lh={},m4=Lt;Object.defineProperty(Lh,"__esModule",{value:!0});var G1=Lh.default=void 0,p4=m4($t()),x4=a;G1=Lh.default=(0,p4.default)((0,x4.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info");const yd={email:/^[^\s@]+@[^\s@]+\.[^\s@]+$/,studentEmail:/^[^\s@]+@(edu\.com|school\.org)$/,phone:/^\+?[\d\s-]{10,}$/,name:/^[a-zA-Z\s-']{2,}$/,studentId:/^[A-Za-z0-9]{4,}$/,password:/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,indianMobile:/^\+91\d{10}$/},g4=e=>yd.email.test(e),y4=e=>yd.name.test(e),v4=e=>yd.studentId.test(e),b4=(e,r)=>{console.log("Validating student:",e);const t={},n=(r==null?void 0:r.isEdit)||!1;return(!e.name||!y4(e.name))&&(t.name="Please enter a valid name (minimum 2 characters, letters only)"),e.grade||(t.grade="Grade is required"),e.email?g4(e.email)||(t.email="Please enter a valid email address"):t.email="Email address is required",n||(e.studentId?v4(e.studentId)||(t.studentId="Please enter a valid student ID (at least 4 alphanumeric characters)"):t.studentId="Student ID is required"),e.parentPhone?yd.indianMobile.test(e.parentPhone)||(t.parentPhone="Parent phone must start with +91 followed by 10 digits"):t.parentPhone="Parent phone is required",e.dateOfBirth||(t.dateOfBirth="Date of birth is required"),(!e.address||e.address.trim()==="")&&(t.address="Address is required"),(!e.parentName||e.parentName.trim()==="")&&(t.parentName="Parent/guardian name is required"),e.gender||(t.gender="Gender is required"),console.log("Validation errors:",t),t},S4=["1","2","3","4","5","6","7","8","9","10","11","12"],w4=["A","B","C","D"],j4=["A+","A-","B+","B-","AB+","AB-","O+","O-"],E4=["School Bus","Self"],gp=()=>{const e=new Date;return e.setFullYear(e.getFullYear()-10),e.toISOString().split("T")[0]},k4=({open:e,onClose:r,onSubmit:t,initialData:n,loading:s})=>{var B,R,Y,P;const[i,o]=b.useState(n||{name:"",studentId:"",grade:"",section:"",dateOfBirth:gp(),gender:"",bloodGroup:"",address:"",email:"",parentName:"",phoneNumber:"",parentPhone:"+91",emergencyContact:"",admissionDate:new Date().toISOString().split("T")[0],status:"ACTIVE",guardianOccupation:"",guardianOfficeAddress:"",aadharNumber:"",udiseNumber:"",houseAlloted:"",guardianAnnualIncome:"",previousSchool:"",tcNumber:"",tcReason:"",tcDate:"",whatsappNumber:"",subjects:"",transportMode:"",busRouteNumber:"",medicalConditions:"",feeStructureId:void 0}),[l,c]=b.useState({}),[d,u]=b.useState("panel1"),[f,h]=b.useState(null),[x,m]=b.useState(!1),[g,p]=b.useState(!1),[y,S]=b.useState([]),[v,E]=b.useState(!1),{showNotification:C}=dr();b.useEffect(()=>{if(!f)return;let M=0;if(i.transportMode==="School Bus"&&i.busRouteNumber){const L=parseInt(String(i.busRouteNumber)),ae=y.find(Z=>Z.id===L);M=Number((ae==null?void 0:ae.feeAmount)||0)}const K=f.annualFees+f.buildingFees+f.labFees+M;(f.transportFee!==M||f.totalFees!==K)&&(h(L=>L&&{...L,transportFee:M,totalFees:K}),p(!0))},[i.transportMode,i.busRouteNumber,y,f]);const A=M=>(K,L)=>{u(L?M:!1)},j=async M=>{if(M)try{m(!0);const K=parseInt(M,10),L=await Bt.getFeeStructureByGrade(K);h(L),L&&L.id!==void 0&&o(ae=>({...ae,feeStructureId:L.id})),p(!0)}catch(K){console.error("Error fetching fee structure:",K),h(null)}finally{m(!1)}},w=async()=>{try{E(!0);const M=await Bt.getAllTransportRoutes();S(M||[])}catch(M){console.error("Error fetching transport routes:",M),S([])}finally{E(!1)}},k=M=>{const K=M.target.value;o(L=>({...L,grade:K})),l.grade&&c(L=>({...L,grade:""})),j(K)},_=M=>{const K=M.target.value;if(o(L=>({...L,transportMode:K,busRouteNumber:K==="School Bus"?L.busRouteNumber:""})),K!=="School Bus"&&(f!=null&&f.transportFee)){const L={...f,transportFee:0,totalFees:f.annualFees+f.buildingFees+f.labFees};h(L)}K==="School Bus"&&w()};b.useEffect(()=>{e&&(n?(o(M=>({...M,...n,grade:n.grade?String(n.grade):M.grade,gender:n.gender?String(n.gender).toUpperCase():M.gender})),n.grade&&j(String(n.grade)),n.transportMode==="School Bus"&&n.busRouteNumber&&w().then(()=>{setTimeout(()=>{const M=n.busRouteNumber,K=M!=null?y.find(L=>L.id===parseInt(M.toString())):void 0;if(K&&f){const L={...f,transportFee:K.feeAmount,totalFees:f.annualFees+f.buildingFees+f.labFees+K.feeAmount};h(L)}},500)})):o(M=>({...M,dateOfBirth:gp()})),w())},[e,n]);const I=M=>K=>{let L=K.target.value;M==="parentPhone"&&!L.startsWith("+91")&&(L="+91"+L.replace(/^\+91/g,"")),o(ae=>({...ae,[M]:L})),l[M]&&c(ae=>({...ae,[M]:""}))},D=()=>{const M={...i,phoneNumber:i.parentPhone||""};if(new Date(M.dateOfBirth||"")>=new Date){c(T=>({...T,dateOfBirth:"Date of birth must be in the past"}));return}const ae=!!(n!=null&&n.id),Z=b4(M,{isEdit:ae});if(Object.keys(Z).length>0){c(Z);const N=Object.keys(Z)[0];N&&(["name","studentId","grade","section","dateOfBirth","gender","bloodGroup","houseAlloted","address","email","medicalConditions"].includes(N)?u("panel1"):["parentName","parentPhone","emergencyContact","whatsappNumber","parentEmail","guardianOccupation","guardianAnnualIncome","guardianOfficeAddress"].includes(N)?u("panel2"):["aadharNumber","udiseNumber","previousSchool","subjects","admissionDate"].includes(N)?u("panel3"):["tcNumber","tcDate","tcReason"].includes(N)&&u("panel4"),C({type:"warning",message:Z[N]||"Please correct the highlighted fields."}));return}t(M)};return a.jsx(Of,{open:e,onClose:r,title:n?"Edit Student":"Add New Student",submitLabel:n?"Update":"Submit",onSubmit:D,maxWidth:"md",loading:s,disableSubmitButton:!1,children:a.jsxs(ee,{sx:{width:"100%"},children:[a.jsxs(ds,{expanded:d==="panel1",onChange:A("panel1"),children:[a.jsx(us,{expandIcon:a.jsx(Wa,{}),children:a.jsx(V,{variant:"subtitle1",children:"Basic Information"})}),a.jsx(fs,{children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Name",value:i.name,onChange:I("name"),error:!!l.name,helperText:l.name,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Student ID",value:i.studentId,onChange:I("studentId"),error:!!l.studentId,helperText:l.studentId||"Student ID cannot be changed after creation",required:!0,disabled:!!(n!=null&&n.id),InputProps:{endAdornment:!(n!=null&&n.id)&&a.jsx(Nn,{position:"end",children:a.jsx(xt,{title:"Enter a unique Student ID. This cannot be changed later.",children:a.jsx(st,{size:"small",children:a.jsx(G1,{fontSize:"small"})})})})}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,error:!!l.grade,children:[a.jsx(ot,{children:"Grade"}),a.jsx(tt,{value:i.grade,onChange:k,label:"Grade",required:!0,children:S4.map(M=>a.jsxs(Te,{value:M,children:["Grade ",M]},M))}),l.grade&&a.jsx(Ma,{children:l.grade})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Section"}),a.jsx(tt,{value:i.section,onChange:I("section"),label:"Section",children:w4.map(M=>a.jsxs(Te,{value:M,children:["Section ",M]},M))})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Date of Birth",type:"date",value:i.dateOfBirth,onChange:I("dateOfBirth"),error:!!l.dateOfBirth,helperText:l.dateOfBirth,InputLabelProps:{shrink:!0},required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,error:!!l.gender,children:[a.jsx(ot,{children:"Gender"}),a.jsxs(tt,{value:i.gender,onChange:I("gender"),label:"Gender",required:!0,children:[a.jsx(Te,{value:"MALE",children:"Male"}),a.jsx(Te,{value:"FEMALE",children:"Female"}),a.jsx(Te,{value:"OTHER",children:"Other"})]}),l.gender&&a.jsx(Ma,{children:l.gender})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Blood Group"}),a.jsxs(tt,{value:i.bloodGroup,onChange:I("bloodGroup"),label:"Blood Group",children:[a.jsx(Te,{value:"",children:"Not Specified"}),j4.map(M=>a.jsx(Te,{value:M,children:M},M))]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"House Alloted",value:i.houseAlloted,onChange:I("houseAlloted")})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,label:"Address",multiline:!0,rows:2,value:i.address,onChange:I("address"),error:!!l.address,helperText:l.address,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Medical Conditions",value:i.medicalConditions,onChange:I("medicalConditions"),multiline:!0,rows:2})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Email",type:"email",value:i.email,onChange:I("email"),error:!!l.email,helperText:l.email,required:!0})})]})})]}),a.jsxs(ds,{expanded:d==="panel2",onChange:A("panel2"),children:[a.jsx(us,{expandIcon:a.jsx(Wa,{}),children:a.jsx(V,{variant:"subtitle1",children:"Parent/Guardian Information"})}),a.jsx(fs,{children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Parent/Guardian Name",value:i.parentName,onChange:I("parentName"),error:!!l.parentName,helperText:l.parentName,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Parent Phone",value:i.parentPhone,onChange:I("parentPhone"),error:!!l.parentPhone,helperText:l.parentPhone||"Must start with +91 followed by 10 digits",required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Emergency Contact Number",value:i.emergencyContact,onChange:I("emergencyContact"),error:!!l.emergencyContact,helperText:l.emergencyContact})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"WhatsApp Number",value:i.whatsappNumber,onChange:I("whatsappNumber")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Parent/Guardian Email",type:"email",value:i.parentEmail,onChange:I("parentEmail")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Guardian Occupation",value:i.guardianOccupation,onChange:I("guardianOccupation")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Guardian Annual Income",value:i.guardianAnnualIncome,onChange:I("guardianAnnualIncome"),type:"number"})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Guardian Office Address",value:i.guardianOfficeAddress,onChange:I("guardianOfficeAddress"),multiline:!0,rows:2})})]})})]}),a.jsxs(ds,{expanded:d==="panel3",onChange:A("panel3"),children:[a.jsx(us,{expandIcon:a.jsx(Wa,{}),children:a.jsx(V,{variant:"subtitle1",children:"Identification & Records"})}),a.jsx(fs,{children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Aadhar Number",value:i.aadharNumber,onChange:I("aadharNumber")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"UDISE Number",value:i.udiseNumber,onChange:I("udiseNumber")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Previous School",value:i.previousSchool,onChange:I("previousSchool")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Subjects",value:i.subjects,onChange:I("subjects"),multiline:!0,rows:2,placeholder:"Comma separated list of subjects"})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Admission Date",type:"date",value:i.admissionDate,onChange:I("admissionDate"),InputLabelProps:{shrink:!0}})})]})})]}),a.jsxs(ds,{expanded:d==="panel4",onChange:A("panel4"),children:[a.jsx(us,{expandIcon:a.jsx(Wa,{}),children:a.jsx(V,{variant:"subtitle1",children:"Transfer Certificate Details"})}),a.jsx(fs,{children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"TC Number",value:i.tcNumber,onChange:I("tcNumber")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"TC Date",type:"date",value:i.tcDate,onChange:I("tcDate"),InputLabelProps:{shrink:!0}})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,label:"TC Reason",value:i.tcReason,onChange:I("tcReason"),multiline:!0,rows:2})})]})})]}),"        ",a.jsxs(ds,{expanded:g||d==="panel5",onChange:A("panel5"),children:[a.jsxs(us,{expandIcon:a.jsx(Wa,{}),children:[a.jsx(V,{variant:"subtitle1",children:"Fee Details"}),x&&a.jsx(vr,{size:20,sx:{ml:2}})]}),a.jsx(fs,{children:x?a.jsx(ee,{display:"flex",justifyContent:"center",p:2,children:a.jsx(vr,{})}):f?a.jsxs(ee,{children:[a.jsxs(V,{variant:"subtitle2",gutterBottom:!0,children:["Fee Structure for Grade ",f.classGrade]}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(Ke,{variant:"outlined",sx:{p:2},children:[a.jsx(V,{variant:"body2",color:"text.secondary",children:"Annual Fees:"}),a.jsxs(V,{variant:"body1",children:["‚Çπ",(B=f.annualFees)==null?void 0:B.toFixed(2)]}),a.jsx(V,{variant:"body2",color:"text.secondary",mt:1,children:"Building Fees:"}),a.jsxs(V,{variant:"body1",children:["‚Çπ",(R=f.buildingFees)==null?void 0:R.toFixed(2)]}),a.jsx(V,{variant:"body2",color:"text.secondary",mt:1,children:"Lab Fees:"}),a.jsxs(V,{variant:"body1",children:["‚Çπ",(Y=f.labFees)==null?void 0:Y.toFixed(2)]}),a.jsx(V,{variant:"body2",color:"text.secondary",mt:1,children:"Transport Fees:"}),a.jsx(V,{variant:"body1",children:f.transportFee?`‚Çπ${f.transportFee.toFixed(2)}`:"‚Çπ0.00"}),a.jsx(Qt,{sx:{my:1}}),a.jsx(V,{variant:"body2",color:"text.secondary",fontWeight:"bold",children:"Total Fees:"}),a.jsxs(V,{variant:"body1",fontWeight:"bold",children:["‚Çπ",(P=f.totalFees||f.annualFees+f.buildingFees+f.labFees+(f.transportFee||0))==null?void 0:P.toFixed(2)]})]})}),f.paymentSchedules&&f.paymentSchedules.length>0&&a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(Ke,{variant:"outlined",sx:{p:2},children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"Payment Schedules"}),a.jsx(X,{container:!0,spacing:1,children:f.paymentSchedules.filter(M=>M.isEnabled).map((M,K)=>{var L;return a.jsx(X,{item:!0,xs:12,children:a.jsxs(ee,{sx:{p:1,bgcolor:i.paymentScheduleId===M.id?"primary.light":"background.paper",border:"1px solid",borderColor:i.paymentScheduleId===M.id?"primary.main":"divider",borderRadius:1,cursor:"pointer"},onClick:()=>{o(ae=>({...ae,paymentScheduleId:M.id}))},children:[a.jsxs(V,{variant:"body2",fontWeight:"medium",children:[M.scheduleType," Payment"]}),a.jsxs(V,{variant:"body2",color:"text.secondary",children:["‚Çπ",(L=M.amount)==null?void 0:L.toFixed(2)," per payment"]})]})},K)})})]})})]})]}):a.jsx(V,{color:"text.secondary",children:"Select a grade to view the fee structure details"})}),"        "]}),a.jsxs(ds,{expanded:d==="panel6",onChange:A("panel6"),children:[a.jsx(us,{expandIcon:a.jsx(Wa,{}),children:a.jsx(V,{variant:"subtitle1",children:"Transportation"})}),a.jsx(fs,{children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Transport Mode"}),a.jsxs(tt,{value:i.transportMode,onChange:_,label:"Transport Mode",children:[a.jsx(Te,{value:"",children:"Not Specified"}),E4.map(M=>a.jsx(Te,{value:M,children:M},M))]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Bus Route Number"}),"                  ",a.jsx(tt,{value:i.busRouteNumber||"",onChange:M=>{const K=M.target.value;if(o(L=>({...L,busRouteNumber:K})),f){const L=y.find(ae=>ae.id===parseInt(K.toString()));if(L){const ae={...f,transportFee:L.feeAmount,totalFees:f.annualFees+f.buildingFees+f.labFees+L.feeAmount};h(ae),p(!0)}}},label:"Bus Route Number",disabled:i.transportMode!=="School Bus",children:y.map(M=>a.jsxs(Te,{value:M.id,children:[M.routeName," - ",M.routeDescription]},M.id))})]})})]})})]})]})})};var $h={},A4=Lt;Object.defineProperty($h,"__esModule",{value:!0});var ai=$h.default=void 0,T4=A4($t()),C4=a;ai=$h.default=(0,T4.default)((0,C4.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var Bh={},D4=Lt;Object.defineProperty(Bh,"__esModule",{value:!0});var Uh=Bh.default=void 0,_4=D4($t()),I4=a;Uh=Bh.default=(0,_4.default)((0,I4.jsx)("path",{d:"M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"}),"FileUpload");/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var q1=1252,F4=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],Vh={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},Wh=function(e){F4.indexOf(e)!=-1&&(q1=Vh[0]=e)};function M4(){Wh(1252)}var pa=function(e){Wh(e)};function X1(){pa(1200),M4()}function yp(e){for(var r=[],t=0,n=e.length;t<n;++t)r[t]=e.charCodeAt(t);return r}function P4(e){for(var r=[],t=0;t<e.length>>1;++t)r[t]=String.fromCharCode(e.charCodeAt(2*t)+(e.charCodeAt(2*t+1)<<8));return r.join("")}function K1(e){for(var r=[],t=0;t<e.length>>1;++t)r[t]=String.fromCharCode(e.charCodeAt(2*t+1)+(e.charCodeAt(2*t)<<8));return r.join("")}var To=function(e){var r=e.charCodeAt(0),t=e.charCodeAt(1);return r==255&&t==254?P4(e.slice(2)):r==254&&t==255?K1(e.slice(2)):r==65279?e.slice(1):e},Hl=function(r){return String.fromCharCode(r)},vp=function(r){return String.fromCharCode(r)},hs,ys="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function bp(e){for(var r="",t=0,n=0,s=0,i=0,o=0,l=0,c=0,d=0;d<e.length;)t=e.charCodeAt(d++),i=t>>2,n=e.charCodeAt(d++),o=(t&3)<<4|n>>4,s=e.charCodeAt(d++),l=(n&15)<<2|s>>6,c=s&63,isNaN(n)?l=c=64:isNaN(s)&&(c=64),r+=ys.charAt(i)+ys.charAt(o)+ys.charAt(l)+ys.charAt(c);return r}function Xn(e){var r="",t=0,n=0,s=0,i=0,o=0,l=0,c=0;e=e.replace(/[^\w\+\/\=]/g,"");for(var d=0;d<e.length;)i=ys.indexOf(e.charAt(d++)),o=ys.indexOf(e.charAt(d++)),t=i<<2|o>>4,r+=String.fromCharCode(t),l=ys.indexOf(e.charAt(d++)),n=(o&15)<<4|l>>2,l!==64&&(r+=String.fromCharCode(n)),c=ys.indexOf(e.charAt(d++)),s=(l&3)<<6|c,c!==64&&(r+=String.fromCharCode(s));return r}var It=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),gi=function(){if(typeof Buffer<"u"){var e=!Buffer.from;if(!e)try{Buffer.from("foo","utf8")}catch{e=!0}return e?function(r,t){return t?new Buffer(r,t):new Buffer(r)}:Buffer.from.bind(Buffer)}return function(){}}();function As(e){return It?Buffer.alloc?Buffer.alloc(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}function Sp(e){return It?Buffer.allocUnsafe?Buffer.allocUnsafe(e):new Buffer(e):typeof Uint8Array<"u"?new Uint8Array(e):new Array(e)}var ma=function(r){return It?gi(r,"binary"):r.split("").map(function(t){return t.charCodeAt(0)&255})};function yi(e){if(Array.isArray(e))return e.map(function(n){return String.fromCharCode(n)}).join("");for(var r=[],t=0;t<e.length;++t)r[t]=String.fromCharCode(e[t]);return r.join("")}function Hh(e){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(e instanceof ArrayBuffer)return Hh(new Uint8Array(e));for(var r=new Array(e.length),t=0;t<e.length;++t)r[t]=e[t];return r}var ms=It?function(e){return Buffer.concat(e.map(function(r){return Buffer.isBuffer(r)?r:gi(r)}))}:function(e){if(typeof Uint8Array<"u"){var r=0,t=0;for(r=0;r<e.length;++r)t+=e[r].length;var n=new Uint8Array(t),s=0;for(r=0,t=0;r<e.length;t+=s,++r)if(s=e[r].length,e[r]instanceof Uint8Array)n.set(e[r],t);else{if(typeof e[r]=="string")throw"wtf";n.set(new Uint8Array(e[r]),t)}return n}return[].concat.apply([],e.map(function(i){return Array.isArray(i)?i:[].slice.call(i)}))};function N4(e){for(var r=[],t=0,n=e.length+250,s=As(e.length+255),i=0;i<e.length;++i){var o=e.charCodeAt(i);if(o<128)s[t++]=o;else if(o<2048)s[t++]=192|o>>6&31,s[t++]=128|o&63;else if(o>=55296&&o<57344){o=(o&1023)+64;var l=e.charCodeAt(++i)&1023;s[t++]=240|o>>8&7,s[t++]=128|o>>2&63,s[t++]=128|l>>6&15|(o&3)<<4,s[t++]=128|l&63}else s[t++]=224|o>>12&15,s[t++]=128|o>>6&63,s[t++]=128|o&63;t>n&&(r.push(s.slice(0,t)),t=0,s=As(65535),n=65530)}return r.push(s.slice(0,t)),ms(r)}var En=/\u0000/g,Co=/[\u0001-\u0006]/g;function Li(e){for(var r="",t=e.length-1;t>=0;)r+=e.charAt(t--);return r}function xa(e,r){var t=""+e;return t.length>=r?t:yr("0",r-t.length)+t}function Yh(e,r){var t=""+e;return t.length>=r?t:yr(" ",r-t.length)+t}function Ac(e,r){var t=""+e;return t.length>=r?t:t+yr(" ",r-t.length)}function R4(e,r){var t=""+Math.round(e);return t.length>=r?t:yr("0",r-t.length)+t}function O4(e,r){var t=""+e;return t.length>=r?t:yr("0",r-t.length)+t}var wp=Math.pow(2,32);function Di(e,r){if(e>wp||e<-wp)return R4(e,r);var t=Math.round(e);return O4(t,r)}function Tc(e,r){return r=r||0,e.length>=7+r&&(e.charCodeAt(r)|32)===103&&(e.charCodeAt(r+1)|32)===101&&(e.charCodeAt(r+2)|32)===110&&(e.charCodeAt(r+3)|32)===101&&(e.charCodeAt(r+4)|32)===114&&(e.charCodeAt(r+5)|32)===97&&(e.charCodeAt(r+6)|32)===108}var jp=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Zd=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function L4(e){return e||(e={}),e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"‰∏äÂçà/‰∏ãÂçà "hh"ÊôÇ"mm"ÂàÜ"ss"Áßí "',e}var bt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"‰∏äÂçà/‰∏ãÂçà "hh"ÊôÇ"mm"ÂàÜ"ss"Áßí "'},Ep={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},$4={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Cc(e,r,t){for(var n=e<0?-1:1,s=e*n,i=0,o=1,l=0,c=1,d=0,u=0,f=Math.floor(s);d<r&&(f=Math.floor(s),l=f*o+i,u=f*d+c,!(s-f<5e-8));)s=1/(s-f),i=o,o=l,c=d,d=u;if(u>r&&(d>r?(u=c,l=i):(u=d,l=o)),!t)return[0,n*l,u];var h=Math.floor(n*l/u);return[h,n*l-h*u,u]}function qs(e,r,t){if(e>2958465||e<0)return null;var n=e|0,s=Math.floor(86400*(e-n)),i=0,o=[],l={D:n,T:s,u:86400*(e-n)-s,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),r&&r.date1904&&(n+=1462),l.u>.9999&&(l.u=0,++s==86400&&(l.T=s=0,++n,++l.D)),n===60)o=t?[1317,10,29]:[1900,2,29],i=3;else if(n===0)o=t?[1317,8,29]:[1900,1,0],i=6;else{n>60&&--n;var c=new Date(1900,0,1);c.setDate(c.getDate()+n-1),o=[c.getFullYear(),c.getMonth()+1,c.getDate()],i=c.getDay(),n<60&&(i=(i+6)%7),t&&(i=Y4(c,o))}return l.y=o[0],l.m=o[1],l.d=o[2],l.S=s%60,s=Math.floor(s/60),l.M=s%60,s=Math.floor(s/60),l.H=s,l.q=i,l}var J1=new Date(1899,11,31,0,0,0),B4=J1.getTime(),U4=new Date(1900,2,1,0,0,0);function Q1(e,r){var t=e.getTime();return r?t-=1461*24*60*60*1e3:e>=U4&&(t+=24*60*60*1e3),(t-(B4+(e.getTimezoneOffset()-J1.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function zh(e){return e.indexOf(".")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function V4(e){return e.indexOf("E")==-1?e:e.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function W4(e){var r=e<0?12:11,t=zh(e.toFixed(12));return t.length<=r||(t=e.toPrecision(10),t.length<=r)?t:e.toExponential(5)}function H4(e){var r=zh(e.toFixed(11));return r.length>(e<0?12:11)||r==="0"||r==="-0"?e.toPrecision(6):r}function nl(e){var r=Math.floor(Math.log(Math.abs(e))*Math.LOG10E),t;return r>=-4&&r<=-1?t=e.toPrecision(10+r):Math.abs(r)<=9?t=W4(e):r===10?t=e.toFixed(10).substr(0,12):t=H4(e),zh(V4(t.toUpperCase()))}function si(e,r){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(e|0)===e?e.toString(10):nl(e);case"undefined":return"";case"object":if(e==null)return"";if(e instanceof Date)return sa(14,Q1(e,r&&r.date1904),r)}throw new Error("unsupported value in General format: "+e)}function Y4(e,r){r[0]-=581;var t=e.getDay();return e<60&&(t=(t+6)%7),t}function z4(e,r,t,n){var s="",i=0,o=0,l=t.y,c,d=0;switch(e){case 98:l=t.y+543;case 121:switch(r.length){case 1:case 2:c=l%100,d=2;break;default:c=l%1e4,d=4;break}break;case 109:switch(r.length){case 1:case 2:c=t.m,d=r.length;break;case 3:return Zd[t.m-1][1];case 5:return Zd[t.m-1][0];default:return Zd[t.m-1][2]}break;case 100:switch(r.length){case 1:case 2:c=t.d,d=r.length;break;case 3:return jp[t.q][0];default:return jp[t.q][1]}break;case 104:switch(r.length){case 1:case 2:c=1+(t.H+11)%12,d=r.length;break;default:throw"bad hour format: "+r}break;case 72:switch(r.length){case 1:case 2:c=t.H,d=r.length;break;default:throw"bad hour format: "+r}break;case 77:switch(r.length){case 1:case 2:c=t.M,d=r.length;break;default:throw"bad minute format: "+r}break;case 115:if(r!="s"&&r!="ss"&&r!=".0"&&r!=".00"&&r!=".000")throw"bad second format: "+r;return t.u===0&&(r=="s"||r=="ss")?xa(t.S,r.length):(n>=2?o=n===3?1e3:100:o=n===1?10:1,i=Math.round(o*(t.S+t.u)),i>=60*o&&(i=0),r==="s"?i===0?"0":""+i/o:(s=xa(i,2+n),r==="ss"?s.substr(0,2):"."+s.substr(2,r.length-1)));case 90:switch(r){case"[h]":case"[hh]":c=t.D*24+t.H;break;case"[m]":case"[mm]":c=(t.D*24+t.H)*60+t.M;break;case"[s]":case"[ss]":c=((t.D*24+t.H)*60+t.M)*60+Math.round(t.S+t.u);break;default:throw"bad abstime format: "+r}d=r.length===3?1:2;break;case 101:c=l,d=1;break}var u=d>0?xa(c,d):"";return u}function vs(e){var r=3;if(e.length<=r)return e;for(var t=e.length%r,n=e.substr(0,t);t!=e.length;t+=r)n+=(n.length>0?",":"")+e.substr(t,r);return n}var Z1=/%/g;function G4(e,r,t){var n=r.replace(Z1,""),s=r.length-n.length;return Ga(e,n,t*Math.pow(10,2*s))+yr("%",s)}function q4(e,r,t){for(var n=r.length-1;r.charCodeAt(n-1)===44;)--n;return Ga(e,r.substr(0,n),t/Math.pow(10,3*(r.length-n)))}function ev(e,r){var t,n=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+ev(e,-r);var s=e.indexOf(".");s===-1&&(s=e.indexOf("E"));var i=Math.floor(Math.log(r)*Math.LOG10E)%s;if(i<0&&(i+=s),t=(r/Math.pow(10,i)).toPrecision(n+1+(s+i)%s),t.indexOf("e")===-1){var o=Math.floor(Math.log(r)*Math.LOG10E);for(t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(o-t.length+i):t+="E+"+(o-i);t.substr(0,2)==="0.";)t=t.charAt(0)+t.substr(2,s)+"."+t.substr(2+s),t=t.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,u){return c+d+u.substr(0,(s+i)%s)+"."+u.substr(i)+"E"})}else t=r.toExponential(n);return e.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),e.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}var tv=/# (\?+)( ?)\/( ?)(\d+)/;function X4(e,r,t){var n=parseInt(e[4],10),s=Math.round(r*n),i=Math.floor(s/n),o=s-i*n,l=n;return t+(i===0?"":""+i)+" "+(o===0?yr(" ",e[1].length+1+e[4].length):Yh(o,e[1].length)+e[2]+"/"+e[3]+xa(l,e[4].length))}function K4(e,r,t){return t+(r===0?"":""+r)+yr(" ",e[1].length+2+e[4].length)}var rv=/^#*0*\.([0#]+)/,nv=/\).*[0#]/,av=/\(###\) ###\\?-####/;function yn(e){for(var r="",t,n=0;n!=e.length;++n)switch(t=e.charCodeAt(n)){case 35:break;case 63:r+=" ";break;case 48:r+="0";break;default:r+=String.fromCharCode(t)}return r}function kp(e,r){var t=Math.pow(10,r);return""+Math.round(e*t)/t}function Ap(e,r){var t=e-Math.floor(e),n=Math.pow(10,r);return r<(""+Math.round(t*n)).length?0:Math.round(t*n)}function J4(e,r){return r<(""+Math.round((e-Math.floor(e))*Math.pow(10,r))).length?1:0}function Q4(e){return e<2147483647&&e>-2147483648?""+(e>=0?e|0:e-1|0):""+Math.floor(e)}function ta(e,r,t){if(e.charCodeAt(0)===40&&!r.match(nv)){var n=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?ta("n",n,t):"("+ta("n",n,-t)+")"}if(r.charCodeAt(r.length-1)===44)return q4(e,r,t);if(r.indexOf("%")!==-1)return G4(e,r,t);if(r.indexOf("E")!==-1)return ev(r,t);if(r.charCodeAt(0)===36)return"$"+ta(e,r.substr(r.charAt(1)==" "?2:1),t);var s,i,o,l,c=Math.abs(t),d=t<0?"-":"";if(r.match(/^00+$/))return d+Di(c,r.length);if(r.match(/^[#?]+$/))return s=Di(t,0),s==="0"&&(s=""),s.length>r.length?s:yn(r.substr(0,r.length-s.length))+s;if(i=r.match(tv))return X4(i,c,d);if(r.match(/^#+0+$/))return d+Di(c,r.length-r.indexOf("0"));if(i=r.match(rv))return s=kp(t,i[1].length).replace(/^([^\.]+)$/,"$1."+yn(i[1])).replace(/\.$/,"."+yn(i[1])).replace(/\.(\d*)$/,function(m,g){return"."+g+yr("0",yn(i[1]).length-g.length)}),r.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),i=r.match(/^(0*)\.(#*)$/))return d+kp(c,i[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=r.match(/^#{1,3},##0(\.?)$/))return d+vs(Di(c,0));if(i=r.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+ta(e,r,-t):vs(""+(Math.floor(t)+J4(t,i[1].length)))+"."+xa(Ap(t,i[1].length),i[1].length);if(i=r.match(/^#,#*,#0/))return ta(e,r.replace(/^#,#*,/,""),t);if(i=r.match(/^([0#]+)(\\?-([0#]+))+$/))return s=Li(ta(e,r.replace(/[\\-]/g,""),t)),o=0,Li(Li(r.replace(/\\/g,"")).replace(/[0#]/g,function(m){return o<s.length?s.charAt(o++):m==="0"?"0":""}));if(r.match(av))return s=ta(e,"##########",t),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var u="";if(i=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),l=Cc(c,Math.pow(10,o)-1,!1),s=""+d,u=Ga("n",i[1],l[1]),u.charAt(u.length-1)==" "&&(u=u.substr(0,u.length-1)+"0"),s+=u+i[2]+"/"+i[3],u=Ac(l[2],o),u.length<i[4].length&&(u=yn(i[4].substr(i[4].length-u.length))+u),s+=u,s;if(i=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),l=Cc(c,Math.pow(10,o)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?Yh(l[1],o)+i[2]+"/"+i[3]+Ac(l[2],o):yr(" ",2*o+1+i[2].length+i[3].length));if(i=r.match(/^[#0?]+$/))return s=Di(t,0),r.length<=s.length?s:yn(r.substr(0,r.length-s.length))+s;if(i=r.match(/^([#0?]+)\.([#0]+)$/)){s=""+t.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=s.indexOf(".");var f=r.indexOf(".")-o,h=r.length-s.length-f;return yn(r.substr(0,f)+s+r.substr(r.length-h))}if(i=r.match(/^00,000\.([#0]*0)$/))return o=Ap(t,i[1].length),t<0?"-"+ta(e,r,-t):vs(Q4(t)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(m){return"00,"+(m.length<3?xa(0,3-m.length):"")+m})+"."+xa(o,i[1].length);switch(r){case"###,##0.00":return ta(e,"#,##0.00",t);case"###,###":case"##,###":case"#,###":var x=vs(Di(c,0));return x!=="0"?d+x:"";case"###,###.00":return ta(e,"###,##0.00",t).replace(/^0\./,".");case"#,###.00":return ta(e,"#,##0.00",t).replace(/^0\./,".")}throw new Error("unsupported format |"+r+"|")}function Z4(e,r,t){for(var n=r.length-1;r.charCodeAt(n-1)===44;)--n;return Ga(e,r.substr(0,n),t/Math.pow(10,3*(r.length-n)))}function e3(e,r,t){var n=r.replace(Z1,""),s=r.length-n.length;return Ga(e,n,t*Math.pow(10,2*s))+yr("%",s)}function sv(e,r){var t,n=e.indexOf("E")-e.indexOf(".")-1;if(e.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+sv(e,-r);var s=e.indexOf(".");s===-1&&(s=e.indexOf("E"));var i=Math.floor(Math.log(r)*Math.LOG10E)%s;if(i<0&&(i+=s),t=(r/Math.pow(10,i)).toPrecision(n+1+(s+i)%s),!t.match(/[Ee]/)){var o=Math.floor(Math.log(r)*Math.LOG10E);t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(o-t.length+i):t+="E+"+(o-i),t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,c,d,u){return c+d+u.substr(0,(s+i)%s)+"."+u.substr(i)+"E"})}else t=r.toExponential(n);return e.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),e.match(/E\-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}function Aa(e,r,t){if(e.charCodeAt(0)===40&&!r.match(nv)){var n=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?Aa("n",n,t):"("+Aa("n",n,-t)+")"}if(r.charCodeAt(r.length-1)===44)return Z4(e,r,t);if(r.indexOf("%")!==-1)return e3(e,r,t);if(r.indexOf("E")!==-1)return sv(r,t);if(r.charCodeAt(0)===36)return"$"+Aa(e,r.substr(r.charAt(1)==" "?2:1),t);var s,i,o,l,c=Math.abs(t),d=t<0?"-":"";if(r.match(/^00+$/))return d+xa(c,r.length);if(r.match(/^[#?]+$/))return s=""+t,t===0&&(s=""),s.length>r.length?s:yn(r.substr(0,r.length-s.length))+s;if(i=r.match(tv))return K4(i,c,d);if(r.match(/^#+0+$/))return d+xa(c,r.length-r.indexOf("0"));if(i=r.match(rv))return s=(""+t).replace(/^([^\.]+)$/,"$1."+yn(i[1])).replace(/\.$/,"."+yn(i[1])),s=s.replace(/\.(\d*)$/,function(m,g){return"."+g+yr("0",yn(i[1]).length-g.length)}),r.indexOf("0.")!==-1?s:s.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),i=r.match(/^(0*)\.(#*)$/))return d+(""+c).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,i[1].length?"0.":".");if(i=r.match(/^#{1,3},##0(\.?)$/))return d+vs(""+c);if(i=r.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+Aa(e,r,-t):vs(""+t)+"."+yr("0",i[1].length);if(i=r.match(/^#,#*,#0/))return Aa(e,r.replace(/^#,#*,/,""),t);if(i=r.match(/^([0#]+)(\\?-([0#]+))+$/))return s=Li(Aa(e,r.replace(/[\\-]/g,""),t)),o=0,Li(Li(r.replace(/\\/g,"")).replace(/[0#]/g,function(m){return o<s.length?s.charAt(o++):m==="0"?"0":""}));if(r.match(av))return s=Aa(e,"##########",t),"("+s.substr(0,3)+") "+s.substr(3,3)+"-"+s.substr(6);var u="";if(i=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(i[4].length,7),l=Cc(c,Math.pow(10,o)-1,!1),s=""+d,u=Ga("n",i[1],l[1]),u.charAt(u.length-1)==" "&&(u=u.substr(0,u.length-1)+"0"),s+=u+i[2]+"/"+i[3],u=Ac(l[2],o),u.length<i[4].length&&(u=yn(i[4].substr(i[4].length-u.length))+u),s+=u,s;if(i=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return o=Math.min(Math.max(i[1].length,i[4].length),7),l=Cc(c,Math.pow(10,o)-1,!0),d+(l[0]||(l[1]?"":"0"))+" "+(l[1]?Yh(l[1],o)+i[2]+"/"+i[3]+Ac(l[2],o):yr(" ",2*o+1+i[2].length+i[3].length));if(i=r.match(/^[#0?]+$/))return s=""+t,r.length<=s.length?s:yn(r.substr(0,r.length-s.length))+s;if(i=r.match(/^([#0]+)\.([#0]+)$/)){s=""+t.toFixed(Math.min(i[2].length,10)).replace(/([^0])0+$/,"$1"),o=s.indexOf(".");var f=r.indexOf(".")-o,h=r.length-s.length-f;return yn(r.substr(0,f)+s+r.substr(r.length-h))}if(i=r.match(/^00,000\.([#0]*0)$/))return t<0?"-"+Aa(e,r,-t):vs(""+t).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(m){return"00,"+(m.length<3?xa(0,3-m.length):"")+m})+"."+xa(0,i[1].length);switch(r){case"###,###":case"##,###":case"#,###":var x=vs(""+c);return x!=="0"?d+x:"";default:if(r.match(/\.[0#?]*$/))return Aa(e,r.slice(0,r.lastIndexOf(".")),t)+yn(r.slice(r.lastIndexOf(".")))}throw new Error("unsupported format |"+r+"|")}function Ga(e,r,t){return(t|0)===t?Aa(e,r,t):ta(e,r,t)}function t3(e){for(var r=[],t=!1,n=0,s=0;n<e.length;++n)switch(e.charCodeAt(n)){case 34:t=!t;break;case 95:case 42:case 92:++n;break;case 59:r[r.length]=e.substr(s,n-s),s=n+1}if(r[r.length]=e.substr(s),t===!0)throw new Error("Format |"+e+"| unterminated string ");return r}var iv=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function ao(e){for(var r=0,t="",n="";r<e.length;)switch(t=e.charAt(r)){case"G":Tc(e,r)&&(r+=6),r++;break;case'"':for(;e.charCodeAt(++r)!==34&&r<e.length;);++r;break;case"\\":r+=2;break;case"_":r+=2;break;case"@":++r;break;case"B":case"b":if(e.charAt(r+1)==="1"||e.charAt(r+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"‰∏ä":if(e.substr(r,3).toUpperCase()==="A/P"||e.substr(r,5).toUpperCase()==="AM/PM"||e.substr(r,5).toUpperCase()==="‰∏äÂçà/‰∏ãÂçà")return!0;++r;break;case"[":for(n=t;e.charAt(r++)!=="]"&&r<e.length;)n+=e.charAt(r);if(n.match(iv))return!0;break;case".":case"0":case"#":for(;r<e.length&&("0#?.,E+-%".indexOf(t=e.charAt(++r))>-1||t=="\\"&&e.charAt(r+1)=="-"&&"0#".indexOf(e.charAt(r+2))>-1););break;case"?":for(;e.charAt(++r)===t;);break;case"*":++r,(e.charAt(r)==" "||e.charAt(r)=="*")&&++r;break;case"(":case")":++r;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;r<e.length&&"0123456789".indexOf(e.charAt(++r))>-1;);break;case" ":++r;break;default:++r;break}return!1}function r3(e,r,t,n){for(var s=[],i="",o=0,l="",c="t",d,u,f,h="H";o<e.length;)switch(l=e.charAt(o)){case"G":if(!Tc(e,o))throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"G",v:"General"},o+=7;break;case'"':for(i="";(f=e.charCodeAt(++o))!==34&&o<e.length;)i+=String.fromCharCode(f);s[s.length]={t:"t",v:i},++o;break;case"\\":var x=e.charAt(++o),m=x==="("||x===")"?x:"t";s[s.length]={t:m,v:x},++o;break;case"_":s[s.length]={t:"t",v:" "},o+=2;break;case"@":s[s.length]={t:"T",v:r},++o;break;case"B":case"b":if(e.charAt(o+1)==="1"||e.charAt(o+1)==="2"){if(d==null&&(d=qs(r,t,e.charAt(o+1)==="2"),d==null))return"";s[s.length]={t:"X",v:e.substr(o,2)},c=l,o+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":l=l.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(r<0||d==null&&(d=qs(r,t),d==null))return"";for(i=l;++o<e.length&&e.charAt(o).toLowerCase()===l;)i+=l;l==="m"&&c.toLowerCase()==="h"&&(l="M"),l==="h"&&(l=h),s[s.length]={t:l,v:i},c=l;break;case"A":case"a":case"‰∏ä":var g={t:l,v:l};if(d==null&&(d=qs(r,t)),e.substr(o,3).toUpperCase()==="A/P"?(d!=null&&(g.v=d.H>=12?"P":"A"),g.t="T",h="h",o+=3):e.substr(o,5).toUpperCase()==="AM/PM"?(d!=null&&(g.v=d.H>=12?"PM":"AM"),g.t="T",o+=5,h="h"):e.substr(o,5).toUpperCase()==="‰∏äÂçà/‰∏ãÂçà"?(d!=null&&(g.v=d.H>=12?"‰∏ãÂçà":"‰∏äÂçà"),g.t="T",o+=5,h="h"):(g.t="t",++o),d==null&&g.t==="T")return"";s[s.length]=g,c=l;break;case"[":for(i=l;e.charAt(o++)!=="]"&&o<e.length;)i+=e.charAt(o);if(i.slice(-1)!=="]")throw'unterminated "[" block: |'+i+"|";if(i.match(iv)){if(d==null&&(d=qs(r,t),d==null))return"";s[s.length]={t:"Z",v:i.toLowerCase()},c=i.charAt(1)}else i.indexOf("$")>-1&&(i=(i.match(/\$([^-\[\]]*)/)||[])[1]||"$",ao(e)||(s[s.length]={t:"t",v:i}));break;case".":if(d!=null){for(i=l;++o<e.length&&(l=e.charAt(o))==="0";)i+=l;s[s.length]={t:"s",v:i};break}case"0":case"#":for(i=l;++o<e.length&&"0#?.,E+-%".indexOf(l=e.charAt(o))>-1;)i+=l;s[s.length]={t:"n",v:i};break;case"?":for(i=l;e.charAt(++o)===l;)i+=l;s[s.length]={t:l,v:i},c=l;break;case"*":++o,(e.charAt(o)==" "||e.charAt(o)=="*")&&++o;break;case"(":case")":s[s.length]={t:n===1?"t":l,v:l},++o;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(i=l;o<e.length&&"0123456789".indexOf(e.charAt(++o))>-1;)i+=e.charAt(o);s[s.length]={t:"D",v:i};break;case" ":s[s.length]={t:l,v:l},++o;break;case"$":s[s.length]={t:"t",v:"$"},++o;break;default:if(",$-+/():!^&'~{}<>=‚Ç¨acfijklopqrtuvwxzP".indexOf(l)===-1)throw new Error("unrecognized character "+l+" in "+e);s[s.length]={t:"t",v:l},++o;break}var p=0,y=0,S;for(o=s.length-1,c="t";o>=0;--o)switch(s[o].t){case"h":case"H":s[o].t=h,c="h",p<1&&(p=1);break;case"s":(S=s[o].v.match(/\.0+$/))&&(y=Math.max(y,S[0].length-1)),p<3&&(p=3);case"d":case"y":case"M":case"e":c=s[o].t;break;case"m":c==="s"&&(s[o].t="M",p<2&&(p=2));break;case"X":break;case"Z":p<1&&s[o].v.match(/[Hh]/)&&(p=1),p<2&&s[o].v.match(/[Mm]/)&&(p=2),p<3&&s[o].v.match(/[Ss]/)&&(p=3)}switch(p){case 0:break;case 1:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M),d.M>=60&&(d.M=0,++d.H);break;case 2:d.u>=.5&&(d.u=0,++d.S),d.S>=60&&(d.S=0,++d.M);break}var v="",E;for(o=0;o<s.length;++o)switch(s[o].t){case"t":case"T":case" ":case"D":break;case"X":s[o].v="",s[o].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":s[o].v=z4(s[o].t.charCodeAt(0),s[o].v,d,y),s[o].t="t";break;case"n":case"?":for(E=o+1;s[E]!=null&&((l=s[E].t)==="?"||l==="D"||(l===" "||l==="t")&&s[E+1]!=null&&(s[E+1].t==="?"||s[E+1].t==="t"&&s[E+1].v==="/")||s[o].t==="("&&(l===" "||l==="n"||l===")")||l==="t"&&(s[E].v==="/"||s[E].v===" "&&s[E+1]!=null&&s[E+1].t=="?"));)s[o].v+=s[E].v,s[E]={v:"",t:";"},++E;v+=s[o].v,o=E-1;break;case"G":s[o].t="t",s[o].v=si(r,t);break}var C="",A,j;if(v.length>0){v.charCodeAt(0)==40?(A=r<0&&v.charCodeAt(0)===45?-r:r,j=Ga("n",v,A)):(A=r<0&&n>1?-r:r,j=Ga("n",v,A),A<0&&s[0]&&s[0].t=="t"&&(j=j.substr(1),s[0].v="-"+s[0].v)),E=j.length-1;var w=s.length;for(o=0;o<s.length;++o)if(s[o]!=null&&s[o].t!="t"&&s[o].v.indexOf(".")>-1){w=o;break}var k=s.length;if(w===s.length&&j.indexOf("E")===-1){for(o=s.length-1;o>=0;--o)s[o]==null||"n?".indexOf(s[o].t)===-1||(E>=s[o].v.length-1?(E-=s[o].v.length,s[o].v=j.substr(E+1,s[o].v.length)):E<0?s[o].v="":(s[o].v=j.substr(0,E+1),E=-1),s[o].t="t",k=o);E>=0&&k<s.length&&(s[k].v=j.substr(0,E+1)+s[k].v)}else if(w!==s.length&&j.indexOf("E")===-1){for(E=j.indexOf(".")-1,o=w;o>=0;--o)if(!(s[o]==null||"n?".indexOf(s[o].t)===-1)){for(u=s[o].v.indexOf(".")>-1&&o===w?s[o].v.indexOf(".")-1:s[o].v.length-1,C=s[o].v.substr(u+1);u>=0;--u)E>=0&&(s[o].v.charAt(u)==="0"||s[o].v.charAt(u)==="#")&&(C=j.charAt(E--)+C);s[o].v=C,s[o].t="t",k=o}for(E>=0&&k<s.length&&(s[k].v=j.substr(0,E+1)+s[k].v),E=j.indexOf(".")+1,o=w;o<s.length;++o)if(!(s[o]==null||"n?(".indexOf(s[o].t)===-1&&o!==w)){for(u=s[o].v.indexOf(".")>-1&&o===w?s[o].v.indexOf(".")+1:0,C=s[o].v.substr(0,u);u<s[o].v.length;++u)E<j.length&&(C+=j.charAt(E++));s[o].v=C,s[o].t="t",k=o}}}for(o=0;o<s.length;++o)s[o]!=null&&"n?".indexOf(s[o].t)>-1&&(A=n>1&&r<0&&o>0&&s[o-1].v==="-"?-r:r,s[o].v=Ga(s[o].t,s[o].v,A),s[o].t="t");var _="";for(o=0;o!==s.length;++o)s[o]!=null&&(_+=s[o].v);return _}var Tp=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Cp(e,r){if(r==null)return!1;var t=parseFloat(r[2]);switch(r[1]){case"=":if(e==t)return!0;break;case">":if(e>t)return!0;break;case"<":if(e<t)return!0;break;case"<>":if(e!=t)return!0;break;case">=":if(e>=t)return!0;break;case"<=":if(e<=t)return!0;break}return!1}function n3(e,r){var t=t3(e),n=t.length,s=t[n-1].indexOf("@");if(n<4&&s>-1&&--n,t.length>4)throw new Error("cannot find right format for |"+t.join("|")+"|");if(typeof r!="number")return[4,t.length===4||s>-1?t[t.length-1]:"@"];switch(t.length){case 1:t=s>-1?["General","General","General",t[0]]:[t[0],t[0],t[0],"@"];break;case 2:t=s>-1?[t[0],t[0],t[0],t[1]]:[t[0],t[1],t[0],"@"];break;case 3:t=s>-1?[t[0],t[1],t[0],t[2]]:[t[0],t[1],t[2],"@"];break}var i=r>0?t[0]:r<0?t[1]:t[2];if(t[0].indexOf("[")===-1&&t[1].indexOf("[")===-1)return[n,i];if(t[0].match(/\[[=<>]/)!=null||t[1].match(/\[[=<>]/)!=null){var o=t[0].match(Tp),l=t[1].match(Tp);return Cp(r,o)?[n,t[0]]:Cp(r,l)?[n,t[1]]:[n,t[o!=null&&l!=null?2:1]]}return[n,i]}function sa(e,r,t){t==null&&(t={});var n="";switch(typeof e){case"string":e=="m/d/yy"&&t.dateNF?n=t.dateNF:n=e;break;case"number":e==14&&t.dateNF?n=t.dateNF:n=(t.table!=null?t.table:bt)[e],n==null&&(n=t.table&&t.table[Ep[e]]||bt[Ep[e]]),n==null&&(n=$4[e]||"General");break}if(Tc(n,0))return si(r,t);r instanceof Date&&(r=Q1(r,t.date1904));var s=n3(n,r);if(Tc(s[1]))return si(r,t);if(r===!0)r="TRUE";else if(r===!1)r="FALSE";else if(r===""||r==null)return"";return r3(s[1],r,t,s[0])}function Js(e,r){if(typeof r!="number"){r=+r||-1;for(var t=0;t<392;++t){if(bt[t]==null){r<0&&(r=t);continue}if(bt[t]==e){r=t;break}}r<0&&(r=391)}return bt[r]=e,r}function ov(){bt=L4()}var a3={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},lv=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function s3(e){var r=typeof e=="number"?bt[e]:e;return r=r.replace(lv,"(\\d+)"),new RegExp("^"+r+"$")}function i3(e,r,t){var n=-1,s=-1,i=-1,o=-1,l=-1,c=-1;(r.match(lv)||[]).forEach(function(f,h){var x=parseInt(t[h+1],10);switch(f.toLowerCase().charAt(0)){case"y":n=x;break;case"d":i=x;break;case"h":o=x;break;case"s":c=x;break;case"m":o>=0?l=x:s=x;break}}),c>=0&&l==-1&&s>=0&&(l=s,s=-1);var d=(""+(n>=0?n:new Date().getFullYear())).slice(-4)+"-"+("00"+(s>=1?s:1)).slice(-2)+"-"+("00"+(i>=1?i:1)).slice(-2);d.length==7&&(d="0"+d),d.length==8&&(d="20"+d);var u=("00"+(o>=0?o:0)).slice(-2)+":"+("00"+(l>=0?l:0)).slice(-2)+":"+("00"+(c>=0?c:0)).slice(-2);return o==-1&&l==-1&&c==-1?d:n==-1&&s==-1&&i==-1?u:d+"T"+u}var o3=function(){var e={};e.version="1.2.0";function r(){for(var j=0,w=new Array(256),k=0;k!=256;++k)j=k,j=j&1?-306674912^j>>>1:j>>>1,j=j&1?-306674912^j>>>1:j>>>1,j=j&1?-306674912^j>>>1:j>>>1,j=j&1?-306674912^j>>>1:j>>>1,j=j&1?-306674912^j>>>1:j>>>1,j=j&1?-306674912^j>>>1:j>>>1,j=j&1?-306674912^j>>>1:j>>>1,j=j&1?-306674912^j>>>1:j>>>1,w[k]=j;return typeof Int32Array<"u"?new Int32Array(w):w}var t=r();function n(j){var w=0,k=0,_=0,I=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(_=0;_!=256;++_)I[_]=j[_];for(_=0;_!=256;++_)for(k=j[_],w=256+_;w<4096;w+=256)k=I[w]=k>>>8^j[k&255];var D=[];for(_=1;_!=16;++_)D[_-1]=typeof Int32Array<"u"?I.subarray(_*256,_*256+256):I.slice(_*256,_*256+256);return D}var s=n(t),i=s[0],o=s[1],l=s[2],c=s[3],d=s[4],u=s[5],f=s[6],h=s[7],x=s[8],m=s[9],g=s[10],p=s[11],y=s[12],S=s[13],v=s[14];function E(j,w){for(var k=w^-1,_=0,I=j.length;_<I;)k=k>>>8^t[(k^j.charCodeAt(_++))&255];return~k}function C(j,w){for(var k=w^-1,_=j.length-15,I=0;I<_;)k=v[j[I++]^k&255]^S[j[I++]^k>>8&255]^y[j[I++]^k>>16&255]^p[j[I++]^k>>>24]^g[j[I++]]^m[j[I++]]^x[j[I++]]^h[j[I++]]^f[j[I++]]^u[j[I++]]^d[j[I++]]^c[j[I++]]^l[j[I++]]^o[j[I++]]^i[j[I++]]^t[j[I++]];for(_+=15;I<_;)k=k>>>8^t[(k^j[I++])&255];return~k}function A(j,w){for(var k=w^-1,_=0,I=j.length,D=0,B=0;_<I;)D=j.charCodeAt(_++),D<128?k=k>>>8^t[(k^D)&255]:D<2048?(k=k>>>8^t[(k^(192|D>>6&31))&255],k=k>>>8^t[(k^(128|D&63))&255]):D>=55296&&D<57344?(D=(D&1023)+64,B=j.charCodeAt(_++)&1023,k=k>>>8^t[(k^(240|D>>8&7))&255],k=k>>>8^t[(k^(128|D>>2&63))&255],k=k>>>8^t[(k^(128|B>>6&15|(D&3)<<4))&255],k=k>>>8^t[(k^(128|B&63))&255]):(k=k>>>8^t[(k^(224|D>>12&15))&255],k=k>>>8^t[(k^(128|D>>6&63))&255],k=k>>>8^t[(k^(128|D&63))&255]);return~k}return e.table=t,e.bstr=E,e.buf=C,e.str=A,e}(),Pt=function(){var r={};r.version="1.2.1";function t(J,le){for(var re=J.split("/"),se=le.split("/"),ce=0,fe=0,De=Math.min(re.length,se.length);ce<De;++ce){if(fe=re[ce].length-se[ce].length)return fe;if(re[ce]!=se[ce])return re[ce]<se[ce]?-1:1}return re.length-se.length}function n(J){if(J.charAt(J.length-1)=="/")return J.slice(0,-1).indexOf("/")===-1?J:n(J.slice(0,-1));var le=J.lastIndexOf("/");return le===-1?J:J.slice(0,le+1)}function s(J){if(J.charAt(J.length-1)=="/")return s(J.slice(0,-1));var le=J.lastIndexOf("/");return le===-1?J:J.slice(le+1)}function i(J,le){typeof le=="string"&&(le=new Date(le));var re=le.getHours();re=re<<6|le.getMinutes(),re=re<<5|le.getSeconds()>>>1,J.write_shift(2,re);var se=le.getFullYear()-1980;se=se<<4|le.getMonth()+1,se=se<<5|le.getDate(),J.write_shift(2,se)}function o(J){var le=J.read_shift(2)&65535,re=J.read_shift(2)&65535,se=new Date,ce=re&31;re>>>=5;var fe=re&15;re>>>=4,se.setMilliseconds(0),se.setFullYear(re+1980),se.setMonth(fe-1),se.setDate(ce);var De=le&31;le>>>=5;var $e=le&63;return le>>>=6,se.setHours(le),se.setMinutes($e),se.setSeconds(De<<1),se}function l(J){Jr(J,0);for(var le={},re=0;J.l<=J.length-4;){var se=J.read_shift(2),ce=J.read_shift(2),fe=J.l+ce,De={};switch(se){case 21589:re=J.read_shift(1),re&1&&(De.mtime=J.read_shift(4)),ce>5&&(re&2&&(De.atime=J.read_shift(4)),re&4&&(De.ctime=J.read_shift(4))),De.mtime&&(De.mt=new Date(De.mtime*1e3));break}J.l=fe,le[se]=De}return le}var c;function d(){return c||(c={})}function u(J,le){if(J[0]==80&&J[1]==75)return Zt(J,le);if((J[0]|32)==109&&(J[1]|32)==105)return xn(J,le);if(J.length<512)throw new Error("CFB file size "+J.length+" < 512");var re=3,se=512,ce=0,fe=0,De=0,$e=0,_e=0,Pe=[],Ne=J.slice(0,512);Jr(Ne,0);var We=f(Ne);switch(re=We[0],re){case 3:se=512;break;case 4:se=4096;break;case 0:if(We[1]==0)return Zt(J,le);default:throw new Error("Major Version: Expected 3 or 4 saw "+re)}se!==512&&(Ne=J.slice(0,se),Jr(Ne,28));var qe=J.slice(0,se);h(Ne,re);var et=Ne.read_shift(4,"i");if(re===3&&et!==0)throw new Error("# Directory Sectors: Expected 0 saw "+et);Ne.l+=4,De=Ne.read_shift(4,"i"),Ne.l+=4,Ne.chk("00100000","Mini Stream Cutoff Size: "),$e=Ne.read_shift(4,"i"),ce=Ne.read_shift(4,"i"),_e=Ne.read_shift(4,"i"),fe=Ne.read_shift(4,"i");for(var ze=-1,Je=0;Je<109&&(ze=Ne.read_shift(4,"i"),!(ze<0));++Je)Pe[Je]=ze;var mt=x(J,se);p(_e,fe,mt,se,Pe);var rr=S(mt,De,Pe,se);rr[De].name="!Directory",ce>0&&$e!==B&&(rr[$e].name="!MiniFAT"),rr[Pe[0]].name="!FAT",rr.fat_addrs=Pe,rr.ssz=se;var or={},Ft=[],Ms=[],Ps=[];v(De,rr,mt,Ft,ce,or,Ms,$e),m(Ms,Ps,Ft),Ft.shift();var Ns={FileIndex:Ms,FullPaths:Ps};return le&&le.raw&&(Ns.raw={header:qe,sectors:mt}),Ns}function f(J){if(J[J.l]==80&&J[J.l+1]==75)return[0,0];J.chk(R,"Header Signature: "),J.l+=16;var le=J.read_shift(2,"u");return[J.read_shift(2,"u"),le]}function h(J,le){var re=9;switch(J.l+=2,re=J.read_shift(2)){case 9:if(le!=3)throw new Error("Sector Shift: Expected 9 saw "+re);break;case 12:if(le!=4)throw new Error("Sector Shift: Expected 12 saw "+re);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+re)}J.chk("0600","Mini Sector Shift: "),J.chk("000000000000","Reserved: ")}function x(J,le){for(var re=Math.ceil(J.length/le)-1,se=[],ce=1;ce<re;++ce)se[ce-1]=J.slice(ce*le,(ce+1)*le);return se[re-1]=J.slice(re*le),se}function m(J,le,re){for(var se=0,ce=0,fe=0,De=0,$e=0,_e=re.length,Pe=[],Ne=[];se<_e;++se)Pe[se]=Ne[se]=se,le[se]=re[se];for(;$e<Ne.length;++$e)se=Ne[$e],ce=J[se].L,fe=J[se].R,De=J[se].C,Pe[se]===se&&(ce!==-1&&Pe[ce]!==ce&&(Pe[se]=Pe[ce]),fe!==-1&&Pe[fe]!==fe&&(Pe[se]=Pe[fe])),De!==-1&&(Pe[De]=se),ce!==-1&&se!=Pe[se]&&(Pe[ce]=Pe[se],Ne.lastIndexOf(ce)<$e&&Ne.push(ce)),fe!==-1&&se!=Pe[se]&&(Pe[fe]=Pe[se],Ne.lastIndexOf(fe)<$e&&Ne.push(fe));for(se=1;se<_e;++se)Pe[se]===se&&(fe!==-1&&Pe[fe]!==fe?Pe[se]=Pe[fe]:ce!==-1&&Pe[ce]!==ce&&(Pe[se]=Pe[ce]));for(se=1;se<_e;++se)if(J[se].type!==0){if($e=se,$e!=Pe[$e])do $e=Pe[$e],le[se]=le[$e]+"/"+le[se];while($e!==0&&Pe[$e]!==-1&&$e!=Pe[$e]);Pe[se]=-1}for(le[0]+="/",se=1;se<_e;++se)J[se].type!==2&&(le[se]+="/")}function g(J,le,re){for(var se=J.start,ce=J.size,fe=[],De=se;re&&ce>0&&De>=0;)fe.push(le.slice(De*D,De*D+D)),ce-=D,De=zs(re,De*4);return fe.length===0?Or(0):ms(fe).slice(0,J.size)}function p(J,le,re,se,ce){var fe=B;if(J===B){if(le!==0)throw new Error("DIFAT chain shorter than expected")}else if(J!==-1){var De=re[J],$e=(se>>>2)-1;if(!De)return;for(var _e=0;_e<$e&&(fe=zs(De,_e*4))!==B;++_e)ce.push(fe);p(zs(De,se-4),le-1,re,se,ce)}}function y(J,le,re,se,ce){var fe=[],De=[];ce||(ce=[]);var $e=se-1,_e=0,Pe=0;for(_e=le;_e>=0;){ce[_e]=!0,fe[fe.length]=_e,De.push(J[_e]);var Ne=re[Math.floor(_e*4/se)];if(Pe=_e*4&$e,se<4+Pe)throw new Error("FAT boundary crossed: "+_e+" 4 "+se);if(!J[Ne])break;_e=zs(J[Ne],Pe)}return{nodes:fe,data:Lp([De])}}function S(J,le,re,se){var ce=J.length,fe=[],De=[],$e=[],_e=[],Pe=se-1,Ne=0,We=0,qe=0,et=0;for(Ne=0;Ne<ce;++Ne)if($e=[],qe=Ne+le,qe>=ce&&(qe-=ce),!De[qe]){_e=[];var ze=[];for(We=qe;We>=0;){ze[We]=!0,De[We]=!0,$e[$e.length]=We,_e.push(J[We]);var Je=re[Math.floor(We*4/se)];if(et=We*4&Pe,se<4+et)throw new Error("FAT boundary crossed: "+We+" 4 "+se);if(!J[Je]||(We=zs(J[Je],et),ze[We]))break}fe[qe]={nodes:$e,data:Lp([_e])}}return fe}function v(J,le,re,se,ce,fe,De,$e){for(var _e=0,Pe=se.length?2:0,Ne=le[J].data,We=0,qe=0,et;We<Ne.length;We+=128){var ze=Ne.slice(We,We+128);Jr(ze,64),qe=ze.read_shift(2),et=Jh(ze,0,qe-Pe),se.push(et);var Je={name:et,type:ze.read_shift(1),color:ze.read_shift(1),L:ze.read_shift(4,"i"),R:ze.read_shift(4,"i"),C:ze.read_shift(4,"i"),clsid:ze.read_shift(16),state:ze.read_shift(4,"i"),start:0,size:0},mt=ze.read_shift(2)+ze.read_shift(2)+ze.read_shift(2)+ze.read_shift(2);mt!==0&&(Je.ct=E(ze,ze.l-8));var rr=ze.read_shift(2)+ze.read_shift(2)+ze.read_shift(2)+ze.read_shift(2);rr!==0&&(Je.mt=E(ze,ze.l-8)),Je.start=ze.read_shift(4,"i"),Je.size=ze.read_shift(4,"i"),Je.size<0&&Je.start<0&&(Je.size=Je.type=0,Je.start=B,Je.name=""),Je.type===5?(_e=Je.start,ce>0&&_e!==B&&(le[_e].name="!StreamData")):Je.size>=4096?(Je.storage="fat",le[Je.start]===void 0&&(le[Je.start]=y(re,Je.start,le.fat_addrs,le.ssz)),le[Je.start].name=Je.name,Je.content=le[Je.start].data.slice(0,Je.size)):(Je.storage="minifat",Je.size<0?Je.size=0:_e!==B&&Je.start!==B&&le[_e]&&(Je.content=g(Je,le[_e].data,(le[$e]||{}).data))),Je.content&&Jr(Je.content,0),fe[et]=Je,De.push(Je)}}function E(J,le){return new Date((Yn(J,le+4)/1e7*Math.pow(2,32)+Yn(J,le)/1e7-11644473600)*1e3)}function C(J,le){return d(),u(c.readFileSync(J),le)}function A(J,le){var re=le&&le.type;switch(re||It&&Buffer.isBuffer(J)&&(re="buffer"),re||"base64"){case"file":return C(J,le);case"base64":return u(ma(Xn(J)),le);case"binary":return u(ma(J),le)}return u(J,le)}function j(J,le){var re=le||{},se=re.root||"Root Entry";if(J.FullPaths||(J.FullPaths=[]),J.FileIndex||(J.FileIndex=[]),J.FullPaths.length!==J.FileIndex.length)throw new Error("inconsistent CFB structure");J.FullPaths.length===0&&(J.FullPaths[0]=se+"/",J.FileIndex[0]={name:se,type:5}),re.CLSID&&(J.FileIndex[0].clsid=re.CLSID),w(J)}function w(J){var le="Sh33tJ5";if(!Pt.find(J,"/"+le)){var re=Or(4);re[0]=55,re[1]=re[3]=50,re[2]=54,J.FileIndex.push({name:le,type:2,content:re,size:4,L:69,R:69,C:69}),J.FullPaths.push(J.FullPaths[0]+le),k(J)}}function k(J,le){j(J);for(var re=!1,se=!1,ce=J.FullPaths.length-1;ce>=0;--ce){var fe=J.FileIndex[ce];switch(fe.type){case 0:se?re=!0:(J.FileIndex.pop(),J.FullPaths.pop());break;case 1:case 2:case 5:se=!0,isNaN(fe.R*fe.L*fe.C)&&(re=!0),fe.R>-1&&fe.L>-1&&fe.R==fe.L&&(re=!0);break;default:re=!0;break}}if(!(!re&&!le)){var De=new Date(1987,1,19),$e=0,_e=Object.create?Object.create(null):{},Pe=[];for(ce=0;ce<J.FullPaths.length;++ce)_e[J.FullPaths[ce]]=!0,J.FileIndex[ce].type!==0&&Pe.push([J.FullPaths[ce],J.FileIndex[ce]]);for(ce=0;ce<Pe.length;++ce){var Ne=n(Pe[ce][0]);se=_e[Ne],se||(Pe.push([Ne,{name:s(Ne).replace("/",""),type:1,clsid:P,ct:De,mt:De,content:null}]),_e[Ne]=!0)}for(Pe.sort(function(et,ze){return t(et[0],ze[0])}),J.FullPaths=[],J.FileIndex=[],ce=0;ce<Pe.length;++ce)J.FullPaths[ce]=Pe[ce][0],J.FileIndex[ce]=Pe[ce][1];for(ce=0;ce<Pe.length;++ce){var We=J.FileIndex[ce],qe=J.FullPaths[ce];if(We.name=s(qe).replace("/",""),We.L=We.R=We.C=-(We.color=1),We.size=We.content?We.content.length:0,We.start=0,We.clsid=We.clsid||P,ce===0)We.C=Pe.length>1?1:-1,We.size=0,We.type=5;else if(qe.slice(-1)=="/"){for($e=ce+1;$e<Pe.length&&n(J.FullPaths[$e])!=qe;++$e);for(We.C=$e>=Pe.length?-1:$e,$e=ce+1;$e<Pe.length&&n(J.FullPaths[$e])!=n(qe);++$e);We.R=$e>=Pe.length?-1:$e,We.type=1}else n(J.FullPaths[ce+1]||"")==n(qe)&&(We.R=ce+1),We.type=2}}}function _(J,le){var re=le||{};if(re.fileType=="mad")return ji(J,re);switch(k(J),re.fileType){case"zip":return Er(J,re)}var se=function(et){for(var ze=0,Je=0,mt=0;mt<et.FileIndex.length;++mt){var rr=et.FileIndex[mt];if(rr.content){var or=rr.content.length;or>0&&(or<4096?ze+=or+63>>6:Je+=or+511>>9)}}for(var Ft=et.FullPaths.length+3>>2,Ms=ze+7>>3,Ps=ze+127>>7,Ns=Ms+Je+Ft+Ps,oa=Ns+127>>7,is=oa<=109?0:Math.ceil((oa-109)/127);Ns+oa+is+127>>7>oa;)is=++oa<=109?0:Math.ceil((oa-109)/127);var Bn=[1,is,oa,Ps,Ft,Je,ze,0];return et.FileIndex[0].size=ze<<6,Bn[7]=(et.FileIndex[0].start=Bn[0]+Bn[1]+Bn[2]+Bn[3]+Bn[4]+Bn[5])+(Bn[6]+7>>3),Bn}(J),ce=Or(se[7]<<9),fe=0,De=0;{for(fe=0;fe<8;++fe)ce.write_shift(1,Y[fe]);for(fe=0;fe<8;++fe)ce.write_shift(2,0);for(ce.write_shift(2,62),ce.write_shift(2,3),ce.write_shift(2,65534),ce.write_shift(2,9),ce.write_shift(2,6),fe=0;fe<3;++fe)ce.write_shift(2,0);for(ce.write_shift(4,0),ce.write_shift(4,se[2]),ce.write_shift(4,se[0]+se[1]+se[2]+se[3]-1),ce.write_shift(4,0),ce.write_shift(4,4096),ce.write_shift(4,se[3]?se[0]+se[1]+se[2]-1:B),ce.write_shift(4,se[3]),ce.write_shift(-4,se[1]?se[0]-1:B),ce.write_shift(4,se[1]),fe=0;fe<109;++fe)ce.write_shift(-4,fe<se[2]?se[1]+fe:-1)}if(se[1])for(De=0;De<se[1];++De){for(;fe<236+De*127;++fe)ce.write_shift(-4,fe<se[2]?se[1]+fe:-1);ce.write_shift(-4,De===se[1]-1?B:De+1)}var $e=function(et){for(De+=et;fe<De-1;++fe)ce.write_shift(-4,fe+1);et&&(++fe,ce.write_shift(-4,B))};for(De=fe=0,De+=se[1];fe<De;++fe)ce.write_shift(-4,M.DIFSECT);for(De+=se[2];fe<De;++fe)ce.write_shift(-4,M.FATSECT);$e(se[3]),$e(se[4]);for(var _e=0,Pe=0,Ne=J.FileIndex[0];_e<J.FileIndex.length;++_e)Ne=J.FileIndex[_e],Ne.content&&(Pe=Ne.content.length,!(Pe<4096)&&(Ne.start=De,$e(Pe+511>>9)));for($e(se[6]+7>>3);ce.l&511;)ce.write_shift(-4,M.ENDOFCHAIN);for(De=fe=0,_e=0;_e<J.FileIndex.length;++_e)Ne=J.FileIndex[_e],Ne.content&&(Pe=Ne.content.length,!(!Pe||Pe>=4096)&&(Ne.start=De,$e(Pe+63>>6)));for(;ce.l&511;)ce.write_shift(-4,M.ENDOFCHAIN);for(fe=0;fe<se[4]<<2;++fe){var We=J.FullPaths[fe];if(!We||We.length===0){for(_e=0;_e<17;++_e)ce.write_shift(4,0);for(_e=0;_e<3;++_e)ce.write_shift(4,-1);for(_e=0;_e<12;++_e)ce.write_shift(4,0);continue}Ne=J.FileIndex[fe],fe===0&&(Ne.start=Ne.size?Ne.start-1:B);var qe=fe===0&&re.root||Ne.name;if(Pe=2*(qe.length+1),ce.write_shift(64,qe,"utf16le"),ce.write_shift(2,Pe),ce.write_shift(1,Ne.type),ce.write_shift(1,Ne.color),ce.write_shift(-4,Ne.L),ce.write_shift(-4,Ne.R),ce.write_shift(-4,Ne.C),Ne.clsid)ce.write_shift(16,Ne.clsid,"hex");else for(_e=0;_e<4;++_e)ce.write_shift(4,0);ce.write_shift(4,Ne.state||0),ce.write_shift(4,0),ce.write_shift(4,0),ce.write_shift(4,0),ce.write_shift(4,0),ce.write_shift(4,Ne.start),ce.write_shift(4,Ne.size),ce.write_shift(4,0)}for(fe=1;fe<J.FileIndex.length;++fe)if(Ne=J.FileIndex[fe],Ne.size>=4096)if(ce.l=Ne.start+1<<9,It&&Buffer.isBuffer(Ne.content))Ne.content.copy(ce,ce.l,0,Ne.size),ce.l+=Ne.size+511&-512;else{for(_e=0;_e<Ne.size;++_e)ce.write_shift(1,Ne.content[_e]);for(;_e&511;++_e)ce.write_shift(1,0)}for(fe=1;fe<J.FileIndex.length;++fe)if(Ne=J.FileIndex[fe],Ne.size>0&&Ne.size<4096)if(It&&Buffer.isBuffer(Ne.content))Ne.content.copy(ce,ce.l,0,Ne.size),ce.l+=Ne.size+63&-64;else{for(_e=0;_e<Ne.size;++_e)ce.write_shift(1,Ne.content[_e]);for(;_e&63;++_e)ce.write_shift(1,0)}if(It)ce.l=ce.length;else for(;ce.l<ce.length;)ce.write_shift(1,0);return ce}function I(J,le){var re=J.FullPaths.map(function(_e){return _e.toUpperCase()}),se=re.map(function(_e){var Pe=_e.split("/");return Pe[Pe.length-(_e.slice(-1)=="/"?2:1)]}),ce=!1;le.charCodeAt(0)===47?(ce=!0,le=re[0].slice(0,-1)+le):ce=le.indexOf("/")!==-1;var fe=le.toUpperCase(),De=ce===!0?re.indexOf(fe):se.indexOf(fe);if(De!==-1)return J.FileIndex[De];var $e=!fe.match(Co);for(fe=fe.replace(En,""),$e&&(fe=fe.replace(Co,"!")),De=0;De<re.length;++De)if(($e?re[De].replace(Co,"!"):re[De]).replace(En,"")==fe||($e?se[De].replace(Co,"!"):se[De]).replace(En,"")==fe)return J.FileIndex[De];return null}var D=64,B=-2,R="d0cf11e0a1b11ae1",Y=[208,207,17,224,161,177,26,225],P="00000000000000000000000000000000",M={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:B,FREESECT:-1,HEADER_SIGNATURE:R,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:P,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function K(J,le,re){d();var se=_(J,re);c.writeFileSync(le,se)}function L(J){for(var le=new Array(J.length),re=0;re<J.length;++re)le[re]=String.fromCharCode(J[re]);return le.join("")}function ae(J,le){var re=_(J,le);switch(le&&le.type||"buffer"){case"file":return d(),c.writeFileSync(le.filename,re),re;case"binary":return typeof re=="string"?re:L(re);case"base64":return bp(typeof re=="string"?re:L(re));case"buffer":if(It)return Buffer.isBuffer(re)?re:gi(re);case"array":return typeof re=="string"?ma(re):re}return re}var Z;function T(J){try{var le=J.InflateRaw,re=new le;if(re._processChunk(new Uint8Array([3,0]),re._finishFlushFlag),re.bytesRead)Z=J;else throw new Error("zlib does not expose bytesRead")}catch(se){console.error("cannot use native zlib: "+(se.message||se))}}function N(J,le){if(!Z)return qt(J,le);var re=Z.InflateRaw,se=new re,ce=se._processChunk(J.slice(J.l),se._finishFlushFlag);return J.l+=se.bytesRead,ce}function H(J){return Z?Z.deflateRawSync(J):Ae(J)}var G=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],oe=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function de(J){var le=(J<<1|J<<11)&139536|(J<<5|J<<15)&558144;return(le>>16|le>>8|le)&255}for(var z=typeof Uint8Array<"u",O=z?new Uint8Array(256):[],W=0;W<256;++W)O[W]=de(W);function F(J,le){var re=O[J&255];return le<=8?re>>>8-le:(re=re<<8|O[J>>8&255],le<=16?re>>>16-le:(re=re<<8|O[J>>16&255],re>>>24-le))}function U(J,le){var re=le&7,se=le>>>3;return(J[se]|(re<=6?0:J[se+1]<<8))>>>re&3}function te(J,le){var re=le&7,se=le>>>3;return(J[se]|(re<=5?0:J[se+1]<<8))>>>re&7}function he(J,le){var re=le&7,se=le>>>3;return(J[se]|(re<=4?0:J[se+1]<<8))>>>re&15}function ie(J,le){var re=le&7,se=le>>>3;return(J[se]|(re<=3?0:J[se+1]<<8))>>>re&31}function be(J,le){var re=le&7,se=le>>>3;return(J[se]|(re<=1?0:J[se+1]<<8))>>>re&127}function xe(J,le,re){var se=le&7,ce=le>>>3,fe=(1<<re)-1,De=J[ce]>>>se;return re<8-se||(De|=J[ce+1]<<8-se,re<16-se)||(De|=J[ce+2]<<16-se,re<24-se)||(De|=J[ce+3]<<24-se),De&fe}function Fe(J,le,re){var se=le&7,ce=le>>>3;return se<=5?J[ce]|=(re&7)<<se:(J[ce]|=re<<se&255,J[ce+1]=(re&7)>>8-se),le+3}function me(J,le,re){var se=le&7,ce=le>>>3;return re=(re&1)<<se,J[ce]|=re,le+1}function ve(J,le,re){var se=le&7,ce=le>>>3;return re<<=se,J[ce]|=re&255,re>>>=8,J[ce+1]=re,le+8}function ne(J,le,re){var se=le&7,ce=le>>>3;return re<<=se,J[ce]|=re&255,re>>>=8,J[ce+1]=re&255,J[ce+2]=re>>>8,le+16}function we(J,le){var re=J.length,se=2*re>le?2*re:le+5,ce=0;if(re>=le)return J;if(It){var fe=Sp(se);if(J.copy)J.copy(fe);else for(;ce<J.length;++ce)fe[ce]=J[ce];return fe}else if(z){var De=new Uint8Array(se);if(De.set)De.set(J);else for(;ce<re;++ce)De[ce]=J[ce];return De}return J.length=se,J}function Ee(J){for(var le=new Array(J),re=0;re<J;++re)le[re]=0;return le}function pe(J,le,re){var se=1,ce=0,fe=0,De=0,$e=0,_e=J.length,Pe=z?new Uint16Array(32):Ee(32);for(fe=0;fe<32;++fe)Pe[fe]=0;for(fe=_e;fe<re;++fe)J[fe]=0;_e=J.length;var Ne=z?new Uint16Array(_e):Ee(_e);for(fe=0;fe<_e;++fe)Pe[ce=J[fe]]++,se<ce&&(se=ce),Ne[fe]=0;for(Pe[0]=0,fe=1;fe<=se;++fe)Pe[fe+16]=$e=$e+Pe[fe-1]<<1;for(fe=0;fe<_e;++fe)$e=J[fe],$e!=0&&(Ne[fe]=Pe[$e+16]++);var We=0;for(fe=0;fe<_e;++fe)if(We=J[fe],We!=0)for($e=F(Ne[fe],se)>>se-We,De=(1<<se+4-We)-1;De>=0;--De)le[$e|De<<We]=We&15|fe<<4;return se}var Ce=z?new Uint16Array(512):Ee(512),ue=z?new Uint16Array(32):Ee(32);if(!z){for(var Me=0;Me<512;++Me)Ce[Me]=0;for(Me=0;Me<32;++Me)ue[Me]=0}(function(){for(var J=[],le=0;le<32;le++)J.push(5);pe(J,ue,32);var re=[];for(le=0;le<=143;le++)re.push(8);for(;le<=255;le++)re.push(9);for(;le<=279;le++)re.push(7);for(;le<=287;le++)re.push(8);pe(re,Ce,288)})();var ke=function(){for(var le=z?new Uint8Array(32768):[],re=0,se=0;re<oe.length-1;++re)for(;se<oe[re+1];++se)le[se]=re;for(;se<32768;++se)le[se]=29;var ce=z?new Uint8Array(259):[];for(re=0,se=0;re<q.length-1;++re)for(;se<q[re+1];++se)ce[se]=re;function fe($e,_e){for(var Pe=0;Pe<$e.length;){var Ne=Math.min(65535,$e.length-Pe),We=Pe+Ne==$e.length;for(_e.write_shift(1,+We),_e.write_shift(2,Ne),_e.write_shift(2,~Ne&65535);Ne-- >0;)_e[_e.l++]=$e[Pe++]}return _e.l}function De($e,_e){for(var Pe=0,Ne=0,We=z?new Uint16Array(32768):[];Ne<$e.length;){var qe=Math.min(65535,$e.length-Ne);if(qe<10){for(Pe=Fe(_e,Pe,+(Ne+qe==$e.length)),Pe&7&&(Pe+=8-(Pe&7)),_e.l=Pe/8|0,_e.write_shift(2,qe),_e.write_shift(2,~qe&65535);qe-- >0;)_e[_e.l++]=$e[Ne++];Pe=_e.l*8;continue}Pe=Fe(_e,Pe,+(Ne+qe==$e.length)+2);for(var et=0;qe-- >0;){var ze=$e[Ne];et=(et<<5^ze)&32767;var Je=-1,mt=0;if((Je=We[et])&&(Je|=Ne&-32768,Je>Ne&&(Je-=32768),Je<Ne))for(;$e[Je+mt]==$e[Ne+mt]&&mt<250;)++mt;if(mt>2){ze=ce[mt],ze<=22?Pe=ve(_e,Pe,O[ze+1]>>1)-1:(ve(_e,Pe,3),Pe+=5,ve(_e,Pe,O[ze-23]>>5),Pe+=3);var rr=ze<8?0:ze-4>>2;rr>0&&(ne(_e,Pe,mt-q[ze]),Pe+=rr),ze=le[Ne-Je],Pe=ve(_e,Pe,O[ze]>>3),Pe-=3;var or=ze<4?0:ze-2>>1;or>0&&(ne(_e,Pe,Ne-Je-oe[ze]),Pe+=or);for(var Ft=0;Ft<mt;++Ft)We[et]=Ne&32767,et=(et<<5^$e[Ne])&32767,++Ne;qe-=mt-1}else ze<=143?ze=ze+48:Pe=me(_e,Pe,1),Pe=ve(_e,Pe,O[ze]),We[et]=Ne&32767,++Ne}Pe=ve(_e,Pe,0)-1}return _e.l=(Pe+7)/8|0,_e.l}return function(_e,Pe){return _e.length<8?fe(_e,Pe):De(_e,Pe)}}();function Ae(J){var le=Or(50+Math.floor(J.length*1.1)),re=ke(J,le);return le.slice(0,re)}var Ue=z?new Uint16Array(32768):Ee(32768),Ye=z?new Uint16Array(32768):Ee(32768),Ve=z?new Uint16Array(128):Ee(128),Xe=1,_t=1;function ct(J,le){var re=ie(J,le)+257;le+=5;var se=ie(J,le)+1;le+=5;var ce=he(J,le)+4;le+=4;for(var fe=0,De=z?new Uint8Array(19):Ee(19),$e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],_e=1,Pe=z?new Uint8Array(8):Ee(8),Ne=z?new Uint8Array(8):Ee(8),We=De.length,qe=0;qe<ce;++qe)De[G[qe]]=fe=te(J,le),_e<fe&&(_e=fe),Pe[fe]++,le+=3;var et=0;for(Pe[0]=0,qe=1;qe<=_e;++qe)Ne[qe]=et=et+Pe[qe-1]<<1;for(qe=0;qe<We;++qe)(et=De[qe])!=0&&($e[qe]=Ne[et]++);var ze=0;for(qe=0;qe<We;++qe)if(ze=De[qe],ze!=0){et=O[$e[qe]]>>8-ze;for(var Je=(1<<7-ze)-1;Je>=0;--Je)Ve[et|Je<<ze]=ze&7|qe<<3}var mt=[];for(_e=1;mt.length<re+se;)switch(et=Ve[be(J,le)],le+=et&7,et>>>=3){case 16:for(fe=3+U(J,le),le+=2,et=mt[mt.length-1];fe-- >0;)mt.push(et);break;case 17:for(fe=3+te(J,le),le+=3;fe-- >0;)mt.push(0);break;case 18:for(fe=11+be(J,le),le+=7;fe-- >0;)mt.push(0);break;default:mt.push(et),_e<et&&(_e=et);break}var rr=mt.slice(0,re),or=mt.slice(re);for(qe=re;qe<286;++qe)rr[qe]=0;for(qe=se;qe<30;++qe)or[qe]=0;return Xe=pe(rr,Ue,286),_t=pe(or,Ye,30),le}function dt(J,le){if(J[0]==3&&!(J[1]&3))return[As(le),2];for(var re=0,se=0,ce=Sp(le||1<<18),fe=0,De=ce.length>>>0,$e=0,_e=0;!(se&1);){if(se=te(J,re),re+=3,se>>>1)se>>1==1?($e=9,_e=5):(re=ct(J,re),$e=Xe,_e=_t);else{re&7&&(re+=8-(re&7));var Pe=J[re>>>3]|J[(re>>>3)+1]<<8;if(re+=32,Pe>0)for(!le&&De<fe+Pe&&(ce=we(ce,fe+Pe),De=ce.length);Pe-- >0;)ce[fe++]=J[re>>>3],re+=8;continue}for(;;){!le&&De<fe+32767&&(ce=we(ce,fe+32767),De=ce.length);var Ne=xe(J,re,$e),We=se>>>1==1?Ce[Ne]:Ue[Ne];if(re+=We&15,We>>>=4,!(We>>>8&255))ce[fe++]=We;else{if(We==256)break;We-=257;var qe=We<8?0:We-4>>2;qe>5&&(qe=0);var et=fe+q[We];qe>0&&(et+=xe(J,re,qe),re+=qe),Ne=xe(J,re,_e),We=se>>>1==1?ue[Ne]:Ye[Ne],re+=We&15,We>>>=4;var ze=We<4?0:We-2>>1,Je=oe[We];for(ze>0&&(Je+=xe(J,re,ze),re+=ze),!le&&De<et&&(ce=we(ce,et+100),De=ce.length);fe<et;)ce[fe]=ce[fe-Je],++fe}}}return le?[ce,re+7>>>3]:[ce.slice(0,fe),re+7>>>3]}function qt(J,le){var re=J.slice(J.l||0),se=dt(re,le);return J.l+=se[1],se[0]}function jr(J,le){if(J)typeof console<"u"&&console.error(le);else throw new Error(le)}function Zt(J,le){var re=J;Jr(re,0);var se=[],ce=[],fe={FileIndex:se,FullPaths:ce};j(fe,{root:le.root});for(var De=re.length-4;(re[De]!=80||re[De+1]!=75||re[De+2]!=5||re[De+3]!=6)&&De>=0;)--De;re.l=De+4,re.l+=4;var $e=re.read_shift(2);re.l+=6;var _e=re.read_shift(4);for(re.l=_e,De=0;De<$e;++De){re.l+=20;var Pe=re.read_shift(4),Ne=re.read_shift(4),We=re.read_shift(2),qe=re.read_shift(2),et=re.read_shift(2);re.l+=8;var ze=re.read_shift(4),Je=l(re.slice(re.l+We,re.l+We+qe));re.l+=We+qe+et;var mt=re.l;re.l=ze+4,as(re,Pe,Ne,fe,Je),re.l=mt}return fe}function as(J,le,re,se,ce){J.l+=2;var fe=J.read_shift(2),De=J.read_shift(2),$e=o(J);if(fe&8257)throw new Error("Unsupported ZIP encryption");for(var _e=J.read_shift(4),Pe=J.read_shift(4),Ne=J.read_shift(4),We=J.read_shift(2),qe=J.read_shift(2),et="",ze=0;ze<We;++ze)et+=String.fromCharCode(J[J.l++]);if(qe){var Je=l(J.slice(J.l,J.l+qe));(Je[21589]||{}).mt&&($e=Je[21589].mt),((ce||{})[21589]||{}).mt&&($e=ce[21589].mt)}J.l+=qe;var mt=J.slice(J.l,J.l+Pe);switch(De){case 8:mt=N(J,Ne);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+De)}var rr=!1;fe&8&&(_e=J.read_shift(4),_e==134695760&&(_e=J.read_shift(4),rr=!0),Pe=J.read_shift(4),Ne=J.read_shift(4)),Pe!=le&&jr(rr,"Bad compressed size: "+le+" != "+Pe),Ne!=re&&jr(rr,"Bad uncompressed size: "+re+" != "+Ne),co(se,et,mt,{unsafe:!0,mt:$e})}function Er(J,le){var re=le||{},se=[],ce=[],fe=Or(1),De=re.compression?8:0,$e=0,_e=0,Pe=0,Ne=0,We=0,qe=J.FullPaths[0],et=qe,ze=J.FileIndex[0],Je=[],mt=0;for(_e=1;_e<J.FullPaths.length;++_e)if(et=J.FullPaths[_e].slice(qe.length),ze=J.FileIndex[_e],!(!ze.size||!ze.content||et=="Sh33tJ5")){var rr=Ne,or=Or(et.length);for(Pe=0;Pe<et.length;++Pe)or.write_shift(1,et.charCodeAt(Pe)&127);or=or.slice(0,or.l),Je[We]=o3.buf(ze.content,0);var Ft=ze.content;De==8&&(Ft=H(Ft)),fe=Or(30),fe.write_shift(4,67324752),fe.write_shift(2,20),fe.write_shift(2,$e),fe.write_shift(2,De),ze.mt?i(fe,ze.mt):fe.write_shift(4,0),fe.write_shift(-4,Je[We]),fe.write_shift(4,Ft.length),fe.write_shift(4,ze.content.length),fe.write_shift(2,or.length),fe.write_shift(2,0),Ne+=fe.length,se.push(fe),Ne+=or.length,se.push(or),Ne+=Ft.length,se.push(Ft),fe=Or(46),fe.write_shift(4,33639248),fe.write_shift(2,0),fe.write_shift(2,20),fe.write_shift(2,$e),fe.write_shift(2,De),fe.write_shift(4,0),fe.write_shift(-4,Je[We]),fe.write_shift(4,Ft.length),fe.write_shift(4,ze.content.length),fe.write_shift(2,or.length),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(4,0),fe.write_shift(4,rr),mt+=fe.l,ce.push(fe),mt+=or.length,ce.push(or),++We}return fe=Or(22),fe.write_shift(4,101010256),fe.write_shift(2,0),fe.write_shift(2,0),fe.write_shift(2,We),fe.write_shift(2,We),fe.write_shift(4,mt),fe.write_shift(4,Ne),fe.write_shift(2,0),ms([ms(se),ms(ce),fe])}var Kn={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function ss(J,le){if(J.ctype)return J.ctype;var re=J.name||"",se=re.match(/\.([^\.]+)$/);return se&&Kn[se[1]]||le&&(se=(re=le).match(/[\.\\]([^\.\\])+$/),se&&Kn[se[1]])?Kn[se[1]]:"application/octet-stream"}function oo(J){for(var le=bp(J),re=[],se=0;se<le.length;se+=76)re.push(le.slice(se,se+76));return re.join(`\r
`)+`\r
`}function Cl(J){var le=J.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Pe){var Ne=Pe.charCodeAt(0).toString(16).toUpperCase();return"="+(Ne.length==1?"0"+Ne:Ne)});le=le.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),le.charAt(0)==`
`&&(le="=0D"+le.slice(1)),le=le.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var re=[],se=le.split(`\r
`),ce=0;ce<se.length;++ce){var fe=se[ce];if(fe.length==0){re.push("");continue}for(var De=0;De<fe.length;){var $e=76,_e=fe.slice(De,De+$e);_e.charAt($e-1)=="="?$e--:_e.charAt($e-2)=="="?$e-=2:_e.charAt($e-3)=="="&&($e-=3),_e=fe.slice(De,De+$e),De+=$e,De<fe.length&&(_e+="="),re.push(_e)}}return re.join(`\r
`)}function lo(J){for(var le=[],re=0;re<J.length;++re){for(var se=J[re];re<=J.length&&se.charAt(se.length-1)=="=";)se=se.slice(0,se.length-1)+J[++re];le.push(se)}for(var ce=0;ce<le.length;++ce)le[ce]=le[ce].replace(/[=][0-9A-Fa-f]{2}/g,function(fe){return String.fromCharCode(parseInt(fe.slice(1),16))});return ma(le.join(`\r
`))}function ir(J,le,re){for(var se="",ce="",fe="",De,$e=0;$e<10;++$e){var _e=le[$e];if(!_e||_e.match(/^\s*$/))break;var Pe=_e.match(/^(.*?):\s*([^\s].*)$/);if(Pe)switch(Pe[1].toLowerCase()){case"content-location":se=Pe[2].trim();break;case"content-type":fe=Pe[2].trim();break;case"content-transfer-encoding":ce=Pe[2].trim();break}}switch(++$e,ce.toLowerCase()){case"base64":De=ma(Xn(le.slice($e).join("")));break;case"quoted-printable":De=lo(le.slice($e));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+ce)}var Ne=co(J,se.slice(re.length),De,{unsafe:!0});fe&&(Ne.ctype=fe)}function xn(J,le){if(L(J.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var re=le&&le.root||"",se=(It&&Buffer.isBuffer(J)?J.toString("binary"):L(J)).split(`\r
`),ce=0,fe="";for(ce=0;ce<se.length;++ce)if(fe=se[ce],!!/^Content-Location:/i.test(fe)&&(fe=fe.slice(fe.indexOf("file")),re||(re=fe.slice(0,fe.lastIndexOf("/")+1)),fe.slice(0,re.length)!=re))for(;re.length>0&&(re=re.slice(0,re.length-1),re=re.slice(0,re.lastIndexOf("/")+1),fe.slice(0,re.length)!=re););var De=(se[1]||"").match(/boundary="(.*?)"/);if(!De)throw new Error("MAD cannot find boundary");var $e="--"+(De[1]||""),_e=[],Pe=[],Ne={FileIndex:_e,FullPaths:Pe};j(Ne);var We,qe=0;for(ce=0;ce<se.length;++ce){var et=se[ce];et!==$e&&et!==$e+"--"||(qe++&&ir(Ne,se.slice(We,ce),re),We=ce)}return Ne}function ji(J,le){var re=le||{},se=re.boundary||"SheetJS";se="------="+se;for(var ce=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+se.slice(2)+'"',"","",""],fe=J.FullPaths[0],De=fe,$e=J.FileIndex[0],_e=1;_e<J.FullPaths.length;++_e)if(De=J.FullPaths[_e].slice(fe.length),$e=J.FileIndex[_e],!(!$e.size||!$e.content||De=="Sh33tJ5")){De=De.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(mt){return"_x"+mt.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(mt){return"_u"+mt.charCodeAt(0).toString(16)+"_"});for(var Pe=$e.content,Ne=It&&Buffer.isBuffer(Pe)?Pe.toString("binary"):L(Pe),We=0,qe=Math.min(1024,Ne.length),et=0,ze=0;ze<=qe;++ze)(et=Ne.charCodeAt(ze))>=32&&et<128&&++We;var Je=We>=qe*4/5;ce.push(se),ce.push("Content-Location: "+(re.root||"file:///C:/SheetJS/")+De),ce.push("Content-Transfer-Encoding: "+(Je?"quoted-printable":"base64")),ce.push("Content-Type: "+ss($e,De)),ce.push(""),ce.push(Je?Cl(Ne):oo(Ne))}return ce.push(se+`--\r
`),ce.join(`\r
`)}function Dl(J){var le={};return j(le,J),le}function co(J,le,re,se){var ce=se&&se.unsafe;ce||j(J);var fe=!ce&&Pt.find(J,le);if(!fe){var De=J.FullPaths[0];le.slice(0,De.length)==De?De=le:(De.slice(-1)!="/"&&(De+="/"),De=(De+le).replace("//","/")),fe={name:s(le),type:2},J.FileIndex.push(fe),J.FullPaths.push(De),ce||Pt.utils.cfb_gc(J)}return fe.content=re,fe.size=re?re.length:0,se&&(se.CLSID&&(fe.clsid=se.CLSID),se.mt&&(fe.mt=se.mt),se.ct&&(fe.ct=se.ct)),fe}function jd(J,le){j(J);var re=Pt.find(J,le);if(re){for(var se=0;se<J.FileIndex.length;++se)if(J.FileIndex[se]==re)return J.FileIndex.splice(se,1),J.FullPaths.splice(se,1),!0}return!1}function Ed(J,le,re){j(J);var se=Pt.find(J,le);if(se){for(var ce=0;ce<J.FileIndex.length;++ce)if(J.FileIndex[ce]==se)return J.FileIndex[ce].name=s(re),J.FullPaths[ce]=re,!0}return!1}function kd(J){k(J,!0)}return r.find=I,r.read=A,r.parse=u,r.write=ae,r.writeFile=K,r.utils={cfb_new:Dl,cfb_add:co,cfb_del:jd,cfb_mov:Ed,cfb_gc:kd,ReadShift:Oo,CheckField:Iv,prep_blob:Jr,bconcat:ms,use_zlib:T,_deflateRaw:Ae,_inflateRaw:qt,consts:M},r}();function l3(e){if(typeof Deno<"u")return Deno.readFileSync(e);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var r=File(e);r.open("r"),r.encoding="binary";var t=r.read();return r.close(),t}catch(n){if(!n.message||!n.message.match(/onstruct/))throw n}throw new Error("Cannot access file "+e)}function Ra(e){for(var r=Object.keys(e),t=[],n=0;n<r.length;++n)Object.prototype.hasOwnProperty.call(e,r[n])&&t.push(r[n]);return t}function Gh(e){for(var r=[],t=Ra(e),n=0;n!==t.length;++n)r[e[t[n]]]=t[n];return r}var Dc=new Date(1899,11,30,0,0,0);function kn(e,r){var t=e.getTime();r&&(t-=1462*24*60*60*1e3);var n=Dc.getTime()+(e.getTimezoneOffset()-Dc.getTimezoneOffset())*6e4;return(t-n)/(24*60*60*1e3)}var cv=new Date,c3=Dc.getTime()+(cv.getTimezoneOffset()-Dc.getTimezoneOffset())*6e4,Dp=cv.getTimezoneOffset();function vd(e){var r=new Date;return r.setTime(e*24*60*60*1e3+c3),r.getTimezoneOffset()!==Dp&&r.setTime(r.getTime()+(r.getTimezoneOffset()-Dp)*6e4),r}function d3(e){var r=0,t=0,n=!1,s=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!s)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var i=1;i!=s.length;++i)if(s[i]){switch(t=1,i>3&&(n=!0),s[i].slice(s[i].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+s[i].slice(s[i].length-1));case"D":t*=24;case"H":t*=60;case"M":if(n)t*=60;else throw new Error("Unsupported ISO Duration Field: M")}r+=t*parseInt(s[i],10)}return r}var _p=new Date("2017-02-19T19:06:09.000Z"),dv=isNaN(_p.getFullYear())?new Date("2/19/17"):_p,u3=dv.getFullYear()==2017;function Xr(e,r){var t=new Date(e);if(u3)return r>0?t.setTime(t.getTime()+t.getTimezoneOffset()*60*1e3):r<0&&t.setTime(t.getTime()-t.getTimezoneOffset()*60*1e3),t;if(e instanceof Date)return e;if(dv.getFullYear()==1917&&!isNaN(t.getFullYear())){var n=t.getFullYear();return e.indexOf(""+n)>-1||t.setFullYear(t.getFullYear()+100),t}var s=e.match(/\d+/g)||["2017","2","19","0","0","0"],i=new Date(+s[0],+s[1]-1,+s[2],+s[3]||0,+s[4]||0,+s[5]||0);return e.indexOf("Z")>-1&&(i=new Date(i.getTime()-i.getTimezoneOffset()*60*1e3)),i}function ii(e,r){if(It&&Buffer.isBuffer(e)){if(r){if(e[0]==255&&e[1]==254)return _o(e.slice(2).toString("utf16le"));if(e[1]==254&&e[2]==255)return _o(K1(e.slice(2).toString("binary")))}return e.toString("binary")}if(typeof TextDecoder<"u")try{if(r){if(e[0]==255&&e[1]==254)return _o(new TextDecoder("utf-16le").decode(e.slice(2)));if(e[0]==254&&e[1]==255)return _o(new TextDecoder("utf-16be").decode(e.slice(2)))}var t={"‚Ç¨":"¬Ä","‚Äö":"¬Ç",∆í:"¬É","‚Äû":"¬Ñ","‚Ä¶":"¬Ö","‚Ä†":"¬Ü","‚Ä°":"¬á","ÀÜ":"¬à","‚Ä∞":"¬â",≈†:"¬ä","‚Äπ":"¬ã",≈í:"¬å",≈Ω:"¬é","‚Äò":"¬ë","‚Äô":"¬í","‚Äú":"¬ì","‚Äù":"¬î","‚Ä¢":"¬ï","‚Äì":"¬ñ","‚Äî":"¬ó","Àú":"¬ò","‚Ñ¢":"¬ô",≈°:"¬ö","‚Ä∫":"¬õ",≈ì:"¬ú",≈æ:"¬û",≈∏:"¬ü"};return Array.isArray(e)&&(e=new Uint8Array(e)),new TextDecoder("latin1").decode(e).replace(/[‚Ç¨‚Äö∆í‚Äû‚Ä¶‚Ä†‚Ä°ÀÜ‚Ä∞≈†‚Äπ≈í≈Ω‚Äò‚Äô‚Äú‚Äù‚Ä¢‚Äì‚ÄîÀú‚Ñ¢≈°‚Ä∫≈ì≈æ≈∏]/g,function(i){return t[i]||i})}catch{}for(var n=[],s=0;s!=e.length;++s)n.push(String.fromCharCode(e[s]));return n.join("")}function Zr(e){if(typeof JSON<"u"&&!Array.isArray(e))return JSON.parse(JSON.stringify(e));if(typeof e!="object"||e==null)return e;if(e instanceof Date)return new Date(e.getTime());var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=Zr(e[t]));return r}function yr(e,r){for(var t="";t.length<r;)t+=e;return t}function ya(e){var r=Number(e);if(!isNaN(r))return isFinite(r)?r:NaN;if(!/\d/.test(e))return r;var t=1,n=e.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return t*=100,""});return!isNaN(r=Number(n))||(n=n.replace(/[(](.*)[)]/,function(s,i){return t=-t,i}),!isNaN(r=Number(n)))?r/t:r}var f3=["january","february","march","april","may","june","july","august","september","october","november","december"];function Ji(e){var r=new Date(e),t=new Date(NaN),n=r.getYear(),s=r.getMonth(),i=r.getDate();if(isNaN(i))return t;var o=e.toLowerCase();if(o.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(o=o.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),o.length>3&&f3.indexOf(o)==-1)return t}else if(o.match(/[a-z]/))return t;return n<0||n>8099?t:(s>0||i>1)&&n!=101?r:e.match(/[^-0-9:,\/\\]/)?t:r}var h3=function(){var e="abacaba".split(/(:?b)/i).length==5;return function(t,n,s){if(e||typeof n=="string")return t.split(n);for(var i=t.split(n),o=[i[0]],l=1;l<i.length;++l)o.push(s),o.push(i[l]);return o}}();function uv(e){return e?e.content&&e.type?ii(e.content,!0):e.data?To(e.data):e.asNodeBuffer&&It?To(e.asNodeBuffer().toString("binary")):e.asBinary?To(e.asBinary()):e._data&&e._data.getContent?To(ii(Array.prototype.slice.call(e._data.getContent(),0))):null:null}function fv(e){if(!e)return null;if(e.data)return yp(e.data);if(e.asNodeBuffer&&It)return e.asNodeBuffer();if(e._data&&e._data.getContent){var r=e._data.getContent();return typeof r=="string"?yp(r):Array.prototype.slice.call(r)}return e.content&&e.type?e.content:null}function m3(e){return e&&e.name.slice(-4)===".bin"?fv(e):uv(e)}function ra(e,r){for(var t=e.FullPaths||Ra(e.files),n=r.toLowerCase().replace(/[\/]/g,"\\"),s=n.replace(/\\/g,"/"),i=0;i<t.length;++i){var o=t[i].replace(/^Root Entry[\/]/,"").toLowerCase();if(n==o||s==o)return e.files?e.files[t[i]]:e.FileIndex[i]}return null}function qh(e,r){var t=ra(e,r);if(t==null)throw new Error("Cannot find file "+r+" in zip");return t}function _r(e,r,t){if(!t)return m3(qh(e,r));if(!r)return null;try{return _r(e,r)}catch{return null}}function zn(e,r,t){if(!t)return uv(qh(e,r));if(!r)return null;try{return zn(e,r)}catch{return null}}function hv(e,r,t){if(!t)return fv(qh(e,r));if(!r)return null;try{return hv(e,r)}catch{return null}}function Ip(e){for(var r=e.FullPaths||Ra(e.files),t=[],n=0;n<r.length;++n)r[n].slice(-1)!="/"&&t.push(r[n].replace(/^Root Entry[\/]/,""));return t.sort()}function p3(e,r,t){if(e.FullPaths){if(typeof t=="string"){var n;return It?n=gi(t):n=N4(t),Pt.utils.cfb_add(e,r,n)}Pt.utils.cfb_add(e,r,t)}else e.file(r,t)}function mv(e,r){switch(r.type){case"base64":return Pt.read(e,{type:"base64"});case"binary":return Pt.read(e,{type:"binary"});case"buffer":case"array":return Pt.read(e,{type:"buffer"})}throw new Error("Unrecognized type "+r.type)}function Do(e,r){if(e.charAt(0)=="/")return e.slice(1);var t=r.split("/");r.slice(-1)!="/"&&t.pop();for(var n=e.split("/");n.length!==0;){var s=n.shift();s===".."?t.pop():s!=="."&&t.push(s)}return t.join("/")}var pv=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,x3=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,Fp=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,g3=/<[^>]*>/g,pn=pv.match(Fp)?Fp:g3,y3=/<\w*:/,v3=/<(\/?)\w+:/;function ut(e,r,t){for(var n={},s=0,i=0;s!==e.length&&!((i=e.charCodeAt(s))===32||i===10||i===13);++s);if(r||(n[0]=e.slice(0,s)),s===e.length)return n;var o=e.match(x3),l=0,c="",d=0,u="",f="",h=1;if(o)for(d=0;d!=o.length;++d){for(f=o[d],i=0;i!=f.length&&f.charCodeAt(i)!==61;++i);for(u=f.slice(0,i).trim();f.charCodeAt(i+1)==32;)++i;for(h=(s=f.charCodeAt(i+1))==34||s==39?1:0,c=f.slice(i+1+h,f.length-h),l=0;l!=u.length&&u.charCodeAt(l)!==58;++l);if(l===u.length)u.indexOf("_")>0&&(u=u.slice(0,u.indexOf("_"))),n[u]=c,t||(n[u.toLowerCase()]=c);else{var x=(l===5&&u.slice(0,5)==="xmlns"?"xmlns":"")+u.slice(l+1);if(n[x]&&u.slice(l-3,l)=="ext")continue;n[x]=c,t||(n[x.toLowerCase()]=c)}}return n}function La(e){return e.replace(v3,"<$1")}var xv={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},b3=Gh(xv),Ot=function(){var e=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,r=/_x([\da-fA-F]{4})_/ig;return function t(n){var s=n+"",i=s.indexOf("<![CDATA[");if(i==-1)return s.replace(e,function(l,c){return xv[l]||String.fromCharCode(parseInt(c,l.indexOf("x")>-1?16:10))||l}).replace(r,function(l,c){return String.fromCharCode(parseInt(c,16))});var o=s.indexOf("]]>");return t(s.slice(0,i))+s.slice(i+9,o)+t(s.slice(o+3))}}(),S3=/[&<>'"]/g,w3=/[\u0000-\u001f]/g;function Xh(e){var r=e+"";return r.replace(S3,function(t){return b3[t]}).replace(/\n/g,"<br/>").replace(w3,function(t){return"&#x"+("000"+t.charCodeAt(0).toString(16)).slice(-4)+";"})}var Mp=function(){var e=/&#(\d+);/g;function r(t,n){return String.fromCharCode(parseInt(n,10))}return function(n){return n.replace(e,r)}}();function hr(e){switch(e){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function eu(e){for(var r="",t=0,n=0,s=0,i=0,o=0,l=0;t<e.length;){if(n=e.charCodeAt(t++),n<128){r+=String.fromCharCode(n);continue}if(s=e.charCodeAt(t++),n>191&&n<224){o=(n&31)<<6,o|=s&63,r+=String.fromCharCode(o);continue}if(i=e.charCodeAt(t++),n<240){r+=String.fromCharCode((n&15)<<12|(s&63)<<6|i&63);continue}o=e.charCodeAt(t++),l=((n&7)<<18|(s&63)<<12|(i&63)<<6|o&63)-65536,r+=String.fromCharCode(55296+(l>>>10&1023)),r+=String.fromCharCode(56320+(l&1023))}return r}function Pp(e){var r=As(2*e.length),t,n,s=1,i=0,o=0,l;for(n=0;n<e.length;n+=s)s=1,(l=e.charCodeAt(n))<128?t=l:l<224?(t=(l&31)*64+(e.charCodeAt(n+1)&63),s=2):l<240?(t=(l&15)*4096+(e.charCodeAt(n+1)&63)*64+(e.charCodeAt(n+2)&63),s=3):(s=4,t=(l&7)*262144+(e.charCodeAt(n+1)&63)*4096+(e.charCodeAt(n+2)&63)*64+(e.charCodeAt(n+3)&63),t-=65536,o=55296+(t>>>10&1023),t=56320+(t&1023)),o!==0&&(r[i++]=o&255,r[i++]=o>>>8,o=0),r[i++]=t%256,r[i++]=t>>>8;return r.slice(0,i).toString("ucs2")}function Np(e){return gi(e,"binary").toString("utf8")}var Yl="foo bar baz√¢¬ò¬É√∞¬ü¬ç¬£",sr=It&&(Np(Yl)==eu(Yl)&&Np||Pp(Yl)==eu(Yl)&&Pp)||eu,_o=It?function(e){return gi(e,"utf8").toString("binary")}:function(e){for(var r=[],t=0,n=0,s=0;t<e.length;)switch(n=e.charCodeAt(t++),!0){case n<128:r.push(String.fromCharCode(n));break;case n<2048:r.push(String.fromCharCode(192+(n>>6))),r.push(String.fromCharCode(128+(n&63)));break;case(n>=55296&&n<57344):n-=55296,s=e.charCodeAt(t++)-56320+(n<<10),r.push(String.fromCharCode(240+(s>>18&7))),r.push(String.fromCharCode(144+(s>>12&63))),r.push(String.fromCharCode(128+(s>>6&63))),r.push(String.fromCharCode(128+(s&63)));break;default:r.push(String.fromCharCode(224+(n>>12))),r.push(String.fromCharCode(128+(n>>6&63))),r.push(String.fromCharCode(128+(n&63)))}return r.join("")},al=function(){var e={};return function(t,n){var s=t+"|"+(n||"");return e[s]?e[s]:e[s]=new RegExp("<(?:\\w+:)?"+t+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+t+">",n||"")}}(),gv=function(){var e=[["nbsp"," "],["middot","¬∑"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(r){return[new RegExp("&"+r[0]+";","ig"),r[1]]});return function(t){for(var n=t.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),s=0;s<e.length;++s)n=n.replace(e[s][0],e[s][1]);return n}}(),j3=function(){var e={};return function(t){return e[t]!==void 0?e[t]:e[t]=new RegExp("<(?:vt:)?"+t+">([\\s\\S]*?)</(?:vt:)?"+t+">","g")}}(),E3=/<\/?(?:vt:)?variant>/g,k3=/<(?:vt:)([^>]*)>([\s\S]*)</;function Rp(e,r){var t=ut(e),n=e.match(j3(t.baseType))||[],s=[];if(n.length!=t.size){if(r.WTF)throw new Error("unexpected vector length "+n.length+" != "+t.size);return s}return n.forEach(function(i){var o=i.replace(E3,"").match(k3);o&&s.push({v:sr(o[2]),t:o[1]})}),s}var A3=/(^\s|\s$|\n)/;function T3(e){return Ra(e).map(function(r){return" "+r+'="'+e[r]+'"'}).join("")}function C3(e,r,t){return"<"+e+(t!=null?T3(t):"")+(r!=null?(r.match(A3)?' xml:space="preserve"':"")+">"+r+"</"+e:"/")+">"}function Kh(e){if(It&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e=="string")return e;if(typeof Uint8Array<"u"&&e instanceof Uint8Array)return sr(yi(Hh(e)));throw new Error("Bad input format: expected Buffer or string")}var sl=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,D3={CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/metadata/core-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/custom-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/extended-properties",CT:"http://schemas.openxmlformats.org/package/2006/content-types",RELS:"http://schemas.openxmlformats.org/package/2006/relationships",TCMNT:"http://schemas.microsoft.com/office/spreadsheetml/2018/threadedcomments",dc:"http://purl.org/dc/elements/1.1/",dcterms:"http://purl.org/dc/terms/",dcmitype:"http://purl.org/dc/dcmitype/",mx:"http://schemas.microsoft.com/office/mac/excel/2008/main",r:"http://schemas.openxmlformats.org/officeDocument/2006/relationships",sjs:"http://schemas.openxmlformats.org/package/2006/sheetjs/core-properties",vt:"http://schemas.openxmlformats.org/officeDocument/2006/docPropsVTypes",xsi:"http://www.w3.org/2001/XMLSchema-instance",xsd:"http://www.w3.org/2001/XMLSchema"},_3=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function I3(e,r){for(var t=1-2*(e[r+7]>>>7),n=((e[r+7]&127)<<4)+(e[r+6]>>>4&15),s=e[r+6]&15,i=5;i>=0;--i)s=s*256+e[r+i];return n==2047?s==0?t*(1/0):NaN:(n==0?n=-1022:(n-=1023,s+=Math.pow(2,52)),t*Math.pow(2,n-52)*s)}function F3(e,r,t){var n=(r<0||1/r==-1/0?1:0)<<7,s=0,i=0,o=n?-r:r;isFinite(o)?o==0?s=i=0:(s=Math.floor(Math.log(o)/Math.LN2),i=o*Math.pow(2,52-s),s<=-1023&&(!isFinite(i)||i<Math.pow(2,52))?s=-1022:(i-=Math.pow(2,52),s+=1023)):(s=2047,i=isNaN(r)?26985:0);for(var l=0;l<=5;++l,i/=256)e[t+l]=i&255;e[t+6]=(s&15)<<4|i&15,e[t+7]=s>>4|n}var Op=function(e){for(var r=[],t=10240,n=0;n<e[0].length;++n)if(e[0][n])for(var s=0,i=e[0][n].length;s<i;s+=t)r.push.apply(r,e[0][n].slice(s,s+t));return r},Lp=It?function(e){return e[0].length>0&&Buffer.isBuffer(e[0][0])?Buffer.concat(e[0].map(function(r){return Buffer.isBuffer(r)?r:gi(r)})):Op(e)}:Op,$p=function(e,r,t){for(var n=[],s=r;s<t;s+=2)n.push(String.fromCharCode(Ya(e,s)));return n.join("").replace(En,"")},Jh=It?function(e,r,t){return Buffer.isBuffer(e)?e.toString("utf16le",r,t).replace(En,""):$p(e,r,t)}:$p,Bp=function(e,r,t){for(var n=[],s=r;s<r+t;++s)n.push(("0"+e[s].toString(16)).slice(-2));return n.join("")},yv=It?function(e,r,t){return Buffer.isBuffer(e)?e.toString("hex",r,r+t):Bp(e,r,t)}:Bp,Up=function(e,r,t){for(var n=[],s=r;s<t;s++)n.push(String.fromCharCode(_i(e,s)));return n.join("")},wl=It?function(r,t,n){return Buffer.isBuffer(r)?r.toString("utf8",t,n):Up(r,t,n)}:Up,vv=function(e,r){var t=Yn(e,r);return t>0?wl(e,r+4,r+4+t-1):""},bv=vv,Sv=function(e,r){var t=Yn(e,r);return t>0?wl(e,r+4,r+4+t-1):""},wv=Sv,jv=function(e,r){var t=2*Yn(e,r);return t>0?wl(e,r+4,r+4+t-1):""},Ev=jv,kv=function(r,t){var n=Yn(r,t);return n>0?Jh(r,t+4,t+4+n):""},Av=kv,Tv=function(e,r){var t=Yn(e,r);return t>0?wl(e,r+4,r+4+t):""},Cv=Tv,Dv=function(e,r){return I3(e,r)},_c=Dv,_v=function(r){return Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array};It&&(bv=function(r,t){if(!Buffer.isBuffer(r))return vv(r,t);var n=r.readUInt32LE(t);return n>0?r.toString("utf8",t+4,t+4+n-1):""},wv=function(r,t){if(!Buffer.isBuffer(r))return Sv(r,t);var n=r.readUInt32LE(t);return n>0?r.toString("utf8",t+4,t+4+n-1):""},Ev=function(r,t){if(!Buffer.isBuffer(r))return jv(r,t);var n=2*r.readUInt32LE(t);return r.toString("utf16le",t+4,t+4+n-1)},Av=function(r,t){if(!Buffer.isBuffer(r))return kv(r,t);var n=r.readUInt32LE(t);return r.toString("utf16le",t+4,t+4+n)},Cv=function(r,t){if(!Buffer.isBuffer(r))return Tv(r,t);var n=r.readUInt32LE(t);return r.toString("utf8",t+4,t+4+n)},_c=function(r,t){return Buffer.isBuffer(r)?r.readDoubleLE(t):Dv(r,t)},_v=function(r){return Buffer.isBuffer(r)||Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array});var _i=function(e,r){return e[r]},Ya=function(e,r){return e[r+1]*256+e[r]},M3=function(e,r){var t=e[r+1]*256+e[r];return t<32768?t:(65535-t+1)*-1},Yn=function(e,r){return e[r+3]*(1<<24)+(e[r+2]<<16)+(e[r+1]<<8)+e[r]},zs=function(e,r){return e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]},P3=function(e,r){return e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3]};function Oo(e,r){var t="",n,s,i=[],o,l,c,d;switch(r){case"dbcs":if(d=this.l,It&&Buffer.isBuffer(this))t=this.slice(this.l,this.l+2*e).toString("utf16le");else for(c=0;c<e;++c)t+=String.fromCharCode(Ya(this,d)),d+=2;e*=2;break;case"utf8":t=wl(this,this.l,this.l+e);break;case"utf16le":e*=2,t=Jh(this,this.l,this.l+e);break;case"wstr":return Oo.call(this,e,"dbcs");case"lpstr-ansi":t=bv(this,this.l),e=4+Yn(this,this.l);break;case"lpstr-cp":t=wv(this,this.l),e=4+Yn(this,this.l);break;case"lpwstr":t=Ev(this,this.l),e=4+2*Yn(this,this.l);break;case"lpp4":e=4+Yn(this,this.l),t=Av(this,this.l),e&2&&(e+=2);break;case"8lpp4":e=4+Yn(this,this.l),t=Cv(this,this.l),e&3&&(e+=4-(e&3));break;case"cstr":for(e=0,t="";(o=_i(this,this.l+e++))!==0;)i.push(Hl(o));t=i.join("");break;case"_wstr":for(e=0,t="";(o=Ya(this,this.l+e))!==0;)i.push(Hl(o)),e+=2;e+=2,t=i.join("");break;case"dbcs-cont":for(t="",d=this.l,c=0;c<e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return o=_i(this,d),this.l=d+1,l=Oo.call(this,e-c,o?"dbcs-cont":"sbcs-cont"),i.join("")+l;i.push(Hl(Ya(this,d))),d+=2}t=i.join(""),e*=2;break;case"cpstr":case"sbcs-cont":for(t="",d=this.l,c=0;c!=e;++c){if(this.lens&&this.lens.indexOf(d)!==-1)return o=_i(this,d),this.l=d+1,l=Oo.call(this,e-c,o?"dbcs-cont":"sbcs-cont"),i.join("")+l;i.push(Hl(_i(this,d))),d+=1}t=i.join("");break;default:switch(e){case 1:return n=_i(this,this.l),this.l++,n;case 2:return n=(r==="i"?M3:Ya)(this,this.l),this.l+=2,n;case 4:case-4:return r==="i"||!(this[this.l+3]&128)?(n=(e>0?zs:P3)(this,this.l),this.l+=4,n):(s=Yn(this,this.l),this.l+=4,s);case 8:case-8:if(r==="f")return e==8?s=_c(this,this.l):s=_c([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,s;e=8;case 16:t=yv(this,this.l,e);break}}return this.l+=e,t}var N3=function(e,r,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24&255},R3=function(e,r,t){e[t]=r&255,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255},O3=function(e,r,t){e[t]=r&255,e[t+1]=r>>>8&255};function L3(e,r,t){var n=0,s=0;if(t==="dbcs"){for(s=0;s!=r.length;++s)O3(this,r.charCodeAt(s),this.l+2*s);n=2*r.length}else if(t==="sbcs"){for(r=r.replace(/[^\x00-\x7F]/g,"_"),s=0;s!=r.length;++s)this[this.l+s]=r.charCodeAt(s)&255;n=r.length}else if(t==="hex"){for(;s<e;++s)this[this.l++]=parseInt(r.slice(2*s,2*s+2),16)||0;return this}else if(t==="utf16le"){var i=Math.min(this.l+e,this.length);for(s=0;s<Math.min(r.length,e);++s){var o=r.charCodeAt(s);this[this.l++]=o&255,this[this.l++]=o>>8}for(;this.l<i;)this[this.l++]=0;return this}else switch(e){case 1:n=1,this[this.l]=r&255;break;case 2:n=2,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255;break;case 3:n=3,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255,r>>>=8,this[this.l+2]=r&255;break;case 4:n=4,N3(this,r,this.l);break;case 8:if(n=8,t==="f"){F3(this,r,this.l);break}case 16:break;case-4:n=4,R3(this,r,this.l);break}return this.l+=n,this}function Iv(e,r){var t=yv(this,this.l,e.length>>1);if(t!==e)throw new Error(r+"Expected "+e+" saw "+t);this.l+=e.length>>1}function Jr(e,r){e.l=r,e.read_shift=Oo,e.chk=Iv,e.write_shift=L3}function mn(e,r){e.l+=r}function Or(e){var r=As(e);return Jr(r,0),r}function ns(e,r,t){if(e){var n,s,i;Jr(e,e.l||0);for(var o=e.length,l=0,c=0;e.l<o;){l=e.read_shift(1),l&128&&(l=(l&127)+((e.read_shift(1)&127)<<7));var d=Rc[l]||Rc[65535];for(n=e.read_shift(1),i=n&127,s=1;s<4&&n&128;++s)i+=((n=e.read_shift(1))&127)<<7*s;c=e.l+i;var u=d.f&&d.f(e,i,t);if(e.l=c,r(u,d,l))return}}}function Wu(){var e=[],r=It?256:2048,t=function(d){var u=Or(d);return Jr(u,0),u},n=t(r),s=function(){n&&(n.length>n.l&&(n=n.slice(0,n.l),n.l=n.length),n.length>0&&e.push(n),n=null)},i=function(d){return n&&d<n.length-n.l?n:(s(),n=t(Math.max(d+1,r)))},o=function(){return s(),ms(e)},l=function(d){s(),n=d,n.l==null&&(n.l=n.length),i(r)};return{next:i,push:l,end:o,_bufs:e}}function Lo(e,r,t){var n=Zr(e);if(r.s?(n.cRel&&(n.c+=r.s.c),n.rRel&&(n.r+=r.s.r)):(n.cRel&&(n.c+=r.c),n.rRel&&(n.r+=r.r)),!t||t.biff<12){for(;n.c>=256;)n.c-=256;for(;n.r>=65536;)n.r-=65536}return n}function Vp(e,r,t){var n=Zr(e);return n.s=Lo(n.s,r.s,t),n.e=Lo(n.e,r.s,t),n}function $o(e,r){if(e.cRel&&e.c<0)for(e=Zr(e);e.c<0;)e.c+=r>8?16384:256;if(e.rRel&&e.r<0)for(e=Zr(e);e.r<0;)e.r+=r>8?1048576:r>5?65536:16384;var t=gt(e);return!e.cRel&&e.cRel!=null&&(t=U3(t)),!e.rRel&&e.rRel!=null&&(t=$3(t)),t}function tu(e,r){return e.s.r==0&&!e.s.rRel&&e.e.r==(r.biff>=12?1048575:r.biff>=8?65536:16384)&&!e.e.rRel?(e.s.cRel?"":"$")+Lr(e.s.c)+":"+(e.e.cRel?"":"$")+Lr(e.e.c):e.s.c==0&&!e.s.cRel&&e.e.c==(r.biff>=12?16383:255)&&!e.e.cRel?(e.s.rRel?"":"$")+en(e.s.r)+":"+(e.e.rRel?"":"$")+en(e.e.r):$o(e.s,r.biff)+":"+$o(e.e,r.biff)}function Qh(e){return parseInt(B3(e),10)-1}function en(e){return""+(e+1)}function $3(e){return e.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function B3(e){return e.replace(/\$(\d+)$/,"$1")}function Zh(e){for(var r=V3(e),t=0,n=0;n!==r.length;++n)t=26*t+r.charCodeAt(n)-64;return t-1}function Lr(e){if(e<0)throw new Error("invalid column "+e);var r="";for(++e;e;e=Math.floor((e-1)/26))r=String.fromCharCode((e-1)%26+65)+r;return r}function U3(e){return e.replace(/^([A-Z])/,"$$$1")}function V3(e){return e.replace(/^\$([A-Z])/,"$1")}function W3(e){return e.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function wn(e){for(var r=0,t=0,n=0;n<e.length;++n){var s=e.charCodeAt(n);s>=48&&s<=57?r=10*r+(s-48):s>=65&&s<=90&&(t=26*t+(s-64))}return{c:t-1,r:r-1}}function gt(e){for(var r=e.c+1,t="";r;r=(r-1)/26|0)t=String.fromCharCode((r-1)%26+65)+t;return t+(e.r+1)}function so(e){var r=e.indexOf(":");return r==-1?{s:wn(e),e:wn(e)}:{s:wn(e.slice(0,r)),e:wn(e.slice(r+1))}}function Nt(e,r){return typeof r>"u"||typeof r=="number"?Nt(e.s,e.e):(typeof e!="string"&&(e=gt(e)),typeof r!="string"&&(r=gt(r)),e==r?e:e+":"+r)}function Sr(e){var r={s:{c:0,r:0},e:{c:0,r:0}},t=0,n=0,s=0,i=e.length;for(t=0;n<i&&!((s=e.charCodeAt(n)-64)<1||s>26);++n)t=26*t+s;for(r.s.c=--t,t=0;n<i&&!((s=e.charCodeAt(n)-48)<0||s>9);++n)t=10*t+s;if(r.s.r=--t,n===i||s!=10)return r.e.c=r.s.c,r.e.r=r.s.r,r;for(++n,t=0;n!=i&&!((s=e.charCodeAt(n)-64)<1||s>26);++n)t=26*t+s;for(r.e.c=--t,t=0;n!=i&&!((s=e.charCodeAt(n)-48)<0||s>9);++n)t=10*t+s;return r.e.r=--t,r}function Wp(e,r){var t=e.t=="d"&&r instanceof Date;if(e.z!=null)try{return e.w=sa(e.z,t?kn(r):r)}catch{}try{return e.w=sa((e.XF||{}).numFmtId||(t?14:0),t?kn(r):r)}catch{return""+r}}function Ja(e,r,t){return e==null||e.t==null||e.t=="z"?"":e.w!==void 0?e.w:(e.t=="d"&&!e.z&&t&&t.dateNF&&(e.z=t.dateNF),e.t=="e"?Si[e.v]||e.v:r==null?Wp(e,e.v):Wp(e,r))}function Fs(e,r){var t=r&&r.sheet?r.sheet:"Sheet1",n={};return n[t]=e,{SheetNames:[t],Sheets:n}}function Fv(e,r,t){var n=t||{},s=e?Array.isArray(e):n.dense,i=e||(s?[]:{}),o=0,l=0;if(i&&n.origin!=null){if(typeof n.origin=="number")o=n.origin;else{var c=typeof n.origin=="string"?wn(n.origin):n.origin;o=c.r,l=c.c}i["!ref"]||(i["!ref"]="A1:A1")}var d={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(i["!ref"]){var u=Sr(i["!ref"]);d.s.c=u.s.c,d.s.r=u.s.r,d.e.c=Math.max(d.e.c,u.e.c),d.e.r=Math.max(d.e.r,u.e.r),o==-1&&(d.e.r=o=u.e.r+1)}for(var f=0;f!=r.length;++f)if(r[f]){if(!Array.isArray(r[f]))throw new Error("aoa_to_sheet expects an array of arrays");for(var h=0;h!=r[f].length;++h)if(!(typeof r[f][h]>"u")){var x={v:r[f][h]},m=o+f,g=l+h;if(d.s.r>m&&(d.s.r=m),d.s.c>g&&(d.s.c=g),d.e.r<m&&(d.e.r=m),d.e.c<g&&(d.e.c=g),r[f][h]&&typeof r[f][h]=="object"&&!Array.isArray(r[f][h])&&!(r[f][h]instanceof Date))x=r[f][h];else if(Array.isArray(x.v)&&(x.f=r[f][h][1],x.v=x.v[0]),x.v===null)if(x.f)x.t="n";else if(n.nullError)x.t="e",x.v=0;else if(n.sheetStubs)x.t="z";else continue;else typeof x.v=="number"?x.t="n":typeof x.v=="boolean"?x.t="b":x.v instanceof Date?(x.z=n.dateNF||bt[14],n.cellDates?(x.t="d",x.w=sa(x.z,kn(x.v))):(x.t="n",x.v=kn(x.v),x.w=sa(x.z,x.v))):x.t="s";if(s)i[m]||(i[m]=[]),i[m][g]&&i[m][g].z&&(x.z=i[m][g].z),i[m][g]=x;else{var p=gt({c:g,r:m});i[p]&&i[p].z&&(x.z=i[p].z),i[p]=x}}}return d.s.c<1e7&&(i["!ref"]=Nt(d)),i}function io(e,r){return Fv(null,e,r)}function H3(e){return e.read_shift(4,"i")}function hn(e){var r=e.read_shift(4);return r===0?"":e.read_shift(r,"dbcs")}function Y3(e){return{ich:e.read_shift(2),ifnt:e.read_shift(2)}}function e0(e,r){var t=e.l,n=e.read_shift(1),s=hn(e),i=[],o={t:s,h:s};if(n&1){for(var l=e.read_shift(4),c=0;c!=l;++c)i.push(Y3(e));o.r=i}else o.r=[{ich:0,ifnt:0}];return e.l=t+r,o}var z3=e0;function ia(e){var r=e.read_shift(4),t=e.read_shift(2);return t+=e.read_shift(1)<<16,e.l++,{c:r,iStyleRef:t}}function vi(e){var r=e.read_shift(2);return r+=e.read_shift(1)<<16,e.l++,{c:-1,iStyleRef:r}}var G3=hn;function t0(e){var r=e.read_shift(4);return r===0||r===4294967295?"":e.read_shift(r,"dbcs")}var q3=hn,Hu=t0;function r0(e){var r=e.slice(e.l,e.l+4),t=r[0]&1,n=r[0]&2;e.l+=4;var s=n===0?_c([0,0,0,0,r[0]&252,r[1],r[2],r[3]],0):zs(r,0)>>2;return t?s/100:s}function Mv(e){var r={s:{},e:{}};return r.s.r=e.read_shift(4),r.e.r=e.read_shift(4),r.s.c=e.read_shift(4),r.e.c=e.read_shift(4),r}var bi=Mv;function dn(e){if(e.length-e.l<8)throw"XLS Xnum Buffer underflow";return e.read_shift(8,"f")}function X3(e){var r={},t=e.read_shift(1),n=t>>>1,s=e.read_shift(1),i=e.read_shift(2,"i"),o=e.read_shift(1),l=e.read_shift(1),c=e.read_shift(1);switch(e.l++,n){case 0:r.auto=1;break;case 1:r.index=s;var d=Qs[s];d&&(r.rgb=ol(d));break;case 2:r.rgb=ol([o,l,c]);break;case 3:r.theme=s;break}return i!=0&&(r.tint=i>0?i/32767:i/32768),r}function K3(e){var r=e.read_shift(1);e.l++;var t={fBold:r&1,fItalic:r&2,fUnderline:r&4,fStrikeout:r&8,fOutline:r&16,fShadow:r&32,fCondense:r&64,fExtend:r&128};return t}function Pv(e,r){var t={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},n=e.read_shift(4);switch(n){case 0:return"";case 4294967295:case 4294967294:return t[e.read_shift(4)]||""}if(n>400)throw new Error("Unsupported Clipboard: "+n.toString(16));return e.l-=4,e.read_shift(0,r==1?"lpstr":"lpwstr")}function J3(e){return Pv(e,1)}function Q3(e){return Pv(e,2)}var n0=2,_n=3,zl=11,Hp=12,Ic=19,Gl=64,Z3=65,eL=71,tL=4108,rL=4126,Yr=80,Nv=81,nL=[Yr,Nv],aL={1:{n:"CodePage",t:n0},2:{n:"Category",t:Yr},3:{n:"PresentationFormat",t:Yr},4:{n:"ByteCount",t:_n},5:{n:"LineCount",t:_n},6:{n:"ParagraphCount",t:_n},7:{n:"SlideCount",t:_n},8:{n:"NoteCount",t:_n},9:{n:"HiddenCount",t:_n},10:{n:"MultimediaClipCount",t:_n},11:{n:"ScaleCrop",t:zl},12:{n:"HeadingPairs",t:tL},13:{n:"TitlesOfParts",t:rL},14:{n:"Manager",t:Yr},15:{n:"Company",t:Yr},16:{n:"LinksUpToDate",t:zl},17:{n:"CharacterCount",t:_n},19:{n:"SharedDoc",t:zl},22:{n:"HyperlinksChanged",t:zl},23:{n:"AppVersion",t:_n,p:"version"},24:{n:"DigSig",t:Z3},26:{n:"ContentType",t:Yr},27:{n:"ContentStatus",t:Yr},28:{n:"Language",t:Yr},29:{n:"Version",t:Yr},255:{},2147483648:{n:"Locale",t:Ic},2147483651:{n:"Behavior",t:Ic},1919054434:{}},sL={1:{n:"CodePage",t:n0},2:{n:"Title",t:Yr},3:{n:"Subject",t:Yr},4:{n:"Author",t:Yr},5:{n:"Keywords",t:Yr},6:{n:"Comments",t:Yr},7:{n:"Template",t:Yr},8:{n:"LastAuthor",t:Yr},9:{n:"RevNumber",t:Yr},10:{n:"EditTime",t:Gl},11:{n:"LastPrinted",t:Gl},12:{n:"CreatedDate",t:Gl},13:{n:"ModifiedDate",t:Gl},14:{n:"PageCount",t:_n},15:{n:"WordCount",t:_n},16:{n:"CharCount",t:_n},17:{n:"Thumbnail",t:eL},18:{n:"Application",t:Yr},19:{n:"DocSecurity",t:_n},255:{},2147483648:{n:"Locale",t:Ic},2147483651:{n:"Behavior",t:Ic},1919054434:{}},Yp={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},iL=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function oL(e){return e.map(function(r){return[r>>16&255,r>>8&255,r&255]})}var lL=oL([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Qs=Zr(lL),Si={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},Rv={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},zp={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function cL(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function dL(e){var r=cL();if(!e||!e.match)return r;var t={};if((e.match(pn)||[]).forEach(function(n){var s=ut(n);switch(s[0].replace(y3,"<")){case"<?xml":break;case"<Types":r.xmlns=s["xmlns"+(s[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":t[s.Extension]=s.ContentType;break;case"<Override":r[zp[s.ContentType]]!==void 0&&r[zp[s.ContentType]].push(s.PartName);break}}),r.xmlns!==D3.CT)throw new Error("Unknown Namespace: "+r.xmlns);return r.calcchain=r.calcchains.length>0?r.calcchains[0]:"",r.sst=r.strs.length>0?r.strs[0]:"",r.style=r.styles.length>0?r.styles[0]:"",r.defaults=t,delete r.calcchains,r}var Mi={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function Yu(e){var r=e.lastIndexOf("/");return e.slice(0,r+1)+"_rels/"+e.slice(r+1)+".rels"}function Bo(e,r){var t={"!id":{}};if(!e)return t;r.charAt(0)!=="/"&&(r="/"+r);var n={};return(e.match(pn)||[]).forEach(function(s){var i=ut(s);if(i[0]==="<Relationship"){var o={};o.Type=i.Type,o.Target=i.Target,o.Id=i.Id,i.TargetMode&&(o.TargetMode=i.TargetMode);var l=i.TargetMode==="External"?i.Target:Do(i.Target,r);t[l]=o,n[i.Id]=o}}),t["!id"]=n,t}var uL="application/vnd.oasis.opendocument.spreadsheet";function fL(e,r){for(var t=Kh(e),n,s;n=sl.exec(t);)switch(n[3]){case"manifest":break;case"file-entry":if(s=ut(n[0],!1),s.path=="/"&&s.type!==uL)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(r&&r.WTF)throw n}}var Uo=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],hL=function(){for(var e=new Array(Uo.length),r=0;r<Uo.length;++r){var t=Uo[r],n="(?:"+t[0].slice(0,t[0].indexOf(":"))+":)"+t[0].slice(t[0].indexOf(":")+1);e[r]=new RegExp("<"+n+"[^>]*>([\\s\\S]*?)</"+n+">")}return e}();function Ov(e){var r={};e=sr(e);for(var t=0;t<Uo.length;++t){var n=Uo[t],s=e.match(hL[t]);s!=null&&s.length>0&&(r[n[1]]=Ot(s[1])),n[2]==="date"&&r[n[1]]&&(r[n[1]]=Xr(r[n[1]]))}return r}var mL=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function Lv(e,r,t,n){var s=[];if(typeof e=="string")s=Rp(e,n);else for(var i=0;i<e.length;++i)s=s.concat(e[i].map(function(u){return{v:u}}));var o=typeof r=="string"?Rp(r,n).map(function(u){return u.v}):r,l=0,c=0;if(o.length>0)for(var d=0;d!==s.length;d+=2){switch(c=+s[d+1].v,s[d].v){case"Worksheets":case"Â∑•‰ΩúË°®":case"–õ–∏—Å—Ç—ã":case"ÿ£Ÿàÿ±ÿßŸÇ ÿßŸÑÿπŸÖŸÑ":case"„ÉØ„Éº„ÇØ„Ç∑„Éº„Éà":case"◊í◊ú◊ô◊ï◊†◊ï◊™ ◊¢◊ë◊ï◊ì◊î":case"Arbeitsbl√§tter":case"√áalƒ±≈üma Sayfalarƒ±":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de c√°lculo":case"Planilhas":case"Regneark":case"Hojas de c√°lculo":case"Werkbladen":t.Worksheets=c,t.SheetNames=o.slice(l,l+c);break;case"Named Ranges":case"Rangos con nombre":case"ÂêçÂâç‰ªò„Åç‰∏ÄË¶ß":case"Benannte Bereiche":case"Navngivne omr√•der":t.NamedRanges=c,t.DefinedNames=o.slice(l,l+c);break;case"Charts":case"Diagramme":t.Chartsheets=c,t.ChartNames=o.slice(l,l+c);break}l+=c}}function pL(e,r,t){var n={};return r||(r={}),e=sr(e),mL.forEach(function(s){var i=(e.match(al(s[0]))||[])[1];switch(s[2]){case"string":i&&(r[s[1]]=Ot(i));break;case"bool":r[s[1]]=i==="true";break;case"raw":var o=e.match(new RegExp("<"+s[0]+"[^>]*>([\\s\\S]*?)</"+s[0]+">"));o&&o.length>0&&(n[s[1]]=o[1]);break}}),n.HeadingPairs&&n.TitlesOfParts&&Lv(n.HeadingPairs,n.TitlesOfParts,r,t),r}var xL=/<[^>]+>[^<]*/g;function gL(e,r){var t={},n="",s=e.match(xL);if(s)for(var i=0;i!=s.length;++i){var o=s[i],l=ut(o);switch(l[0]){case"<?xml":break;case"<Properties":break;case"<property":n=Ot(l.name);break;case"</property>":n=null;break;default:if(o.indexOf("<vt:")===0){var c=o.split(">"),d=c[0].slice(4),u=c[1];switch(d){case"lpstr":case"bstr":case"lpwstr":t[n]=Ot(u);break;case"bool":t[n]=hr(u);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":t[n]=parseInt(u,10);break;case"r4":case"r8":case"decimal":t[n]=parseFloat(u);break;case"filetime":case"date":t[n]=Xr(u);break;case"cy":case"error":t[n]=Ot(u);break;default:if(d.slice(-1)=="/")break;r.WTF&&typeof console<"u"&&console.warn("Unexpected",o,d,c)}}else if(o.slice(0,2)!=="</"){if(r.WTF)throw new Error(o)}}}return t}var yL={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},ru;function vL(e,r,t){ru||(ru=Gh(yL)),r=ru[r]||r,e[r]=t}function a0(e){var r=e.read_shift(4),t=e.read_shift(4);return new Date((t/1e7*Math.pow(2,32)+r/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function $v(e,r,t){var n=e.l,s=e.read_shift(0,"lpstr-cp");if(t)for(;e.l-n&3;)++e.l;return s}function Bv(e,r,t){var n=e.read_shift(0,"lpwstr");return t&&(e.l+=4-(n.length+1&3)&3),n}function Uv(e,r,t){return r===31?Bv(e):$v(e,r,t)}function zu(e,r,t){return Uv(e,r,t===!1?0:4)}function bL(e,r){if(!r)throw new Error("VtUnalignedString must have positive length");return Uv(e,r,0)}function SL(e){for(var r=e.read_shift(4),t=[],n=0;n!=r;++n){var s=e.l;t[n]=e.read_shift(0,"lpwstr").replace(En,""),e.l-s&2&&(e.l+=2)}return t}function wL(e){for(var r=e.read_shift(4),t=[],n=0;n!=r;++n)t[n]=e.read_shift(0,"lpstr-cp").replace(En,"");return t}function jL(e){var r=e.l,t=Fc(e,Nv);e[e.l]==0&&e[e.l+1]==0&&e.l-r&2&&(e.l+=2);var n=Fc(e,_n);return[t,n]}function EL(e){for(var r=e.read_shift(4),t=[],n=0;n<r/2;++n)t.push(jL(e));return t}function Gp(e,r){for(var t=e.read_shift(4),n={},s=0;s!=t;++s){var i=e.read_shift(4),o=e.read_shift(4);n[i]=e.read_shift(o,r===1200?"utf16le":"utf8").replace(En,"").replace(Co,"!"),r===1200&&o%2&&(e.l+=2)}return e.l&3&&(e.l=e.l>>2+1<<2),n}function Vv(e){var r=e.read_shift(4),t=e.slice(e.l,e.l+r);return e.l+=r,(r&3)>0&&(e.l+=4-(r&3)&3),t}function kL(e){var r={};return r.Size=e.read_shift(4),e.l+=r.Size+3-(r.Size-1)%4,r}function Fc(e,r,t){var n=e.read_shift(2),s,i=t||{};if(e.l+=2,r!==Hp&&n!==r&&nL.indexOf(r)===-1&&!((r&65534)==4126&&(n&65534)==4126))throw new Error("Expected type "+r+" saw "+n);switch(r===Hp?n:r){case 2:return s=e.read_shift(2,"i"),i.raw||(e.l+=2),s;case 3:return s=e.read_shift(4,"i"),s;case 11:return e.read_shift(4)!==0;case 19:return s=e.read_shift(4),s;case 30:return $v(e,n,4).replace(En,"");case 31:return Bv(e);case 64:return a0(e);case 65:return Vv(e);case 71:return kL(e);case 80:return zu(e,n,!i.raw).replace(En,"");case 81:return bL(e,n).replace(En,"");case 4108:return EL(e);case 4126:case 4127:return n==4127?SL(e):wL(e);default:throw new Error("TypedPropertyValue unrecognized type "+r+" "+n)}}function qp(e,r){var t=e.l,n=e.read_shift(4),s=e.read_shift(4),i=[],o=0,l=0,c=-1,d={};for(o=0;o!=s;++o){var u=e.read_shift(4),f=e.read_shift(4);i[o]=[u,f+t]}i.sort(function(S,v){return S[1]-v[1]});var h={};for(o=0;o!=s;++o){if(e.l!==i[o][1]){var x=!0;if(o>0&&r)switch(r[i[o-1][0]].t){case 2:e.l+2===i[o][1]&&(e.l+=2,x=!1);break;case 80:e.l<=i[o][1]&&(e.l=i[o][1],x=!1);break;case 4108:e.l<=i[o][1]&&(e.l=i[o][1],x=!1);break}if((!r||o==0)&&e.l<=i[o][1]&&(x=!1,e.l=i[o][1]),x)throw new Error("Read Error: Expected address "+i[o][1]+" at "+e.l+" :"+o)}if(r){var m=r[i[o][0]];if(h[m.n]=Fc(e,m.t,{raw:!0}),m.p==="version"&&(h[m.n]=String(h[m.n]>>16)+"."+("0000"+String(h[m.n]&65535)).slice(-4)),m.n=="CodePage")switch(h[m.n]){case 0:h[m.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:pa(l=h[m.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+h[m.n])}}else if(i[o][0]===1){if(l=h.CodePage=Fc(e,n0),pa(l),c!==-1){var g=e.l;e.l=i[c][1],d=Gp(e,l),e.l=g}}else if(i[o][0]===0){if(l===0){c=o,e.l=i[o+1][1];continue}d=Gp(e,l)}else{var p=d[i[o][0]],y;switch(e[e.l]){case 65:e.l+=4,y=Vv(e);break;case 30:e.l+=4,y=zu(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 31:e.l+=4,y=zu(e,e[e.l-4]).replace(/\u0000+$/,"");break;case 3:e.l+=4,y=e.read_shift(4,"i");break;case 19:e.l+=4,y=e.read_shift(4);break;case 5:e.l+=4,y=e.read_shift(8,"f");break;case 11:e.l+=4,y=kr(e,4);break;case 64:e.l+=4,y=Xr(a0(e));break;default:throw new Error("unparsed value: "+e[e.l])}h[p]=y}}return e.l=t+n,h}function Xp(e,r,t){var n=e.content;if(!n)return{};Jr(n,0);var s,i,o,l,c=0;n.chk("feff","Byte Order: "),n.read_shift(2);var d=n.read_shift(4),u=n.read_shift(16);if(u!==Pt.utils.consts.HEADER_CLSID&&u!==t)throw new Error("Bad PropertySet CLSID "+u);if(s=n.read_shift(4),s!==1&&s!==2)throw new Error("Unrecognized #Sets: "+s);if(i=n.read_shift(16),l=n.read_shift(4),s===1&&l!==n.l)throw new Error("Length mismatch: "+l+" !== "+n.l);s===2&&(o=n.read_shift(16),c=n.read_shift(4));var f=qp(n,r),h={SystemIdentifier:d};for(var x in f)h[x]=f[x];if(h.FMTID=i,s===1)return h;if(c-n.l==2&&(n.l+=2),n.l!==c)throw new Error("Length mismatch 2: "+n.l+" !== "+c);var m;try{m=qp(n,null)}catch{}for(x in m)h[x]=m[x];return h.FMTID=[i,o],h}function ls(e,r){return e.read_shift(r),null}function AL(e,r,t){for(var n=[],s=e.l+r;e.l<s;)n.push(t(e,s-e.l));if(s!==e.l)throw new Error("Slurp error");return n}function kr(e,r){return e.read_shift(r)===1}function Ir(e){return e.read_shift(2,"u")}function Wv(e,r){return AL(e,r,Ir)}function TL(e){var r=e.read_shift(1),t=e.read_shift(1);return t===1?r:r===1}function jl(e,r,t){var n=e.read_shift(t&&t.biff>=12?2:1),s="sbcs-cont";if(t&&t.biff>=8,!t||t.biff==8){var i=e.read_shift(1);i&&(s="dbcs-cont")}else t.biff==12&&(s="wstr");t.biff>=2&&t.biff<=5&&(s="cpstr");var o=n?e.read_shift(n,s):"";return o}function CL(e){var r=e.read_shift(2),t=e.read_shift(1),n=t&4,s=t&8,i=1+(t&1),o=0,l,c={};s&&(o=e.read_shift(2)),n&&(l=e.read_shift(4));var d=i==2?"dbcs-cont":"sbcs-cont",u=r===0?"":e.read_shift(r,d);return s&&(e.l+=4*o),n&&(e.l+=l),c.t=u,s||(c.raw="<t>"+c.t+"</t>",c.r=c.t),c}function oi(e,r,t){var n;if(t){if(t.biff>=2&&t.biff<=5)return e.read_shift(r,"cpstr");if(t.biff>=12)return e.read_shift(r,"dbcs-cont")}var s=e.read_shift(1);return s===0?n=e.read_shift(r,"sbcs-cont"):n=e.read_shift(r,"dbcs-cont"),n}function El(e,r,t){var n=e.read_shift(t&&t.biff==2?1:2);return n===0?(e.l++,""):oi(e,n,t)}function wi(e,r,t){if(t.biff>5)return El(e,r,t);var n=e.read_shift(1);return n===0?(e.l++,""):e.read_shift(n,t.biff<=4||!e.lens?"cpstr":"sbcs-cont")}function DL(e){var r=e.read_shift(1);e.l++;var t=e.read_shift(2);return e.l+=2,[r,t]}function _L(e){var r=e.read_shift(4),t=e.l,n=!1;r>24&&(e.l+=r-24,e.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(n=!0),e.l=t);var s=e.read_shift((n?r-24:r)>>1,"utf16le").replace(En,"");return n&&(e.l+=24),s}function IL(e){for(var r=e.read_shift(2),t="";r-- >0;)t+="../";var n=e.read_shift(0,"lpstr-ansi");if(e.l+=2,e.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var s=e.read_shift(4);if(s===0)return t+n.replace(/\\/g,"/");var i=e.read_shift(4);if(e.read_shift(2)!=3)throw new Error("Bad FileMoniker");var o=e.read_shift(i>>1,"utf16le").replace(En,"");return t+o}function FL(e,r){var t=e.read_shift(16);switch(t){case"e0c9ea79f9bace118c8200aa004ba90b":return _L(e);case"0303000000000000c000000000000046":return IL(e);default:throw new Error("Unsupported Moniker "+t)}}function ql(e){var r=e.read_shift(4),t=r>0?e.read_shift(r,"utf16le").replace(En,""):"";return t}function ML(e,r){var t=e.l+r,n=e.read_shift(4);if(n!==2)throw new Error("Unrecognized streamVersion: "+n);var s=e.read_shift(2);e.l+=2;var i,o,l,c,d="",u,f;s&16&&(i=ql(e,t-e.l)),s&128&&(o=ql(e,t-e.l)),(s&257)===257&&(l=ql(e,t-e.l)),(s&257)===1&&(c=FL(e,t-e.l)),s&8&&(d=ql(e,t-e.l)),s&32&&(u=e.read_shift(16)),s&64&&(f=a0(e)),e.l=t;var h=o||l||c||"";h&&d&&(h+="#"+d),h||(h="#"+d),s&2&&h.charAt(0)=="/"&&h.charAt(1)!="/"&&(h="file://"+h);var x={Target:h};return u&&(x.guid=u),f&&(x.time=f),i&&(x.Tooltip=i),x}function Hv(e){var r=e.read_shift(1),t=e.read_shift(1),n=e.read_shift(1),s=e.read_shift(1);return[r,t,n,s]}function Yv(e,r){var t=Hv(e);return t[3]=0,t}function $a(e){var r=e.read_shift(2),t=e.read_shift(2),n=e.read_shift(2);return{r,c:t,ixfe:n}}function PL(e){var r=e.read_shift(2),t=e.read_shift(2);return e.l+=8,{type:r,flags:t}}function NL(e,r,t){return r===0?"":wi(e,r,t)}function RL(e,r,t){var n=t.biff>8?4:2,s=e.read_shift(n),i=e.read_shift(n,"i"),o=e.read_shift(n,"i");return[s,i,o]}function zv(e){var r=e.read_shift(2),t=r0(e);return[r,t]}function OL(e,r,t){e.l+=4,r-=4;var n=e.l+r,s=jl(e,r,t),i=e.read_shift(2);if(n-=e.l,i!==n)throw new Error("Malformed AddinUdf: padding = "+n+" != "+i);return e.l+=i,s}function bd(e){var r=e.read_shift(2),t=e.read_shift(2),n=e.read_shift(2),s=e.read_shift(2);return{s:{c:n,r},e:{c:s,r:t}}}function Gv(e){var r=e.read_shift(2),t=e.read_shift(2),n=e.read_shift(1),s=e.read_shift(1);return{s:{c:n,r},e:{c:s,r:t}}}var LL=Gv;function qv(e){e.l+=4;var r=e.read_shift(2),t=e.read_shift(2),n=e.read_shift(2);return e.l+=12,[t,r,n]}function $L(e){var r={};return e.l+=4,e.l+=16,r.fSharedNote=e.read_shift(2),e.l+=4,r}function BL(e){var r={};return e.l+=4,e.cf=e.read_shift(2),r}function an(e){e.l+=2,e.l+=e.read_shift(2)}var UL={0:an,4:an,5:an,6:an,7:BL,8:an,9:an,10:an,11:an,12:an,13:$L,14:an,15:an,16:an,17:an,18:an,19:an,20:an,21:qv};function VL(e,r){for(var t=e.l+r,n=[];e.l<t;){var s=e.read_shift(2);e.l-=2;try{n.push(UL[s](e,t-e.l))}catch{return e.l=t,n}}return e.l!=t&&(e.l=t),n}function Xl(e,r){var t={BIFFVer:0,dt:0};switch(t.BIFFVer=e.read_shift(2),r-=2,r>=2&&(t.dt=e.read_shift(2),e.l-=2),t.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(r>6)throw new Error("Unexpected BIFF Ver "+t.BIFFVer)}return e.read_shift(r),t}function WL(e,r){return r===0||e.read_shift(2),1200}function HL(e,r,t){if(t.enc)return e.l+=r,"";var n=e.l,s=wi(e,0,t);return e.read_shift(r+n-e.l),s}function YL(e,r,t){var n=t&&t.biff==8||r==2?e.read_shift(2):(e.l+=r,0);return{fDialog:n&16,fBelow:n&64,fRight:n&128}}function zL(e,r,t){var n=e.read_shift(4),s=e.read_shift(1)&3,i=e.read_shift(1);switch(i){case 0:i="Worksheet";break;case 1:i="Macrosheet";break;case 2:i="Chartsheet";break;case 6:i="VBAModule";break}var o=jl(e,0,t);return o.length===0&&(o="Sheet1"),{pos:n,hs:s,dt:i,name:o}}function GL(e,r){for(var t=e.l+r,n=e.read_shift(4),s=e.read_shift(4),i=[],o=0;o!=s&&e.l<t;++o)i.push(CL(e));return i.Count=n,i.Unique=s,i}function qL(e,r){var t={};return t.dsst=e.read_shift(2),e.l+=r-2,t}function XL(e){var r={};r.r=e.read_shift(2),r.c=e.read_shift(2),r.cnt=e.read_shift(2)-r.c;var t=e.read_shift(2);e.l+=4;var n=e.read_shift(1);return e.l+=3,n&7&&(r.level=n&7),n&32&&(r.hidden=!0),n&64&&(r.hpt=t/20),r}function KL(e){var r=PL(e);if(r.type!=2211)throw new Error("Invalid Future Record "+r.type);var t=e.read_shift(4);return t!==0}function JL(e){return e.read_shift(2),e.read_shift(4)}function Kp(e,r,t){var n=0;t&&t.biff==2||(n=e.read_shift(2));var s=e.read_shift(2);t&&t.biff==2&&(n=1-(s>>15),s&=32767);var i={Unsynced:n&1,DyZero:(n&2)>>1,ExAsc:(n&4)>>2,ExDsc:(n&8)>>3};return[i,s]}function QL(e){var r=e.read_shift(2),t=e.read_shift(2),n=e.read_shift(2),s=e.read_shift(2),i=e.read_shift(2),o=e.read_shift(2),l=e.read_shift(2),c=e.read_shift(2),d=e.read_shift(2);return{Pos:[r,t],Dim:[n,s],Flags:i,CurTab:o,FirstTab:l,Selected:c,TabRatio:d}}function ZL(e,r,t){if(t&&t.biff>=2&&t.biff<5)return{};var n=e.read_shift(2);return{RTL:n&64}}function e6(){}function t6(e,r,t){var n={dyHeight:e.read_shift(2),fl:e.read_shift(2)};switch(t&&t.biff||8){case 2:break;case 3:case 4:e.l+=2;break;default:e.l+=10;break}return n.name=jl(e,0,t),n}function r6(e){var r=$a(e);return r.isst=e.read_shift(4),r}function n6(e,r,t){t.biffguess&&t.biff==2&&(t.biff=5);var n=e.l+r,s=$a(e);t.biff==2&&e.l++;var i=El(e,n-e.l,t);return s.val=i,s}function a6(e,r,t){var n=e.read_shift(2),s=wi(e,0,t);return[n,s]}var s6=wi;function Jp(e,r,t){var n=e.l+r,s=t.biff==8||!t.biff?4:2,i=e.read_shift(s),o=e.read_shift(s),l=e.read_shift(2),c=e.read_shift(2);return e.l=n,{s:{r:i,c:l},e:{r:o,c}}}function i6(e){var r=e.read_shift(2),t=e.read_shift(2),n=zv(e);return{r,c:t,ixfe:n[0],rknum:n[1]}}function o6(e,r){for(var t=e.l+r-2,n=e.read_shift(2),s=e.read_shift(2),i=[];e.l<t;)i.push(zv(e));if(e.l!==t)throw new Error("MulRK read error");var o=e.read_shift(2);if(i.length!=o-s+1)throw new Error("MulRK length mismatch");return{r:n,c:s,C:o,rkrec:i}}function l6(e,r){for(var t=e.l+r-2,n=e.read_shift(2),s=e.read_shift(2),i=[];e.l<t;)i.push(e.read_shift(2));if(e.l!==t)throw new Error("MulBlank read error");var o=e.read_shift(2);if(i.length!=o-s+1)throw new Error("MulBlank length mismatch");return{r:n,c:s,C:o,ixfe:i}}function c6(e,r,t,n){var s={},i=e.read_shift(4),o=e.read_shift(4),l=e.read_shift(4),c=e.read_shift(2);return s.patternType=iL[l>>26],n.cellStyles&&(s.alc=i&7,s.fWrap=i>>3&1,s.alcV=i>>4&7,s.fJustLast=i>>7&1,s.trot=i>>8&255,s.cIndent=i>>16&15,s.fShrinkToFit=i>>20&1,s.iReadOrder=i>>22&2,s.fAtrNum=i>>26&1,s.fAtrFnt=i>>27&1,s.fAtrAlc=i>>28&1,s.fAtrBdr=i>>29&1,s.fAtrPat=i>>30&1,s.fAtrProt=i>>31&1,s.dgLeft=o&15,s.dgRight=o>>4&15,s.dgTop=o>>8&15,s.dgBottom=o>>12&15,s.icvLeft=o>>16&127,s.icvRight=o>>23&127,s.grbitDiag=o>>30&3,s.icvTop=l&127,s.icvBottom=l>>7&127,s.icvDiag=l>>14&127,s.dgDiag=l>>21&15,s.icvFore=c&127,s.icvBack=c>>7&127,s.fsxButton=c>>14&1),s}function d6(e,r,t){var n={};return n.ifnt=e.read_shift(2),n.numFmtId=e.read_shift(2),n.flags=e.read_shift(2),n.fStyle=n.flags>>2&1,r-=6,n.data=c6(e,r,n.fStyle,t),n}function u6(e){e.l+=4;var r=[e.read_shift(2),e.read_shift(2)];if(r[0]!==0&&r[0]--,r[1]!==0&&r[1]--,r[0]>7||r[1]>7)throw new Error("Bad Gutters: "+r.join("|"));return r}function Qp(e,r,t){var n=$a(e);(t.biff==2||r==9)&&++e.l;var s=TL(e);return n.val=s,n.t=s===!0||s===!1?"b":"e",n}function f6(e,r,t){t.biffguess&&t.biff==2&&(t.biff=5);var n=$a(e),s=dn(e);return n.val=s,n}var Zp=NL;function h6(e,r,t){var n=e.l+r,s=e.read_shift(2),i=e.read_shift(2);if(t.sbcch=i,i==1025||i==14849)return[i,s];if(i<1||i>255)throw new Error("Unexpected SupBook type: "+i);for(var o=oi(e,i),l=[];n>e.l;)l.push(El(e));return[i,s,o,l]}function ex(e,r,t){var n=e.read_shift(2),s,i={fBuiltIn:n&1,fWantAdvise:n>>>1&1,fWantPict:n>>>2&1,fOle:n>>>3&1,fOleLink:n>>>4&1,cf:n>>>5&1023,fIcon:n>>>15&1};return t.sbcch===14849&&(s=OL(e,r-2,t)),i.body=s||e.read_shift(r-2),typeof s=="string"&&(i.Name=s),i}var m6=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function tx(e,r,t){var n=e.l+r,s=e.read_shift(2),i=e.read_shift(1),o=e.read_shift(1),l=e.read_shift(t&&t.biff==2?1:2),c=0;(!t||t.biff>=5)&&(t.biff!=5&&(e.l+=2),c=e.read_shift(2),t.biff==5&&(e.l+=2),e.l+=4);var d=oi(e,o,t);s&32&&(d=m6[d.charCodeAt(0)]);var u=n-e.l;t&&t.biff==2&&--u;var f=n==e.l||l===0||!(u>0)?[]:XB(e,u,t,l);return{chKey:i,Name:d,itab:c,rgce:f}}function Xv(e,r,t){if(t.biff<8)return p6(e,r,t);for(var n=[],s=e.l+r,i=e.read_shift(t.biff>8?4:2);i--!==0;)n.push(RL(e,t.biff>8?12:6,t));if(e.l!=s)throw new Error("Bad ExternSheet: "+e.l+" != "+s);return n}function p6(e,r,t){e[e.l+1]==3&&e[e.l]++;var n=jl(e,r,t);return n.charCodeAt(0)==3?n.slice(1):n}function x6(e,r,t){if(t.biff<8){e.l+=r;return}var n=e.read_shift(2),s=e.read_shift(2),i=oi(e,n,t),o=oi(e,s,t);return[i,o]}function g6(e,r,t){var n=Gv(e);e.l++;var s=e.read_shift(1);return r-=8,[KB(e,r,t),s,n]}function rx(e,r,t){var n=LL(e);switch(t.biff){case 2:e.l++,r-=7;break;case 3:case 4:e.l+=2,r-=8;break;default:e.l+=6,r-=12}return[n,GB(e,r,t)]}function y6(e){var r=e.read_shift(4)!==0,t=e.read_shift(4)!==0,n=e.read_shift(4);return[r,t,n]}function v6(e,r,t){if(!(t.biff<8)){var n=e.read_shift(2),s=e.read_shift(2),i=e.read_shift(2),o=e.read_shift(2),l=wi(e,0,t);return t.biff<8&&e.read_shift(1),[{r:n,c:s},l,o,i]}}function b6(e,r,t){return v6(e,r,t)}function S6(e,r){for(var t=[],n=e.read_shift(2);n--;)t.push(bd(e));return t}function w6(e,r,t){if(t&&t.biff<8)return E6(e,r,t);var n=qv(e),s=VL(e,r-22,n[1]);return{cmo:n,ft:s}}var j6={8:function(e,r){var t=e.l+r;e.l+=10;var n=e.read_shift(2);e.l+=4,e.l+=2,e.l+=2,e.l+=2,e.l+=4;var s=e.read_shift(1);return e.l+=s,e.l=t,{fmt:n}}};function E6(e,r,t){e.l+=4;var n=e.read_shift(2),s=e.read_shift(2),i=e.read_shift(2);e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=2,e.l+=6,r-=36;var o=[];return o.push((j6[n]||mn)(e,r,t)),{cmo:[s,n,i],ft:o}}function k6(e,r,t){var n=e.l,s="";try{e.l+=4;var i=(t.lastobj||{cmo:[0,0]}).cmo[1],o;[0,5,7,11,12,14].indexOf(i)==-1?e.l+=6:o=DL(e,6,t);var l=e.read_shift(2);e.read_shift(2),Ir(e,2);var c=e.read_shift(2);e.l+=c;for(var d=1;d<e.lens.length-1;++d){if(e.l-n!=e.lens[d])throw new Error("TxO: bad continue record");var u=e[e.l],f=oi(e,e.lens[d+1]-e.lens[d]-1);if(s+=f,s.length>=(u?l:2*l))break}if(s.length!==l&&s.length!==l*2)throw new Error("cchText: "+l+" != "+s.length);return e.l=n+r,{t:s}}catch{return e.l=n+r,{t:s}}}function A6(e,r){var t=bd(e);e.l+=16;var n=ML(e,r-24);return[t,n]}function T6(e,r){e.read_shift(2);var t=bd(e),n=e.read_shift((r-10)/2,"dbcs-cont");return n=n.replace(En,""),[t,n]}function C6(e){var r=[0,0],t;return t=e.read_shift(2),r[0]=Yp[t]||t,t=e.read_shift(2),r[1]=Yp[t]||t,r}function D6(e){for(var r=e.read_shift(2),t=[];r-- >0;)t.push(Yv(e));return t}function _6(e){for(var r=e.read_shift(2),t=[];r-- >0;)t.push(Yv(e));return t}function I6(e){e.l+=2;var r={cxfs:0,crc:0};return r.cxfs=e.read_shift(2),r.crc=e.read_shift(4),r}function Kv(e,r,t){if(!t.cellStyles)return mn(e,r);var n=t&&t.biff>=12?4:2,s=e.read_shift(n),i=e.read_shift(n),o=e.read_shift(n),l=e.read_shift(n),c=e.read_shift(2);n==2&&(e.l+=2);var d={s,e:i,w:o,ixfe:l,flags:c};return(t.biff>=5||!t.biff)&&(d.level=c>>8&7),d}function F6(e,r){var t={};return r<32||(e.l+=16,t.header=dn(e),t.footer=dn(e),e.l+=2),t}function M6(e,r,t){var n={area:!1};if(t.biff!=5)return e.l+=r,n;var s=e.read_shift(1);return e.l+=3,s&16&&(n.area=!0),n}var P6=$a,N6=Wv,R6=El;function O6(e){var r=e.read_shift(2),t=e.read_shift(2),n=e.read_shift(4),s={fmt:r,env:t,len:n,data:e.slice(e.l,e.l+n)};return e.l+=n,s}function L6(e,r,t){t.biffguess&&t.biff==5&&(t.biff=2);var n=$a(e);++e.l;var s=wi(e,r-7,t);return n.t="str",n.val=s,n}function $6(e){var r=$a(e);++e.l;var t=dn(e);return r.t="n",r.val=t,r}function B6(e){var r=$a(e);++e.l;var t=e.read_shift(2);return r.t="n",r.val=t,r}function U6(e){var r=e.read_shift(1);return r===0?(e.l++,""):e.read_shift(r,"sbcs-cont")}function V6(e,r){e.l+=6,e.l+=2,e.l+=1,e.l+=3,e.l+=1,e.l+=r-13}function W6(e,r,t){var n=e.l+r,s=$a(e),i=e.read_shift(2),o=oi(e,i,t);return e.l=n,s.t="str",s.val=o,s}var H6=[2,3,48,49,131,139,140,245],nx=function(){var e={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},r=Gh({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function t(l,c){var d=[],u=As(1);switch(c.type){case"base64":u=ma(Xn(l));break;case"binary":u=ma(l);break;case"buffer":case"array":u=l;break}Jr(u,0);var f=u.read_shift(1),h=!!(f&136),x=!1,m=!1;switch(f){case 2:break;case 3:break;case 48:x=!0,h=!0;break;case 49:x=!0,h=!0;break;case 131:break;case 139:break;case 140:m=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+f.toString(16))}var g=0,p=521;f==2&&(g=u.read_shift(2)),u.l+=3,f!=2&&(g=u.read_shift(4)),g>1048576&&(g=1e6),f!=2&&(p=u.read_shift(2));var y=u.read_shift(2),S=c.codepage||1252;f!=2&&(u.l+=16,u.read_shift(1),u[u.l]!==0&&(S=e[u[u.l]]),u.l+=1,u.l+=2),m&&(u.l+=36);for(var v=[],E={},C=Math.min(u.length,f==2?521:p-10-(x?264:0)),A=m?32:11;u.l<C&&u[u.l]!=13;)switch(E={},E.name=hs.utils.decode(S,u.slice(u.l,u.l+A)).replace(/[\u0000\r\n].*$/g,""),u.l+=A,E.type=String.fromCharCode(u.read_shift(1)),f!=2&&!m&&(E.offset=u.read_shift(4)),E.len=u.read_shift(1),f==2&&(E.offset=u.read_shift(2)),E.dec=u.read_shift(1),E.name.length&&v.push(E),f!=2&&(u.l+=m?13:14),E.type){case"B":(!x||E.len!=8)&&c.WTF&&console.log("Skipping "+E.name+":"+E.type);break;case"G":case"P":c.WTF&&console.log("Skipping "+E.name+":"+E.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+E.type)}if(u[u.l]!==13&&(u.l=p-1),u.read_shift(1)!==13)throw new Error("DBF Terminator not found "+u.l+" "+u[u.l]);u.l=p;var j=0,w=0;for(d[0]=[],w=0;w!=v.length;++w)d[0][w]=v[w].name;for(;g-- >0;){if(u[u.l]===42){u.l+=y;continue}for(++u.l,d[++j]=[],w=0,w=0;w!=v.length;++w){var k=u.slice(u.l,u.l+v[w].len);u.l+=v[w].len,Jr(k,0);var _=hs.utils.decode(S,k);switch(v[w].type){case"C":_.trim().length&&(d[j][w]=_.replace(/\s+$/,""));break;case"D":_.length===8?d[j][w]=new Date(+_.slice(0,4),+_.slice(4,6)-1,+_.slice(6,8)):d[j][w]=_;break;case"F":d[j][w]=parseFloat(_.trim());break;case"+":case"I":d[j][w]=m?k.read_shift(-4,"i")^2147483648:k.read_shift(4,"i");break;case"L":switch(_.trim().toUpperCase()){case"Y":case"T":d[j][w]=!0;break;case"N":case"F":d[j][w]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+_+"|")}break;case"M":if(!h)throw new Error("DBF Unexpected MEMO for type "+f.toString(16));d[j][w]="##MEMO##"+(m?parseInt(_.trim(),10):k.read_shift(4));break;case"N":_=_.replace(/\u0000/g,"").trim(),_&&_!="."&&(d[j][w]=+_||0);break;case"@":d[j][w]=new Date(k.read_shift(-8,"f")-621356832e5);break;case"T":d[j][w]=new Date((k.read_shift(4)-2440588)*864e5+k.read_shift(4));break;case"Y":d[j][w]=k.read_shift(4,"i")/1e4+k.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":d[j][w]=-k.read_shift(-8,"f");break;case"B":if(x&&v[w].len==8){d[j][w]=k.read_shift(8,"f");break}case"G":case"P":k.l+=v[w].len;break;case"0":if(v[w].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+v[w].type)}}}if(f!=2&&u.l<u.length&&u[u.l++]!=26)throw new Error("DBF EOF Marker missing "+(u.l-1)+" of "+u.length+" "+u[u.l-1].toString(16));return c&&c.sheetRows&&(d=d.slice(0,c.sheetRows)),c.DBF=v,d}function n(l,c){var d=c||{};d.dateNF||(d.dateNF="yyyymmdd");var u=io(t(l,d),d);return u["!cols"]=d.DBF.map(function(f){return{wch:f.len,DBF:f}}),delete d.DBF,u}function s(l,c){try{return Fs(n(l,c),c)}catch(d){if(c&&c.WTF)throw d}return{SheetNames:[],Sheets:{}}}var i={B:8,C:250,L:1,D:8,"?":0,"":0};function o(l,c){var d=c||{};if(+d.codepage>=0&&pa(+d.codepage),d.type=="string")throw new Error("Cannot write DBF to JS string");var u=Wu(),f=Qu(l,{header:1,raw:!0,cellDates:!0}),h=f[0],x=f.slice(1),m=l["!cols"]||[],g=0,p=0,y=0,S=1;for(g=0;g<h.length;++g){if(((m[g]||{}).DBF||{}).name){h[g]=m[g].DBF.name,++y;continue}if(h[g]!=null){if(++y,typeof h[g]=="number"&&(h[g]=h[g].toString(10)),typeof h[g]!="string")throw new Error("DBF Invalid column name "+h[g]+" |"+typeof h[g]+"|");if(h.indexOf(h[g])!==g){for(p=0;p<1024;++p)if(h.indexOf(h[g]+"_"+p)==-1){h[g]+="_"+p;break}}}}var v=Sr(l["!ref"]),E=[],C=[],A=[];for(g=0;g<=v.e.c-v.s.c;++g){var j="",w="",k=0,_=[];for(p=0;p<x.length;++p)x[p][g]!=null&&_.push(x[p][g]);if(_.length==0||h[g]==null){E[g]="?";continue}for(p=0;p<_.length;++p){switch(typeof _[p]){case"number":w="B";break;case"string":w="C";break;case"boolean":w="L";break;case"object":w=_[p]instanceof Date?"D":"C";break;default:w="C"}k=Math.max(k,String(_[p]).length),j=j&&j!=w?"C":w}k>250&&(k=250),w=((m[g]||{}).DBF||{}).type,w=="C"&&m[g].DBF.len>k&&(k=m[g].DBF.len),j=="B"&&w=="N"&&(j="N",A[g]=m[g].DBF.dec,k=m[g].DBF.len),C[g]=j=="C"||w=="N"?k:i[j]||0,S+=C[g],E[g]=j}var I=u.next(32);for(I.write_shift(4,318902576),I.write_shift(4,x.length),I.write_shift(2,296+32*y),I.write_shift(2,S),g=0;g<4;++g)I.write_shift(4,0);for(I.write_shift(4,0|(+r[q1]||3)<<8),g=0,p=0;g<h.length;++g)if(h[g]!=null){var D=u.next(32),B=(h[g].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);D.write_shift(1,B,"sbcs"),D.write_shift(1,E[g]=="?"?"C":E[g],"sbcs"),D.write_shift(4,p),D.write_shift(1,C[g]||i[E[g]]||0),D.write_shift(1,A[g]||0),D.write_shift(1,2),D.write_shift(4,0),D.write_shift(1,0),D.write_shift(4,0),D.write_shift(4,0),p+=C[g]||i[E[g]]||0}var R=u.next(264);for(R.write_shift(4,13),g=0;g<65;++g)R.write_shift(4,0);for(g=0;g<x.length;++g){var Y=u.next(S);for(Y.write_shift(1,0),p=0;p<h.length;++p)if(h[p]!=null)switch(E[p]){case"L":Y.write_shift(1,x[g][p]==null?63:x[g][p]?84:70);break;case"B":Y.write_shift(8,x[g][p]||0,"f");break;case"N":var P="0";for(typeof x[g][p]=="number"&&(P=x[g][p].toFixed(A[p]||0)),y=0;y<C[p]-P.length;++y)Y.write_shift(1,32);Y.write_shift(1,P,"sbcs");break;case"D":x[g][p]?(Y.write_shift(4,("0000"+x[g][p].getFullYear()).slice(-4),"sbcs"),Y.write_shift(2,("00"+(x[g][p].getMonth()+1)).slice(-2),"sbcs"),Y.write_shift(2,("00"+x[g][p].getDate()).slice(-2),"sbcs")):Y.write_shift(8,"00000000","sbcs");break;case"C":var M=String(x[g][p]!=null?x[g][p]:"").slice(0,C[p]);for(Y.write_shift(1,M,"sbcs"),y=0;y<C[p]-M.length;++y)Y.write_shift(1,32);break}}return u.next(1).write_shift(1,26),u.end()}return{to_workbook:s,to_sheet:n,from_sheet:o}}(),Y6=function(){var e={AA:"√Ä",BA:"√Å",CA:"√Ç",DA:195,HA:"√Ñ",JA:197,AE:"√à",BE:"√â",CE:"√ä",HE:"√ã",AI:"√å",BI:"√ç",CI:"√é",HI:"√è",AO:"√í",BO:"√ì",CO:"√î",DO:213,HO:"√ñ",AU:"√ô",BU:"√ö",CU:"√õ",HU:"√ú",Aa:"√†",Ba:"√°",Ca:"√¢",Da:227,Ha:"√§",Ja:229,Ae:"√®",Be:"√©",Ce:"√™",He:"√´",Ai:"√¨",Bi:"√≠",Ci:"√Æ",Hi:"√Ø",Ao:"√≤",Bo:"√≥",Co:"√¥",Do:245,Ho:"√∂",Au:"√π",Bu:"√∫",Cu:"√ª",Hu:"√º",KC:"√á",Kc:"√ß",q:"√¶",z:"≈ì",a:"√Ü",j:"≈í",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},r=new RegExp("\x1BN("+Ra(e).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),t=function(h,x){var m=e[x];return typeof m=="number"?vp(m):m},n=function(h,x,m){var g=x.charCodeAt(0)-32<<4|m.charCodeAt(0)-48;return g==59?h:vp(g)};e["|"]=254;function s(h,x){switch(x.type){case"base64":return i(Xn(h),x);case"binary":return i(h,x);case"buffer":return i(It&&Buffer.isBuffer(h)?h.toString("binary"):yi(h),x);case"array":return i(ii(h),x)}throw new Error("Unrecognized type "+x.type)}function i(h,x){var m=h.split(/[\n\r]+/),g=-1,p=-1,y=0,S=0,v=[],E=[],C=null,A={},j=[],w=[],k=[],_=0,I;for(+x.codepage>=0&&pa(+x.codepage);y!==m.length;++y){_=0;var D=m[y].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,n).replace(r,t),B=D.replace(/;;/g,"\0").split(";").map(function(G){return G.replace(/\u0000/g,";")}),R=B[0],Y;if(D.length>0)switch(R){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":B[1].charAt(0)=="P"&&E.push(D.slice(3).replace(/;;/g,";"));break;case"C":var P=!1,M=!1,K=!1,L=!1,ae=-1,Z=-1;for(S=1;S<B.length;++S)switch(B[S].charAt(0)){case"A":break;case"X":p=parseInt(B[S].slice(1))-1,M=!0;break;case"Y":for(g=parseInt(B[S].slice(1))-1,M||(p=0),I=v.length;I<=g;++I)v[I]=[];break;case"K":Y=B[S].slice(1),Y.charAt(0)==='"'?Y=Y.slice(1,Y.length-1):Y==="TRUE"?Y=!0:Y==="FALSE"?Y=!1:isNaN(ya(Y))?isNaN(Ji(Y).getDate())||(Y=Xr(Y)):(Y=ya(Y),C!==null&&ao(C)&&(Y=vd(Y))),P=!0;break;case"E":L=!0;var T=$i(B[S].slice(1),{r:g,c:p});v[g][p]=[v[g][p],T];break;case"S":K=!0,v[g][p]=[v[g][p],"S5S"];break;case"G":break;case"R":ae=parseInt(B[S].slice(1))-1;break;case"C":Z=parseInt(B[S].slice(1))-1;break;default:if(x&&x.WTF)throw new Error("SYLK bad record "+D)}if(P&&(v[g][p]&&v[g][p].length==2?v[g][p][0]=Y:v[g][p]=Y,C=null),K){if(L)throw new Error("SYLK shared formula cannot have own formula");var N=ae>-1&&v[ae][Z];if(!N||!N[1])throw new Error("SYLK shared formula cannot find base");v[g][p][1]=ib(N[1],{r:g-ae,c:p-Z})}break;case"F":var H=0;for(S=1;S<B.length;++S)switch(B[S].charAt(0)){case"X":p=parseInt(B[S].slice(1))-1,++H;break;case"Y":for(g=parseInt(B[S].slice(1))-1,I=v.length;I<=g;++I)v[I]=[];break;case"M":_=parseInt(B[S].slice(1))/20;break;case"F":break;case"G":break;case"P":C=E[parseInt(B[S].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(k=B[S].slice(1).split(" "),I=parseInt(k[0],10);I<=parseInt(k[1],10);++I)_=parseInt(k[2],10),w[I-1]=_===0?{hidden:!0}:{wch:_},Qi(w[I-1]);break;case"C":p=parseInt(B[S].slice(1))-1,w[p]||(w[p]={});break;case"R":g=parseInt(B[S].slice(1))-1,j[g]||(j[g]={}),_>0?(j[g].hpt=_,j[g].hpx=ll(_)):_===0&&(j[g].hidden=!0);break;default:if(x&&x.WTF)throw new Error("SYLK bad record "+D)}H<1&&(C=null);break;default:if(x&&x.WTF)throw new Error("SYLK bad record "+D)}}return j.length>0&&(A["!rows"]=j),w.length>0&&(A["!cols"]=w),x&&x.sheetRows&&(v=v.slice(0,x.sheetRows)),[v,A]}function o(h,x){var m=s(h,x),g=m[0],p=m[1],y=io(g,x);return Ra(p).forEach(function(S){y[S]=p[S]}),y}function l(h,x){return Fs(o(h,x),x)}function c(h,x,m,g){var p="C;Y"+(m+1)+";X"+(g+1)+";K";switch(h.t){case"n":p+=h.v||0,h.f&&!h.F&&(p+=";E"+I5(h.f,{r:m,c:g}));break;case"b":p+=h.v?"TRUE":"FALSE";break;case"e":p+=h.w||h.v;break;case"d":p+='"'+(h.w||h.v)+'"';break;case"s":p+='"'+h.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return p}function d(h,x){x.forEach(function(m,g){var p="F;W"+(g+1)+" "+(g+1)+" ";m.hidden?p+="0":(typeof m.width=="number"&&!m.wpx&&(m.wpx=Pc(m.width)),typeof m.wpx=="number"&&!m.wch&&(m.wch=Nc(m.wpx)),typeof m.wch=="number"&&(p+=Math.round(m.wch))),p.charAt(p.length-1)!=" "&&h.push(p)})}function u(h,x){x.forEach(function(m,g){var p="F;";m.hidden?p+="M0;":m.hpt?p+="M"+20*m.hpt+";":m.hpx&&(p+="M"+20*nb(m.hpx)+";"),p.length>2&&h.push(p+"R"+(g+1))})}function f(h,x){var m=["ID;PWXL;N;E"],g=[],p=Sr(h["!ref"]),y,S=Array.isArray(h),v=`\r
`;m.push("P;PGeneral"),m.push("F;P0;DG0G8;M255"),h["!cols"]&&d(m,h["!cols"]),h["!rows"]&&u(m,h["!rows"]),m.push("B;Y"+(p.e.r-p.s.r+1)+";X"+(p.e.c-p.s.c+1)+";D"+[p.s.c,p.s.r,p.e.c,p.e.r].join(" "));for(var E=p.s.r;E<=p.e.r;++E)for(var C=p.s.c;C<=p.e.c;++C){var A=gt({r:E,c:C});y=S?(h[E]||[])[C]:h[A],!(!y||y.v==null&&(!y.f||y.F))&&g.push(c(y,h,E,C))}return m.join(v)+v+g.join(v)+v+"E"+v}return{to_workbook:l,to_sheet:o,from_sheet:f}}(),z6=function(){function e(i,o){switch(o.type){case"base64":return r(Xn(i),o);case"binary":return r(i,o);case"buffer":return r(It&&Buffer.isBuffer(i)?i.toString("binary"):yi(i),o);case"array":return r(ii(i),o)}throw new Error("Unrecognized type "+o.type)}function r(i,o){for(var l=i.split(`
`),c=-1,d=-1,u=0,f=[];u!==l.length;++u){if(l[u].trim()==="BOT"){f[++c]=[],d=0;continue}if(!(c<0)){var h=l[u].trim().split(","),x=h[0],m=h[1];++u;for(var g=l[u]||"";(g.match(/["]/g)||[]).length&1&&u<l.length-1;)g+=`
`+l[++u];switch(g=g.trim(),+x){case-1:if(g==="BOT"){f[++c]=[],d=0;continue}else if(g!=="EOD")throw new Error("Unrecognized DIF special command "+g);break;case 0:g==="TRUE"?f[c][d]=!0:g==="FALSE"?f[c][d]=!1:isNaN(ya(m))?isNaN(Ji(m).getDate())?f[c][d]=m:f[c][d]=Xr(m):f[c][d]=ya(m),++d;break;case 1:g=g.slice(1,g.length-1),g=g.replace(/""/g,'"'),g&&g.match(/^=".*"$/)&&(g=g.slice(2,-1)),f[c][d++]=g!==""?g:null;break}if(g==="EOD")break}}return o&&o.sheetRows&&(f=f.slice(0,o.sheetRows)),f}function t(i,o){return io(e(i,o),o)}function n(i,o){return Fs(t(i,o),o)}var s=function(){var i=function(c,d,u,f,h){c.push(d),c.push(u+","+f),c.push('"'+h.replace(/"/g,'""')+'"')},o=function(c,d,u,f){c.push(d+","+u),c.push(d==1?'"'+f.replace(/"/g,'""')+'"':f)};return function(c){var d=[],u=Sr(c["!ref"]),f,h=Array.isArray(c);i(d,"TABLE",0,1,"sheetjs"),i(d,"VECTORS",0,u.e.r-u.s.r+1,""),i(d,"TUPLES",0,u.e.c-u.s.c+1,""),i(d,"DATA",0,0,"");for(var x=u.s.r;x<=u.e.r;++x){o(d,-1,0,"BOT");for(var m=u.s.c;m<=u.e.c;++m){var g=gt({r:x,c:m});if(f=h?(c[x]||[])[m]:c[g],!f){o(d,1,0,"");continue}switch(f.t){case"n":var p=f.w;!p&&f.v!=null&&(p=f.v),p==null?f.f&&!f.F?o(d,1,0,"="+f.f):o(d,1,0,""):o(d,0,p,"V");break;case"b":o(d,0,f.v?1:0,f.v?"TRUE":"FALSE");break;case"s":o(d,1,0,isNaN(f.v)?f.v:'="'+f.v+'"');break;case"d":f.w||(f.w=sa(f.z||bt[14],kn(Xr(f.v)))),o(d,0,f.w,"V");break;default:o(d,1,0,"")}}}o(d,-1,0,"EOD");var y=`\r
`,S=d.join(y);return S}}();return{to_workbook:n,to_sheet:t,from_sheet:s}}(),G6=function(){function e(f){return f.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function r(f){return f.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function t(f,h){for(var x=f.split(`
`),m=-1,g=-1,p=0,y=[];p!==x.length;++p){var S=x[p].trim().split(":");if(S[0]==="cell"){var v=wn(S[1]);if(y.length<=v.r)for(m=y.length;m<=v.r;++m)y[m]||(y[m]=[]);switch(m=v.r,g=v.c,S[2]){case"t":y[m][g]=e(S[3]);break;case"v":y[m][g]=+S[3];break;case"vtf":var E=S[S.length-1];case"vtc":switch(S[3]){case"nl":y[m][g]=!!+S[4];break;default:y[m][g]=+S[4];break}S[2]=="vtf"&&(y[m][g]=[y[m][g],E])}}}return h&&h.sheetRows&&(y=y.slice(0,h.sheetRows)),y}function n(f,h){return io(t(f,h),h)}function s(f,h){return Fs(n(f,h),h)}var i=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),o=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,l=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),c="--SocialCalcSpreadsheetControlSave--";function d(f){if(!f||!f["!ref"])return"";for(var h=[],x=[],m,g="",p=so(f["!ref"]),y=Array.isArray(f),S=p.s.r;S<=p.e.r;++S)for(var v=p.s.c;v<=p.e.c;++v)if(g=gt({r:S,c:v}),m=y?(f[S]||[])[v]:f[g],!(!m||m.v==null||m.t==="z")){switch(x=["cell",g,"t"],m.t){case"s":case"str":x.push(r(m.v));break;case"n":m.f?(x[2]="vtf",x[3]="n",x[4]=m.v,x[5]=r(m.f)):(x[2]="v",x[3]=m.v);break;case"b":x[2]="vt"+(m.f?"f":"c"),x[3]="nl",x[4]=m.v?"1":"0",x[5]=r(m.f||(m.v?"TRUE":"FALSE"));break;case"d":var E=kn(Xr(m.v));x[2]="vtc",x[3]="nd",x[4]=""+E,x[5]=m.w||sa(m.z||bt[14],E);break;case"e":continue}h.push(x.join(":"))}return h.push("sheet:c:"+(p.e.c-p.s.c+1)+":r:"+(p.e.r-p.s.r+1)+":tvf:1"),h.push("valueformat:1:text-wiki"),h.join(`
`)}function u(f){return[i,o,l,o,d(f),c].join(`
`)}return{to_workbook:s,to_sheet:n,from_sheet:u}}(),il=function(){function e(u,f,h,x,m){m.raw?f[h][x]=u:u===""||(u==="TRUE"?f[h][x]=!0:u==="FALSE"?f[h][x]=!1:isNaN(ya(u))?isNaN(Ji(u).getDate())?f[h][x]=u:f[h][x]=Xr(u):f[h][x]=ya(u))}function r(u,f){var h=f||{},x=[];if(!u||u.length===0)return x;for(var m=u.split(/[\r\n]/),g=m.length-1;g>=0&&m[g].length===0;)--g;for(var p=10,y=0,S=0;S<=g;++S)y=m[S].indexOf(" "),y==-1?y=m[S].length:y++,p=Math.max(p,y);for(S=0;S<=g;++S){x[S]=[];var v=0;for(e(m[S].slice(0,p).trim(),x,S,v,h),v=1;v<=(m[S].length-p)/10+1;++v)e(m[S].slice(p+(v-1)*10,p+v*10).trim(),x,S,v,h)}return h.sheetRows&&(x=x.slice(0,h.sheetRows)),x}var t={44:",",9:"	",59:";",124:"|"},n={44:3,9:2,59:1,124:0};function s(u){for(var f={},h=!1,x=0,m=0;x<u.length;++x)(m=u.charCodeAt(x))==34?h=!h:!h&&m in t&&(f[m]=(f[m]||0)+1);m=[];for(x in f)Object.prototype.hasOwnProperty.call(f,x)&&m.push([f[x],x]);if(!m.length){f=n;for(x in f)Object.prototype.hasOwnProperty.call(f,x)&&m.push([f[x],x])}return m.sort(function(g,p){return g[0]-p[0]||n[g[1]]-n[p[1]]}),t[m.pop()[1]]||44}function i(u,f){var h=f||{},x="",m=h.dense?[]:{},g={s:{c:0,r:0},e:{c:0,r:0}};u.slice(0,4)=="sep="?u.charCodeAt(5)==13&&u.charCodeAt(6)==10?(x=u.charAt(4),u=u.slice(7)):u.charCodeAt(5)==13||u.charCodeAt(5)==10?(x=u.charAt(4),u=u.slice(6)):x=s(u.slice(0,1024)):h&&h.FS?x=h.FS:x=s(u.slice(0,1024));var p=0,y=0,S=0,v=0,E=0,C=x.charCodeAt(0),A=!1,j=0,w=u.charCodeAt(0);u=u.replace(/\r\n/mg,`
`);var k=h.dateNF!=null?s3(h.dateNF):null;function _(){var I=u.slice(v,E),D={};if(I.charAt(0)=='"'&&I.charAt(I.length-1)=='"'&&(I=I.slice(1,-1).replace(/""/g,'"')),I.length===0)D.t="z";else if(h.raw)D.t="s",D.v=I;else if(I.trim().length===0)D.t="s",D.v=I;else if(I.charCodeAt(0)==61)I.charCodeAt(1)==34&&I.charCodeAt(I.length-1)==34?(D.t="s",D.v=I.slice(2,-1).replace(/""/g,'"')):M5(I)?(D.t="n",D.f=I.slice(1)):(D.t="s",D.v=I);else if(I=="TRUE")D.t="b",D.v=!0;else if(I=="FALSE")D.t="b",D.v=!1;else if(!isNaN(S=ya(I)))D.t="n",h.cellText!==!1&&(D.w=I),D.v=S;else if(!isNaN(Ji(I).getDate())||k&&I.match(k)){D.z=h.dateNF||bt[14];var B=0;k&&I.match(k)&&(I=i3(I,h.dateNF,I.match(k)||[]),B=1),h.cellDates?(D.t="d",D.v=Xr(I,B)):(D.t="n",D.v=kn(Xr(I,B))),h.cellText!==!1&&(D.w=sa(D.z,D.v instanceof Date?kn(D.v):D.v)),h.cellNF||delete D.z}else D.t="s",D.v=I;if(D.t=="z"||(h.dense?(m[p]||(m[p]=[]),m[p][y]=D):m[gt({c:y,r:p})]=D),v=E+1,w=u.charCodeAt(v),g.e.c<y&&(g.e.c=y),g.e.r<p&&(g.e.r=p),j==C)++y;else if(y=0,++p,h.sheetRows&&h.sheetRows<=p)return!0}e:for(;E<u.length;++E)switch(j=u.charCodeAt(E)){case 34:w===34&&(A=!A);break;case C:case 10:case 13:if(!A&&_())break e;break}return E-v>0&&_(),m["!ref"]=Nt(g),m}function o(u,f){return!(f&&f.PRN)||f.FS||u.slice(0,4)=="sep="||u.indexOf("	")>=0||u.indexOf(",")>=0||u.indexOf(";")>=0?i(u,f):io(r(u,f),f)}function l(u,f){var h="",x=f.type=="string"?[0,0,0,0]:f0(u,f);switch(f.type){case"base64":h=Xn(u);break;case"binary":h=u;break;case"buffer":f.codepage==65001?h=u.toString("utf8"):f.codepage&&typeof hs<"u"?h=hs.utils.decode(f.codepage,u):h=It&&Buffer.isBuffer(u)?u.toString("binary"):yi(u);break;case"array":h=ii(u);break;case"string":h=u;break;default:throw new Error("Unrecognized type "+f.type)}return x[0]==239&&x[1]==187&&x[2]==191?h=sr(h.slice(3)):f.type!="string"&&f.type!="buffer"&&f.codepage==65001?h=sr(h):f.type=="binary"&&typeof hs<"u"&&f.codepage&&(h=hs.utils.decode(f.codepage,hs.utils.encode(28591,h))),h.slice(0,19)=="socialcalc:version:"?G6.to_sheet(f.type=="string"?h:sr(h),f):o(h,f)}function c(u,f){return Fs(l(u,f),f)}function d(u){for(var f=[],h=Sr(u["!ref"]),x,m=Array.isArray(u),g=h.s.r;g<=h.e.r;++g){for(var p=[],y=h.s.c;y<=h.e.c;++y){var S=gt({r:g,c:y});if(x=m?(u[g]||[])[y]:u[S],!x||x.v==null){p.push("          ");continue}for(var v=(x.w||(Ja(x),x.w)||"").slice(0,10);v.length<10;)v+=" ";p.push(v+(y===0?" ":""))}f.push(p.join(""))}return f.join(`
`)}return{to_workbook:c,to_sheet:l,from_sheet:d}}();function q6(e,r){var t=r||{},n=!!t.WTF;t.WTF=!0;try{var s=Y6.to_workbook(e,t);return t.WTF=n,s}catch(i){if(t.WTF=n,!i.message.match(/SYLK bad record ID/)&&n)throw i;return il.to_workbook(e,r)}}var Vo=function(){function e(T,N,H){if(T){Jr(T,T.l||0);for(var G=H.Enum||ae;T.l<T.length;){var q=T.read_shift(2),oe=G[q]||G[65535],de=T.read_shift(2),z=T.l+de,O=oe.f&&oe.f(T,de,H);if(T.l=z,N(O,oe,q))return}}}function r(T,N){switch(N.type){case"base64":return t(ma(Xn(T)),N);case"binary":return t(ma(T),N);case"buffer":case"array":return t(T,N)}throw"Unsupported type "+N.type}function t(T,N){if(!T)return T;var H=N||{},G=H.dense?[]:{},q="Sheet1",oe="",de=0,z={},O=[],W=[],F={s:{r:0,c:0},e:{r:0,c:0}},U=H.sheetRows||0;if(T[2]==0&&(T[3]==8||T[3]==9)&&T.length>=16&&T[14]==5&&T[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(T[2]==2)H.Enum=ae,e(T,function(be,xe,Fe){switch(Fe){case 0:H.vers=be,be>=4096&&(H.qpro=!0);break;case 6:F=be;break;case 204:be&&(oe=be);break;case 222:oe=be;break;case 15:case 51:H.qpro||(be[1].v=be[1].v.slice(1));case 13:case 14:case 16:Fe==14&&(be[2]&112)==112&&(be[2]&15)>1&&(be[2]&15)<15&&(be[1].z=H.dateNF||bt[14],H.cellDates&&(be[1].t="d",be[1].v=vd(be[1].v))),H.qpro&&be[3]>de&&(G["!ref"]=Nt(F),z[q]=G,O.push(q),G=H.dense?[]:{},F={s:{r:0,c:0},e:{r:0,c:0}},de=be[3],q=oe||"Sheet"+(de+1),oe="");var me=H.dense?(G[be[0].r]||[])[be[0].c]:G[gt(be[0])];if(me){me.t=be[1].t,me.v=be[1].v,be[1].z!=null&&(me.z=be[1].z),be[1].f!=null&&(me.f=be[1].f);break}H.dense?(G[be[0].r]||(G[be[0].r]=[]),G[be[0].r][be[0].c]=be[1]):G[gt(be[0])]=be[1];break}},H);else if(T[2]==26||T[2]==14)H.Enum=Z,T[2]==14&&(H.qpro=!0,T.l=0),e(T,function(be,xe,Fe){switch(Fe){case 204:q=be;break;case 22:be[1].v=be[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(be[3]>de&&(G["!ref"]=Nt(F),z[q]=G,O.push(q),G=H.dense?[]:{},F={s:{r:0,c:0},e:{r:0,c:0}},de=be[3],q="Sheet"+(de+1)),U>0&&be[0].r>=U)break;H.dense?(G[be[0].r]||(G[be[0].r]=[]),G[be[0].r][be[0].c]=be[1]):G[gt(be[0])]=be[1],F.e.c<be[0].c&&(F.e.c=be[0].c),F.e.r<be[0].r&&(F.e.r=be[0].r);break;case 27:be[14e3]&&(W[be[14e3][0]]=be[14e3][1]);break;case 1537:W[be[0]]=be[1],be[0]==de&&(q=be[1]);break}},H);else throw new Error("Unrecognized LOTUS BOF "+T[2]);if(G["!ref"]=Nt(F),z[oe||q]=G,O.push(oe||q),!W.length)return{SheetNames:O,Sheets:z};for(var te={},he=[],ie=0;ie<W.length;++ie)z[O[ie]]?(he.push(W[ie]||O[ie]),te[W[ie]]=z[W[ie]]||z[O[ie]]):(he.push(W[ie]),te[W[ie]]={"!ref":"A1"});return{SheetNames:he,Sheets:te}}function n(T,N){var H=N||{};if(+H.codepage>=0&&pa(+H.codepage),H.type=="string")throw new Error("Cannot write WK1 to JS string");var G=Wu(),q=Sr(T["!ref"]),oe=Array.isArray(T),de=[];ua(G,0,i(1030)),ua(G,6,c(q));for(var z=Math.min(q.e.r,8191),O=q.s.r;O<=z;++O)for(var W=en(O),F=q.s.c;F<=q.e.c;++F){O===q.s.r&&(de[F]=Lr(F));var U=de[F]+W,te=oe?(T[O]||[])[F]:T[U];if(!(!te||te.t=="z"))if(te.t=="n")(te.v|0)==te.v&&te.v>=-32768&&te.v<=32767?ua(G,13,x(O,F,te.v)):ua(G,14,g(O,F,te.v));else{var he=Ja(te);ua(G,15,f(O,F,he.slice(0,239)))}}return ua(G,1),G.end()}function s(T,N){var H=N||{};if(+H.codepage>=0&&pa(+H.codepage),H.type=="string")throw new Error("Cannot write WK3 to JS string");var G=Wu();ua(G,0,o(T));for(var q=0,oe=0;q<T.SheetNames.length;++q)(T.Sheets[T.SheetNames[q]]||{})["!ref"]&&ua(G,27,L(T.SheetNames[q],oe++));var de=0;for(q=0;q<T.SheetNames.length;++q){var z=T.Sheets[T.SheetNames[q]];if(!(!z||!z["!ref"])){for(var O=Sr(z["!ref"]),W=Array.isArray(z),F=[],U=Math.min(O.e.r,8191),te=O.s.r;te<=U;++te)for(var he=en(te),ie=O.s.c;ie<=O.e.c;++ie){te===O.s.r&&(F[ie]=Lr(ie));var be=F[ie]+he,xe=W?(z[te]||[])[ie]:z[be];if(!(!xe||xe.t=="z"))if(xe.t=="n")ua(G,23,_(te,ie,de,xe.v));else{var Fe=Ja(xe);ua(G,22,j(te,ie,de,Fe.slice(0,239)))}}++de}}return ua(G,1),G.end()}function i(T){var N=Or(2);return N.write_shift(2,T),N}function o(T){var N=Or(26);N.write_shift(2,4096),N.write_shift(2,4),N.write_shift(4,0);for(var H=0,G=0,q=0,oe=0;oe<T.SheetNames.length;++oe){var de=T.SheetNames[oe],z=T.Sheets[de];if(!(!z||!z["!ref"])){++q;var O=so(z["!ref"]);H<O.e.r&&(H=O.e.r),G<O.e.c&&(G=O.e.c)}}return H>8191&&(H=8191),N.write_shift(2,H),N.write_shift(1,q),N.write_shift(1,G),N.write_shift(2,0),N.write_shift(2,0),N.write_shift(1,1),N.write_shift(1,2),N.write_shift(4,0),N.write_shift(4,0),N}function l(T,N,H){var G={s:{c:0,r:0},e:{c:0,r:0}};return N==8&&H.qpro?(G.s.c=T.read_shift(1),T.l++,G.s.r=T.read_shift(2),G.e.c=T.read_shift(1),T.l++,G.e.r=T.read_shift(2),G):(G.s.c=T.read_shift(2),G.s.r=T.read_shift(2),N==12&&H.qpro&&(T.l+=2),G.e.c=T.read_shift(2),G.e.r=T.read_shift(2),N==12&&H.qpro&&(T.l+=2),G.s.c==65535&&(G.s.c=G.e.c=G.s.r=G.e.r=0),G)}function c(T){var N=Or(8);return N.write_shift(2,T.s.c),N.write_shift(2,T.s.r),N.write_shift(2,T.e.c),N.write_shift(2,T.e.r),N}function d(T,N,H){var G=[{c:0,r:0},{t:"n",v:0},0,0];return H.qpro&&H.vers!=20768?(G[0].c=T.read_shift(1),G[3]=T.read_shift(1),G[0].r=T.read_shift(2),T.l+=2):(G[2]=T.read_shift(1),G[0].c=T.read_shift(2),G[0].r=T.read_shift(2)),G}function u(T,N,H){var G=T.l+N,q=d(T,N,H);if(q[1].t="s",H.vers==20768){T.l++;var oe=T.read_shift(1);return q[1].v=T.read_shift(oe,"utf8"),q}return H.qpro&&T.l++,q[1].v=T.read_shift(G-T.l,"cstr"),q}function f(T,N,H){var G=Or(7+H.length);G.write_shift(1,255),G.write_shift(2,N),G.write_shift(2,T),G.write_shift(1,39);for(var q=0;q<G.length;++q){var oe=H.charCodeAt(q);G.write_shift(1,oe>=128?95:oe)}return G.write_shift(1,0),G}function h(T,N,H){var G=d(T,N,H);return G[1].v=T.read_shift(2,"i"),G}function x(T,N,H){var G=Or(7);return G.write_shift(1,255),G.write_shift(2,N),G.write_shift(2,T),G.write_shift(2,H,"i"),G}function m(T,N,H){var G=d(T,N,H);return G[1].v=T.read_shift(8,"f"),G}function g(T,N,H){var G=Or(13);return G.write_shift(1,255),G.write_shift(2,N),G.write_shift(2,T),G.write_shift(8,H,"f"),G}function p(T,N,H){var G=T.l+N,q=d(T,N,H);if(q[1].v=T.read_shift(8,"f"),H.qpro)T.l=G;else{var oe=T.read_shift(2);E(T.slice(T.l,T.l+oe),q),T.l+=oe}return q}function y(T,N,H){var G=N&32768;return N&=-32769,N=(G?T:0)+(N>=8192?N-16384:N),(G?"":"$")+(H?Lr(N):en(N))}var S={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},v=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function E(T,N){Jr(T,0);for(var H=[],G=0,q="",oe="",de="",z="";T.l<T.length;){var O=T[T.l++];switch(O){case 0:H.push(T.read_shift(8,"f"));break;case 1:oe=y(N[0].c,T.read_shift(2),!0),q=y(N[0].r,T.read_shift(2),!1),H.push(oe+q);break;case 2:{var W=y(N[0].c,T.read_shift(2),!0),F=y(N[0].r,T.read_shift(2),!1);oe=y(N[0].c,T.read_shift(2),!0),q=y(N[0].r,T.read_shift(2),!1),H.push(W+F+":"+oe+q)}break;case 3:if(T.l<T.length){console.error("WK1 premature formula end");return}break;case 4:H.push("("+H.pop()+")");break;case 5:H.push(T.read_shift(2));break;case 6:{for(var U="";O=T[T.l++];)U+=String.fromCharCode(O);H.push('"'+U.replace(/"/g,'""')+'"')}break;case 8:H.push("-"+H.pop());break;case 23:H.push("+"+H.pop());break;case 22:H.push("NOT("+H.pop()+")");break;case 20:case 21:z=H.pop(),de=H.pop(),H.push(["AND","OR"][O-20]+"("+de+","+z+")");break;default:if(O<32&&v[O])z=H.pop(),de=H.pop(),H.push(de+v[O]+z);else if(S[O]){if(G=S[O][1],G==69&&(G=T[T.l++]),G>H.length){console.error("WK1 bad formula parse 0x"+O.toString(16)+":|"+H.join("|")+"|");return}var te=H.slice(-G);H.length-=G,H.push(S[O][0]+"("+te.join(",")+")")}else return O<=7?console.error("WK1 invalid opcode "+O.toString(16)):O<=24?console.error("WK1 unsupported op "+O.toString(16)):O<=30?console.error("WK1 invalid opcode "+O.toString(16)):O<=115?console.error("WK1 unsupported function opcode "+O.toString(16)):console.error("WK1 unrecognized opcode "+O.toString(16))}}H.length==1?N[1].f=""+H[0]:console.error("WK1 bad formula parse |"+H.join("|")+"|")}function C(T){var N=[{c:0,r:0},{t:"n",v:0},0];return N[0].r=T.read_shift(2),N[3]=T[T.l++],N[0].c=T[T.l++],N}function A(T,N){var H=C(T);return H[1].t="s",H[1].v=T.read_shift(N-4,"cstr"),H}function j(T,N,H,G){var q=Or(6+G.length);q.write_shift(2,T),q.write_shift(1,H),q.write_shift(1,N),q.write_shift(1,39);for(var oe=0;oe<G.length;++oe){var de=G.charCodeAt(oe);q.write_shift(1,de>=128?95:de)}return q.write_shift(1,0),q}function w(T,N){var H=C(T);H[1].v=T.read_shift(2);var G=H[1].v>>1;if(H[1].v&1)switch(G&7){case 0:G=(G>>3)*5e3;break;case 1:G=(G>>3)*500;break;case 2:G=(G>>3)/20;break;case 3:G=(G>>3)/200;break;case 4:G=(G>>3)/2e3;break;case 5:G=(G>>3)/2e4;break;case 6:G=(G>>3)/16;break;case 7:G=(G>>3)/64;break}return H[1].v=G,H}function k(T,N){var H=C(T),G=T.read_shift(4),q=T.read_shift(4),oe=T.read_shift(2);if(oe==65535)return G===0&&q===3221225472?(H[1].t="e",H[1].v=15):G===0&&q===3489660928?(H[1].t="e",H[1].v=42):H[1].v=0,H;var de=oe&32768;return oe=(oe&32767)-16446,H[1].v=(1-de*2)*(q*Math.pow(2,oe+32)+G*Math.pow(2,oe)),H}function _(T,N,H,G){var q=Or(14);if(q.write_shift(2,T),q.write_shift(1,H),q.write_shift(1,N),G==0)return q.write_shift(4,0),q.write_shift(4,0),q.write_shift(2,65535),q;var oe=0,de=0,z=0,O=0;return G<0&&(oe=1,G=-G),de=Math.log2(G)|0,G/=Math.pow(2,de-31),O=G>>>0,O&2147483648||(G/=2,++de,O=G>>>0),G-=O,O|=2147483648,O>>>=0,G*=Math.pow(2,32),z=G>>>0,q.write_shift(4,z),q.write_shift(4,O),de+=16383+(oe?32768:0),q.write_shift(2,de),q}function I(T,N){var H=k(T);return T.l+=N-14,H}function D(T,N){var H=C(T),G=T.read_shift(4);return H[1].v=G>>6,H}function B(T,N){var H=C(T),G=T.read_shift(8,"f");return H[1].v=G,H}function R(T,N){var H=B(T);return T.l+=N-10,H}function Y(T,N){return T[T.l+N-1]==0?T.read_shift(N,"cstr"):""}function P(T,N){var H=T[T.l++];H>N-1&&(H=N-1);for(var G="";G.length<H;)G+=String.fromCharCode(T[T.l++]);return G}function M(T,N,H){if(!(!H.qpro||N<21)){var G=T.read_shift(1);T.l+=17,T.l+=1,T.l+=2;var q=T.read_shift(N-21,"cstr");return[G,q]}}function K(T,N){for(var H={},G=T.l+N;T.l<G;){var q=T.read_shift(2);if(q==14e3){for(H[q]=[0,""],H[q][0]=T.read_shift(2);T[T.l];)H[q][1]+=String.fromCharCode(T[T.l]),T.l++;T.l++}}return H}function L(T,N){var H=Or(5+T.length);H.write_shift(2,14e3),H.write_shift(2,N);for(var G=0;G<T.length;++G){var q=T.charCodeAt(G);H[H.l++]=q>127?95:q}return H[H.l++]=0,H}var ae={0:{n:"BOF",f:Ir},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:l},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:h},14:{n:"NUMBER",f:m},15:{n:"LABEL",f:u},16:{n:"FORMULA",f:p},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:u},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:Y},222:{n:"SHEETNAMELP",f:P},65535:{n:""}},Z={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:A},23:{n:"NUMBER17",f:k},24:{n:"NUMBER18",f:w},25:{n:"FORMULA19",f:I},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:K},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:D},38:{n:"??"},39:{n:"NUMBER27",f:B},40:{n:"FORMULA28",f:R},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:Y},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:M},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:n,book_to_wk3:s,to_workbook:r}}();function X6(e){var r={},t=e.match(pn),n=0,s=!1;if(t)for(;n!=t.length;++n){var i=ut(t[n]);switch(i[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!i.val)break;case"<shadow>":case"<shadow/>":r.shadow=1;break;case"</shadow>":break;case"<charset":if(i.val=="1")break;r.cp=Vh[parseInt(i.val,10)];break;case"<outline":if(!i.val)break;case"<outline>":case"<outline/>":r.outline=1;break;case"</outline>":break;case"<rFont":r.name=i.val;break;case"<sz":r.sz=i.val;break;case"<strike":if(!i.val)break;case"<strike>":case"<strike/>":r.strike=1;break;case"</strike>":break;case"<u":if(!i.val)break;switch(i.val){case"double":r.uval="double";break;case"singleAccounting":r.uval="single-accounting";break;case"doubleAccounting":r.uval="double-accounting";break}case"<u>":case"<u/>":r.u=1;break;case"</u>":break;case"<b":if(i.val=="0")break;case"<b>":case"<b/>":r.b=1;break;case"</b>":break;case"<i":if(i.val=="0")break;case"<i>":case"<i/>":r.i=1;break;case"</i>":break;case"<color":i.rgb&&(r.color=i.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":r.family=i.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":r.valign=i.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(i[0].charCodeAt(1)!==47&&!s)throw new Error("Unrecognized rich format "+i[0])}}return r}var K6=function(){var e=al("t"),r=al("rPr");function t(i){var o=i.match(e);if(!o)return{t:"s",v:""};var l={t:"s",v:Ot(o[1])},c=i.match(r);return c&&(l.s=X6(c[1])),l}var n=/<(?:\w+:)?r>/g,s=/<\/(?:\w+:)?r>/;return function(o){return o.replace(n,"").split(s).map(t).filter(function(l){return l.v})}}(),J6=function(){var r=/(\r\n|\n)/g;function t(s,i,o){var l=[];s.u&&l.push("text-decoration: underline;"),s.uval&&l.push("text-underline-style:"+s.uval+";"),s.sz&&l.push("font-size:"+s.sz+"pt;"),s.outline&&l.push("text-effect: outline;"),s.shadow&&l.push("text-shadow: auto;"),i.push('<span style="'+l.join("")+'">'),s.b&&(i.push("<b>"),o.push("</b>")),s.i&&(i.push("<i>"),o.push("</i>")),s.strike&&(i.push("<s>"),o.push("</s>"));var c=s.valign||"";return c=="superscript"||c=="super"?c="sup":c=="subscript"&&(c="sub"),c!=""&&(i.push("<"+c+">"),o.push("</"+c+">")),o.push("</span>"),s}function n(s){var i=[[],s.v,[]];return s.v?(s.s&&t(s.s,i[0],i[2]),i[0].join("")+i[1].replace(r,"<br/>")+i[2].join("")):""}return function(i){return i.map(n).join("")}}(),Q6=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,Z6=/<(?:\w+:)?r>/,e$=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function s0(e,r){var t=r?r.cellHTML:!0,n={};return e?(e.match(/^\s*<(?:\w+:)?t[^>]*>/)?(n.t=Ot(sr(e.slice(e.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),n.r=sr(e),t&&(n.h=Xh(n.t))):e.match(Z6)&&(n.r=sr(e),n.t=Ot(sr((e.replace(e$,"").match(Q6)||[]).join("").replace(pn,""))),t&&(n.h=J6(K6(n.r)))),n):{t:""}}var t$=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,r$=/<(?:\w+:)?(?:si|sstItem)>/g,n$=/<\/(?:\w+:)?(?:si|sstItem)>/;function a$(e,r){var t=[],n="";if(!e)return t;var s=e.match(t$);if(s){n=s[2].replace(r$,"").split(n$);for(var i=0;i!=n.length;++i){var o=s0(n[i].trim(),r);o!=null&&(t[t.length]=o)}s=ut(s[1]),t.Count=s.count,t.Unique=s.uniqueCount}return t}function s$(e){return[e.read_shift(4),e.read_shift(4)]}function i$(e,r){var t=[],n=!1;return ns(e,function(i,o,l){switch(l){case 159:t.Count=i[0],t.Unique=i[1];break;case 19:t.push(i);break;case 160:return!0;case 35:n=!0;break;case 36:n=!1;break;default:if(o.T,!n||r.WTF)throw new Error("Unexpected record 0x"+l.toString(16))}}),t}function Jv(e){for(var r=[],t=e.split(""),n=0;n<t.length;++n)r[n]=t[n].charCodeAt(0);return r}function qa(e,r){var t={};return t.Major=e.read_shift(2),t.Minor=e.read_shift(2),r>=4&&(e.l+=r-4),t}function o$(e){var r={};return r.id=e.read_shift(0,"lpp4"),r.R=qa(e,4),r.U=qa(e,4),r.W=qa(e,4),r}function l$(e){for(var r=e.read_shift(4),t=e.l+r-4,n={},s=e.read_shift(4),i=[];s-- >0;)i.push({t:e.read_shift(4),v:e.read_shift(0,"lpp4")});if(n.name=e.read_shift(0,"lpp4"),n.comps=i,e.l!=t)throw new Error("Bad DataSpaceMapEntry: "+e.l+" != "+t);return n}function c$(e){var r=[];e.l+=4;for(var t=e.read_shift(4);t-- >0;)r.push(l$(e));return r}function d$(e){var r=[];e.l+=4;for(var t=e.read_shift(4);t-- >0;)r.push(e.read_shift(0,"lpp4"));return r}function u$(e){var r={};return e.read_shift(4),e.l+=4,r.id=e.read_shift(0,"lpp4"),r.name=e.read_shift(0,"lpp4"),r.R=qa(e,4),r.U=qa(e,4),r.W=qa(e,4),r}function f$(e){var r=u$(e);if(r.ename=e.read_shift(0,"8lpp4"),r.blksz=e.read_shift(4),r.cmode=e.read_shift(4),e.read_shift(4)!=4)throw new Error("Bad !Primary record");return r}function Qv(e,r){var t=e.l+r,n={};n.Flags=e.read_shift(4)&63,e.l+=4,n.AlgID=e.read_shift(4);var s=!1;switch(n.AlgID){case 26126:case 26127:case 26128:s=n.Flags==36;break;case 26625:s=n.Flags==4;break;case 0:s=n.Flags==16||n.Flags==4||n.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+n.AlgID}if(!s)throw new Error("Encryption Flags/AlgID mismatch");return n.AlgIDHash=e.read_shift(4),n.KeySize=e.read_shift(4),n.ProviderType=e.read_shift(4),e.l+=8,n.CSPName=e.read_shift(t-e.l>>1,"utf16le"),e.l=t,n}function Zv(e,r){var t={},n=e.l+r;return e.l+=4,t.Salt=e.slice(e.l,e.l+16),e.l+=16,t.Verifier=e.slice(e.l,e.l+16),e.l+=16,e.read_shift(4),t.VerifierHash=e.slice(e.l,n),e.l=n,t}function h$(e){var r=qa(e);switch(r.Minor){case 2:return[r.Minor,m$(e)];case 3:return[r.Minor,p$()];case 4:return[r.Minor,x$(e)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+r.Minor)}function m$(e){var r=e.read_shift(4);if((r&63)!=36)throw new Error("EncryptionInfo mismatch");var t=e.read_shift(4),n=Qv(e,t),s=Zv(e,e.length-e.l);return{t:"Std",h:n,v:s}}function p$(){throw new Error("File is password-protected: ECMA-376 Extensible")}function x$(e){var r=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];e.l+=4;var t=e.read_shift(e.length-e.l,"utf8"),n={};return t.replace(pn,function(i){var o=ut(i);switch(La(o[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":r.forEach(function(l){n[l]=o[l]});break;case"<dataIntegrity":n.encryptedHmacKey=o.encryptedHmacKey,n.encryptedHmacValue=o.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":n.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":n.uri=o.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":n.encs.push(o);break;default:throw o[0]}}),n}function g$(e,r){var t={},n=t.EncryptionVersionInfo=qa(e,4);if(r-=4,n.Minor!=2)throw new Error("unrecognized minor version code: "+n.Minor);if(n.Major>4||n.Major<2)throw new Error("unrecognized major version code: "+n.Major);t.Flags=e.read_shift(4),r-=4;var s=e.read_shift(4);return r-=4,t.EncryptionHeader=Qv(e,s),r-=s,t.EncryptionVerifier=Zv(e,r),t}function y$(e){var r={},t=r.EncryptionVersionInfo=qa(e,4);if(t.Major!=1||t.Minor!=1)throw"unrecognized version code "+t.Major+" : "+t.Minor;return r.Salt=e.read_shift(16),r.EncryptedVerifier=e.read_shift(16),r.EncryptedVerifierHash=e.read_shift(16),r}function v$(e){var r=0,t,n=Jv(e),s=n.length+1,i,o,l,c,d;for(t=As(s),t[0]=n.length,i=1;i!=s;++i)t[i]=n[i-1];for(i=s-1;i>=0;--i)o=t[i],l=r&16384?1:0,c=r<<1&32767,d=l|c,r=d^o;return r^52811}var eb=function(){var e=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],r=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],t=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],n=function(o){return(o/2|o*128)&255},s=function(o,l){return n(o^l)},i=function(o){for(var l=r[o.length-1],c=104,d=o.length-1;d>=0;--d)for(var u=o[d],f=0;f!=7;++f)u&64&&(l^=t[c]),u*=2,--c;return l};return function(o){for(var l=Jv(o),c=i(l),d=l.length,u=As(16),f=0;f!=16;++f)u[f]=0;var h,x,m;for((d&1)===1&&(h=c>>8,u[d]=s(e[0],h),--d,h=c&255,x=l[l.length-1],u[d]=s(x,h));d>0;)--d,h=c>>8,u[d]=s(l[d],h),--d,h=c&255,u[d]=s(l[d],h);for(d=15,m=15-l.length;m>0;)h=c>>8,u[d]=s(e[m],h),--d,--m,h=c&255,u[d]=s(l[d],h),--d,--m;return u}}(),b$=function(e,r,t,n,s){s||(s=r),n||(n=eb(e));var i,o;for(i=0;i!=r.length;++i)o=r[i],o^=n[t],o=(o>>5|o<<3)&255,s[i]=o,++t;return[s,t,n]},S$=function(e){var r=0,t=eb(e);return function(n){var s=b$("",n,r,t);return r=s[1],s[0]}};function w$(e,r,t,n){var s={key:Ir(e),verificationBytes:Ir(e)};return t.password&&(s.verifier=v$(t.password)),n.valid=s.verificationBytes===s.verifier,n.valid&&(n.insitu=S$(t.password)),s}function j$(e,r,t){var n=t||{};return n.Info=e.read_shift(2),e.l-=2,n.Info===1?n.Data=y$(e):n.Data=g$(e,r),n}function E$(e,r,t){var n={Type:t.biff>=8?e.read_shift(2):0};return n.Type?j$(e,r-2,n):w$(e,t.biff>=8?r:r-2,t,n),n}var k$=function(){function e(s,i){switch(i.type){case"base64":return r(Xn(s),i);case"binary":return r(s,i);case"buffer":return r(It&&Buffer.isBuffer(s)?s.toString("binary"):yi(s),i);case"array":return r(ii(s),i)}throw new Error("Unrecognized type "+i.type)}function r(s,i){var o=i||{},l=o.dense?[]:{},c=s.match(/\\trowd.*?\\row\b/g);if(!c.length)throw new Error("RTF missing table");var d={s:{c:0,r:0},e:{c:0,r:c.length-1}};return c.forEach(function(u,f){Array.isArray(l)&&(l[f]=[]);for(var h=/\\\w+\b/g,x=0,m,g=-1;m=h.exec(u);){switch(m[0]){case"\\cell":var p=u.slice(x,h.lastIndex-m[0].length);if(p[0]==" "&&(p=p.slice(1)),++g,p.length){var y={v:p,t:"s"};Array.isArray(l)?l[f][g]=y:l[gt({r:f,c:g})]=y}break}x=h.lastIndex}g>d.e.c&&(d.e.c=g)}),l["!ref"]=Nt(d),l}function t(s,i){return Fs(e(s,i),i)}function n(s){for(var i=["{\\rtf1\\ansi"],o=Sr(s["!ref"]),l,c=Array.isArray(s),d=o.s.r;d<=o.e.r;++d){i.push("\\trowd\\trautofit1");for(var u=o.s.c;u<=o.e.c;++u)i.push("\\cellx"+(u+1));for(i.push("\\pard\\intbl"),u=o.s.c;u<=o.e.c;++u){var f=gt({r:d,c:u});l=c?(s[d]||[])[u]:s[f],!(!l||l.v==null&&(!l.f||l.F))&&(i.push(" "+(l.w||(Ja(l),l.w))),i.push("\\cell"))}i.push("\\pard\\intbl\\row")}return i.join("")+"}"}return{to_workbook:t,to_sheet:e,from_sheet:n}}();function A$(e){var r=e.slice(e[0]==="#"?1:0).slice(0,6);return[parseInt(r.slice(0,2),16),parseInt(r.slice(2,4),16),parseInt(r.slice(4,6),16)]}function ol(e){for(var r=0,t=1;r!=3;++r)t=t*256+(e[r]>255?255:e[r]<0?0:e[r]);return t.toString(16).toUpperCase().slice(1)}function T$(e){var r=e[0]/255,t=e[1]/255,n=e[2]/255,s=Math.max(r,t,n),i=Math.min(r,t,n),o=s-i;if(o===0)return[0,0,r];var l=0,c=0,d=s+i;switch(c=o/(d>1?2-d:d),s){case r:l=((t-n)/o+6)%6;break;case t:l=(n-r)/o+2;break;case n:l=(r-t)/o+4;break}return[l/6,c,d/2]}function C$(e){var r=e[0],t=e[1],n=e[2],s=t*2*(n<.5?n:1-n),i=n-s/2,o=[i,i,i],l=6*r,c;if(t!==0)switch(l|0){case 0:case 6:c=s*l,o[0]+=s,o[1]+=c;break;case 1:c=s*(2-l),o[0]+=c,o[1]+=s;break;case 2:c=s*(l-2),o[1]+=s,o[2]+=c;break;case 3:c=s*(4-l),o[1]+=c,o[2]+=s;break;case 4:c=s*(l-4),o[2]+=s,o[0]+=c;break;case 5:c=s*(6-l),o[2]+=c,o[0]+=s;break}for(var d=0;d!=3;++d)o[d]=Math.round(o[d]*255);return o}function Mc(e,r){if(r===0)return e;var t=T$(A$(e));return r<0?t[2]=t[2]*(1+r):t[2]=1-(1-t[2])*(1-r),ol(C$(t))}var tb=6,D$=15,_$=1,bn=tb;function Pc(e){return Math.floor((e+Math.round(128/bn)/256)*bn)}function Nc(e){return Math.floor((e-5)/bn*100+.5)/100}function Gu(e){return Math.round((e*bn+5)/bn*256)/256}function nu(e){return Gu(Nc(Pc(e)))}function i0(e){var r=Math.abs(e-nu(e)),t=bn;if(r>.005)for(bn=_$;bn<D$;++bn)Math.abs(e-nu(e))<=r&&(r=Math.abs(e-nu(e)),t=bn);bn=t}function Qi(e){e.width?(e.wpx=Pc(e.width),e.wch=Nc(e.wpx),e.MDW=bn):e.wpx?(e.wch=Nc(e.wpx),e.width=Gu(e.wch),e.MDW=bn):typeof e.wch=="number"&&(e.width=Gu(e.wch),e.wpx=Pc(e.width),e.MDW=bn),e.customWidth&&delete e.customWidth}var I$=96,rb=I$;function nb(e){return e*96/rb}function ll(e){return e*rb/96}var F$={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function M$(e,r,t,n){r.Borders=[];var s={},i=!1;(e[0].match(pn)||[]).forEach(function(o){var l=ut(o);switch(La(l[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":s={},l.diagonalUp&&(s.diagonalUp=hr(l.diagonalUp)),l.diagonalDown&&(s.diagonalDown=hr(l.diagonalDown)),r.Borders.push(s);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(n&&n.WTF&&!i)throw new Error("unrecognized "+l[0]+" in borders")}})}function P$(e,r,t,n){r.Fills=[];var s={},i=!1;(e[0].match(pn)||[]).forEach(function(o){var l=ut(o);switch(La(l[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":s={},r.Fills.push(s);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":r.Fills.push(s),s={};break;case"<patternFill":case"<patternFill>":l.patternType&&(s.patternType=l.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":s.bgColor||(s.bgColor={}),l.indexed&&(s.bgColor.indexed=parseInt(l.indexed,10)),l.theme&&(s.bgColor.theme=parseInt(l.theme,10)),l.tint&&(s.bgColor.tint=parseFloat(l.tint)),l.rgb&&(s.bgColor.rgb=l.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":s.fgColor||(s.fgColor={}),l.theme&&(s.fgColor.theme=parseInt(l.theme,10)),l.tint&&(s.fgColor.tint=parseFloat(l.tint)),l.rgb!=null&&(s.fgColor.rgb=l.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(n&&n.WTF&&!i)throw new Error("unrecognized "+l[0]+" in fills")}})}function N$(e,r,t,n){r.Fonts=[];var s={},i=!1;(e[0].match(pn)||[]).forEach(function(o){var l=ut(o);switch(La(l[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":r.Fonts.push(s),s={};break;case"<name":l.val&&(s.name=sr(l.val));break;case"<name/>":case"</name>":break;case"<b":s.bold=l.val?hr(l.val):1;break;case"<b/>":s.bold=1;break;case"<i":s.italic=l.val?hr(l.val):1;break;case"<i/>":s.italic=1;break;case"<u":switch(l.val){case"none":s.underline=0;break;case"single":s.underline=1;break;case"double":s.underline=2;break;case"singleAccounting":s.underline=33;break;case"doubleAccounting":s.underline=34;break}break;case"<u/>":s.underline=1;break;case"<strike":s.strike=l.val?hr(l.val):1;break;case"<strike/>":s.strike=1;break;case"<outline":s.outline=l.val?hr(l.val):1;break;case"<outline/>":s.outline=1;break;case"<shadow":s.shadow=l.val?hr(l.val):1;break;case"<shadow/>":s.shadow=1;break;case"<condense":s.condense=l.val?hr(l.val):1;break;case"<condense/>":s.condense=1;break;case"<extend":s.extend=l.val?hr(l.val):1;break;case"<extend/>":s.extend=1;break;case"<sz":l.val&&(s.sz=+l.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":l.val&&(s.vertAlign=l.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":l.val&&(s.family=parseInt(l.val,10));break;case"<family/>":case"</family>":break;case"<scheme":l.val&&(s.scheme=l.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(l.val=="1")break;l.codepage=Vh[parseInt(l.val,10)];break;case"<color":if(s.color||(s.color={}),l.auto&&(s.color.auto=hr(l.auto)),l.rgb)s.color.rgb=l.rgb.slice(-6);else if(l.indexed){s.color.index=parseInt(l.indexed,10);var c=Qs[s.color.index];s.color.index==81&&(c=Qs[1]),c||(c=Qs[1]),s.color.rgb=c[0].toString(16)+c[1].toString(16)+c[2].toString(16)}else l.theme&&(s.color.theme=parseInt(l.theme,10),l.tint&&(s.color.tint=parseFloat(l.tint)),l.theme&&t.themeElements&&t.themeElements.clrScheme&&(s.color.rgb=Mc(t.themeElements.clrScheme[s.color.theme].rgb,s.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":i=!0;break;case"</AlternateContent>":i=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":i=!0;break;case"</ext>":i=!1;break;default:if(n&&n.WTF&&!i)throw new Error("unrecognized "+l[0]+" in fonts")}})}function R$(e,r,t){r.NumberFmt=[];for(var n=Ra(bt),s=0;s<n.length;++s)r.NumberFmt[n[s]]=bt[n[s]];var i=e[0].match(pn);if(i)for(s=0;s<i.length;++s){var o=ut(i[s]);switch(La(o[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var l=Ot(sr(o.formatCode)),c=parseInt(o.numFmtId,10);if(r.NumberFmt[c]=l,c>0){if(c>392){for(c=392;c>60&&r.NumberFmt[c]!=null;--c);r.NumberFmt[c]=l}Js(l,c)}}break;case"</numFmt>":break;default:if(t.WTF)throw new Error("unrecognized "+o[0]+" in numFmts")}}}var Kl=["numFmtId","fillId","fontId","borderId","xfId"],Jl=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function O$(e,r,t){r.CellXf=[];var n,s=!1;(e[0].match(pn)||[]).forEach(function(i){var o=ut(i),l=0;switch(La(o[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(n=o,delete n[0],l=0;l<Kl.length;++l)n[Kl[l]]&&(n[Kl[l]]=parseInt(n[Kl[l]],10));for(l=0;l<Jl.length;++l)n[Jl[l]]&&(n[Jl[l]]=hr(n[Jl[l]]));if(r.NumberFmt&&n.numFmtId>392){for(l=392;l>60;--l)if(r.NumberFmt[n.numFmtId]==r.NumberFmt[l]){n.numFmtId=l;break}}r.CellXf.push(n);break;case"</xf>":break;case"<alignment":case"<alignment/>":var c={};o.vertical&&(c.vertical=o.vertical),o.horizontal&&(c.horizontal=o.horizontal),o.textRotation!=null&&(c.textRotation=o.textRotation),o.indent&&(c.indent=o.indent),o.wrapText&&(c.wrapText=hr(o.wrapText)),n.alignment=c;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":s=!0;break;case"</AlternateContent>":s=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;default:if(t&&t.WTF&&!s)throw new Error("unrecognized "+o[0]+" in cellXfs")}})}var L$=function(){var r=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,t=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,n=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,s=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,i=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(l,c,d){var u={};if(!l)return u;l=l.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var f;return(f=l.match(r))&&R$(f,u,d),(f=l.match(s))&&N$(f,u,c,d),(f=l.match(n))&&P$(f,u,c,d),(f=l.match(i))&&M$(f,u,c,d),(f=l.match(t))&&O$(f,u,d),u}}();function $$(e,r){var t=e.read_shift(2),n=hn(e);return[t,n]}function B$(e,r,t){var n={};n.sz=e.read_shift(2)/20;var s=K3(e);s.fItalic&&(n.italic=1),s.fCondense&&(n.condense=1),s.fExtend&&(n.extend=1),s.fShadow&&(n.shadow=1),s.fOutline&&(n.outline=1),s.fStrikeout&&(n.strike=1);var i=e.read_shift(2);switch(i===700&&(n.bold=1),e.read_shift(2)){case 1:n.vertAlign="superscript";break;case 2:n.vertAlign="subscript";break}var o=e.read_shift(1);o!=0&&(n.underline=o);var l=e.read_shift(1);l>0&&(n.family=l);var c=e.read_shift(1);switch(c>0&&(n.charset=c),e.l++,n.color=X3(e),e.read_shift(1)){case 1:n.scheme="major";break;case 2:n.scheme="minor";break}return n.name=hn(e),n}var U$=mn;function V$(e,r){var t=e.l+r,n=e.read_shift(2),s=e.read_shift(2);return e.l=t,{ixfe:n,numFmtId:s}}var W$=mn;function H$(e,r,t){var n={};n.NumberFmt=[];for(var s in bt)n.NumberFmt[s]=bt[s];n.CellXf=[],n.Fonts=[];var i=[],o=!1;return ns(e,function(c,d,u){switch(u){case 44:n.NumberFmt[c[0]]=c[1],Js(c[1],c[0]);break;case 43:n.Fonts.push(c),c.color.theme!=null&&r&&r.themeElements&&r.themeElements.clrScheme&&(c.color.rgb=Mc(r.themeElements.clrScheme[c.color.theme].rgb,c.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:i[i.length-1]==617&&n.CellXf.push(c);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:o=!0;break;case 36:o=!1;break;case 37:i.push(u),o=!0;break;case 38:i.pop(),o=!1;break;default:if(d.T>0)i.push(u);else if(d.T<0)i.pop();else if(!o||t.WTF&&i[i.length-1]!=37)throw new Error("Unexpected record 0x"+u.toString(16))}}),n}var Y$=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function z$(e,r,t){r.themeElements.clrScheme=[];var n={};(e[0].match(pn)||[]).forEach(function(s){var i=ut(s);switch(i[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":n.rgb=i.val;break;case"<a:sysClr":n.rgb=i.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":i[0].charAt(1)==="/"?(r.themeElements.clrScheme[Y$.indexOf(i[0])]=n,n={}):n.name=i[0].slice(3,i[0].length-1);break;default:if(t&&t.WTF)throw new Error("Unrecognized "+i[0]+" in clrScheme")}})}function G$(){}function q$(){}var X$=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,K$=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,J$=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function Q$(e,r,t){r.themeElements={};var n;[["clrScheme",X$,z$],["fontScheme",K$,G$],["fmtScheme",J$,q$]].forEach(function(s){if(!(n=e.match(s[1])))throw new Error(s[0]+" not found in themeElements");s[2](n,r,t)})}var Z$=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function ab(e,r){(!e||e.length===0)&&(e=e5());var t,n={};if(!(t=e.match(Z$)))throw new Error("themeElements not found in theme");return Q$(t[0],n,r),n.raw=e,n}function e5(e,r){if(r&&r.themeXLSX)return r.themeXLSX;if(e&&typeof e.raw=="string")return e.raw;var t=[pv];return t[t.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',t[t.length]="<a:themeElements>",t[t.length]='<a:clrScheme name="Office">',t[t.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',t[t.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',t[t.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',t[t.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',t[t.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',t[t.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',t[t.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',t[t.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',t[t.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',t[t.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',t[t.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',t[t.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',t[t.length]="</a:clrScheme>",t[t.length]='<a:fontScheme name="Office">',t[t.length]="<a:majorFont>",t[t.length]='<a:latin typeface="Cambria"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface="Ôº≠Ôº≥ Ôº∞„Ç¥„Ç∑„ÉÉ„ÇØ"/>',t[t.length]='<a:font script="Hang" typeface="ÎßëÏùÄ Í≥†Îîï"/>',t[t.length]='<a:font script="Hans" typeface="ÂÆã‰Ωì"/>',t[t.length]='<a:font script="Hant" typeface="Êñ∞Á¥∞ÊòéÈ´î"/>',t[t.length]='<a:font script="Arab" typeface="Times New Roman"/>',t[t.length]='<a:font script="Hebr" typeface="Times New Roman"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="MoolBoran"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Times New Roman"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:majorFont>",t[t.length]="<a:minorFont>",t[t.length]='<a:latin typeface="Calibri"/>',t[t.length]='<a:ea typeface=""/>',t[t.length]='<a:cs typeface=""/>',t[t.length]='<a:font script="Jpan" typeface="Ôº≠Ôº≥ Ôº∞„Ç¥„Ç∑„ÉÉ„ÇØ"/>',t[t.length]='<a:font script="Hang" typeface="ÎßëÏùÄ Í≥†Îîï"/>',t[t.length]='<a:font script="Hans" typeface="ÂÆã‰Ωì"/>',t[t.length]='<a:font script="Hant" typeface="Êñ∞Á¥∞ÊòéÈ´î"/>',t[t.length]='<a:font script="Arab" typeface="Arial"/>',t[t.length]='<a:font script="Hebr" typeface="Arial"/>',t[t.length]='<a:font script="Thai" typeface="Tahoma"/>',t[t.length]='<a:font script="Ethi" typeface="Nyala"/>',t[t.length]='<a:font script="Beng" typeface="Vrinda"/>',t[t.length]='<a:font script="Gujr" typeface="Shruti"/>',t[t.length]='<a:font script="Khmr" typeface="DaunPenh"/>',t[t.length]='<a:font script="Knda" typeface="Tunga"/>',t[t.length]='<a:font script="Guru" typeface="Raavi"/>',t[t.length]='<a:font script="Cans" typeface="Euphemia"/>',t[t.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',t[t.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',t[t.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',t[t.length]='<a:font script="Thaa" typeface="MV Boli"/>',t[t.length]='<a:font script="Deva" typeface="Mangal"/>',t[t.length]='<a:font script="Telu" typeface="Gautami"/>',t[t.length]='<a:font script="Taml" typeface="Latha"/>',t[t.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',t[t.length]='<a:font script="Orya" typeface="Kalinga"/>',t[t.length]='<a:font script="Mlym" typeface="Kartika"/>',t[t.length]='<a:font script="Laoo" typeface="DokChampa"/>',t[t.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',t[t.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',t[t.length]='<a:font script="Viet" typeface="Arial"/>',t[t.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',t[t.length]='<a:font script="Geor" typeface="Sylfaen"/>',t[t.length]="</a:minorFont>",t[t.length]="</a:fontScheme>",t[t.length]='<a:fmtScheme name="Office">',t[t.length]="<a:fillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="1"/>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:lin ang="16200000" scaled="0"/>',t[t.length]="</a:gradFill>",t[t.length]="</a:fillStyleLst>",t[t.length]="<a:lnStyleLst>",t[t.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',t[t.length]="</a:lnStyleLst>",t[t.length]="<a:effectStyleLst>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]="</a:effectStyle>",t[t.length]="<a:effectStyle>",t[t.length]="<a:effectLst>",t[t.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',t[t.length]="</a:effectLst>",t[t.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',t[t.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',t[t.length]="</a:effectStyle>",t[t.length]="</a:effectStyleLst>",t[t.length]="<a:bgFillStyleLst>",t[t.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]='<a:gradFill rotWithShape="1">',t[t.length]="<a:gsLst>",t[t.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',t[t.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',t[t.length]="</a:gsLst>",t[t.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',t[t.length]="</a:gradFill>",t[t.length]="</a:bgFillStyleLst>",t[t.length]="</a:fmtScheme>",t[t.length]="</a:themeElements>",t[t.length]="<a:objectDefaults>",t[t.length]="<a:spDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',t[t.length]="</a:spDef>",t[t.length]="<a:lnDef>",t[t.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',t[t.length]="</a:lnDef>",t[t.length]="</a:objectDefaults>",t[t.length]="<a:extraClrSchemeLst/>",t[t.length]="</a:theme>",t.join("")}function t5(e,r,t){var n=e.l+r,s=e.read_shift(4);if(s!==124226){if(!t.cellStyles){e.l=n;return}var i=e.slice(e.l);e.l=n;var o;try{o=mv(i,{type:"array"})}catch{return}var l=zn(o,"theme/theme/theme1.xml",!0);if(l)return ab(l,t)}}function r5(e){return e.read_shift(4)}function n5(e){var r={};switch(r.xclrType=e.read_shift(2),r.nTintShade=e.read_shift(2),r.xclrType){case 0:e.l+=4;break;case 1:r.xclrValue=a5(e,4);break;case 2:r.xclrValue=Hv(e);break;case 3:r.xclrValue=r5(e);break;case 4:e.l+=4;break}return e.l+=8,r}function a5(e,r){return mn(e,r)}function s5(e,r){return mn(e,r)}function i5(e){var r=e.read_shift(2),t=e.read_shift(2)-4,n=[r];switch(r){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:n[1]=n5(e);break;case 6:n[1]=s5(e,t);break;case 14:case 15:n[1]=e.read_shift(t===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+r+" "+t)}return n}function o5(e,r){var t=e.l+r;e.l+=2;var n=e.read_shift(2);e.l+=2;for(var s=e.read_shift(2),i=[];s-- >0;)i.push(i5(e,t-e.l));return{ixfe:n,ext:i}}function l5(e,r){r.forEach(function(t){switch(t[0]){}})}function c5(e,r){return{flags:e.read_shift(4),version:e.read_shift(4),name:hn(e)}}function d5(e){for(var r=[],t=e.read_shift(4);t-- >0;)r.push([e.read_shift(4),e.read_shift(4)]);return r}function u5(e){return e.l+=4,e.read_shift(4)!=0}function f5(e,r,t){var n={Types:[],Cell:[],Value:[]},s=t||{},i=[],o=!1,l=2;return ns(e,function(c,d,u){switch(u){case 335:n.Types.push({name:c.name});break;case 51:c.forEach(function(f){l==1?n.Cell.push({type:n.Types[f[0]-1].name,index:f[1]}):l==0&&n.Value.push({type:n.Types[f[0]-1].name,index:f[1]})});break;case 337:l=c?1:0;break;case 338:l=2;break;case 35:i.push(u),o=!0;break;case 36:i.pop(),o=!1;break;default:if(!d.T){if(!o||s.WTF&&i[i.length-1]!=35)throw new Error("Unexpected record 0x"+u.toString(16))}}}),n}function h5(e,r,t){var n={Types:[],Cell:[],Value:[]};if(!e)return n;var s=!1,i=2,o;return e.replace(pn,function(l){var c=ut(l);switch(La(c[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":n.Types.push({name:c.name});break;case"</metadataType>":break;case"<futureMetadata":for(var d=0;d<n.Types.length;++d)n.Types[d].name==c.name&&(o=n.Types[d]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":i==1?n.Cell.push({type:n.Types[c.t-1].name,index:+c.v}):i==0&&n.Value.push({type:n.Types[c.t-1].name,index:+c.v});break;case"</rc>":break;case"<cellMetadata":i=1;break;case"</cellMetadata>":i=2;break;case"<valueMetadata":i=0;break;case"</valueMetadata>":i=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=!0;break;case"</ext>":s=!1;break;case"<rvb":if(!o)break;o.offsets||(o.offsets=[]),o.offsets.push(+c.i);break;default:if(!s&&t.WTF)throw new Error("unrecognized "+c[0]+" in metadata")}return l}),n}function m5(e){var r=[];if(!e)return r;var t=1;return(e.match(pn)||[]).forEach(function(n){var s=ut(n);switch(s[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete s[0],s.i?t=s.i:s.i=t,r.push(s);break}}),r}function p5(e){var r={};r.i=e.read_shift(4);var t={};t.r=e.read_shift(4),t.c=e.read_shift(4),r.r=gt(t);var n=e.read_shift(1);return n&2&&(r.l="1"),n&8&&(r.a="1"),r}function x5(e,r,t){var n=[];return ns(e,function(i,o,l){switch(l){case 63:n.push(i);break;default:if(!o.T)throw new Error("Unexpected record 0x"+l.toString(16))}}),n}function g5(e,r,t,n){if(!e)return e;var s=n||{},i=!1;ns(e,function(l,c,d){switch(d){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:i=!0;break;case 36:i=!1;break;default:if(!c.T){if(!i||s.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}},s)}function y5(e,r){if(!e)return"??";var t=(e.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return r["!id"][t].Target}function ax(e,r,t,n){var s=Array.isArray(e),i;r.forEach(function(o){var l=wn(o.ref);if(s?(e[l.r]||(e[l.r]=[]),i=e[l.r][l.c]):i=e[o.ref],!i){i={t:"z"},s?e[l.r][l.c]=i:e[o.ref]=i;var c=Sr(e["!ref"]||"BDWGO1000001:A1");c.s.r>l.r&&(c.s.r=l.r),c.e.r<l.r&&(c.e.r=l.r),c.s.c>l.c&&(c.s.c=l.c),c.e.c<l.c&&(c.e.c=l.c);var d=Nt(c);d!==e["!ref"]&&(e["!ref"]=d)}i.c||(i.c=[]);var u={a:o.author,t:o.t,r:o.r,T:t};o.h&&(u.h=o.h);for(var f=i.c.length-1;f>=0;--f){if(!t&&i.c[f].T)return;t&&!i.c[f].T&&i.c.splice(f,1)}if(t&&n){for(f=0;f<n.length;++f)if(u.a==n[f].id){u.a=n[f].name||u.a;break}}i.c.push(u)})}function v5(e,r){if(e.match(/<(?:\w+:)?comments *\/>/))return[];var t=[],n=[],s=e.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);s&&s[1]&&s[1].split(/<\/\w*:?author>/).forEach(function(o){if(!(o===""||o.trim()==="")){var l=o.match(/<(?:\w+:)?author[^>]*>(.*)/);l&&t.push(l[1])}});var i=e.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return i&&i[1]&&i[1].split(/<\/\w*:?comment>/).forEach(function(o){if(!(o===""||o.trim()==="")){var l=o.match(/<(?:\w+:)?comment[^>]*>/);if(l){var c=ut(l[0]),d={author:c.authorId&&t[c.authorId]||"sheetjsghost",ref:c.ref,guid:c.guid},u=wn(c.ref);if(!(r.sheetRows&&r.sheetRows<=u.r)){var f=o.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),h=!!f&&!!f[1]&&s0(f[1])||{r:"",t:"",h:""};d.r=h.r,h.r=="<t></t>"&&(h.t=h.h=""),d.t=(h.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),r.cellHTML&&(d.h=h.h),n.push(d)}}}}),n}function b5(e,r){var t=[],n=!1,s={},i=0;return e.replace(pn,function(l,c){var d=ut(l);switch(La(d[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":s={author:d.personId,guid:d.id,ref:d.ref,T:1};break;case"</threadedComment>":s.t!=null&&t.push(s);break;case"<text>":case"<text":i=c+l.length;break;case"</text>":s.t=e.slice(i,c).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":n=!0;break;case"</mentions>":n=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(!n&&r.WTF)throw new Error("unrecognized "+d[0]+" in threaded comments")}return l}),t}function S5(e,r){var t=[],n=!1;return e.replace(pn,function(i){var o=ut(i);switch(La(o[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":t.push({name:o.displayname,id:o.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;default:if(!n&&r.WTF)throw new Error("unrecognized "+o[0]+" in threaded comments")}return i}),t}function w5(e){var r={};r.iauthor=e.read_shift(4);var t=bi(e);return r.rfx=t.s,r.ref=gt(t.s),e.l+=16,r}var j5=hn;function E5(e,r){var t=[],n=[],s={},i=!1;return ns(e,function(l,c,d){switch(d){case 632:n.push(l);break;case 635:s=l;break;case 637:s.t=l.t,s.h=l.h,s.r=l.r;break;case 636:if(s.author=n[s.iauthor],delete s.iauthor,r.sheetRows&&s.rfx&&r.sheetRows<=s.rfx.r)break;s.t||(s.t=""),delete s.rfx,t.push(s);break;case 3072:break;case 35:i=!0;break;case 36:i=!1;break;case 37:break;case 38:break;default:if(!c.T){if(!i||r.WTF)throw new Error("Unexpected record 0x"+d.toString(16))}}}),t}var k5="application/vnd.ms-office.vbaProject";function A5(e){var r=Pt.utils.cfb_new({root:"R"});return e.FullPaths.forEach(function(t,n){if(!(t.slice(-1)==="/"||!t.match(/_VBA_PROJECT_CUR/))){var s=t.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");Pt.utils.cfb_add(r,s,e.FileIndex[n].content)}}),Pt.write(r)}function T5(){return{"!type":"dialog"}}function C5(){return{"!type":"dialog"}}function D5(){return{"!type":"macro"}}function _5(){return{"!type":"macro"}}var $i=function(){var e=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,r={r:0,c:0};function t(n,s,i,o){var l=!1,c=!1;i.length==0?c=!0:i.charAt(0)=="["&&(c=!0,i=i.slice(1,-1)),o.length==0?l=!0:o.charAt(0)=="["&&(l=!0,o=o.slice(1,-1));var d=i.length>0?parseInt(i,10)|0:0,u=o.length>0?parseInt(o,10)|0:0;return l?u+=r.c:--u,c?d+=r.r:--d,s+(l?"":"$")+Lr(u)+(c?"":"$")+en(d)}return function(s,i){return r=i,s.replace(e,t)}}(),sb=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,I5=function(){return function(r,t){return r.replace(sb,function(n,s,i,o,l,c){var d=Zh(o)-(i?0:t.c),u=Qh(c)-(l?0:t.r),f=u==0?"":l?u+1:"["+u+"]",h=d==0?"":i?d+1:"["+d+"]";return s+"R"+f+"C"+h})}}();function ib(e,r){return e.replace(sb,function(t,n,s,i,o,l){return n+(s=="$"?s+i:Lr(Zh(i)+r.c))+(o=="$"?o+l:en(Qh(l)+r.r))})}function F5(e,r,t){var n=so(r),s=n.s,i=wn(t),o={r:i.r-s.r,c:i.c-s.c};return ib(e,o)}function M5(e){return e.length!=1}function sx(e){return e.replace(/_xlfn\./g,"")}function Dr(e){e.l+=1}function Ts(e,r){var t=e.read_shift(r==1?1:2);return[t&16383,t>>14&1,t>>15&1]}function ob(e,r,t){var n=2;if(t){if(t.biff>=2&&t.biff<=5)return lb(e);t.biff==12&&(n=4)}var s=e.read_shift(n),i=e.read_shift(n),o=Ts(e,2),l=Ts(e,2);return{s:{r:s,c:o[0],cRel:o[1],rRel:o[2]},e:{r:i,c:l[0],cRel:l[1],rRel:l[2]}}}function lb(e){var r=Ts(e,2),t=Ts(e,2),n=e.read_shift(1),s=e.read_shift(1);return{s:{r:r[0],c:n,cRel:r[1],rRel:r[2]},e:{r:t[0],c:s,cRel:t[1],rRel:t[2]}}}function P5(e,r,t){if(t.biff<8)return lb(e);var n=e.read_shift(t.biff==12?4:2),s=e.read_shift(t.biff==12?4:2),i=Ts(e,2),o=Ts(e,2);return{s:{r:n,c:i[0],cRel:i[1],rRel:i[2]},e:{r:s,c:o[0],cRel:o[1],rRel:o[2]}}}function cb(e,r,t){if(t&&t.biff>=2&&t.biff<=5)return N5(e);var n=e.read_shift(t&&t.biff==12?4:2),s=Ts(e,2);return{r:n,c:s[0],cRel:s[1],rRel:s[2]}}function N5(e){var r=Ts(e,2),t=e.read_shift(1);return{r:r[0],c:t,cRel:r[1],rRel:r[2]}}function R5(e){var r=e.read_shift(2),t=e.read_shift(2);return{r,c:t&255,fQuoted:!!(t&16384),cRel:t>>15,rRel:t>>15}}function O5(e,r,t){var n=t&&t.biff?t.biff:8;if(n>=2&&n<=5)return L5(e);var s=e.read_shift(n>=12?4:2),i=e.read_shift(2),o=(i&16384)>>14,l=(i&32768)>>15;if(i&=16383,l==1)for(;s>524287;)s-=1048576;if(o==1)for(;i>8191;)i=i-16384;return{r:s,c:i,cRel:o,rRel:l}}function L5(e){var r=e.read_shift(2),t=e.read_shift(1),n=(r&32768)>>15,s=(r&16384)>>14;return r&=16383,n==1&&r>=8192&&(r=r-16384),s==1&&t>=128&&(t=t-256),{r,c:t,cRel:s,rRel:n}}function $5(e,r,t){var n=(e[e.l++]&96)>>5,s=ob(e,t.biff>=2&&t.biff<=5?6:8,t);return[n,s]}function B5(e,r,t){var n=(e[e.l++]&96)>>5,s=e.read_shift(2,"i"),i=8;if(t)switch(t.biff){case 5:e.l+=12,i=6;break;case 12:i=12;break}var o=ob(e,i,t);return[n,s,o]}function U5(e,r,t){var n=(e[e.l++]&96)>>5;return e.l+=t&&t.biff>8?12:t.biff<8?6:8,[n]}function V5(e,r,t){var n=(e[e.l++]&96)>>5,s=e.read_shift(2),i=8;if(t)switch(t.biff){case 5:e.l+=12,i=6;break;case 12:i=12;break}return e.l+=i,[n,s]}function W5(e,r,t){var n=(e[e.l++]&96)>>5,s=P5(e,r-1,t);return[n,s]}function H5(e,r,t){var n=(e[e.l++]&96)>>5;return e.l+=t.biff==2?6:t.biff==12?14:7,[n]}function ix(e){var r=e[e.l+1]&1,t=1;return e.l+=4,[r,t]}function Y5(e,r,t){e.l+=2;for(var n=e.read_shift(t&&t.biff==2?1:2),s=[],i=0;i<=n;++i)s.push(e.read_shift(t&&t.biff==2?1:2));return s}function z5(e,r,t){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(t&&t.biff==2?1:2)]}function G5(e,r,t){var n=e[e.l+1]&255?1:0;return e.l+=2,[n,e.read_shift(t&&t.biff==2?1:2)]}function q5(e){var r=e[e.l+1]&255?1:0;return e.l+=2,[r,e.read_shift(2)]}function X5(e,r,t){var n=e[e.l+1]&255?1:0;return e.l+=t&&t.biff==2?3:4,[n]}function db(e){var r=e.read_shift(1),t=e.read_shift(1);return[r,t]}function K5(e){return e.read_shift(2),db(e)}function J5(e){return e.read_shift(2),db(e)}function Q5(e,r,t){var n=(e[e.l]&96)>>5;e.l+=1;var s=cb(e,0,t);return[n,s]}function Z5(e,r,t){var n=(e[e.l]&96)>>5;e.l+=1;var s=O5(e,0,t);return[n,s]}function eB(e,r,t){var n=(e[e.l]&96)>>5;e.l+=1;var s=e.read_shift(2);t&&t.biff==5&&(e.l+=12);var i=cb(e,0,t);return[n,s,i]}function tB(e,r,t){var n=(e[e.l]&96)>>5;e.l+=1;var s=e.read_shift(t&&t.biff<=3?1:2);return[r8[s],hb[s],n]}function rB(e,r,t){var n=e[e.l++],s=e.read_shift(1),i=t&&t.biff<=3?[n==88?-1:0,e.read_shift(1)]:nB(e);return[s,(i[0]===0?hb:t8)[i[1]]]}function nB(e){return[e[e.l+1]>>7,e.read_shift(2)&32767]}function aB(e,r,t){e.l+=t&&t.biff==2?3:4}function sB(e,r,t){if(e.l++,t&&t.biff==12)return[e.read_shift(4,"i"),0];var n=e.read_shift(2),s=e.read_shift(t&&t.biff==2?1:2);return[n,s]}function iB(e){return e.l++,Si[e.read_shift(1)]}function oB(e){return e.l++,e.read_shift(2)}function lB(e){return e.l++,e.read_shift(1)!==0}function cB(e){return e.l++,dn(e)}function dB(e,r,t){return e.l++,jl(e,r-1,t)}function uB(e,r){var t=[e.read_shift(1)];if(r==12)switch(t[0]){case 2:t[0]=4;break;case 4:t[0]=16;break;case 0:t[0]=1;break;case 1:t[0]=2;break}switch(t[0]){case 4:t[1]=kr(e,1)?"TRUE":"FALSE",r!=12&&(e.l+=7);break;case 37:case 16:t[1]=Si[e[e.l]],e.l+=r==12?4:8;break;case 0:e.l+=8;break;case 1:t[1]=dn(e);break;case 2:t[1]=wi(e,0,{biff:r>0&&r<8?2:r});break;default:throw new Error("Bad SerAr: "+t[0])}return t}function fB(e,r,t){for(var n=e.read_shift(t.biff==12?4:2),s=[],i=0;i!=n;++i)s.push((t.biff==12?bi:bd)(e));return s}function hB(e,r,t){var n=0,s=0;t.biff==12?(n=e.read_shift(4),s=e.read_shift(4)):(s=1+e.read_shift(1),n=1+e.read_shift(2)),t.biff>=2&&t.biff<8&&(--n,--s==0&&(s=256));for(var i=0,o=[];i!=n&&(o[i]=[]);++i)for(var l=0;l!=s;++l)o[i][l]=uB(e,t.biff);return o}function mB(e,r,t){var n=e.read_shift(1)>>>5&3,s=!t||t.biff>=8?4:2,i=e.read_shift(s);switch(t.biff){case 2:e.l+=5;break;case 3:case 4:e.l+=8;break;case 5:e.l+=12;break}return[n,0,i]}function pB(e,r,t){if(t.biff==5)return xB(e);var n=e.read_shift(1)>>>5&3,s=e.read_shift(2),i=e.read_shift(4);return[n,s,i]}function xB(e){var r=e.read_shift(1)>>>5&3,t=e.read_shift(2,"i");e.l+=8;var n=e.read_shift(2);return e.l+=12,[r,t,n]}function gB(e,r,t){var n=e.read_shift(1)>>>5&3;e.l+=t&&t.biff==2?3:4;var s=e.read_shift(t&&t.biff==2?1:2);return[n,s]}function yB(e,r,t){var n=e.read_shift(1)>>>5&3,s=e.read_shift(t&&t.biff==2?1:2);return[n,s]}function vB(e,r,t){var n=e.read_shift(1)>>>5&3;return e.l+=4,t.biff<8&&e.l--,t.biff==12&&(e.l+=2),[n]}function bB(e,r,t){var n=(e[e.l++]&96)>>5,s=e.read_shift(2),i=4;if(t)switch(t.biff){case 5:i=15;break;case 12:i=6;break}return e.l+=i,[n,s]}var SB=mn,wB=mn,jB=mn;function kl(e,r,t){return e.l+=2,[R5(e)]}function o0(e){return e.l+=6,[]}var EB=kl,kB=o0,AB=o0,TB=kl;function ub(e){return e.l+=2,[Ir(e),e.read_shift(2)&1]}var CB=kl,DB=ub,_B=o0,IB=kl,FB=kl,MB=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function PB(e){e.l+=2;var r=e.read_shift(2),t=e.read_shift(2),n=e.read_shift(4),s=e.read_shift(2),i=e.read_shift(2),o=MB[t>>2&31];return{ixti:r,coltype:t&3,rt:o,idx:n,c:s,C:i}}function NB(e){return e.l+=2,[e.read_shift(4)]}function RB(e,r,t){return e.l+=5,e.l+=2,e.l+=t.biff==2?1:4,["PTGSHEET"]}function OB(e,r,t){return e.l+=t.biff==2?4:5,["PTGENDSHEET"]}function LB(e){var r=e.read_shift(1)>>>5&3,t=e.read_shift(2);return[r,t]}function $B(e){var r=e.read_shift(1)>>>5&3,t=e.read_shift(2);return[r,t]}function BB(e){return e.l+=4,[0,0]}var ox={1:{n:"PtgExp",f:sB},2:{n:"PtgTbl",f:jB},3:{n:"PtgAdd",f:Dr},4:{n:"PtgSub",f:Dr},5:{n:"PtgMul",f:Dr},6:{n:"PtgDiv",f:Dr},7:{n:"PtgPower",f:Dr},8:{n:"PtgConcat",f:Dr},9:{n:"PtgLt",f:Dr},10:{n:"PtgLe",f:Dr},11:{n:"PtgEq",f:Dr},12:{n:"PtgGe",f:Dr},13:{n:"PtgGt",f:Dr},14:{n:"PtgNe",f:Dr},15:{n:"PtgIsect",f:Dr},16:{n:"PtgUnion",f:Dr},17:{n:"PtgRange",f:Dr},18:{n:"PtgUplus",f:Dr},19:{n:"PtgUminus",f:Dr},20:{n:"PtgPercent",f:Dr},21:{n:"PtgParen",f:Dr},22:{n:"PtgMissArg",f:Dr},23:{n:"PtgStr",f:dB},26:{n:"PtgSheet",f:RB},27:{n:"PtgEndSheet",f:OB},28:{n:"PtgErr",f:iB},29:{n:"PtgBool",f:lB},30:{n:"PtgInt",f:oB},31:{n:"PtgNum",f:cB},32:{n:"PtgArray",f:H5},33:{n:"PtgFunc",f:tB},34:{n:"PtgFuncVar",f:rB},35:{n:"PtgName",f:mB},36:{n:"PtgRef",f:Q5},37:{n:"PtgArea",f:$5},38:{n:"PtgMemArea",f:gB},39:{n:"PtgMemErr",f:SB},40:{n:"PtgMemNoMem",f:wB},41:{n:"PtgMemFunc",f:yB},42:{n:"PtgRefErr",f:vB},43:{n:"PtgAreaErr",f:U5},44:{n:"PtgRefN",f:Z5},45:{n:"PtgAreaN",f:W5},46:{n:"PtgMemAreaN",f:LB},47:{n:"PtgMemNoMemN",f:$B},57:{n:"PtgNameX",f:pB},58:{n:"PtgRef3d",f:eB},59:{n:"PtgArea3d",f:B5},60:{n:"PtgRefErr3d",f:bB},61:{n:"PtgAreaErr3d",f:V5},255:{}},UB={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},VB={1:{n:"PtgElfLel",f:ub},2:{n:"PtgElfRw",f:IB},3:{n:"PtgElfCol",f:EB},6:{n:"PtgElfRwV",f:FB},7:{n:"PtgElfColV",f:TB},10:{n:"PtgElfRadical",f:CB},11:{n:"PtgElfRadicalS",f:_B},13:{n:"PtgElfColS",f:kB},15:{n:"PtgElfColSV",f:AB},16:{n:"PtgElfRadicalLel",f:DB},25:{n:"PtgList",f:PB},29:{n:"PtgSxName",f:NB},255:{}},WB={0:{n:"PtgAttrNoop",f:BB},1:{n:"PtgAttrSemi",f:X5},2:{n:"PtgAttrIf",f:G5},4:{n:"PtgAttrChoose",f:Y5},8:{n:"PtgAttrGoto",f:z5},16:{n:"PtgAttrSum",f:aB},32:{n:"PtgAttrBaxcel",f:ix},33:{n:"PtgAttrBaxcel",f:ix},64:{n:"PtgAttrSpace",f:K5},65:{n:"PtgAttrSpaceSemi",f:J5},128:{n:"PtgAttrIfError",f:q5},255:{}};function Al(e,r,t,n){if(n.biff<8)return mn(e,r);for(var s=e.l+r,i=[],o=0;o!==t.length;++o)switch(t[o][0]){case"PtgArray":t[o][1]=hB(e,0,n),i.push(t[o][1]);break;case"PtgMemArea":t[o][2]=fB(e,t[o][1],n),i.push(t[o][2]);break;case"PtgExp":n&&n.biff==12&&(t[o][1][1]=e.read_shift(4),i.push(t[o][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+t[o][0]}return r=s-e.l,r!==0&&i.push(mn(e,r)),i}function Tl(e,r,t){for(var n=e.l+r,s,i,o=[];n!=e.l;)r=n-e.l,i=e[e.l],s=ox[i]||ox[UB[i]],(i===24||i===25)&&(s=(i===24?VB:WB)[e[e.l+1]]),!s||!s.f?mn(e,r):o.push([s.n,s.f(e,r,t)]);return o}function HB(e){for(var r=[],t=0;t<e.length;++t){for(var n=e[t],s=[],i=0;i<n.length;++i){var o=n[i];if(o)switch(o[0]){case 2:s.push('"'+o[1].replace(/"/g,'""')+'"');break;default:s.push(o[1])}else s.push("")}r.push(s.join(","))}return r.join(";")}var YB={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function zB(e,r){if(!e&&!(r&&r.biff<=5&&r.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(e)?"'"+e+"'":e}function fb(e,r,t){if(!e)return"SH33TJSERR0";if(t.biff>8&&(!e.XTI||!e.XTI[r]))return e.SheetNames[r];if(!e.XTI)return"SH33TJSERR6";var n=e.XTI[r];if(t.biff<8)return r>1e4&&(r-=65536),r<0&&(r=-r),r==0?"":e.XTI[r-1];if(!n)return"SH33TJSERR1";var s="";if(t.biff>8)switch(e[n[0]][0]){case 357:return s=n[1]==-1?"#REF":e.SheetNames[n[1]],n[1]==n[2]?s:s+":"+e.SheetNames[n[2]];case 358:return t.SID!=null?e.SheetNames[t.SID]:"SH33TJSSAME"+e[n[0]][0];case 355:default:return"SH33TJSSRC"+e[n[0]][0]}switch(e[n[0]][0][0]){case 1025:return s=n[1]==-1?"#REF":e.SheetNames[n[1]]||"SH33TJSERR3",n[1]==n[2]?s:s+":"+e.SheetNames[n[2]];case 14849:return e[n[0]].slice(1).map(function(i){return i.Name}).join(";;");default:return e[n[0]][0][3]?(s=n[1]==-1?"#REF":e[n[0]][0][3][n[1]]||"SH33TJSERR4",n[1]==n[2]?s:s+":"+e[n[0]][0][3][n[2]]):"SH33TJSERR2"}}function lx(e,r,t){var n=fb(e,r,t);return n=="#REF"?n:zB(n,t)}function on(e,r,t,n,s){var i=s&&s.biff||8,o={s:{c:0,r:0},e:{c:0,r:0}},l=[],c,d,u,f=0,h=0,x,m="";if(!e[0]||!e[0][0])return"";for(var g=-1,p="",y=0,S=e[0].length;y<S;++y){var v=e[0][y];switch(v[0]){case"PtgUminus":l.push("-"+l.pop());break;case"PtgUplus":l.push("+"+l.pop());break;case"PtgPercent":l.push(l.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(c=l.pop(),d=l.pop(),g>=0){switch(e[0][g][1][0]){case 0:p=yr(" ",e[0][g][1][1]);break;case 1:p=yr("\r",e[0][g][1][1]);break;default:if(p="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][g][1][0])}d=d+p,g=-1}l.push(d+YB[v[0]]+c);break;case"PtgIsect":c=l.pop(),d=l.pop(),l.push(d+" "+c);break;case"PtgUnion":c=l.pop(),d=l.pop(),l.push(d+","+c);break;case"PtgRange":c=l.pop(),d=l.pop(),l.push(d+":"+c);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":u=Lo(v[1][1],o,s),l.push($o(u,i));break;case"PtgRefN":u=t?Lo(v[1][1],t,s):v[1][1],l.push($o(u,i));break;case"PtgRef3d":f=v[1][1],u=Lo(v[1][2],o,s),m=lx(n,f,s),l.push(m+"!"+$o(u,i));break;case"PtgFunc":case"PtgFuncVar":var E=v[1][0],C=v[1][1];E||(E=0),E&=127;var A=E==0?[]:l.slice(-E);l.length-=E,C==="User"&&(C=A.shift()),l.push(C+"("+A.join(",")+")");break;case"PtgBool":l.push(v[1]?"TRUE":"FALSE");break;case"PtgInt":l.push(v[1]);break;case"PtgNum":l.push(String(v[1]));break;case"PtgStr":l.push('"'+v[1].replace(/"/g,'""')+'"');break;case"PtgErr":l.push(v[1]);break;case"PtgAreaN":x=Vp(v[1][1],t?{s:t}:o,s),l.push(tu(x,s));break;case"PtgArea":x=Vp(v[1][1],o,s),l.push(tu(x,s));break;case"PtgArea3d":f=v[1][1],x=v[1][2],m=lx(n,f,s),l.push(m+"!"+tu(x,s));break;case"PtgAttrSum":l.push("SUM("+l.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":h=v[1][2];var j=(n.names||[])[h-1]||(n[0]||[])[h],w=j?j.Name:"SH33TJSNAME"+String(h);w&&w.slice(0,6)=="_xlfn."&&!s.xlfn&&(w=w.slice(6)),l.push(w);break;case"PtgNameX":var k=v[1][1];h=v[1][2];var _;if(s.biff<=5)k<0&&(k=-k),n[k]&&(_=n[k][h]);else{var I="";if(((n[k]||[])[0]||[])[0]==14849||(((n[k]||[])[0]||[])[0]==1025?n[k][h]&&n[k][h].itab>0&&(I=n.SheetNames[n[k][h].itab-1]+"!"):I=n.SheetNames[h-1]+"!"),n[k]&&n[k][h])I+=n[k][h].Name;else if(n[0]&&n[0][h])I+=n[0][h].Name;else{var D=(fb(n,k,s)||"").split(";;");D[h-1]?I=D[h-1]:I+="SH33TJSERRX"}l.push(I);break}_||(_={Name:"SH33TJSERRY"}),l.push(_.Name);break;case"PtgParen":var B="(",R=")";if(g>=0){switch(p="",e[0][g][1][0]){case 2:B=yr(" ",e[0][g][1][1])+B;break;case 3:B=yr("\r",e[0][g][1][1])+B;break;case 4:R=yr(" ",e[0][g][1][1])+R;break;case 5:R=yr("\r",e[0][g][1][1])+R;break;default:if(s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+e[0][g][1][0])}g=-1}l.push(B+l.pop()+R);break;case"PtgRefErr":l.push("#REF!");break;case"PtgRefErr3d":l.push("#REF!");break;case"PtgExp":u={c:v[1][1],r:v[1][0]};var Y={c:t.c,r:t.r};if(n.sharedf[gt(u)]){var P=n.sharedf[gt(u)];l.push(on(P,o,Y,n,s))}else{var M=!1;for(c=0;c!=n.arrayf.length;++c)if(d=n.arrayf[c],!(u.c<d[0].s.c||u.c>d[0].e.c)&&!(u.r<d[0].s.r||u.r>d[0].e.r)){l.push(on(d[1],o,Y,n,s)),M=!0;break}M||l.push(v[1])}break;case"PtgArray":l.push("{"+HB(v[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":g=y;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":l.push("");break;case"PtgAreaErr":l.push("#REF!");break;case"PtgAreaErr3d":l.push("#REF!");break;case"PtgList":l.push("Table"+v[1].idx+"[#"+v[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(v));default:throw new Error("Unrecognized Formula Token: "+String(v))}var K=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(s.biff!=3&&g>=0&&K.indexOf(e[0][y][0])==-1){v=e[0][g];var L=!0;switch(v[1][0]){case 4:L=!1;case 0:p=yr(" ",v[1][1]);break;case 5:L=!1;case 1:p=yr("\r",v[1][1]);break;default:if(p="",s.WTF)throw new Error("Unexpected PtgAttrSpaceType "+v[1][0])}l.push((L?p:"")+l.pop()+(L?"":p)),g=-1}}if(l.length>1&&s.WTF)throw new Error("bad formula stack");return l[0]}function GB(e,r,t){var n=e.l+r,s=t.biff==2?1:2,i,o=e.read_shift(s);if(o==65535)return[[],mn(e,r-2)];var l=Tl(e,o,t);return r!==o+s&&(i=Al(e,r-o-s,l,t)),e.l=n,[l,i]}function qB(e,r,t){var n=e.l+r,s=t.biff==2?1:2,i,o=e.read_shift(s);if(o==65535)return[[],mn(e,r-2)];var l=Tl(e,o,t);return r!==o+s&&(i=Al(e,r-o-s,l,t)),e.l=n,[l,i]}function XB(e,r,t,n){var s=e.l+r,i=Tl(e,n,t),o;return s!==e.l&&(o=Al(e,s-e.l,i,t)),[i,o]}function KB(e,r,t){var n=e.l+r,s,i=e.read_shift(2),o=Tl(e,i,t);return i==65535?[[],mn(e,r-2)]:(r!==i+2&&(s=Al(e,n-i-2,o,t)),[o,s])}function JB(e){var r;if(Ya(e,e.l+6)!==65535)return[dn(e),"n"];switch(e[e.l]){case 0:return e.l+=8,["String","s"];case 1:return r=e[e.l+2]===1,e.l+=8,[r,"b"];case 2:return r=e[e.l+2],e.l+=8,[r,"e"];case 3:return e.l+=8,["","s"]}return[]}function au(e,r,t){var n=e.l+r,s=$a(e);t.biff==2&&++e.l;var i=JB(e),o=e.read_shift(1);t.biff!=2&&(e.read_shift(1),t.biff>=5&&e.read_shift(4));var l=qB(e,n-e.l,t);return{cell:s,val:i[0],formula:l,shared:o>>3&1,tt:i[1]}}function Sd(e,r,t){var n=e.read_shift(4),s=Tl(e,n,t),i=e.read_shift(4),o=i>0?Al(e,i,s,t):null;return[s,o]}var QB=Sd,wd=Sd,ZB=Sd,e8=Sd,t8={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},hb={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},r8={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function cx(e){return e.slice(0,3)=="of:"&&(e=e.slice(3)),e.charCodeAt(0)==61&&(e=e.slice(1),e.charCodeAt(0)==61&&(e=e.slice(1))),e=e.replace(/COM\.MICROSOFT\./g,""),e=e.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(r,t){return t.replace(/\./g,"")}),e=e.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),e.replace(/[;~]/g,",").replace(/\|/g,";")}function su(e){var r=e.split(":"),t=r[0].split(".")[0];return[t,r[0].split(".")[1]+(r.length>1?":"+(r[1].split(".")[1]||r[1].split(".")[0]):"")]}var Wo={},Bi={};function Ho(e,r){if(e){var t=[.7,.7,.75,.75,.3,.3];r=="xlml"&&(t=[1,1,1,1,.5,.5]),e.left==null&&(e.left=t[0]),e.right==null&&(e.right=t[1]),e.top==null&&(e.top=t[2]),e.bottom==null&&(e.bottom=t[3]),e.header==null&&(e.header=t[4]),e.footer==null&&(e.footer=t[5])}}function mb(e,r,t,n,s,i){try{n.cellNF&&(e.z=bt[r])}catch(l){if(n.WTF)throw l}if(!(e.t==="z"&&!n.cellStyles)){if(e.t==="d"&&typeof e.v=="string"&&(e.v=Xr(e.v)),(!n||n.cellText!==!1)&&e.t!=="z")try{if(bt[r]==null&&Js(a3[r]||"General",r),e.t==="e")e.w=e.w||Si[e.v];else if(r===0)if(e.t==="n")(e.v|0)===e.v?e.w=e.v.toString(10):e.w=nl(e.v);else if(e.t==="d"){var o=kn(e.v);(o|0)===o?e.w=o.toString(10):e.w=nl(o)}else{if(e.v===void 0)return"";e.w=si(e.v,Bi)}else e.t==="d"?e.w=sa(r,kn(e.v),Bi):e.w=sa(r,e.v,Bi)}catch(l){if(n.WTF)throw l}if(n.cellStyles&&t!=null)try{e.s=i.Fills[t],e.s.fgColor&&e.s.fgColor.theme&&!e.s.fgColor.rgb&&(e.s.fgColor.rgb=Mc(s.themeElements.clrScheme[e.s.fgColor.theme].rgb,e.s.fgColor.tint||0),n.WTF&&(e.s.fgColor.raw_rgb=s.themeElements.clrScheme[e.s.fgColor.theme].rgb)),e.s.bgColor&&e.s.bgColor.theme&&(e.s.bgColor.rgb=Mc(s.themeElements.clrScheme[e.s.bgColor.theme].rgb,e.s.bgColor.tint||0),n.WTF&&(e.s.bgColor.raw_rgb=s.themeElements.clrScheme[e.s.bgColor.theme].rgb))}catch(l){if(n.WTF&&i.Fills)throw l}}}function n8(e,r){var t=Sr(r);t.s.r<=t.e.r&&t.s.c<=t.e.c&&t.s.r>=0&&t.s.c>=0&&(e["!ref"]=Nt(t))}var a8=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,s8=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,i8=/<(?:\w:)?hyperlink [^>]*>/mg,o8=/"(\w*:\w*)"/,l8=/<(?:\w:)?col\b[^>]*[\/]?>/g,c8=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,d8=/<(?:\w:)?pageMargins[^>]*\/>/g,pb=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,u8=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,f8=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function h8(e,r,t,n,s,i,o){if(!e)return e;n||(n={"!id":{}});var l=r.dense?[]:{},c={s:{r:2e6,c:2e6},e:{r:0,c:0}},d="",u="",f=e.match(s8);f?(d=e.slice(0,f.index),u=e.slice(f.index+f[0].length)):d=u=e;var h=d.match(pb);h?l0(h[0],l,s,t):(h=d.match(u8))&&m8(h[0],h[1]||"",l,s,t);var x=(d.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(x>0){var m=d.slice(x,x+50).match(o8);m&&n8(l,m[1])}var g=d.match(f8);g&&g[1]&&b8(g[1],s);var p=[];if(r.cellStyles){var y=d.match(l8);y&&g8(p,y)}f&&S8(f[1],l,r,c,i,o);var S=u.match(c8);S&&(l["!autofilter"]=y8(S[0]));var v=[],E=u.match(a8);if(E)for(x=0;x!=E.length;++x)v[x]=Sr(E[x].slice(E[x].indexOf('"')+1));var C=u.match(i8);C&&p8(l,C,n);var A=u.match(d8);if(A&&(l["!margins"]=x8(ut(A[0]))),!l["!ref"]&&c.e.c>=c.s.c&&c.e.r>=c.s.r&&(l["!ref"]=Nt(c)),r.sheetRows>0&&l["!ref"]){var j=Sr(l["!ref"]);r.sheetRows<=+j.e.r&&(j.e.r=r.sheetRows-1,j.e.r>c.e.r&&(j.e.r=c.e.r),j.e.r<j.s.r&&(j.s.r=j.e.r),j.e.c>c.e.c&&(j.e.c=c.e.c),j.e.c<j.s.c&&(j.s.c=j.e.c),l["!fullref"]=l["!ref"],l["!ref"]=Nt(j))}return p.length>0&&(l["!cols"]=p),v.length>0&&(l["!merges"]=v),l}function l0(e,r,t,n){var s=ut(e);t.Sheets[n]||(t.Sheets[n]={}),s.codeName&&(t.Sheets[n].CodeName=Ot(sr(s.codeName)))}function m8(e,r,t,n,s){l0(e.slice(0,e.indexOf(">")),t,n,s)}function p8(e,r,t){for(var n=Array.isArray(e),s=0;s!=r.length;++s){var i=ut(sr(r[s]),!0);if(!i.ref)return;var o=((t||{})["!id"]||[])[i.id];o?(i.Target=o.Target,i.location&&(i.Target+="#"+Ot(i.location))):(i.Target="#"+Ot(i.location),o={Target:i.Target,TargetMode:"Internal"}),i.Rel=o,i.tooltip&&(i.Tooltip=i.tooltip,delete i.tooltip);for(var l=Sr(i.ref),c=l.s.r;c<=l.e.r;++c)for(var d=l.s.c;d<=l.e.c;++d){var u=gt({c:d,r:c});n?(e[c]||(e[c]=[]),e[c][d]||(e[c][d]={t:"z",v:void 0}),e[c][d].l=i):(e[u]||(e[u]={t:"z",v:void 0}),e[u].l=i)}}}function x8(e){var r={};return["left","right","top","bottom","header","footer"].forEach(function(t){e[t]&&(r[t]=parseFloat(e[t]))}),r}function g8(e,r){for(var t=!1,n=0;n!=r.length;++n){var s=ut(r[n],!0);s.hidden&&(s.hidden=hr(s.hidden));var i=parseInt(s.min,10)-1,o=parseInt(s.max,10)-1;for(s.outlineLevel&&(s.level=+s.outlineLevel||0),delete s.min,delete s.max,s.width=+s.width,!t&&s.width&&(t=!0,i0(s.width)),Qi(s);i<=o;)e[i++]=Zr(s)}}function y8(e){var r={ref:(e.match(/ref="([^"]*)"/)||[])[1]};return r}var v8=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function b8(e,r){r.Views||(r.Views=[{}]),(e.match(v8)||[]).forEach(function(t,n){var s=ut(t);r.Views[n]||(r.Views[n]={}),+s.zoomScale&&(r.Views[n].zoom=+s.zoomScale),hr(s.rightToLeft)&&(r.Views[n].RTL=!0)})}var S8=function(){var e=/<(?:\w+:)?c[ \/>]/,r=/<\/(?:\w+:)?row>/,t=/r=["']([^"']*)["']/,n=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,s=/ref=["']([^"']*)["']/,i=al("v"),o=al("f");return function(c,d,u,f,h,x){for(var m=0,g="",p=[],y=[],S=0,v=0,E=0,C="",A,j,w=0,k=0,_,I,D=0,B=0,R=Array.isArray(x.CellXf),Y,P=[],M=[],K=Array.isArray(d),L=[],ae={},Z=!1,T=!!u.sheetStubs,N=c.split(r),H=0,G=N.length;H!=G;++H){g=N[H].trim();var q=g.length;if(q!==0){var oe=0;e:for(m=0;m<q;++m)switch(g[m]){case">":if(g[m-1]!="/"){++m;break e}if(u&&u.cellStyles){if(j=ut(g.slice(oe,m),!0),w=j.r!=null?parseInt(j.r,10):w+1,k=-1,u.sheetRows&&u.sheetRows<w)continue;ae={},Z=!1,j.ht&&(Z=!0,ae.hpt=parseFloat(j.ht),ae.hpx=ll(ae.hpt)),j.hidden=="1"&&(Z=!0,ae.hidden=!0),j.outlineLevel!=null&&(Z=!0,ae.level=+j.outlineLevel),Z&&(L[w-1]=ae)}break;case"<":oe=m;break}if(oe>=m)break;if(j=ut(g.slice(oe,m),!0),w=j.r!=null?parseInt(j.r,10):w+1,k=-1,!(u.sheetRows&&u.sheetRows<w)){f.s.r>w-1&&(f.s.r=w-1),f.e.r<w-1&&(f.e.r=w-1),u&&u.cellStyles&&(ae={},Z=!1,j.ht&&(Z=!0,ae.hpt=parseFloat(j.ht),ae.hpx=ll(ae.hpt)),j.hidden=="1"&&(Z=!0,ae.hidden=!0),j.outlineLevel!=null&&(Z=!0,ae.level=+j.outlineLevel),Z&&(L[w-1]=ae)),p=g.slice(m).split(e);for(var de=0;de!=p.length&&p[de].trim().charAt(0)=="<";++de);for(p=p.slice(de),m=0;m!=p.length;++m)if(g=p[m].trim(),g.length!==0){if(y=g.match(t),S=m,v=0,E=0,g="<c "+(g.slice(0,1)=="<"?">":"")+g,y!=null&&y.length===2){for(S=0,C=y[1],v=0;v!=C.length&&!((E=C.charCodeAt(v)-64)<1||E>26);++v)S=26*S+E;--S,k=S}else++k;for(v=0;v!=g.length&&g.charCodeAt(v)!==62;++v);if(++v,j=ut(g.slice(0,v),!0),j.r||(j.r=gt({r:w-1,c:k})),C=g.slice(v),A={t:""},(y=C.match(i))!=null&&y[1]!==""&&(A.v=Ot(y[1])),u.cellFormula){if((y=C.match(o))!=null&&y[1]!==""){if(A.f=Ot(sr(y[1])).replace(/\r\n/g,`
`),u.xlfn||(A.f=sx(A.f)),y[0].indexOf('t="array"')>-1)A.F=(C.match(s)||[])[1],A.F.indexOf(":")>-1&&P.push([Sr(A.F),A.F]);else if(y[0].indexOf('t="shared"')>-1){I=ut(y[0]);var z=Ot(sr(y[1]));u.xlfn||(z=sx(z)),M[parseInt(I.si,10)]=[I,z,j.r]}}else(y=C.match(/<f[^>]*\/>/))&&(I=ut(y[0]),M[I.si]&&(A.f=F5(M[I.si][1],M[I.si][2],j.r)));var O=wn(j.r);for(v=0;v<P.length;++v)O.r>=P[v][0].s.r&&O.r<=P[v][0].e.r&&O.c>=P[v][0].s.c&&O.c<=P[v][0].e.c&&(A.F=P[v][1])}if(j.t==null&&A.v===void 0)if(A.f||A.F)A.v=0,A.t="n";else if(T)A.t="z";else continue;else A.t=j.t||"n";switch(f.s.c>k&&(f.s.c=k),f.e.c<k&&(f.e.c=k),A.t){case"n":if(A.v==""||A.v==null){if(!T)continue;A.t="z"}else A.v=parseFloat(A.v);break;case"s":if(typeof A.v>"u"){if(!T)continue;A.t="z"}else _=Wo[parseInt(A.v,10)],A.v=_.t,A.r=_.r,u.cellHTML&&(A.h=_.h);break;case"str":A.t="s",A.v=A.v!=null?sr(A.v):"",u.cellHTML&&(A.h=Xh(A.v));break;case"inlineStr":y=C.match(n),A.t="s",y!=null&&(_=s0(y[1]))?(A.v=_.t,u.cellHTML&&(A.h=_.h)):A.v="";break;case"b":A.v=hr(A.v);break;case"d":u.cellDates?A.v=Xr(A.v,1):(A.v=kn(Xr(A.v,1)),A.t="n");break;case"e":(!u||u.cellText!==!1)&&(A.w=A.v),A.v=Rv[A.v];break}if(D=B=0,Y=null,R&&j.s!==void 0&&(Y=x.CellXf[j.s],Y!=null&&(Y.numFmtId!=null&&(D=Y.numFmtId),u.cellStyles&&Y.fillId!=null&&(B=Y.fillId))),mb(A,D,B,u,h,x),u.cellDates&&R&&A.t=="n"&&ao(bt[D])&&(A.t="d",A.v=vd(A.v)),j.cm&&u.xlmeta){var W=(u.xlmeta.Cell||[])[+j.cm-1];W&&W.type=="XLDAPR"&&(A.D=!0)}if(K){var F=wn(j.r);d[F.r]||(d[F.r]=[]),d[F.r][F.c]=A}else d[j.r]=A}}}}L.length>0&&(d["!rows"]=L)}}();function w8(e,r){var t={},n=e.l+r;t.r=e.read_shift(4),e.l+=4;var s=e.read_shift(2);e.l+=1;var i=e.read_shift(1);return e.l=n,i&7&&(t.level=i&7),i&16&&(t.hidden=!0),i&32&&(t.hpt=s/20),t}var j8=bi;function E8(){}function k8(e,r){var t={},n=e[e.l];return++e.l,t.above=!(n&64),t.left=!(n&128),e.l+=18,t.name=G3(e),t}function A8(e){var r=ia(e);return[r]}function T8(e){var r=vi(e);return[r]}function C8(e){var r=ia(e),t=e.read_shift(1);return[r,t,"b"]}function D8(e){var r=vi(e),t=e.read_shift(1);return[r,t,"b"]}function _8(e){var r=ia(e),t=e.read_shift(1);return[r,t,"e"]}function I8(e){var r=vi(e),t=e.read_shift(1);return[r,t,"e"]}function F8(e){var r=ia(e),t=e.read_shift(4);return[r,t,"s"]}function M8(e){var r=vi(e),t=e.read_shift(4);return[r,t,"s"]}function P8(e){var r=ia(e),t=dn(e);return[r,t,"n"]}function xb(e){var r=vi(e),t=dn(e);return[r,t,"n"]}function N8(e){var r=ia(e),t=r0(e);return[r,t,"n"]}function R8(e){var r=vi(e),t=r0(e);return[r,t,"n"]}function O8(e){var r=ia(e),t=e0(e);return[r,t,"is"]}function L8(e){var r=ia(e),t=hn(e);return[r,t,"str"]}function $8(e){var r=vi(e),t=hn(e);return[r,t,"str"]}function B8(e,r,t){var n=e.l+r,s=ia(e);s.r=t["!row"];var i=e.read_shift(1),o=[s,i,"b"];if(t.cellFormula){e.l+=2;var l=wd(e,n-e.l,t);o[3]=on(l,null,s,t.supbooks,t)}else e.l=n;return o}function U8(e,r,t){var n=e.l+r,s=ia(e);s.r=t["!row"];var i=e.read_shift(1),o=[s,i,"e"];if(t.cellFormula){e.l+=2;var l=wd(e,n-e.l,t);o[3]=on(l,null,s,t.supbooks,t)}else e.l=n;return o}function V8(e,r,t){var n=e.l+r,s=ia(e);s.r=t["!row"];var i=dn(e),o=[s,i,"n"];if(t.cellFormula){e.l+=2;var l=wd(e,n-e.l,t);o[3]=on(l,null,s,t.supbooks,t)}else e.l=n;return o}function W8(e,r,t){var n=e.l+r,s=ia(e);s.r=t["!row"];var i=hn(e),o=[s,i,"str"];if(t.cellFormula){e.l+=2;var l=wd(e,n-e.l,t);o[3]=on(l,null,s,t.supbooks,t)}else e.l=n;return o}var H8=bi;function Y8(e,r){var t=e.l+r,n=bi(e),s=t0(e),i=hn(e),o=hn(e),l=hn(e);e.l=t;var c={rfx:n,relId:s,loc:i,display:l};return o&&(c.Tooltip=o),c}function z8(){}function G8(e,r,t){var n=e.l+r,s=Mv(e),i=e.read_shift(1),o=[s];if(o[2]=i,t.cellFormula){var l=QB(e,n-e.l,t);o[1]=l}else e.l=n;return o}function q8(e,r,t){var n=e.l+r,s=bi(e),i=[s];if(t.cellFormula){var o=e8(e,n-e.l,t);i[1]=o,e.l=n}else e.l=n;return i}var X8=["left","right","top","bottom","header","footer"];function K8(e){var r={};return X8.forEach(function(t){r[t]=dn(e)}),r}function J8(e){var r=e.read_shift(2);return e.l+=28,{RTL:r&32}}function Q8(){}function Z8(){}function eU(e,r,t,n,s,i,o){if(!e)return e;var l=r||{};n||(n={"!id":{}});var c=l.dense?[]:{},d,u={s:{r:2e6,c:2e6},e:{r:0,c:0}},f=!1,h=!1,x,m,g,p,y,S,v,E,C,A=[];l.biff=12,l["!row"]=0;var j=0,w=!1,k=[],_={},I=l.supbooks||s.supbooks||[[]];if(I.sharedf=_,I.arrayf=k,I.SheetNames=s.SheetNames||s.Sheets.map(function(K){return K.name}),!l.supbooks&&(l.supbooks=I,s.Names))for(var D=0;D<s.Names.length;++D)I[0][D+1]=s.Names[D];var B=[],R=[],Y=!1;Rc[16]={n:"BrtShortReal",f:xb};var P;if(ns(e,function(L,ae,Z){if(!h)switch(Z){case 148:d=L;break;case 0:x=L,l.sheetRows&&l.sheetRows<=x.r&&(h=!0),E=en(p=x.r),l["!row"]=x.r,(L.hidden||L.hpt||L.level!=null)&&(L.hpt&&(L.hpx=ll(L.hpt)),R[L.r]=L);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(m={t:L[2]},L[2]){case"n":m.v=L[1];break;case"s":v=Wo[L[1]],m.v=v.t,m.r=v.r;break;case"b":m.v=!!L[1];break;case"e":m.v=L[1],l.cellText!==!1&&(m.w=Si[m.v]);break;case"str":m.t="s",m.v=L[1];break;case"is":m.t="s",m.v=L[1].t;break}if((g=o.CellXf[L[0].iStyleRef])&&mb(m,g.numFmtId,null,l,i,o),y=L[0].c==-1?y+1:L[0].c,l.dense?(c[p]||(c[p]=[]),c[p][y]=m):c[Lr(y)+E]=m,l.cellFormula){for(w=!1,j=0;j<k.length;++j){var T=k[j];x.r>=T[0].s.r&&x.r<=T[0].e.r&&y>=T[0].s.c&&y<=T[0].e.c&&(m.F=Nt(T[0]),w=!0)}!w&&L.length>3&&(m.f=L[3])}if(u.s.r>x.r&&(u.s.r=x.r),u.s.c>y&&(u.s.c=y),u.e.r<x.r&&(u.e.r=x.r),u.e.c<y&&(u.e.c=y),l.cellDates&&g&&m.t=="n"&&ao(bt[g.numFmtId])){var N=qs(m.v);N&&(m.t="d",m.v=new Date(N.y,N.m-1,N.d,N.H,N.M,N.S,N.u))}P&&(P.type=="XLDAPR"&&(m.D=!0),P=void 0);break;case 1:case 12:if(!l.sheetStubs||f)break;m={t:"z",v:void 0},y=L[0].c==-1?y+1:L[0].c,l.dense?(c[p]||(c[p]=[]),c[p][y]=m):c[Lr(y)+E]=m,u.s.r>x.r&&(u.s.r=x.r),u.s.c>y&&(u.s.c=y),u.e.r<x.r&&(u.e.r=x.r),u.e.c<y&&(u.e.c=y),P&&(P.type=="XLDAPR"&&(m.D=!0),P=void 0);break;case 176:A.push(L);break;case 49:P=((l.xlmeta||{}).Cell||[])[L-1];break;case 494:var H=n["!id"][L.relId];for(H?(L.Target=H.Target,L.loc&&(L.Target+="#"+L.loc),L.Rel=H):L.relId==""&&(L.Target="#"+L.loc),p=L.rfx.s.r;p<=L.rfx.e.r;++p)for(y=L.rfx.s.c;y<=L.rfx.e.c;++y)l.dense?(c[p]||(c[p]=[]),c[p][y]||(c[p][y]={t:"z",v:void 0}),c[p][y].l=L):(S=gt({c:y,r:p}),c[S]||(c[S]={t:"z",v:void 0}),c[S].l=L);break;case 426:if(!l.cellFormula)break;k.push(L),C=l.dense?c[p][y]:c[Lr(y)+E],C.f=on(L[1],u,{r:x.r,c:y},I,l),C.F=Nt(L[0]);break;case 427:if(!l.cellFormula)break;_[gt(L[0].s)]=L[1],C=l.dense?c[p][y]:c[Lr(y)+E],C.f=on(L[1],u,{r:x.r,c:y},I,l);break;case 60:if(!l.cellStyles)break;for(;L.e>=L.s;)B[L.e--]={width:L.w/256,hidden:!!(L.flags&1),level:L.level},Y||(Y=!0,i0(L.w/256)),Qi(B[L.e+1]);break;case 161:c["!autofilter"]={ref:Nt(L)};break;case 476:c["!margins"]=L;break;case 147:s.Sheets[t]||(s.Sheets[t]={}),L.name&&(s.Sheets[t].CodeName=L.name),(L.above||L.left)&&(c["!outline"]={above:L.above,left:L.left});break;case 137:s.Views||(s.Views=[{}]),s.Views[0]||(s.Views[0]={}),L.RTL&&(s.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:f=!0;break;case 36:f=!1;break;case 37:f=!0;break;case 38:f=!1;break;default:if(!ae.T){if(!f||l.WTF)throw new Error("Unexpected record 0x"+Z.toString(16))}}},l),delete l.supbooks,delete l["!row"],!c["!ref"]&&(u.s.r<2e6||d&&(d.e.r>0||d.e.c>0||d.s.r>0||d.s.c>0))&&(c["!ref"]=Nt(d||u)),l.sheetRows&&c["!ref"]){var M=Sr(c["!ref"]);l.sheetRows<=+M.e.r&&(M.e.r=l.sheetRows-1,M.e.r>u.e.r&&(M.e.r=u.e.r),M.e.r<M.s.r&&(M.s.r=M.e.r),M.e.c>u.e.c&&(M.e.c=u.e.c),M.e.c<M.s.c&&(M.s.c=M.e.c),c["!fullref"]=c["!ref"],c["!ref"]=Nt(M))}return A.length>0&&(c["!merges"]=A),B.length>0&&(c["!cols"]=B),R.length>0&&(c["!rows"]=R),c}function tU(e){var r=[],t=e.match(/^<c:numCache>/),n;(e.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(i){var o=i.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);o&&(r[+o[1]]=t?+o[2]:o[2])});var s=Ot((e.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(e.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(i){n=i.replace(/<.*?>/g,"")}),[r,s,n]}function rU(e,r,t,n,s,i){var o=i||{"!type":"chart"};if(!e)return i;var l=0,c=0,d="A",u={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(e.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(f){var h=tU(f);u.s.r=u.s.c=0,u.e.c=l,d=Lr(l),h[0].forEach(function(x,m){o[d+en(m)]={t:"n",v:x,z:h[1]},c=m}),u.e.r<c&&(u.e.r=c),++l}),l>0&&(o["!ref"]=Nt(u)),o}function nU(e,r,t,n,s){if(!e)return e;n||(n={"!id":{}});var i={"!type":"chart","!drawel":null,"!rel":""},o,l=e.match(pb);return l&&l0(l[0],i,s,t),(o=e.match(/drawing r:id="(.*?)"/))&&(i["!rel"]=o[1]),n["!id"][i["!rel"]]&&(i["!drawel"]=n["!id"][i["!rel"]]),i}function aU(e,r){e.l+=10;var t=hn(e);return{name:t}}function sU(e,r,t,n,s){if(!e)return e;n||(n={"!id":{}});var i={"!type":"chart","!drawel":null,"!rel":""},o=!1;return ns(e,function(c,d,u){switch(u){case 550:i["!rel"]=c;break;case 651:s.Sheets[t]||(s.Sheets[t]={}),c.name&&(s.Sheets[t].CodeName=c.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:o=!0;break;case 36:o=!1;break;case 37:break;case 38:break;default:if(!(d.T>0)){if(!(d.T<0)){if(!o||r.WTF)throw new Error("Unexpected record 0x"+u.toString(16))}}}},r),n["!id"][i["!rel"]]&&(i["!drawel"]=n["!id"][i["!rel"]]),i}var gb=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],iU=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],oU=[],lU=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function dx(e,r){for(var t=0;t!=e.length;++t)for(var n=e[t],s=0;s!=r.length;++s){var i=r[s];if(n[i[0]]==null)n[i[0]]=i[1];else switch(i[2]){case"bool":typeof n[i[0]]=="string"&&(n[i[0]]=hr(n[i[0]]));break;case"int":typeof n[i[0]]=="string"&&(n[i[0]]=parseInt(n[i[0]],10));break}}}function ux(e,r){for(var t=0;t!=r.length;++t){var n=r[t];if(e[n[0]]==null)e[n[0]]=n[1];else switch(n[2]){case"bool":typeof e[n[0]]=="string"&&(e[n[0]]=hr(e[n[0]]));break;case"int":typeof e[n[0]]=="string"&&(e[n[0]]=parseInt(e[n[0]],10));break}}}function yb(e){ux(e.WBProps,gb),ux(e.CalcPr,lU),dx(e.WBView,iU),dx(e.Sheets,oU),Bi.date1904=hr(e.WBProps.date1904)}var cU="][*?/\\".split("");function dU(e,r){if(e.length>31){if(r)return!1;throw new Error("Sheet names cannot exceed 31 chars")}var t=!0;return cU.forEach(function(n){if(e.indexOf(n)!=-1){if(!r)throw new Error("Sheet name cannot contain : \\ / ? * [ ]");t=!1}}),t}var uU=/<\w+:workbook/;function fU(e,r){if(!e)throw new Error("Could not find file");var t={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},n=!1,s="xmlns",i={},o=0;if(e.replace(pn,function(c,d){var u=ut(c);switch(La(u[0])){case"<?xml":break;case"<workbook":c.match(uU)&&(s="xmlns"+c.match(/<(\w+):/)[1]),t.xmlns=u[s];break;case"</workbook>":break;case"<fileVersion":delete u[0],t.AppVersion=u;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":gb.forEach(function(f){if(u[f[0]]!=null)switch(f[2]){case"bool":t.WBProps[f[0]]=hr(u[f[0]]);break;case"int":t.WBProps[f[0]]=parseInt(u[f[0]],10);break;default:t.WBProps[f[0]]=u[f[0]]}}),u.codeName&&(t.WBProps.CodeName=sr(u.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete u[0],t.WBView.push(u);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(u.state){case"hidden":u.Hidden=1;break;case"veryHidden":u.Hidden=2;break;default:u.Hidden=0}delete u.state,u.name=Ot(sr(u.name)),delete u[0],t.Sheets.push(u);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":n=!0;break;case"</definedNames>":n=!1;break;case"<definedName":i={},i.Name=sr(u.name),u.comment&&(i.Comment=u.comment),u.localSheetId&&(i.Sheet=+u.localSheetId),hr(u.hidden||"0")&&(i.Hidden=!0),o=d+c.length;break;case"</definedName>":i.Ref=Ot(sr(e.slice(o,d))),t.Names.push(i);break;case"<definedName/>":break;case"<calcPr":delete u[0],t.CalcPr=u;break;case"<calcPr/>":delete u[0],t.CalcPr=u;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":n=!0;break;case"</ext>":n=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":n=!0;break;case"</AlternateContent>":n=!1;break;case"<revisionPtr":break;default:if(!n&&r.WTF)throw new Error("unrecognized "+u[0]+" in workbook")}return c}),_3.indexOf(t.xmlns)===-1)throw new Error("Unknown Namespace: "+t.xmlns);return yb(t),t}function hU(e,r){var t={};return t.Hidden=e.read_shift(4),t.iTabID=e.read_shift(4),t.strRelID=Hu(e),t.name=hn(e),t}function mU(e,r){var t={},n=e.read_shift(4);t.defaultThemeVersion=e.read_shift(4);var s=r>8?hn(e):"";return s.length>0&&(t.CodeName=s),t.autoCompressPictures=!!(n&65536),t.backupFile=!!(n&64),t.checkCompatibility=!!(n&4096),t.date1904=!!(n&1),t.filterPrivacy=!!(n&8),t.hidePivotFieldList=!!(n&1024),t.promptedSolutions=!!(n&16),t.publishItems=!!(n&2048),t.refreshAllConnections=!!(n&262144),t.saveExternalLinkValues=!!(n&128),t.showBorderUnselectedTables=!!(n&4),t.showInkAnnotation=!!(n&32),t.showObjects=["all","placeholders","none"][n>>13&3],t.showPivotChartFilter=!!(n&32768),t.updateLinks=["userSet","never","always"][n>>8&3],t}function pU(e,r){var t={};return e.read_shift(4),t.ArchID=e.read_shift(4),e.l+=r-8,t}function xU(e,r,t){var n=e.l+r;e.l+=4,e.l+=1;var s=e.read_shift(4),i=q3(e),o=ZB(e,0,t),l=t0(e);e.l=n;var c={Name:i,Ptg:o};return s<268435455&&(c.Sheet=s),l&&(c.Comment=l),c}function gU(e,r){var t={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},n=[],s=!1;r||(r={}),r.biff=12;var i=[],o=[[]];return o.SheetNames=[],o.XTI=[],Rc[16]={n:"BrtFRTArchID$",f:pU},ns(e,function(c,d,u){switch(u){case 156:o.SheetNames.push(c.name),t.Sheets.push(c);break;case 153:t.WBProps=c;break;case 39:c.Sheet!=null&&(r.SID=c.Sheet),c.Ref=on(c.Ptg,null,null,o,r),delete r.SID,delete c.Ptg,i.push(c);break;case 1036:break;case 357:case 358:case 355:case 667:o[0].length?o.push([u,c]):o[0]=[u,c],o[o.length-1].XTI=[];break;case 362:o.length===0&&(o[0]=[],o[0].XTI=[]),o[o.length-1].XTI=o[o.length-1].XTI.concat(c),o.XTI=o.XTI.concat(c);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:n.push(u),s=!0;break;case 36:n.pop(),s=!1;break;case 37:n.push(u),s=!0;break;case 38:n.pop(),s=!1;break;case 16:break;default:if(!d.T){if(!s||r.WTF&&n[n.length-1]!=37&&n[n.length-1]!=35)throw new Error("Unexpected record 0x"+u.toString(16))}}},r),yb(t),t.Names=i,t.supbooks=o,t}function yU(e,r,t){return r.slice(-4)===".bin"?gU(e,t):fU(e,t)}function vU(e,r,t,n,s,i,o,l){return r.slice(-4)===".bin"?eU(e,n,t,s,i,o,l):h8(e,n,t,s,i,o,l)}function bU(e,r,t,n,s,i,o,l){return r.slice(-4)===".bin"?sU(e,n,t,s,i):nU(e,n,t,s,i)}function SU(e,r,t,n,s,i,o,l){return r.slice(-4)===".bin"?D5():_5()}function wU(e,r,t,n,s,i,o,l){return r.slice(-4)===".bin"?T5():C5()}function jU(e,r,t,n){return r.slice(-4)===".bin"?H$(e,t,n):L$(e,t,n)}function EU(e,r,t){return ab(e,t)}function kU(e,r,t){return r.slice(-4)===".bin"?i$(e,t):a$(e,t)}function AU(e,r,t){return r.slice(-4)===".bin"?E5(e,t):v5(e,t)}function TU(e,r,t){return r.slice(-4)===".bin"?x5(e):m5(e)}function CU(e,r,t,n){return t.slice(-4)===".bin"?g5(e,r,t,n):void 0}function DU(e,r,t){return r.slice(-4)===".bin"?f5(e,r,t):h5(e,r,t)}var vb=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,bb=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function da(e,r){var t=e.split(/\s+/),n=[];if(r||(n[0]=t[0]),t.length===1)return n;var s=e.match(vb),i,o,l,c;if(s)for(c=0;c!=s.length;++c)i=s[c].match(bb),(o=i[1].indexOf(":"))===-1?n[i[1]]=i[2].slice(1,i[2].length-1):(i[1].slice(0,6)==="xmlns:"?l="xmlns"+i[1].slice(6):l=i[1].slice(o+1),n[l]=i[2].slice(1,i[2].length-1));return n}function _U(e){var r=e.split(/\s+/),t={};if(r.length===1)return t;var n=e.match(vb),s,i,o,l;if(n)for(l=0;l!=n.length;++l)s=n[l].match(bb),(i=s[1].indexOf(":"))===-1?t[s[1]]=s[2].slice(1,s[2].length-1):(s[1].slice(0,6)==="xmlns:"?o="xmlns"+s[1].slice(6):o=s[1].slice(i+1),t[o]=s[2].slice(1,s[2].length-1));return t}var Yo;function IU(e,r){var t=Yo[e]||Ot(e);return t==="General"?si(r):sa(t,r)}function FU(e,r,t,n){var s=n;switch((t[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":s=hr(n);break;case"i2":case"int":s=parseInt(n,10);break;case"r4":case"float":s=parseFloat(n);break;case"date":case"dateTime.tz":s=Xr(n);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+t[0])}e[Ot(r)]=s}function MU(e,r,t){if(e.t!=="z"){if(!t||t.cellText!==!1)try{e.t==="e"?e.w=e.w||Si[e.v]:r==="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=nl(e.v):e.w=si(e.v):e.w=IU(r||"General",e.v)}catch(i){if(t.WTF)throw i}try{var n=Yo[r]||r||"General";if(t.cellNF&&(e.z=n),t.cellDates&&e.t=="n"&&ao(n)){var s=qs(e.v);s&&(e.t="d",e.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}catch(i){if(t.WTF)throw i}}}function PU(e,r,t){if(t.cellStyles&&r.Interior){var n=r.Interior;n.Pattern&&(n.patternType=F$[n.Pattern]||n.Pattern)}e[r.ID]=r}function NU(e,r,t,n,s,i,o,l,c,d){var u="General",f=n.StyleID,h={};d=d||{};var x=[],m=0;for(f===void 0&&l&&(f=l.StyleID),f===void 0&&o&&(f=o.StyleID);i[f]!==void 0&&(i[f].nf&&(u=i[f].nf),i[f].Interior&&x.push(i[f].Interior),!!i[f].Parent);)f=i[f].Parent;switch(t.Type){case"Boolean":n.t="b",n.v=hr(e);break;case"String":n.t="s",n.r=Mp(Ot(e)),n.v=e.indexOf("<")>-1?Ot(r||e).replace(/<.*?>/g,""):n.r;break;case"DateTime":e.slice(-1)!="Z"&&(e+="Z"),n.v=(Xr(e)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),n.v!==n.v?n.v=Ot(e):n.v<60&&(n.v=n.v-1),(!u||u=="General")&&(u="yyyy-mm-dd");case"Number":n.v===void 0&&(n.v=+e),n.t||(n.t="n");break;case"Error":n.t="e",n.v=Rv[e],d.cellText!==!1&&(n.w=e);break;default:e==""&&r==""?n.t="z":(n.t="s",n.v=Mp(r||e));break}if(MU(n,u,d),d.cellFormula!==!1)if(n.Formula){var g=Ot(n.Formula);g.charCodeAt(0)==61&&(g=g.slice(1)),n.f=$i(g,s),delete n.Formula,n.ArrayRange=="RC"?n.F=$i("RC:RC",s):n.ArrayRange&&(n.F=$i(n.ArrayRange,s),c.push([Sr(n.F),n.F]))}else for(m=0;m<c.length;++m)s.r>=c[m][0].s.r&&s.r<=c[m][0].e.r&&s.c>=c[m][0].s.c&&s.c<=c[m][0].e.c&&(n.F=c[m][1]);d.cellStyles&&(x.forEach(function(p){!h.patternType&&p.patternType&&(h.patternType=p.patternType)}),n.s=h),n.StyleID!==void 0&&(n.ixfe=n.StyleID)}function RU(e){e.t=e.v||"",e.t=e.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),e.v=e.w=e.ixfe=void 0}function iu(e,r){var t=r||{};ov();var n=To(Kh(e));(t.type=="binary"||t.type=="array"||t.type=="base64")&&(n=sr(n));var s=n.slice(0,1024).toLowerCase(),i=!1;if(s=s.replace(/".*?"/g,""),(s.indexOf(">")&1023)>Math.min(s.indexOf(",")&1023,s.indexOf(";")&1023)){var o=Zr(t);return o.type="string",il.to_workbook(n,o)}if(s.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(xe){s.indexOf("<"+xe)>=0&&(i=!0)}),i)return YU(n,t);Yo={"General Number":"General","General Date":bt[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":bt[15],"Short Date":bt[14],"Long Time":bt[19],"Medium Time":bt[18],"Short Time":bt[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:bt[2],Standard:bt[4],Percent:bt[10],Scientific:bt[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var l,c=[],d,u={},f=[],h=t.dense?[]:{},x="",m={},g={},p=da('<Data ss:Type="String">'),y=0,S=0,v=0,E={s:{r:2e6,c:2e6},e:{r:0,c:0}},C={},A={},j="",w=0,k=[],_={},I={},D=0,B=[],R=[],Y={},P=[],M,K=!1,L=[],ae=[],Z={},T=0,N=0,H={Sheets:[],WBProps:{date1904:!1}},G={};sl.lastIndex=0,n=n.replace(/<!--([\s\S]*?)-->/mg,"");for(var q="";l=sl.exec(n);)switch(l[3]=(q=l[3]).toLowerCase()){case"data":if(q=="data"){if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break}if(c[c.length-1][1])break;l[1]==="/"?NU(n.slice(y,l.index),j,p,c[c.length-1][0]=="comment"?Y:m,{c:S,r:v},C,P[S],g,L,t):(j="",p=da(l[0]),y=l.index+l[0].length);break;case"cell":if(l[1]==="/")if(R.length>0&&(m.c=R),(!t.sheetRows||t.sheetRows>v)&&m.v!==void 0&&(t.dense?(h[v]||(h[v]=[]),h[v][S]=m):h[Lr(S)+en(v)]=m),m.HRef&&(m.l={Target:Ot(m.HRef)},m.HRefScreenTip&&(m.l.Tooltip=m.HRefScreenTip),delete m.HRef,delete m.HRefScreenTip),(m.MergeAcross||m.MergeDown)&&(T=S+(parseInt(m.MergeAcross,10)|0),N=v+(parseInt(m.MergeDown,10)|0),k.push({s:{c:S,r:v},e:{c:T,r:N}})),!t.sheetStubs)m.MergeAcross?S=T+1:++S;else if(m.MergeAcross||m.MergeDown){for(var oe=S;oe<=T;++oe)for(var de=v;de<=N;++de)(oe>S||de>v)&&(t.dense?(h[de]||(h[de]=[]),h[de][oe]={t:"z"}):h[Lr(oe)+en(de)]={t:"z"});S=T+1}else++S;else m=_U(l[0]),m.Index&&(S=+m.Index-1),S<E.s.c&&(E.s.c=S),S>E.e.c&&(E.e.c=S),l[0].slice(-2)==="/>"&&++S,R=[];break;case"row":l[1]==="/"||l[0].slice(-2)==="/>"?(v<E.s.r&&(E.s.r=v),v>E.e.r&&(E.e.r=v),l[0].slice(-2)==="/>"&&(g=da(l[0]),g.Index&&(v=+g.Index-1)),S=0,++v):(g=da(l[0]),g.Index&&(v=+g.Index-1),Z={},(g.AutoFitHeight=="0"||g.Height)&&(Z.hpx=parseInt(g.Height,10),Z.hpt=nb(Z.hpx),ae[v]=Z),g.Hidden=="1"&&(Z.hidden=!0,ae[v]=Z));break;case"worksheet":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));f.push(x),E.s.r<=E.e.r&&E.s.c<=E.e.c&&(h["!ref"]=Nt(E),t.sheetRows&&t.sheetRows<=E.e.r&&(h["!fullref"]=h["!ref"],E.e.r=t.sheetRows-1,h["!ref"]=Nt(E))),k.length&&(h["!merges"]=k),P.length>0&&(h["!cols"]=P),ae.length>0&&(h["!rows"]=ae),u[x]=h}else E={s:{r:2e6,c:2e6},e:{r:0,c:0}},v=S=0,c.push([l[3],!1]),d=da(l[0]),x=Ot(d.Name),h=t.dense?[]:{},k=[],L=[],ae=[],G={name:x,Hidden:0},H.Sheets.push(G);break;case"table":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else{if(l[0].slice(-2)=="/>")break;c.push([l[3],!1]),P=[],K=!1}break;case"style":l[1]==="/"?PU(C,A,t):A=da(l[0]);break;case"numberformat":A.nf=Ot(da(l[0]).Format||"General"),Yo[A.nf]&&(A.nf=Yo[A.nf]);for(var z=0;z!=392&&bt[z]!=A.nf;++z);if(z==392){for(z=57;z!=392;++z)if(bt[z]==null){Js(A.nf,z);break}}break;case"column":if(c[c.length-1][0]!=="table")break;if(M=da(l[0]),M.Hidden&&(M.hidden=!0,delete M.Hidden),M.Width&&(M.wpx=parseInt(M.Width,10)),!K&&M.wpx>10){K=!0,bn=tb;for(var O=0;O<P.length;++O)P[O]&&Qi(P[O])}K&&Qi(M),P[M.Index-1||P.length]=M;for(var W=0;W<+M.Span;++W)P[P.length]=Zr(M);break;case"namedrange":if(l[1]==="/")break;H.Names||(H.Names=[]);var F=ut(l[0]),U={Name:F.Name,Ref:$i(F.RefersTo.slice(1),{r:0,c:0})};H.Sheets.length>0&&(U.Sheet=H.Sheets.length-1),H.Names.push(U);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(l[0].slice(-2)==="/>")break;l[1]==="/"?j+=n.slice(w,l.index):w=l.index+l[0].length;break;case"interior":if(!t.cellStyles)break;A.Interior=da(l[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(l[0].slice(-2)==="/>")break;l[1]==="/"?vL(_,q,n.slice(D,l.index)):D=l.index+l[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else c.push([l[3],!1]);break;case"comment":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"));RU(Y),R.push(Y)}else c.push([l[3],!1]),d=da(l[0]),Y={a:d.Author};break;case"autofilter":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else if(l[0].charAt(l[0].length-2)!=="/"){var te=da(l[0]);h["!autofilter"]={ref:$i(te.Range).replace(/\$/g,"")},c.push([l[3],!0])}break;case"name":break;case"datavalidation":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(l[1]==="/"){if((d=c.pop())[0]!==l[3])throw new Error("Bad state: "+d.join("|"))}else l[0].charAt(l[0].length-2)!=="/"&&c.push([l[3],!0]);break;case"null":break;default:if(c.length==0&&l[3]=="document"||c.length==0&&l[3]=="uof")return gx(n,t);var he=!0;switch(c[c.length-1][0]){case"officedocumentsettings":switch(l[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:he=!1}break;case"componentoptions":switch(l[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:he=!1}break;case"excelworkbook":switch(l[3]){case"date1904":H.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:he=!1}break;case"workbookoptions":switch(l[3]){case"owcversion":break;case"height":break;case"width":break;default:he=!1}break;case"worksheetoptions":switch(l[3]){case"visible":if(l[0].slice(-2)!=="/>")if(l[1]==="/")switch(n.slice(D,l.index)){case"SheetHidden":G.Hidden=1;break;case"SheetVeryHidden":G.Hidden=2;break}else D=l.index+l[0].length;break;case"header":h["!margins"]||Ho(h["!margins"]={},"xlml"),isNaN(+ut(l[0]).Margin)||(h["!margins"].header=+ut(l[0]).Margin);break;case"footer":h["!margins"]||Ho(h["!margins"]={},"xlml"),isNaN(+ut(l[0]).Margin)||(h["!margins"].footer=+ut(l[0]).Margin);break;case"pagemargins":var ie=ut(l[0]);h["!margins"]||Ho(h["!margins"]={},"xlml"),isNaN(+ie.Top)||(h["!margins"].top=+ie.Top),isNaN(+ie.Left)||(h["!margins"].left=+ie.Left),isNaN(+ie.Right)||(h["!margins"].right=+ie.Right),isNaN(+ie.Bottom)||(h["!margins"].bottom=+ie.Bottom);break;case"displayrighttoleft":H.Views||(H.Views=[]),H.Views[0]||(H.Views[0]={}),H.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":h["!outline"]||(h["!outline"]={}),h["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":h["!outline"]||(h["!outline"]={}),h["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:he=!1}break;case"pivottable":case"pivotcache":switch(l[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:he=!1}break;case"pagebreaks":switch(l[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:he=!1}break;case"autofilter":switch(l[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:he=!1}break;case"querytable":switch(l[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:he=!1}break;case"datavalidation":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:he=!1}break;case"sorting":case"conditionalformatting":switch(l[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:he=!1}break;case"mapinfo":case"schema":case"data":switch(l[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:he=!1}break;case"smarttags":break;default:he=!1;break}if(he||l[3].match(/!\[CDATA/))break;if(!c[c.length-1][1])throw"Unrecognized tag: "+l[3]+"|"+c.join("|");if(c[c.length-1][0]==="customdocumentproperties"){if(l[0].slice(-2)==="/>")break;l[1]==="/"?FU(I,q,B,n.slice(D,l.index)):(B=l,D=l.index+l[0].length);break}if(t.WTF)throw"Unrecognized tag: "+l[3]+"|"+c.join("|")}var be={};return!t.bookSheets&&!t.bookProps&&(be.Sheets=u),be.SheetNames=f,be.Workbook=H,be.SSF=Zr(bt),be.Props=_,be.Custprops=I,be}function qu(e,r){switch(u0(r=r||{}),r.type||"base64"){case"base64":return iu(Xn(e),r);case"binary":case"buffer":case"file":return iu(e,r);case"array":return iu(yi(e),r)}}function OU(e){var r={},t=e.content;if(t.l=28,r.AnsiUserType=t.read_shift(0,"lpstr-ansi"),r.AnsiClipboardFormat=J3(t),t.length-t.l<=4)return r;var n=t.read_shift(4);if(n==0||n>40||(t.l-=4,r.Reserved1=t.read_shift(0,"lpstr-ansi"),t.length-t.l<=4)||(n=t.read_shift(4),n!==1907505652)||(r.UnicodeClipboardFormat=Q3(t),n=t.read_shift(4),n==0||n>40))return r;t.l-=4,r.Reserved2=t.read_shift(0,"lpwstr")}var LU=[60,1084,2066,2165,2175];function $U(e,r,t,n,s){var i=n,o=[],l=t.slice(t.l,t.l+i);if(s&&s.enc&&s.enc.insitu&&l.length>0)switch(e){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:s.enc.insitu(l)}o.push(l),t.l+=i;for(var c=Ya(t,t.l),d=Xu[c],u=0;d!=null&&LU.indexOf(c)>-1;)i=Ya(t,t.l+2),u=t.l+4,c==2066?u+=4:(c==2165||c==2175)&&(u+=12),l=t.slice(u,t.l+4+i),o.push(l),t.l+=4+i,d=Xu[c=Ya(t,t.l)];var f=ms(o);Jr(f,0);var h=0;f.lens=[];for(var x=0;x<o.length;++x)f.lens.push(h),h+=o[x].length;if(f.length<n)throw"XLS Record 0x"+e.toString(16)+" Truncated: "+f.length+" < "+n;return r.f(f,f.length,s)}function ka(e,r,t){if(e.t!=="z"&&e.XF){var n=0;try{n=e.z||e.XF.numFmtId||0,r.cellNF&&(e.z=bt[n])}catch(i){if(r.WTF)throw i}if(!r||r.cellText!==!1)try{e.t==="e"?e.w=e.w||Si[e.v]:n===0||n=="General"?e.t==="n"?(e.v|0)===e.v?e.w=e.v.toString(10):e.w=nl(e.v):e.w=si(e.v):e.w=sa(n,e.v,{date1904:!!t,dateNF:r&&r.dateNF})}catch(i){if(r.WTF)throw i}if(r.cellDates&&n&&e.t=="n"&&ao(bt[n]||String(n))){var s=qs(e.v);s&&(e.t="d",e.v=new Date(s.y,s.m-1,s.d,s.H,s.M,s.S,s.u))}}}function Ql(e,r,t){return{v:e,ixfe:r,t}}function BU(e,r){var t={opts:{}},n={},s=r.dense?[]:{},i={},o={},l=null,c=[],d="",u={},f,h="",x,m,g,p,y={},S=[],v,E,C=[],A=[],j={Sheets:[],WBProps:{date1904:!1},Views:[{}]},w={},k=function(Ae){return Ae<8?Qs[Ae]:Ae<64&&A[Ae-8]||Qs[Ae]},_=function(Ae,Ue,Ye){var Ve=Ue.XF.data;if(!(!Ve||!Ve.patternType||!Ye||!Ye.cellStyles)){Ue.s={},Ue.s.patternType=Ve.patternType;var Xe;(Xe=ol(k(Ve.icvFore)))&&(Ue.s.fgColor={rgb:Xe}),(Xe=ol(k(Ve.icvBack)))&&(Ue.s.bgColor={rgb:Xe})}},I=function(Ae,Ue,Ye){if(!(Z>1)&&!(Ye.sheetRows&&Ae.r>=Ye.sheetRows)){if(Ye.cellStyles&&Ue.XF&&Ue.XF.data&&_(Ae,Ue,Ye),delete Ue.ixfe,delete Ue.XF,f=Ae,h=gt(Ae),(!o||!o.s||!o.e)&&(o={s:{r:0,c:0},e:{r:0,c:0}}),Ae.r<o.s.r&&(o.s.r=Ae.r),Ae.c<o.s.c&&(o.s.c=Ae.c),Ae.r+1>o.e.r&&(o.e.r=Ae.r+1),Ae.c+1>o.e.c&&(o.e.c=Ae.c+1),Ye.cellFormula&&Ue.f){for(var Ve=0;Ve<S.length;++Ve)if(!(S[Ve][0].s.c>Ae.c||S[Ve][0].s.r>Ae.r)&&!(S[Ve][0].e.c<Ae.c||S[Ve][0].e.r<Ae.r)){Ue.F=Nt(S[Ve][0]),(S[Ve][0].s.c!=Ae.c||S[Ve][0].s.r!=Ae.r)&&delete Ue.f,Ue.f&&(Ue.f=""+on(S[Ve][1],o,Ae,L,D));break}}Ye.dense?(s[Ae.r]||(s[Ae.r]=[]),s[Ae.r][Ae.c]=Ue):s[h]=Ue}},D={enc:!1,sbcch:0,snames:[],sharedf:y,arrayf:S,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!r&&!!r.cellStyles,WTF:!!r&&!!r.wtf};r.password&&(D.password=r.password);var B,R=[],Y=[],P=[],M=[],K=!1,L=[];L.SheetNames=D.snames,L.sharedf=D.sharedf,L.arrayf=D.arrayf,L.names=[],L.XTI=[];var ae=0,Z=0,T=0,N=[],H=[],G;D.codepage=1200,pa(1200);for(var q=!1;e.l<e.length-1;){var oe=e.l,de=e.read_shift(2);if(de===0&&ae===10)break;var z=e.l===e.length?0:e.read_shift(2),O=Xu[de];if(O&&O.f){if(r.bookSheets&&ae===133&&de!==133)break;if(ae=de,O.r===2||O.r==12){var W=e.read_shift(2);if(z-=2,!D.enc&&W!==de&&((W&255)<<8|W>>8)!==de)throw new Error("rt mismatch: "+W+"!="+de);O.r==12&&(e.l+=10,z-=10)}var F={};if(de===10?F=O.f(e,z,D):F=$U(de,O,e,z,D),Z==0&&[9,521,1033,2057].indexOf(ae)===-1)continue;switch(de){case 34:t.opts.Date1904=j.WBProps.date1904=F;break;case 134:t.opts.WriteProtect=!0;break;case 47:if(D.enc||(e.l=0),D.enc=F,!r.password)throw new Error("File is password-protected");if(F.valid==null)throw new Error("Encryption scheme unsupported");if(!F.valid)throw new Error("Password is incorrect");break;case 92:D.lastuser=F;break;case 66:var U=Number(F);switch(U){case 21010:U=1200;break;case 32768:U=1e4;break;case 32769:U=1252;break}pa(D.codepage=U),q=!0;break;case 317:D.rrtabid=F;break;case 25:D.winlocked=F;break;case 439:t.opts.RefreshAll=F;break;case 12:t.opts.CalcCount=F;break;case 16:t.opts.CalcDelta=F;break;case 17:t.opts.CalcIter=F;break;case 13:t.opts.CalcMode=F;break;case 14:t.opts.CalcPrecision=F;break;case 95:t.opts.CalcSaveRecalc=F;break;case 15:D.CalcRefMode=F;break;case 2211:t.opts.FullCalc=F;break;case 129:F.fDialog&&(s["!type"]="dialog"),F.fBelow||((s["!outline"]||(s["!outline"]={})).above=!0),F.fRight||((s["!outline"]||(s["!outline"]={})).left=!0);break;case 224:C.push(F);break;case 430:L.push([F]),L[L.length-1].XTI=[];break;case 35:case 547:L[L.length-1].push(F);break;case 24:case 536:G={Name:F.Name,Ref:on(F.rgce,o,null,L,D)},F.itab>0&&(G.Sheet=F.itab-1),L.names.push(G),L[0]||(L[0]=[],L[0].XTI=[]),L[L.length-1].push(F),F.Name=="_xlnm._FilterDatabase"&&F.itab>0&&F.rgce&&F.rgce[0]&&F.rgce[0][0]&&F.rgce[0][0][0]=="PtgArea3d"&&(H[F.itab-1]={ref:Nt(F.rgce[0][0][1][2])});break;case 22:D.ExternCount=F;break;case 23:L.length==0&&(L[0]=[],L[0].XTI=[]),L[L.length-1].XTI=L[L.length-1].XTI.concat(F),L.XTI=L.XTI.concat(F);break;case 2196:if(D.biff<8)break;G!=null&&(G.Comment=F[1]);break;case 18:s["!protect"]=F;break;case 19:F!==0&&D.WTF&&console.error("Password verifier: "+F);break;case 133:i[F.pos]=F,D.snames.push(F.name);break;case 10:{if(--Z)break;if(o.e){if(o.e.r>0&&o.e.c>0){if(o.e.r--,o.e.c--,s["!ref"]=Nt(o),r.sheetRows&&r.sheetRows<=o.e.r){var te=o.e.r;o.e.r=r.sheetRows-1,s["!fullref"]=s["!ref"],s["!ref"]=Nt(o),o.e.r=te}o.e.r++,o.e.c++}R.length>0&&(s["!merges"]=R),Y.length>0&&(s["!objects"]=Y),P.length>0&&(s["!cols"]=P),M.length>0&&(s["!rows"]=M),j.Sheets.push(w)}d===""?u=s:n[d]=s,s=r.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(D.biff===8&&(D.biff={9:2,521:3,1033:4}[de]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[F.BIFFVer]||8),D.biffguess=F.BIFFVer==0,F.BIFFVer==0&&F.dt==4096&&(D.biff=5,q=!0,pa(D.codepage=28591)),D.biff==8&&F.BIFFVer==0&&F.dt==16&&(D.biff=2),Z++)break;if(s=r.dense?[]:{},D.biff<8&&!q&&(q=!0,pa(D.codepage=r.codepage||1252)),D.biff<5||F.BIFFVer==0&&F.dt==4096){d===""&&(d="Sheet1"),o={s:{r:0,c:0},e:{r:0,c:0}};var he={pos:e.l-z,name:d};i[he.pos]=he,D.snames.push(d)}else d=(i[oe]||{name:""}).name;F.dt==32&&(s["!type"]="chart"),F.dt==64&&(s["!type"]="macro"),R=[],Y=[],D.arrayf=S=[],P=[],M=[],K=!1,w={Hidden:(i[oe]||{hs:0}).hs,name:d}}break;case 515:case 3:case 2:s["!type"]=="chart"&&(r.dense?(s[F.r]||[])[F.c]:s[gt({c:F.c,r:F.r})])&&++F.c,v={ixfe:F.ixfe,XF:C[F.ixfe]||{},v:F.val,t:"n"},T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:F.c,r:F.r},v,r);break;case 5:case 517:v={ixfe:F.ixfe,XF:C[F.ixfe],v:F.val,t:F.t},T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:F.c,r:F.r},v,r);break;case 638:v={ixfe:F.ixfe,XF:C[F.ixfe],v:F.rknum,t:"n"},T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:F.c,r:F.r},v,r);break;case 189:for(var ie=F.c;ie<=F.C;++ie){var be=F.rkrec[ie-F.c][0];v={ixfe:be,XF:C[be],v:F.rkrec[ie-F.c][1],t:"n"},T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:ie,r:F.r},v,r)}break;case 6:case 518:case 1030:{if(F.val=="String"){l=F;break}if(v=Ql(F.val,F.cell.ixfe,F.tt),v.XF=C[v.ixfe],r.cellFormula){var xe=F.formula;if(xe&&xe[0]&&xe[0][0]&&xe[0][0][0]=="PtgExp"){var Fe=xe[0][0][1][0],me=xe[0][0][1][1],ve=gt({r:Fe,c:me});y[ve]?v.f=""+on(F.formula,o,F.cell,L,D):v.F=((r.dense?(s[Fe]||[])[me]:s[ve])||{}).F}else v.f=""+on(F.formula,o,F.cell,L,D)}T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I(F.cell,v,r),l=F}break;case 7:case 519:if(l)l.val=F,v=Ql(F,l.cell.ixfe,"s"),v.XF=C[v.ixfe],r.cellFormula&&(v.f=""+on(l.formula,o,l.cell,L,D)),T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I(l.cell,v,r),l=null;else throw new Error("String record expects Formula");break;case 33:case 545:{S.push(F);var ne=gt(F[0].s);if(x=r.dense?(s[F[0].s.r]||[])[F[0].s.c]:s[ne],r.cellFormula&&x){if(!l||!ne||!x)break;x.f=""+on(F[1],o,F[0],L,D),x.F=Nt(F[0])}}break;case 1212:{if(!r.cellFormula)break;if(h){if(!l)break;y[gt(l.cell)]=F[0],x=r.dense?(s[l.cell.r]||[])[l.cell.c]:s[gt(l.cell)],(x||{}).f=""+on(F[0],o,f,L,D)}}break;case 253:v=Ql(c[F.isst].t,F.ixfe,"s"),c[F.isst].h&&(v.h=c[F.isst].h),v.XF=C[v.ixfe],T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:F.c,r:F.r},v,r);break;case 513:r.sheetStubs&&(v={ixfe:F.ixfe,XF:C[F.ixfe],t:"z"},T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:F.c,r:F.r},v,r));break;case 190:if(r.sheetStubs)for(var we=F.c;we<=F.C;++we){var Ee=F.ixfe[we-F.c];v={ixfe:Ee,XF:C[Ee],t:"z"},T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:we,r:F.r},v,r)}break;case 214:case 516:case 4:v=Ql(F.val,F.ixfe,"s"),v.XF=C[v.ixfe],T>0&&(v.z=N[v.ixfe>>8&63]),ka(v,r,t.opts.Date1904),I({c:F.c,r:F.r},v,r);break;case 0:case 512:Z===1&&(o=F);break;case 252:c=F;break;case 1054:if(D.biff==4){N[T++]=F[1];for(var pe=0;pe<T+163&&bt[pe]!=F[1];++pe);pe>=163&&Js(F[1],T+163)}else Js(F[1],F[0]);break;case 30:{N[T++]=F;for(var Ce=0;Ce<T+163&&bt[Ce]!=F;++Ce);Ce>=163&&Js(F,T+163)}break;case 229:R=R.concat(F);break;case 93:Y[F.cmo[0]]=D.lastobj=F;break;case 438:D.lastobj.TxO=F;break;case 127:D.lastobj.ImData=F;break;case 440:for(p=F[0].s.r;p<=F[0].e.r;++p)for(g=F[0].s.c;g<=F[0].e.c;++g)x=r.dense?(s[p]||[])[g]:s[gt({c:g,r:p})],x&&(x.l=F[1]);break;case 2048:for(p=F[0].s.r;p<=F[0].e.r;++p)for(g=F[0].s.c;g<=F[0].e.c;++g)x=r.dense?(s[p]||[])[g]:s[gt({c:g,r:p})],x&&x.l&&(x.l.Tooltip=F[1]);break;case 28:{if(D.biff<=5&&D.biff>=2)break;x=r.dense?(s[F[0].r]||[])[F[0].c]:s[gt(F[0])];var ue=Y[F[2]];x||(r.dense?(s[F[0].r]||(s[F[0].r]=[]),x=s[F[0].r][F[0].c]={t:"z"}):x=s[gt(F[0])]={t:"z"},o.e.r=Math.max(o.e.r,F[0].r),o.s.r=Math.min(o.s.r,F[0].r),o.e.c=Math.max(o.e.c,F[0].c),o.s.c=Math.min(o.s.c,F[0].c)),x.c||(x.c=[]),m={a:F[1],t:ue.TxO.t},x.c.push(m)}break;case 2173:l5(C[F.ixfe],F.ext);break;case 125:{if(!D.cellStyles)break;for(;F.e>=F.s;)P[F.e--]={width:F.w/256,level:F.level||0,hidden:!!(F.flags&1)},K||(K=!0,i0(F.w/256)),Qi(P[F.e+1])}break;case 520:{var Me={};F.level!=null&&(M[F.r]=Me,Me.level=F.level),F.hidden&&(M[F.r]=Me,Me.hidden=!0),F.hpt&&(M[F.r]=Me,Me.hpt=F.hpt,Me.hpx=ll(F.hpt))}break;case 38:case 39:case 40:case 41:s["!margins"]||Ho(s["!margins"]={}),s["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[de]]=F;break;case 161:s["!margins"]||Ho(s["!margins"]={}),s["!margins"].header=F.header,s["!margins"].footer=F.footer;break;case 574:F.RTL&&(j.Views[0].RTL=!0);break;case 146:A=F;break;case 2198:B=F;break;case 140:E=F;break;case 442:d?w.CodeName=F||w.name:j.WBProps.CodeName=F||"ThisWorkbook";break}}else O||console.error("Missing Info for XLS Record 0x"+de.toString(16)),e.l+=z}return t.SheetNames=Ra(i).sort(function(ke,Ae){return Number(ke)-Number(Ae)}).map(function(ke){return i[ke].name}),r.bookSheets||(t.Sheets=n),!t.SheetNames.length&&u["!ref"]?(t.SheetNames.push("Sheet1"),t.Sheets&&(t.Sheets.Sheet1=u)):t.Preamble=u,t.Sheets&&H.forEach(function(ke,Ae){t.Sheets[t.SheetNames[Ae]]["!autofilter"]=ke}),t.Strings=c,t.SSF=Zr(bt),D.enc&&(t.Encryption=D.enc),B&&(t.Themes=B),t.Metadata={},E!==void 0&&(t.Metadata.Country=E),L.names.length>0&&(j.Names=L.names),t.Workbook=j,t}var fx={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function UU(e,r,t){var n=Pt.find(e,"/!DocumentSummaryInformation");if(n&&n.size>0)try{var s=Xp(n,aL,fx.DSI);for(var i in s)r[i]=s[i]}catch(d){if(t.WTF)throw d}var o=Pt.find(e,"/!SummaryInformation");if(o&&o.size>0)try{var l=Xp(o,sL,fx.SI);for(var c in l)r[c]==null&&(r[c]=l[c])}catch(d){if(t.WTF)throw d}r.HeadingPairs&&r.TitlesOfParts&&(Lv(r.HeadingPairs,r.TitlesOfParts,r,t),delete r.HeadingPairs,delete r.TitlesOfParts)}function Sb(e,r){r||(r={}),u0(r),X1(),r.codepage&&Wh(r.codepage);var t,n;if(e.FullPaths){if(Pt.find(e,"/encryption"))throw new Error("File is password-protected");t=Pt.find(e,"!CompObj"),n=Pt.find(e,"/Workbook")||Pt.find(e,"/Book")}else{switch(r.type){case"base64":e=ma(Xn(e));break;case"binary":e=ma(e);break;case"buffer":break;case"array":Array.isArray(e)||(e=Array.prototype.slice.call(e));break}Jr(e,0),n={content:e}}var s,i;if(t&&OU(t),r.bookProps&&!r.bookSheets)s={};else{var o=It?"buffer":"array";if(n&&n.content)s=BU(n.content,r);else if((i=Pt.find(e,"PerfectOffice_MAIN"))&&i.content)s=Vo.to_workbook(i.content,(r.type=o,r));else if((i=Pt.find(e,"NativeContent_MAIN"))&&i.content)s=Vo.to_workbook(i.content,(r.type=o,r));else throw(i=Pt.find(e,"MN0"))&&i.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");r.bookVBA&&e.FullPaths&&Pt.find(e,"/_VBA_PROJECT_CUR/VBA/dir")&&(s.vbaraw=A5(e))}var l={};return e.FullPaths&&UU(e,l,r),s.Props=s.Custprops=l,r.bookFiles&&(s.cfb=e),s}var Rc={0:{f:w8},1:{f:A8},2:{f:N8},3:{f:_8},4:{f:C8},5:{f:P8},6:{f:L8},7:{f:F8},8:{f:W8},9:{f:V8},10:{f:B8},11:{f:U8},12:{f:T8},13:{f:R8},14:{f:I8},15:{f:D8},16:{f:xb},17:{f:$8},18:{f:M8},19:{f:e0},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:xU},40:{},42:{},43:{f:B$},44:{f:$$},45:{f:U$},46:{f:W$},47:{f:V$},48:{},49:{f:H3},50:{},51:{f:d5},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:Kv},62:{f:O8},63:{f:p5},64:{f:Q8},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:mn,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:J8},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:k8},148:{f:j8,p:16},151:{f:z8},152:{},153:{f:mU},154:{},155:{},156:{f:hU},157:{},158:{},159:{T:1,f:s$},160:{T:-1},161:{T:1,f:bi},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:H8},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:c5},336:{T:-1},337:{f:u5,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:Hu},357:{},358:{},359:{},360:{T:1},361:{},362:{f:Xv},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:G8},427:{f:q8},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:K8},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:E8},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:Y8},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:Hu},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:j5},633:{T:1},634:{T:-1},635:{T:1,f:w5},636:{T:-1},637:{f:z3},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:aU},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:Z8},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},Xu={6:{f:au},10:{f:ls},12:{f:Ir},13:{f:Ir},14:{f:kr},15:{f:kr},16:{f:dn},17:{f:kr},18:{f:kr},19:{f:Ir},20:{f:Zp},21:{f:Zp},23:{f:Xv},24:{f:tx},25:{f:kr},26:{},27:{},28:{f:b6},29:{},34:{f:kr},35:{f:ex},38:{f:dn},39:{f:dn},40:{f:dn},41:{f:dn},42:{f:kr},43:{f:kr},47:{f:E$},49:{f:t6},51:{f:Ir},60:{},61:{f:QL},64:{f:kr},65:{f:e6},66:{f:Ir},77:{},80:{},81:{},82:{},85:{f:Ir},89:{},90:{},91:{},92:{f:HL},93:{f:w6},94:{},95:{f:kr},96:{},97:{},99:{f:kr},125:{f:Kv},128:{f:u6},129:{f:YL},130:{f:Ir},131:{f:kr},132:{f:kr},133:{f:zL},134:{},140:{f:C6},141:{f:Ir},144:{},146:{f:_6},151:{},152:{},153:{},154:{},155:{},156:{f:Ir},157:{},158:{},160:{f:N6},161:{f:F6},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:o6},190:{f:l6},193:{f:ls},197:{},198:{},199:{},200:{},201:{},202:{f:kr},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:Ir},220:{},221:{f:kr},222:{},224:{f:d6},225:{f:WL},226:{f:ls},227:{},229:{f:S6},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:GL},253:{f:r6},255:{f:qL},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:Wv},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:kr},353:{f:ls},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:h6},431:{f:kr},432:{},433:{},434:{},437:{},438:{f:k6},439:{f:kr},440:{f:A6},441:{},442:{f:El},443:{},444:{f:Ir},445:{},446:{},448:{f:ls},449:{f:JL,r:2},450:{f:ls},512:{f:Jp},513:{f:P6},515:{f:f6},516:{f:n6},517:{f:Qp},519:{f:R6},520:{f:XL},523:{},545:{f:rx},549:{f:Kp},566:{},574:{f:ZL},638:{f:i6},659:{},1048:{},1054:{f:a6},1084:{},1212:{f:g6},2048:{f:T6},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:Xl},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:ls},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:I6,r:12},2173:{f:o5,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:kr,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:x6,r:12},2197:{},2198:{f:t5,r:12},2199:{},2200:{},2201:{},2202:{f:y6,r:12},2203:{f:ls},2204:{},2205:{},2206:{},2207:{},2211:{f:KL},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:Ir},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:M6},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:D6},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:Jp},1:{},2:{f:B6},3:{f:$6},4:{f:L6},5:{f:Qp},7:{f:U6},8:{},9:{f:Xl},11:{},22:{f:Ir},30:{f:s6},31:{},32:{},33:{f:rx},36:{},37:{f:Kp},50:{f:V6},62:{},52:{},67:{},68:{f:Ir},69:{},86:{},126:{},127:{f:O6},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:W6},223:{},234:{},354:{},421:{},518:{f:au},521:{f:Xl},536:{f:tx},547:{f:ex},561:{},579:{},1030:{f:au},1033:{f:Xl},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function ua(e,r,t,n){var s=r;if(!isNaN(s)){var i=n||(t||[]).length||0,o=e.next(4);o.write_shift(2,s),o.write_shift(2,i),i>0&&_v(t)&&e.push(t)}}function hx(e,r){var t=r||{},n=t.dense?[]:{};e=e.replace(/<!--.*?-->/g,"");var s=e.match(/<table/i);if(!s)throw new Error("Invalid HTML: could not find <table>");var i=e.match(/<\/table/i),o=s.index,l=i&&i.index||e.length,c=h3(e.slice(o,l),/(:?<tr[^>]*>)/i,"<tr>"),d=-1,u=0,f=0,h=0,x={s:{r:1e7,c:1e7},e:{r:0,c:0}},m=[];for(o=0;o<c.length;++o){var g=c[o].trim(),p=g.slice(0,3).toLowerCase();if(p=="<tr"){if(++d,t.sheetRows&&t.sheetRows<=d){--d;break}u=0;continue}if(!(p!="<td"&&p!="<th")){var y=g.split(/<\/t[dh]>/i);for(l=0;l<y.length;++l){var S=y[l].trim();if(S.match(/<t[dh]/i)){for(var v=S,E=0;v.charAt(0)=="<"&&(E=v.indexOf(">"))>-1;)v=v.slice(E+1);for(var C=0;C<m.length;++C){var A=m[C];A.s.c==u&&A.s.r<d&&d<=A.e.r&&(u=A.e.c+1,C=-1)}var j=ut(S.slice(0,S.indexOf(">")));h=j.colspan?+j.colspan:1,((f=+j.rowspan)>1||h>1)&&m.push({s:{r:d,c:u},e:{r:d+(f||1)-1,c:u+h-1}});var w=j.t||j["data-t"]||"";if(!v.length){u+=h;continue}if(v=gv(v),x.s.r>d&&(x.s.r=d),x.e.r<d&&(x.e.r=d),x.s.c>u&&(x.s.c=u),x.e.c<u&&(x.e.c=u),!v.length){u+=h;continue}var k={t:"s",v};t.raw||!v.trim().length||w=="s"||(v==="TRUE"?k={t:"b",v:!0}:v==="FALSE"?k={t:"b",v:!1}:isNaN(ya(v))?isNaN(Ji(v).getDate())||(k={t:"d",v:Xr(v)},t.cellDates||(k={t:"n",v:kn(k.v)}),k.z=t.dateNF||bt[14]):k={t:"n",v:ya(v)}),t.dense?(n[d]||(n[d]=[]),n[d][u]=k):n[gt({r:d,c:u})]=k,u+=h}}}}return n["!ref"]=Nt(x),m.length&&(n["!merges"]=m),n}function VU(e,r,t,n){for(var s=e["!merges"]||[],i=[],o=r.s.c;o<=r.e.c;++o){for(var l=0,c=0,d=0;d<s.length;++d)if(!(s[d].s.r>t||s[d].s.c>o)&&!(s[d].e.r<t||s[d].e.c<o)){if(s[d].s.r<t||s[d].s.c<o){l=-1;break}l=s[d].e.r-s[d].s.r+1,c=s[d].e.c-s[d].s.c+1;break}if(!(l<0)){var u=gt({r:t,c:o}),f=n.dense?(e[t]||[])[o]:e[u],h=f&&f.v!=null&&(f.h||Xh(f.w||(Ja(f),f.w)||""))||"",x={};l>1&&(x.rowspan=l),c>1&&(x.colspan=c),n.editable?h='<span contenteditable="true">'+h+"</span>":f&&(x["data-t"]=f&&f.t||"z",f.v!=null&&(x["data-v"]=f.v),f.z!=null&&(x["data-z"]=f.z),f.l&&(f.l.Target||"#").charAt(0)!="#"&&(h='<a href="'+f.l.Target+'">'+h+"</a>")),x.id=(n.id||"sjs")+"-"+u,i.push(C3("td",h,x))}}var m="<tr>";return m+i.join("")+"</tr>"}var WU='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HU="</body></html>";function YU(e,r){var t=e.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!t||t.length==0)throw new Error("Invalid HTML: could not find <table>");if(t.length==1)return Fs(hx(t[0],r),r);var n=h0();return t.forEach(function(s,i){m0(n,hx(s,r),"Sheet"+(i+1))}),n}function zU(e,r,t){var n=[];return n.join("")+"<table"+(t&&t.id?' id="'+t.id+'"':"")+">"}function GU(e,r){var t=r||{},n=t.header!=null?t.header:WU,s=t.footer!=null?t.footer:HU,i=[n],o=so(e["!ref"]);t.dense=Array.isArray(e),i.push(zU(e,o,t));for(var l=o.s.r;l<=o.e.r;++l)i.push(VU(e,o,l,t));return i.push("</table>"+s),i.join("")}function wb(e,r,t){var n=t||{},s=0,i=0;if(n.origin!=null)if(typeof n.origin=="number")s=n.origin;else{var o=typeof n.origin=="string"?wn(n.origin):n.origin;s=o.r,i=o.c}var l=r.getElementsByTagName("tr"),c=Math.min(n.sheetRows||1e7,l.length),d={s:{r:0,c:0},e:{r:s,c:i}};if(e["!ref"]){var u=so(e["!ref"]);d.s.r=Math.min(d.s.r,u.s.r),d.s.c=Math.min(d.s.c,u.s.c),d.e.r=Math.max(d.e.r,u.e.r),d.e.c=Math.max(d.e.c,u.e.c),s==-1&&(d.e.r=s=u.e.r+1)}var f=[],h=0,x=e["!rows"]||(e["!rows"]=[]),m=0,g=0,p=0,y=0,S=0,v=0;for(e["!cols"]||(e["!cols"]=[]);m<l.length&&g<c;++m){var E=l[m];if(mx(E)){if(n.display)continue;x[g]={hidden:!0}}var C=E.children;for(p=y=0;p<C.length;++p){var A=C[p];if(!(n.display&&mx(A))){var j=A.hasAttribute("data-v")?A.getAttribute("data-v"):A.hasAttribute("v")?A.getAttribute("v"):gv(A.innerHTML),w=A.getAttribute("data-z")||A.getAttribute("z");for(h=0;h<f.length;++h){var k=f[h];k.s.c==y+i&&k.s.r<g+s&&g+s<=k.e.r&&(y=k.e.c+1-i,h=-1)}v=+A.getAttribute("colspan")||1,((S=+A.getAttribute("rowspan")||1)>1||v>1)&&f.push({s:{r:g+s,c:y+i},e:{r:g+s+(S||1)-1,c:y+i+(v||1)-1}});var _={t:"s",v:j},I=A.getAttribute("data-t")||A.getAttribute("t")||"";j!=null&&(j.length==0?_.t=I||"z":n.raw||j.trim().length==0||I=="s"||(j==="TRUE"?_={t:"b",v:!0}:j==="FALSE"?_={t:"b",v:!1}:isNaN(ya(j))?isNaN(Ji(j).getDate())||(_={t:"d",v:Xr(j)},n.cellDates||(_={t:"n",v:kn(_.v)}),_.z=n.dateNF||bt[14]):_={t:"n",v:ya(j)})),_.z===void 0&&w!=null&&(_.z=w);var D="",B=A.getElementsByTagName("A");if(B&&B.length)for(var R=0;R<B.length&&!(B[R].hasAttribute("href")&&(D=B[R].getAttribute("href"),D.charAt(0)!="#"));++R);D&&D.charAt(0)!="#"&&(_.l={Target:D}),n.dense?(e[g+s]||(e[g+s]=[]),e[g+s][y+i]=_):e[gt({c:y+i,r:g+s})]=_,d.e.c<y+i&&(d.e.c=y+i),y+=v}}++g}return f.length&&(e["!merges"]=(e["!merges"]||[]).concat(f)),d.e.r=Math.max(d.e.r,g-1+s),e["!ref"]=Nt(d),g>=c&&(e["!fullref"]=Nt((d.e.r=l.length-m+g-1+s,d))),e}function jb(e,r){var t=r||{},n=t.dense?[]:{};return wb(n,e,r)}function qU(e,r){return Fs(jb(e,r),r)}function mx(e){var r="",t=XU(e);return t&&(r=t(e).getPropertyValue("display")),r||(r=e.style&&e.style.display),r==="none"}function XU(e){return e.ownerDocument.defaultView&&typeof e.ownerDocument.defaultView.getComputedStyle=="function"?e.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function KU(e){var r=e.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(n,s){return Array(parseInt(s,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),t=Ot(r.replace(/<[^>]*>/g,""));return[t]}var px={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function Eb(e,r){var t=r||{},n=Kh(e),s=[],i,o,l={name:""},c="",d=0,u,f,h={},x=[],m=t.dense?[]:{},g,p,y={value:""},S="",v=0,E=[],C=-1,A=-1,j={s:{r:1e6,c:1e7},e:{r:0,c:0}},w=0,k={},_=[],I={},D=0,B=0,R=[],Y=1,P=1,M=[],K={Names:[]},L={},ae=["",""],Z=[],T={},N="",H=0,G=!1,q=!1,oe=0;for(sl.lastIndex=0,n=n.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");g=sl.exec(n);)switch(g[3]=g[3].replace(/_.*$/,"")){case"table":case"Â∑•‰ΩúË°®":g[1]==="/"?(j.e.c>=j.s.c&&j.e.r>=j.s.r?m["!ref"]=Nt(j):m["!ref"]="A1:A1",t.sheetRows>0&&t.sheetRows<=j.e.r&&(m["!fullref"]=m["!ref"],j.e.r=t.sheetRows-1,m["!ref"]=Nt(j)),_.length&&(m["!merges"]=_),R.length&&(m["!rows"]=R),u.name=u.ÂêçÁß∞||u.name,typeof JSON<"u"&&JSON.stringify(u),x.push(u.name),h[u.name]=m,q=!1):g[0].charAt(g[0].length-2)!=="/"&&(u=ut(g[0],!1),C=A=-1,j.s.r=j.s.c=1e7,j.e.r=j.e.c=0,m=t.dense?[]:{},_=[],R=[],q=!0);break;case"table-row-group":g[1]==="/"?--w:++w;break;case"table-row":case"Ë°å":if(g[1]==="/"){C+=Y,Y=1;break}if(f=ut(g[0],!1),f.Ë°åÂè∑?C=f.Ë°åÂè∑-1:C==-1&&(C=0),Y=+f["number-rows-repeated"]||1,Y<10)for(oe=0;oe<Y;++oe)w>0&&(R[C+oe]={level:w});A=-1;break;case"covered-table-cell":g[1]!=="/"&&++A,t.sheetStubs&&(t.dense?(m[C]||(m[C]=[]),m[C][A]={t:"z"}):m[gt({r:C,c:A})]={t:"z"}),S="",E=[];break;case"table-cell":case"Êï∞ÊçÆ":if(g[0].charAt(g[0].length-2)==="/")++A,y=ut(g[0],!1),P=parseInt(y["number-columns-repeated"]||"1",10),p={t:"z",v:null},y.formula&&t.cellFormula!=!1&&(p.f=cx(Ot(y.formula))),(y.Êï∞ÊçÆÁ±ªÂûã||y["value-type"])=="string"&&(p.t="s",p.v=Ot(y["string-value"]||""),t.dense?(m[C]||(m[C]=[]),m[C][A]=p):m[gt({r:C,c:A})]=p),A+=P-1;else if(g[1]!=="/"){++A,S="",v=0,E=[],P=1;var de=Y?C+Y-1:C;if(A>j.e.c&&(j.e.c=A),A<j.s.c&&(j.s.c=A),C<j.s.r&&(j.s.r=C),de>j.e.r&&(j.e.r=de),y=ut(g[0],!1),Z=[],T={},p={t:y.Êï∞ÊçÆÁ±ªÂûã||y["value-type"],v:null},t.cellFormula)if(y.formula&&(y.formula=Ot(y.formula)),y["number-matrix-columns-spanned"]&&y["number-matrix-rows-spanned"]&&(D=parseInt(y["number-matrix-rows-spanned"],10)||0,B=parseInt(y["number-matrix-columns-spanned"],10)||0,I={s:{r:C,c:A},e:{r:C+D-1,c:A+B-1}},p.F=Nt(I),M.push([I,p.F])),y.formula)p.f=cx(y.formula);else for(oe=0;oe<M.length;++oe)C>=M[oe][0].s.r&&C<=M[oe][0].e.r&&A>=M[oe][0].s.c&&A<=M[oe][0].e.c&&(p.F=M[oe][1]);switch((y["number-columns-spanned"]||y["number-rows-spanned"])&&(D=parseInt(y["number-rows-spanned"],10)||0,B=parseInt(y["number-columns-spanned"],10)||0,I={s:{r:C,c:A},e:{r:C+D-1,c:A+B-1}},_.push(I)),y["number-columns-repeated"]&&(P=parseInt(y["number-columns-repeated"],10)),p.t){case"boolean":p.t="b",p.v=hr(y["boolean-value"]);break;case"float":p.t="n",p.v=parseFloat(y.value);break;case"percentage":p.t="n",p.v=parseFloat(y.value);break;case"currency":p.t="n",p.v=parseFloat(y.value);break;case"date":p.t="d",p.v=Xr(y["date-value"]),t.cellDates||(p.t="n",p.v=kn(p.v)),p.z="m/d/yy";break;case"time":p.t="n",p.v=d3(y["time-value"])/86400,t.cellDates&&(p.t="d",p.v=vd(p.v)),p.z="HH:MM:SS";break;case"number":p.t="n",p.v=parseFloat(y.Êï∞ÊçÆÊï∞ÂÄº);break;default:if(p.t==="string"||p.t==="text"||!p.t)p.t="s",y["string-value"]!=null&&(S=Ot(y["string-value"]),E=[]);else throw new Error("Unsupported value type "+p.t)}}else{if(G=!1,p.t==="s"&&(p.v=S||"",E.length&&(p.R=E),G=v==0),L.Target&&(p.l=L),Z.length>0&&(p.c=Z,Z=[]),S&&t.cellText!==!1&&(p.w=S),G&&(p.t="z",delete p.v),(!G||t.sheetStubs)&&!(t.sheetRows&&t.sheetRows<=C))for(var z=0;z<Y;++z){if(P=parseInt(y["number-columns-repeated"]||"1",10),t.dense)for(m[C+z]||(m[C+z]=[]),m[C+z][A]=z==0?p:Zr(p);--P>0;)m[C+z][A+P]=Zr(p);else for(m[gt({r:C+z,c:A})]=p;--P>0;)m[gt({r:C+z,c:A+P})]=Zr(p);j.e.c<=A&&(j.e.c=A)}P=parseInt(y["number-columns-repeated"]||"1",10),A+=P-1,P=0,p={},S="",E=[]}L={};break;case"document":case"document-content":case"ÁîµÂ≠êË°®Ê†ºÊñáÊ°£":case"spreadsheet":case"‰∏ª‰Ωì":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(g[1]==="/"){if((i=s.pop())[0]!==g[3])throw"Bad state: "+i}else g[0].charAt(g[0].length-2)!=="/"&&s.push([g[3],!0]);break;case"annotation":if(g[1]==="/"){if((i=s.pop())[0]!==g[3])throw"Bad state: "+i;T.t=S,E.length&&(T.R=E),T.a=N,Z.push(T)}else g[0].charAt(g[0].length-2)!=="/"&&s.push([g[3],!1]);N="",H=0,S="",v=0,E=[];break;case"creator":g[1]==="/"?N=n.slice(H,g.index):H=g.index+g[0].length;break;case"meta":case"ÂÖÉÊï∞ÊçÆ":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(g[1]==="/"){if((i=s.pop())[0]!==g[3])throw"Bad state: "+i}else g[0].charAt(g[0].length-2)!=="/"&&s.push([g[3],!1]);S="",v=0,E=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(g[1]==="/"){if(k[l.name]=c,(i=s.pop())[0]!==g[3])throw"Bad state: "+i}else g[0].charAt(g[0].length-2)!=="/"&&(c="",l=ut(g[0],!1),s.push([g[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(s[s.length-1][0]){case"time-style":case"date-style":o=ut(g[0],!1),c+=px[g[3]][o.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(s[s.length-1][0]){case"time-style":case"date-style":o=ut(g[0],!1),c+=px[g[3]][o.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(g[0].slice(-2)==="/>")break;if(g[1]==="/")switch(s[s.length-1][0]){case"number-style":case"date-style":case"time-style":c+=n.slice(d,g.index);break}else d=g.index+g[0].length;break;case"named-range":o=ut(g[0],!1),ae=su(o["cell-range-address"]);var O={Name:o.name,Ref:ae[0]+"!"+ae[1]};q&&(O.Sheet=x.length),K.Names.push(O);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"ÁîµÂ≠êË°®Ê†º":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"ÊñáÊú¨‰∏≤":if(["master-styles"].indexOf(s[s.length-1][0])>-1)break;if(g[1]==="/"&&(!y||!y["string-value"])){var W=KU(n.slice(v,g.index));S=(S.length>0?S+`
`:"")+W[0]}else ut(g[0],!1),v=g.index+g[0].length;break;case"s":break;case"database-range":if(g[1]==="/")break;try{ae=su(ut(g[0])["target-range-address"]),h[ae[0]]["!autofilter"]={ref:ae[1]}}catch{}break;case"date":break;case"object":break;case"title":case"Ê†áÈ¢ò":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(g[1]!=="/"){if(L=ut(g[0],!1),!L.href)break;L.Target=Ot(L.href),delete L.href,L.Target.charAt(0)=="#"&&L.Target.indexOf(".")>-1?(ae=su(L.Target.slice(1)),L.Target="#"+ae[0]+"!"+ae[1]):L.Target.match(/^\.\.[\\\/]/)&&(L.Target=L.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(g[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"Ë°®:":case"Â≠ó:":break;default:if(t.WTF)throw new Error(g)}}var F={Sheets:h,SheetNames:x,Workbook:K};return t.bookSheets&&delete F.Sheets,F}function xx(e,r){r=r||{},ra(e,"META-INF/manifest.xml")&&fL(_r(e,"META-INF/manifest.xml"),r);var t=zn(e,"content.xml");if(!t)throw new Error("Missing content.xml in ODS / UOF file");var n=Eb(sr(t),r);return ra(e,"meta.xml")&&(n.Props=Ov(_r(e,"meta.xml"))),n}function gx(e,r){return Eb(e,r)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function c0(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}function Ku(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):sr(yi(e))}function Ju(e){var r=e.reduce(function(s,i){return s+i.length},0),t=new Uint8Array(r),n=0;return e.forEach(function(s){t.set(s,n),n+=s.length}),t}function yx(e){return e-=e>>1&1431655765,e=(e&858993459)+(e>>2&858993459),(e+(e>>4)&252645135)*16843009>>>24}function JU(e,r){for(var t=(e[r+15]&127)<<7|e[r+14]>>1,n=e[r+14]&1,s=r+13;s>=r;--s)n=n*256+e[s];return(e[r+15]&128?-n:n)*Math.pow(10,t-6176)}function cl(e,r){var t=r?r[0]:0,n=e[t]&127;e:if(e[t++]>=128&&(n|=(e[t]&127)<<7,e[t++]<128||(n|=(e[t]&127)<<14,e[t++]<128)||(n|=(e[t]&127)<<21,e[t++]<128)||(n+=(e[t]&127)*Math.pow(2,28),++t,e[t++]<128)||(n+=(e[t]&127)*Math.pow(2,35),++t,e[t++]<128)||(n+=(e[t]&127)*Math.pow(2,42),++t,e[t++]<128)))break e;return r&&(r[0]=t),n}function Br(e){var r=0,t=e[r]&127;e:if(e[r++]>=128){if(t|=(e[r]&127)<<7,e[r++]<128||(t|=(e[r]&127)<<14,e[r++]<128)||(t|=(e[r]&127)<<21,e[r++]<128))break e;t|=(e[r]&127)<<28}return t}function fn(e){for(var r=[],t=[0];t[0]<e.length;){var n=t[0],s=cl(e,t),i=s&7;s=Math.floor(s/8);var o=0,l;if(s==0)break;switch(i){case 0:{for(var c=t[0];e[t[0]++]>=128;);l=e.slice(c,t[0])}break;case 5:o=4,l=e.slice(t[0],t[0]+o),t[0]+=o;break;case 1:o=8,l=e.slice(t[0],t[0]+o),t[0]+=o;break;case 2:o=cl(e,t),l=e.slice(t[0],t[0]+o),t[0]+=o;break;case 3:case 4:default:throw new Error("PB Type ".concat(i," for Field ").concat(s," at offset ").concat(n))}var d={data:l,type:i};r[s]==null?r[s]=[d]:r[s].push(d)}return r}function d0(e,r){return(e==null?void 0:e.map(function(t){return r(t.data)}))||[]}function QU(e){for(var r,t=[],n=[0];n[0]<e.length;){var s=cl(e,n),i=fn(e.slice(n[0],n[0]+s));n[0]+=s;var o={id:Br(i[1][0].data),messages:[]};i[2].forEach(function(l){var c=fn(l.data),d=Br(c[3][0].data);o.messages.push({meta:c,data:e.slice(n[0],n[0]+d)}),n[0]+=d}),(r=i[3])!=null&&r[0]&&(o.merge=Br(i[3][0].data)>>>0>0),t.push(o)}return t}function ZU(e,r){if(e!=0)throw new Error("Unexpected Snappy chunk type ".concat(e));for(var t=[0],n=cl(r,t),s=[];t[0]<r.length;){var i=r[t[0]]&3;if(i==0){var o=r[t[0]++]>>2;if(o<60)++o;else{var l=o-59;o=r[t[0]],l>1&&(o|=r[t[0]+1]<<8),l>2&&(o|=r[t[0]+2]<<16),l>3&&(o|=r[t[0]+3]<<24),o>>>=0,o++,t[0]+=l}s.push(r.slice(t[0],t[0]+o)),t[0]+=o;continue}else{var c=0,d=0;if(i==1?(d=(r[t[0]]>>2&7)+4,c=(r[t[0]++]&224)<<3,c|=r[t[0]++]):(d=(r[t[0]++]>>2)+1,i==2?(c=r[t[0]]|r[t[0]+1]<<8,t[0]+=2):(c=(r[t[0]]|r[t[0]+1]<<8|r[t[0]+2]<<16|r[t[0]+3]<<24)>>>0,t[0]+=4)),s=[Ju(s)],c==0)throw new Error("Invalid offset 0");if(c>s[0].length)throw new Error("Invalid offset beyond length");if(d>=c)for(s.push(s[0].slice(-c)),d-=c;d>=s[s.length-1].length;)s.push(s[s.length-1]),d-=s[s.length-1].length;s.push(s[0].slice(-c,-c+d))}}var u=Ju(s);if(u.length!=n)throw new Error("Unexpected length: ".concat(u.length," != ").concat(n));return u}function e9(e){for(var r=[],t=0;t<e.length;){var n=e[t++],s=e[t]|e[t+1]<<8|e[t+2]<<16;t+=3,r.push(ZU(n,e.slice(t,t+s))),t+=s}if(t!==e.length)throw new Error("data is not a valid framed stream!");return Ju(r)}function t9(e,r,t,n){var s=c0(e),i=s.getUint32(4,!0),o=(n>1?12:8)+yx(i&(n>1?3470:398))*4,l=-1,c=-1,d=NaN,u=new Date(2001,0,1);i&512&&(l=s.getUint32(o,!0),o+=4),o+=yx(i&(n>1?12288:4096))*4,i&16&&(c=s.getUint32(o,!0),o+=4),i&32&&(d=s.getFloat64(o,!0),o+=8),i&64&&(u.setTime(u.getTime()+s.getFloat64(o,!0)*1e3),o+=8);var f;switch(e[2]){case 0:break;case 2:f={t:"n",v:d};break;case 3:f={t:"s",v:r[c]};break;case 5:f={t:"d",v:u};break;case 6:f={t:"b",v:d>0};break;case 7:f={t:"n",v:d/86400};break;case 8:f={t:"e",v:0};break;case 9:if(l>-1)f={t:"s",v:t[l]};else if(c>-1)f={t:"s",v:r[c]};else if(!isNaN(d))f={t:"n",v:d};else throw new Error("Unsupported cell type ".concat(e.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(e.slice(0,4)))}return f}function r9(e,r,t){var n=c0(e),s=n.getUint32(8,!0),i=12,o=-1,l=-1,c=NaN,d=NaN,u=new Date(2001,0,1);s&1&&(c=JU(e,i),i+=16),s&2&&(d=n.getFloat64(i,!0),i+=8),s&4&&(u.setTime(u.getTime()+n.getFloat64(i,!0)*1e3),i+=8),s&8&&(l=n.getUint32(i,!0),i+=4),s&16&&(o=n.getUint32(i,!0),i+=4);var f;switch(e[1]){case 0:break;case 2:f={t:"n",v:c};break;case 3:f={t:"s",v:r[l]};break;case 5:f={t:"d",v:u};break;case 6:f={t:"b",v:d>0};break;case 7:f={t:"n",v:d/86400};break;case 8:f={t:"e",v:0};break;case 9:if(o>-1)f={t:"s",v:t[o]};else throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(s&31," : ").concat(e.slice(0,4)));break;case 10:f={t:"n",v:c};break;default:throw new Error("Unsupported cell type ".concat(e[1]," : ").concat(s&31," : ").concat(e.slice(0,4)))}return f}function n9(e,r,t){switch(e[0]){case 0:case 1:case 2:case 3:return t9(e,r,t,e[0]);case 5:return r9(e,r,t);default:throw new Error("Unsupported payload version ".concat(e[0]))}}function Ss(e){var r=fn(e);return cl(r[1][0].data)}function vx(e,r){var t=fn(r.data),n=Br(t[1][0].data),s=t[3],i=[];return(s||[]).forEach(function(o){var l=fn(o.data),c=Br(l[1][0].data)>>>0;switch(n){case 1:i[c]=Ku(l[3][0].data);break;case 8:{var d=e[Ss(l[9][0].data)][0],u=fn(d.data),f=e[Ss(u[1][0].data)][0],h=Br(f.meta[1][0].data);if(h!=2001)throw new Error("2000 unexpected reference to ".concat(h));var x=fn(f.data);i[c]=x[3].map(function(m){return Ku(m.data)}).join("")}break}}),i}function a9(e,r){var t,n,s,i,o,l,c,d,u,f,h,x,m,g,p=fn(e),y=Br(p[1][0].data)>>>0,S=Br(p[2][0].data)>>>0,v=((n=(t=p[8])==null?void 0:t[0])==null?void 0:n.data)&&Br(p[8][0].data)>0||!1,E,C;if((i=(s=p[7])==null?void 0:s[0])!=null&&i.data&&r!=0)E=(l=(o=p[7])==null?void 0:o[0])==null?void 0:l.data,C=(d=(c=p[6])==null?void 0:c[0])==null?void 0:d.data;else if((f=(u=p[4])==null?void 0:u[0])!=null&&f.data&&r!=1)E=(x=(h=p[4])==null?void 0:h[0])==null?void 0:x.data,C=(g=(m=p[3])==null?void 0:m[0])==null?void 0:g.data;else throw"NUMBERS Tile missing ".concat(r," cell storage");for(var A=v?4:1,j=c0(E),w=[],k=0;k<E.length/2;++k){var _=j.getUint16(k*2,!0);_<65535&&w.push([k,_])}if(w.length!=S)throw"Expected ".concat(S," cells, found ").concat(w.length);var I=[];for(k=0;k<w.length-1;++k)I[w[k][0]]=C.subarray(w[k][1]*A,w[k+1][1]*A);return w.length>=1&&(I[w[w.length-1][0]]=C.subarray(w[w.length-1][1]*A)),{R:y,cells:I}}function s9(e,r){var t,n=fn(r.data),s=(t=n==null?void 0:n[7])!=null&&t[0]?Br(n[7][0].data)>>>0>0?1:0:-1,i=d0(n[5],function(o){return a9(o,s)});return{nrows:Br(n[4][0].data)>>>0,data:i.reduce(function(o,l){return o[l.R]||(o[l.R]=[]),l.cells.forEach(function(c,d){if(o[l.R][d])throw new Error("Duplicate cell r=".concat(l.R," c=").concat(d));o[l.R][d]=c}),o},[])}}function i9(e,r,t){var n,s=fn(r.data),i={s:{r:0,c:0},e:{r:0,c:0}};if(i.e.r=(Br(s[6][0].data)>>>0)-1,i.e.r<0)throw new Error("Invalid row varint ".concat(s[6][0].data));if(i.e.c=(Br(s[7][0].data)>>>0)-1,i.e.c<0)throw new Error("Invalid col varint ".concat(s[7][0].data));t["!ref"]=Nt(i);var o=fn(s[4][0].data),l=vx(e,e[Ss(o[4][0].data)][0]),c=(n=o[17])!=null&&n[0]?vx(e,e[Ss(o[17][0].data)][0]):[],d=fn(o[3][0].data),u=0;d[1].forEach(function(f){var h=fn(f.data),x=e[Ss(h[2][0].data)][0],m=Br(x.meta[1][0].data);if(m!=6002)throw new Error("6001 unexpected reference to ".concat(m));var g=s9(e,x);g.data.forEach(function(p,y){p.forEach(function(S,v){var E=gt({r:u+y,c:v}),C=n9(S,l,c);C&&(t[E]=C)})}),u+=g.nrows})}function o9(e,r){var t=fn(r.data),n={"!ref":"A1"},s=e[Ss(t[2][0].data)],i=Br(s[0].meta[1][0].data);if(i!=6001)throw new Error("6000 unexpected reference to ".concat(i));return i9(e,s[0],n),n}function l9(e,r){var t,n=fn(r.data),s={name:(t=n[1])!=null&&t[0]?Ku(n[1][0].data):"",sheets:[]},i=d0(n[2],Ss);return i.forEach(function(o){e[o].forEach(function(l){var c=Br(l.meta[1][0].data);c==6e3&&s.sheets.push(o9(e,l))})}),s}function c9(e,r){var t=h0(),n=fn(r.data),s=d0(n[1],Ss);if(s.forEach(function(i){e[i].forEach(function(o){var l=Br(o.meta[1][0].data);if(l==2){var c=l9(e,o);c.sheets.forEach(function(d,u){m0(t,d,u==0?c.name:c.name+"_"+u,!0)})}})}),t.SheetNames.length==0)throw new Error("Empty NUMBERS file");return t}function ou(e){var r,t,n,s,i={},o=[];if(e.FullPaths.forEach(function(c){if(c.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),e.FileIndex.forEach(function(c){if(c.name.match(/\.iwa$/)){var d;try{d=e9(c.content)}catch(f){return console.log("?? "+c.content.length+" "+(f.message||f))}var u;try{u=QU(d)}catch(f){return console.log("## "+(f.message||f))}u.forEach(function(f){i[f.id]=f.messages,o.push(f.id)})}}),!o.length)throw new Error("File has no messages");var l=((s=(n=(t=(r=i==null?void 0:i[1])==null?void 0:r[0])==null?void 0:t.meta)==null?void 0:n[1])==null?void 0:s[0].data)&&Br(i[1][0].meta[1][0].data)==1&&i[1][0];if(l||o.forEach(function(c){i[c].forEach(function(d){var u=Br(d.meta[1][0].data)>>>0;if(u==1)if(!l)l=d;else throw new Error("Document has multiple roots")})}),!l)throw new Error("Cannot find Document root");return c9(i,l)}function d9(e){return function(t){for(var n=0;n!=e.length;++n){var s=e[n];t[s[0]]===void 0&&(t[s[0]]=s[1]),s[2]==="n"&&(t[s[0]]=Number(t[s[0]]))}}}function u0(e){d9([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(e)}function u9(e){return Mi.WS.indexOf(e)>-1?"sheet":e==Mi.CS?"chart":e==Mi.DS?"dialog":e==Mi.MS?"macro":e&&e.length?e:"sheet"}function f9(e,r){if(!e)return 0;try{e=r.map(function(n){return n.id||(n.id=n.strRelID),[n.name,e["!id"][n.id].Target,u9(e["!id"][n.id].Type)]})}catch{return null}return!e||e.length===0?null:e}function h9(e,r,t,n,s,i,o,l,c,d,u,f){try{i[n]=Bo(zn(e,t,!0),r);var h=_r(e,r),x;switch(l){case"sheet":x=vU(h,r,s,c,i[n],d,u,f);break;case"chart":if(x=bU(h,r,s,c,i[n],d,u,f),!x||!x["!drawel"])break;var m=Do(x["!drawel"].Target,r),g=Yu(m),p=y5(zn(e,m,!0),Bo(zn(e,g,!0),m)),y=Do(p,m),S=Yu(y);x=rU(zn(e,y,!0),y,c,Bo(zn(e,S,!0),y),d,x);break;case"macro":x=SU(h,r,s,c,i[n],d,u,f);break;case"dialog":x=wU(h,r,s,c,i[n],d,u,f);break;default:throw new Error("Unrecognized sheet type "+l)}o[n]=x;var v=[];i&&i[n]&&Ra(i[n]).forEach(function(E){var C="";if(i[n][E].Type==Mi.CMNT){C=Do(i[n][E].Target,r);var A=AU(_r(e,C,!0),C,c);if(!A||!A.length)return;ax(x,A,!1)}i[n][E].Type==Mi.TCMNT&&(C=Do(i[n][E].Target,r),v=v.concat(b5(_r(e,C,!0),c)))}),v&&v.length&&ax(x,v,!0,c.people||[])}catch(E){if(c.WTF)throw E}}function Zn(e){return e.charAt(0)=="/"?e.slice(1):e}function m9(e,r){if(ov(),r=r||{},u0(r),ra(e,"META-INF/manifest.xml")||ra(e,"objectdata.xml"))return xx(e,r);if(ra(e,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof ou<"u"){if(e.FileIndex)return ou(e);var t=Pt.utils.cfb_new();return Ip(e).forEach(function(R){p3(t,R,hv(e,R))}),ou(t)}throw new Error("Unsupported NUMBERS file")}if(!ra(e,"[Content_Types].xml"))throw ra(e,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):ra(e,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var n=Ip(e),s=dL(zn(e,"[Content_Types].xml")),i=!1,o,l;if(s.workbooks.length===0&&(l="xl/workbook.xml",_r(e,l,!0)&&s.workbooks.push(l)),s.workbooks.length===0){if(l="xl/workbook.bin",!_r(e,l,!0))throw new Error("Could not find workbook");s.workbooks.push(l),i=!0}s.workbooks[0].slice(-3)=="bin"&&(i=!0);var c={},d={};if(!r.bookSheets&&!r.bookProps){if(Wo=[],s.sst)try{Wo=kU(_r(e,Zn(s.sst)),s.sst,r)}catch(R){if(r.WTF)throw R}r.cellStyles&&s.themes.length&&(c=EU(zn(e,s.themes[0].replace(/^\//,""),!0)||"",s.themes[0],r)),s.style&&(d=jU(_r(e,Zn(s.style)),s.style,c,r))}s.links.map(function(R){try{var Y=Bo(zn(e,Yu(Zn(R))),R);return CU(_r(e,Zn(R)),Y,R,r)}catch{}});var u=yU(_r(e,Zn(s.workbooks[0])),s.workbooks[0],r),f={},h="";s.coreprops.length&&(h=_r(e,Zn(s.coreprops[0]),!0),h&&(f=Ov(h)),s.extprops.length!==0&&(h=_r(e,Zn(s.extprops[0]),!0),h&&pL(h,f,r)));var x={};(!r.bookSheets||r.bookProps)&&s.custprops.length!==0&&(h=zn(e,Zn(s.custprops[0]),!0),h&&(x=gL(h,r)));var m={};if((r.bookSheets||r.bookProps)&&(u.Sheets?o=u.Sheets.map(function(Y){return Y.name}):f.Worksheets&&f.SheetNames.length>0&&(o=f.SheetNames),r.bookProps&&(m.Props=f,m.Custprops=x),r.bookSheets&&typeof o<"u"&&(m.SheetNames=o),r.bookSheets?m.SheetNames:r.bookProps))return m;o={};var g={};r.bookDeps&&s.calcchain&&(g=TU(_r(e,Zn(s.calcchain)),s.calcchain));var p=0,y={},S,v;{var E=u.Sheets;f.Worksheets=E.length,f.SheetNames=[];for(var C=0;C!=E.length;++C)f.SheetNames[C]=E[C].name}var A=i?"bin":"xml",j=s.workbooks[0].lastIndexOf("/"),w=(s.workbooks[0].slice(0,j+1)+"_rels/"+s.workbooks[0].slice(j+1)+".rels").replace(/^\//,"");ra(e,w)||(w="xl/_rels/workbook."+A+".rels");var k=Bo(zn(e,w,!0),w.replace(/_rels.*/,"s5s"));(s.metadata||[]).length>=1&&(r.xlmeta=DU(_r(e,Zn(s.metadata[0])),s.metadata[0],r)),(s.people||[]).length>=1&&(r.people=S5(_r(e,Zn(s.people[0])),r)),k&&(k=f9(k,u.Sheets));var _=_r(e,"xl/worksheets/sheet.xml",!0)?1:0;e:for(p=0;p!=f.Worksheets;++p){var I="sheet";if(k&&k[p]?(S="xl/"+k[p][1].replace(/[\/]?xl\//,""),ra(e,S)||(S=k[p][1]),ra(e,S)||(S=w.replace(/_rels\/.*$/,"")+k[p][1]),I=k[p][2]):(S="xl/worksheets/sheet"+(p+1-_)+"."+A,S=S.replace(/sheet0\./,"sheet.")),v=S.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),r&&r.sheets!=null)switch(typeof r.sheets){case"number":if(p!=r.sheets)continue e;break;case"string":if(f.SheetNames[p].toLowerCase()!=r.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(r.sheets)){for(var D=!1,B=0;B!=r.sheets.length;++B)typeof r.sheets[B]=="number"&&r.sheets[B]==p&&(D=1),typeof r.sheets[B]=="string"&&r.sheets[B].toLowerCase()==f.SheetNames[p].toLowerCase()&&(D=1);if(!D)continue e}}h9(e,S,v,f.SheetNames[p],p,y,o,I,r,u,c,d)}return m={Directory:s,Workbook:u,Props:f,Custprops:x,Deps:g,Sheets:o,SheetNames:f.SheetNames,Strings:Wo,Styles:d,Themes:c,SSF:Zr(bt)},r&&r.bookFiles&&(e.files?(m.keys=n,m.files=e.files):(m.keys=[],m.files={},e.FullPaths.forEach(function(R,Y){R=R.replace(/^Root Entry[\/]/,""),m.keys.push(R),m.files[R]=e.FileIndex[Y]}))),r&&r.bookVBA&&(s.vba.length>0?m.vbaraw=_r(e,Zn(s.vba[0]),!0):s.defaults&&s.defaults.bin===k5&&(m.vbaraw=_r(e,"xl/vbaProject.bin",!0))),m}function p9(e,r){var t=r||{},n="Workbook",s=Pt.find(e,n);try{if(n="/!DataSpaces/Version",s=Pt.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(o$(s.content),n="/!DataSpaces/DataSpaceMap",s=Pt.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var i=c$(s.content);if(i.length!==1||i[0].comps.length!==1||i[0].comps[0].t!==0||i[0].name!=="StrongEncryptionDataSpace"||i[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",s=Pt.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var o=d$(s.content);if(o.length!=1||o[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+n);if(n="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",s=Pt.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);f$(s.content)}catch{}if(n="/EncryptionInfo",s=Pt.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);var l=h$(s.content);if(n="/EncryptedPackage",s=Pt.find(e,n),!s||!s.content)throw new Error("ECMA-376 Encrypted file missing "+n);if(l[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(l[1],s.content,t.password||"",t);if(l[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(l[1],s.content,t.password||"",t);throw new Error("File is password-protected")}function f0(e,r){var t="";switch((r||{}).type||"base64"){case"buffer":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];case"base64":t=Xn(e.slice(0,12));break;case"binary":t=e;break;case"array":return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7]];default:throw new Error("Unrecognized type "+(r&&r.type||"undefined"))}return[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3),t.charCodeAt(4),t.charCodeAt(5),t.charCodeAt(6),t.charCodeAt(7)]}function x9(e,r){return Pt.find(e,"EncryptedPackage")?p9(e,r):Sb(e,r)}function g9(e,r){var t,n=e,s=r||{};return s.type||(s.type=It&&Buffer.isBuffer(e)?"buffer":"base64"),t=mv(n,s),m9(t,s)}function kb(e,r){var t=0;e:for(;t<e.length;)switch(e.charCodeAt(t)){case 10:case 13:case 32:++t;break;case 60:return qu(e.slice(t),r);default:break e}return il.to_workbook(e,r)}function y9(e,r){var t="",n=f0(e,r);switch(r.type){case"base64":t=Xn(e);break;case"binary":t=e;break;case"buffer":t=e.toString("binary");break;case"array":t=ii(e);break;default:throw new Error("Unrecognized type "+r.type)}return n[0]==239&&n[1]==187&&n[2]==191&&(t=sr(t)),r.type="binary",kb(t,r)}function v9(e,r){var t=e;return r.type=="base64"&&(t=Xn(t)),t=hs.utils.decode(1200,t.slice(2),"str"),r.type="binary",kb(t,r)}function b9(e){return e.match(/[^\x00-\x7F]/)?_o(e):e}function lu(e,r,t,n){return n?(t.type="string",il.to_workbook(e,t)):il.to_workbook(r,t)}function Oc(e,r){X1();var t=r||{};if(typeof ArrayBuffer<"u"&&e instanceof ArrayBuffer)return Oc(new Uint8Array(e),(t=Zr(t),t.type="array",t));typeof Uint8Array<"u"&&e instanceof Uint8Array&&!t.type&&(t.type=typeof Deno<"u"?"buffer":"array");var n=e,s=[0,0,0,0],i=!1;if(t.cellStyles&&(t.cellNF=!0,t.sheetStubs=!0),Bi={},t.dateNF&&(Bi.dateNF=t.dateNF),t.type||(t.type=It&&Buffer.isBuffer(e)?"buffer":"base64"),t.type=="file"&&(t.type=It?"buffer":"binary",n=l3(e),typeof Uint8Array<"u"&&!It&&(t.type="array")),t.type=="string"&&(i=!0,t.type="binary",t.codepage=65001,n=b9(e)),t.type=="array"&&typeof Uint8Array<"u"&&e instanceof Uint8Array&&typeof ArrayBuffer<"u"){var o=new ArrayBuffer(3),l=new Uint8Array(o);if(l.foo="bar",!l.foo)return t=Zr(t),t.type="array",Oc(Hh(n),t)}switch((s=f0(n,t))[0]){case 208:if(s[1]===207&&s[2]===17&&s[3]===224&&s[4]===161&&s[5]===177&&s[6]===26&&s[7]===225)return x9(Pt.read(n,t),t);break;case 9:if(s[1]<=8)return Sb(n,t);break;case 60:return qu(n,t);case 73:if(s[1]===73&&s[2]===42&&s[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(s[1]===68)return q6(n,t);break;case 84:if(s[1]===65&&s[2]===66&&s[3]===76)return z6.to_workbook(n,t);break;case 80:return s[1]===75&&s[2]<9&&s[3]<9?g9(n,t):lu(e,n,t,i);case 239:return s[3]===60?qu(n,t):lu(e,n,t,i);case 255:if(s[1]===254)return v9(n,t);if(s[1]===0&&s[2]===2&&s[3]===0)return Vo.to_workbook(n,t);break;case 0:if(s[1]===0&&(s[2]>=2&&s[3]===0||s[2]===0&&(s[3]===8||s[3]===9)))return Vo.to_workbook(n,t);break;case 3:case 131:case 139:case 140:return nx.to_workbook(n,t);case 123:if(s[1]===92&&s[2]===114&&s[3]===116)return k$.to_workbook(n,t);break;case 10:case 13:case 32:return y9(n,t);case 137:if(s[1]===80&&s[2]===78&&s[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return H6.indexOf(s[0])>-1&&s[2]<=12&&s[3]<=31?nx.to_workbook(n,t):lu(e,n,t,i)}function S9(e,r,t,n,s,i,o,l){var c=en(t),d=l.defval,u=l.raw||!Object.prototype.hasOwnProperty.call(l,"raw"),f=!0,h=s===1?[]:{};if(s!==1)if(Object.defineProperty)try{Object.defineProperty(h,"__rowNum__",{value:t,enumerable:!1})}catch{h.__rowNum__=t}else h.__rowNum__=t;if(!o||e[t])for(var x=r.s.c;x<=r.e.c;++x){var m=o?e[t][x]:e[n[x]+c];if(m===void 0||m.t===void 0){if(d===void 0)continue;i[x]!=null&&(h[i[x]]=d);continue}var g=m.v;switch(m.t){case"z":if(g==null)break;continue;case"e":g=g==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+m.t)}if(i[x]!=null){if(g==null)if(m.t=="e"&&g===null)h[i[x]]=null;else if(d!==void 0)h[i[x]]=d;else if(u&&g===null)h[i[x]]=null;else continue;else h[i[x]]=u&&(m.t!=="n"||m.t==="n"&&l.rawNumbers!==!1)?g:Ja(m,g,l);g!=null&&(f=!1)}}return{row:h,isempty:f}}function Qu(e,r){if(e==null||e["!ref"]==null)return[];var t={t:"n",v:0},n=0,s=1,i=[],o=0,l="",c={s:{r:0,c:0},e:{r:0,c:0}},d=r||{},u=d.range!=null?d.range:e["!ref"];switch(d.header===1?n=1:d.header==="A"?n=2:Array.isArray(d.header)?n=3:d.header==null&&(n=0),typeof u){case"string":c=Sr(u);break;case"number":c=Sr(e["!ref"]),c.s.r=u;break;default:c=u}n>0&&(s=0);var f=en(c.s.r),h=[],x=[],m=0,g=0,p=Array.isArray(e),y=c.s.r,S=0,v={};p&&!e[y]&&(e[y]=[]);var E=d.skipHidden&&e["!cols"]||[],C=d.skipHidden&&e["!rows"]||[];for(S=c.s.c;S<=c.e.c;++S)if(!(E[S]||{}).hidden)switch(h[S]=Lr(S),t=p?e[y][S]:e[h[S]+f],n){case 1:i[S]=S-c.s.c;break;case 2:i[S]=h[S];break;case 3:i[S]=d.header[S-c.s.c];break;default:if(t==null&&(t={w:"__EMPTY",t:"s"}),l=o=Ja(t,null,d),g=v[o]||0,!g)v[o]=1;else{do l=o+"_"+g++;while(v[l]);v[o]=g,v[l]=1}i[S]=l}for(y=c.s.r+s;y<=c.e.r;++y)if(!(C[y]||{}).hidden){var A=S9(e,c,y,h,n,i,p,d);(A.isempty===!1||(n===1?d.blankrows!==!1:d.blankrows))&&(x[m++]=A.row)}return x.length=m,x}var bx=/"/g;function w9(e,r,t,n,s,i,o,l){for(var c=!0,d=[],u="",f=en(t),h=r.s.c;h<=r.e.c;++h)if(n[h]){var x=l.dense?(e[t]||[])[h]:e[n[h]+f];if(x==null)u="";else if(x.v!=null){c=!1,u=""+(l.rawNumbers&&x.t=="n"?x.v:Ja(x,null,l));for(var m=0,g=0;m!==u.length;++m)if((g=u.charCodeAt(m))===s||g===i||g===34||l.forceQuotes){u='"'+u.replace(bx,'""')+'"';break}u=="ID"&&(u='"ID"')}else x.f!=null&&!x.F?(c=!1,u="="+x.f,u.indexOf(",")>=0&&(u='"'+u.replace(bx,'""')+'"')):u="";d.push(u)}return l.blankrows===!1&&c?null:d.join(o)}function Ab(e,r){var t=[],n=r??{};if(e==null||e["!ref"]==null)return"";var s=Sr(e["!ref"]),i=n.FS!==void 0?n.FS:",",o=i.charCodeAt(0),l=n.RS!==void 0?n.RS:`
`,c=l.charCodeAt(0),d=new RegExp((i=="|"?"\\|":i)+"+$"),u="",f=[];n.dense=Array.isArray(e);for(var h=n.skipHidden&&e["!cols"]||[],x=n.skipHidden&&e["!rows"]||[],m=s.s.c;m<=s.e.c;++m)(h[m]||{}).hidden||(f[m]=Lr(m));for(var g=0,p=s.s.r;p<=s.e.r;++p)(x[p]||{}).hidden||(u=w9(e,s,p,f,o,c,i,n),u!=null&&(n.strip&&(u=u.replace(d,"")),(u||n.blankrows!==!1)&&t.push((g++?l:"")+u)));return delete n.dense,t.join("")}function j9(e,r){r||(r={}),r.FS="	",r.RS=`
`;var t=Ab(e,r);return t}function E9(e){var r="",t,n="";if(e==null||e["!ref"]==null)return[];var s=Sr(e["!ref"]),i="",o=[],l,c=[],d=Array.isArray(e);for(l=s.s.c;l<=s.e.c;++l)o[l]=Lr(l);for(var u=s.s.r;u<=s.e.r;++u)for(i=en(u),l=s.s.c;l<=s.e.c;++l)if(r=o[l]+i,t=d?(e[u]||[])[l]:e[r],n="",t!==void 0){if(t.F!=null){if(r=t.F,!t.f)continue;n=t.f,r.indexOf(":")==-1&&(r=r+":"+r)}if(t.f!=null)n=t.f;else{if(t.t=="z")continue;if(t.t=="n"&&t.v!=null)n=""+t.v;else if(t.t=="b")n=t.v?"TRUE":"FALSE";else if(t.w!==void 0)n="'"+t.w;else{if(t.v===void 0)continue;t.t=="s"?n="'"+t.v:n=""+t.v}}c[c.length]=r+"="+n}return c}function Tb(e,r,t){var n=t||{},s=+!n.skipHeader,i=e||{},o=0,l=0;if(i&&n.origin!=null)if(typeof n.origin=="number")o=n.origin;else{var c=typeof n.origin=="string"?wn(n.origin):n.origin;o=c.r,l=c.c}var d,u={s:{c:0,r:0},e:{c:l,r:o+r.length-1+s}};if(i["!ref"]){var f=Sr(i["!ref"]);u.e.c=Math.max(u.e.c,f.e.c),u.e.r=Math.max(u.e.r,f.e.r),o==-1&&(o=f.e.r+1,u.e.r=o+r.length-1+s)}else o==-1&&(o=0,u.e.r=r.length-1+s);var h=n.header||[],x=0;r.forEach(function(g,p){Ra(g).forEach(function(y){(x=h.indexOf(y))==-1&&(h[x=h.length]=y);var S=g[y],v="z",E="",C=gt({c:l+x,r:o+p+s});d=dl(i,C),S&&typeof S=="object"&&!(S instanceof Date)?i[C]=S:(typeof S=="number"?v="n":typeof S=="boolean"?v="b":typeof S=="string"?v="s":S instanceof Date?(v="d",n.cellDates||(v="n",S=kn(S)),E=n.dateNF||bt[14]):S===null&&n.nullError&&(v="e",S=0),d?(d.t=v,d.v=S,delete d.w,delete d.R,E&&(d.z=E)):i[C]=d={t:v,v:S},E&&(d.z=E))})}),u.e.c=Math.max(u.e.c,l+h.length-1);var m=en(o);if(s)for(x=0;x<h.length;++x)i[Lr(x+l)+m]={t:"s",v:h[x]};return i["!ref"]=Nt(u),i}function k9(e,r){return Tb(null,e,r)}function dl(e,r,t){if(typeof r=="string"){if(Array.isArray(e)){var n=wn(r);return e[n.r]||(e[n.r]=[]),e[n.r][n.c]||(e[n.r][n.c]={t:"z"})}return e[r]||(e[r]={t:"z"})}return typeof r!="number"?dl(e,gt(r)):dl(e,gt({r,c:t||0}))}function A9(e,r){if(typeof r=="number"){if(r>=0&&e.SheetNames.length>r)return r;throw new Error("Cannot find sheet # "+r)}else if(typeof r=="string"){var t=e.SheetNames.indexOf(r);if(t>-1)return t;throw new Error("Cannot find sheet name |"+r+"|")}else throw new Error("Cannot find sheet |"+r+"|")}function h0(){return{SheetNames:[],Sheets:{}}}function m0(e,r,t,n){var s=1;if(!t)for(;s<=65535&&e.SheetNames.indexOf(t="Sheet"+s)!=-1;++s,t=void 0);if(!t||e.SheetNames.length>=65535)throw new Error("Too many worksheets");if(n&&e.SheetNames.indexOf(t)>=0){var i=t.match(/(^.*?)(\d+)$/);s=i&&+i[2]||0;var o=i&&i[1]||t;for(++s;s<=65535&&e.SheetNames.indexOf(t=o+s)!=-1;++s);}if(dU(t),e.SheetNames.indexOf(t)>=0)throw new Error("Worksheet with name |"+t+"| already exists!");return e.SheetNames.push(t),e.Sheets[t]=r,t}function T9(e,r,t){e.Workbook||(e.Workbook={}),e.Workbook.Sheets||(e.Workbook.Sheets=[]);var n=A9(e,r);switch(e.Workbook.Sheets[n]||(e.Workbook.Sheets[n]={}),t){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+t)}e.Workbook.Sheets[n].Hidden=t}function C9(e,r){return e.z=r,e}function Cb(e,r,t){return r?(e.l={Target:r},t&&(e.l.Tooltip=t)):delete e.l,e}function D9(e,r,t){return Cb(e,"#"+r,t)}function _9(e,r,t){e.c||(e.c=[]),e.c.push({t:r,a:t||"SheetJS"})}function I9(e,r,t,n){for(var s=typeof r!="string"?r:Sr(r),i=typeof r=="string"?r:Nt(r),o=s.s.r;o<=s.e.r;++o)for(var l=s.s.c;l<=s.e.c;++l){var c=dl(e,o,l);c.t="n",c.F=i,delete c.v,o==s.s.r&&l==s.s.c&&(c.f=t,n&&(c.D=!0))}return e}var Db={encode_col:Lr,encode_row:en,encode_cell:gt,encode_range:Nt,decode_col:Zh,decode_row:Qh,split_cell:W3,decode_cell:wn,decode_range:so,format_cell:Ja,sheet_add_aoa:Fv,sheet_add_json:Tb,sheet_add_dom:wb,aoa_to_sheet:io,json_to_sheet:k9,table_to_sheet:jb,table_to_book:qU,sheet_to_csv:Ab,sheet_to_txt:j9,sheet_to_json:Qu,sheet_to_html:GU,sheet_to_formulae:E9,sheet_to_row_object_array:Qu,sheet_get_cell:dl,book_new:h0,book_append_sheet:m0,book_set_sheet_visibility:T9,cell_set_number_format:C9,cell_set_hyperlink:Cb,cell_set_internal_link:D9,cell_add_comment:_9,sheet_set_array_formula:I9,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};const F9=["studentId","name","email","grade","phoneNumber"],M9=`studentId,name,grade,section,email,phoneNumber,dateOfBirth,gender,address,parentName,parentEmail,parentPhone
S001,John Smith,9,A,john.smith@example.com,1234567890,2010-05-15,MALE,123 Main St,Robert Smith,robert.smith@example.com,9876543210
S002,Jane Doe,9,A,jane.doe@example.com,0987654321,2010-03-20,FEMALE,456 Oak Ave,Mary Doe,mary.doe@example.com,1234567890`,P9=({open:e,onClose:r,onSubmit:t,loading:n})=>{const[s,i]=b.useState(""),[o,l]=b.useState([]),[c,d]=b.useState([]),[u,f]=b.useState("initial"),[h,x]=b.useState(""),m=b.useRef(null),g=A=>{i(A.target.value),f("initial"),l([]),d([]),x("")},p=(A,j)=>{const w=[];return F9.forEach(k=>{A[k]||w.push({index:j,field:k,message:`Missing required field: ${k}`})}),A.email&&!/^\S+@\S+\.\S+$/.test(A.email)&&w.push({index:j,field:"email",message:"Invalid email format"}),w},y=()=>{try{const A=Lf.parse(s,{header:!0,skipEmptyLines:!0});if(A.errors.length>0){d(A.errors.map((k,_)=>({index:_,field:"csv",message:k.message}))),f("error");return}const j=A.data,w=[];j.forEach((k,_)=>{const I=p(k,_);w.push(...I)}),w.length>0?(d(w),f("error")):(l(j),f("success"))}catch(A){console.error("Error parsing CSV:",A),d([{index:0,field:"csv",message:"Failed to parse CSV: "+(A instanceof Error?A.message:String(A))}]),f("error")}},S=async()=>{if(!(o.length===0||u!=="success"))try{await t(o),i(""),l([]),f("initial"),x("")}catch(A){console.error("Failed to submit students:",A)}},v=()=>{const A=new Blob([M9],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a");j.href=URL.createObjectURL(A),j.setAttribute("download","student_upload_template.csv"),document.body.appendChild(j),j.click(),document.body.removeChild(j)},E=()=>{m.current&&m.current.click()},C=A=>{var k;const j=(k=A.target.files)==null?void 0:k[0];if(!j)return;x(j.name);const w=new FileReader;w.onload=_=>{var D;const I=(D=_.target)==null?void 0:D.result;try{if(j.name.endsWith(".xlsx")||j.name.endsWith(".xls")){const B=Oc(I,{type:"binary"}),R=B.SheetNames[0],Y=B.Sheets[R],P=Db.sheet_to_csv(Y);i(P)}else if(j.name.endsWith(".csv"))i(I);else throw new Error("Unsupported file format. Please use CSV, XLSX, or XLS files.");f("initial"),l([]),d([])}catch(B){console.error("Error reading file:",B),d([{index:0,field:"file",message:"Failed to read file: "+(B instanceof Error?B.message:String(B))}]),f("error")}},j.name.endsWith(".csv")?w.readAsText(j):w.readAsBinaryString(j),A.target&&(A.target.value="")};return a.jsxs(At,{open:e,onClose:r,maxWidth:"md",fullWidth:!0,children:[a.jsx(Dt,{children:"Bulk Student Upload"}),a.jsxs(Tt,{children:[a.jsxs(ee,{sx:{mb:2},children:[a.jsx(V,{variant:"body1",gutterBottom:!0,children:"Upload your CSV/Excel file or paste CSV data below to add multiple students at once."}),a.jsx(V,{variant:"body2",color:"text.secondary",children:"Required fields: Student ID, Name, Grade, Email, and Phone Number"})]}),a.jsxs(ee,{sx:{mb:2,display:"flex",gap:1},children:[a.jsx(xt,{title:"Download sample CSV template",children:a.jsx(ye,{variant:"outlined",size:"small",onClick:v,startIcon:a.jsx(ai,{}),children:"Download Template"})}),a.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",style:{display:"none"},ref:m,onChange:C}),a.jsx(xt,{title:"Upload CSV or Excel file",children:a.jsx(ye,{variant:"contained",size:"small",onClick:E,startIcon:a.jsx(Uh,{}),color:"primary",children:"Upload File"})})]}),h&&a.jsxs(pt,{severity:"info",sx:{mb:2},children:["File loaded: ",h]}),a.jsx(Se,{label:"CSV Data",multiline:!0,rows:10,value:s,onChange:g,fullWidth:!0,variant:"outlined",placeholder:"studentId,name,grade,section,email,phoneNumber,dateOfBirth,gender,address,parentName,parentEmail,parentPhone",sx:{mb:2}}),a.jsx(ee,{sx:{mb:2},children:a.jsx(ye,{variant:"contained",color:"secondary",onClick:y,disabled:!s.trim()||n,children:"Parse Data"})}),u==="success"&&a.jsxs(pt,{severity:"success",sx:{mb:2},children:[a.jsx(Mn,{children:"Data Successfully Parsed"}),"Found ",o.length," valid student records ready to be imported."]}),u==="error"&&a.jsxs(pt,{severity:"error",sx:{mb:2},children:[a.jsx(Mn,{children:"Validation Errors"}),a.jsx(ee,{component:"ul",sx:{pl:2,mt:1},children:c.map((A,j)=>a.jsx("li",{children:`Row ${A.index+1}, ${A.field}: ${A.message}`},j))})]}),o.length>0&&a.jsxs(Ke,{variant:"outlined",sx:{p:2,mt:2,maxHeight:"200px",overflow:"auto"},children:[a.jsxs(V,{variant:"subtitle1",gutterBottom:!0,children:["Preview of Parsed Data (",o.length," students)"]}),a.jsx(Qt,{sx:{mb:2}}),o.slice(0,5).map((A,j)=>a.jsx(ee,{sx:{mb:1,p:1,bgcolor:"background.paper"},children:a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"ID:"})," ",A.studentId,",",a.jsx("strong",{children:" Name:"})," ",A.name,",",a.jsx("strong",{children:" Grade:"})," ",A.grade,A.section?`-${A.section}`:"",",",a.jsx("strong",{children:" Email:"})," ",A.email]})},j)),o.length>5&&a.jsx(at,{label:`${o.length-5} more students`,size:"small",sx:{mt:1}})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,disabled:n,children:"Cancel"}),a.jsx(ye,{onClick:S,color:"primary",disabled:o.length===0||u!=="success"||n,startIcon:n?a.jsx(vr,{size:20}):a.jsx(ti,{}),children:n?"Importing...":"Import Students"})]})]})};var _b={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Ds,function(){var t=1e3,n=6e4,s=36e5,i="millisecond",o="second",l="minute",c="hour",d="day",u="week",f="month",h="quarter",x="year",m="date",g="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,S={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(R){var Y=["th","st","nd","rd"],P=R%100;return"["+R+(Y[(P-20)%10]||Y[P]||Y[0])+"]"}},v=function(R,Y,P){var M=String(R);return!M||M.length>=Y?R:""+Array(Y+1-M.length).join(P)+R},E={s:v,z:function(R){var Y=-R.utcOffset(),P=Math.abs(Y),M=Math.floor(P/60),K=P%60;return(Y<=0?"+":"-")+v(M,2,"0")+":"+v(K,2,"0")},m:function R(Y,P){if(Y.date()<P.date())return-R(P,Y);var M=12*(P.year()-Y.year())+(P.month()-Y.month()),K=Y.clone().add(M,f),L=P-K<0,ae=Y.clone().add(M+(L?-1:1),f);return+(-(M+(P-K)/(L?K-ae:ae-K))||0)},a:function(R){return R<0?Math.ceil(R)||0:Math.floor(R)},p:function(R){return{M:f,y:x,w:u,d,D:m,h:c,m:l,s:o,ms:i,Q:h}[R]||String(R||"").toLowerCase().replace(/s$/,"")},u:function(R){return R===void 0}},C="en",A={};A[C]=S;var j="$isDayjsObject",w=function(R){return R instanceof D||!(!R||!R[j])},k=function R(Y,P,M){var K;if(!Y)return C;if(typeof Y=="string"){var L=Y.toLowerCase();A[L]&&(K=L),P&&(A[L]=P,K=L);var ae=Y.split("-");if(!K&&ae.length>1)return R(ae[0])}else{var Z=Y.name;A[Z]=Y,K=Z}return!M&&K&&(C=K),K||!M&&C},_=function(R,Y){if(w(R))return R.clone();var P=typeof Y=="object"?Y:{};return P.date=R,P.args=arguments,new D(P)},I=E;I.l=k,I.i=w,I.w=function(R,Y){return _(R,{locale:Y.$L,utc:Y.$u,x:Y.$x,$offset:Y.$offset})};var D=function(){function R(P){this.$L=k(P.locale,null,!0),this.parse(P),this.$x=this.$x||P.x||{},this[j]=!0}var Y=R.prototype;return Y.parse=function(P){this.$d=function(M){var K=M.date,L=M.utc;if(K===null)return new Date(NaN);if(I.u(K))return new Date;if(K instanceof Date)return new Date(K);if(typeof K=="string"&&!/Z$/i.test(K)){var ae=K.match(p);if(ae){var Z=ae[2]-1||0,T=(ae[7]||"0").substring(0,3);return L?new Date(Date.UTC(ae[1],Z,ae[3]||1,ae[4]||0,ae[5]||0,ae[6]||0,T)):new Date(ae[1],Z,ae[3]||1,ae[4]||0,ae[5]||0,ae[6]||0,T)}}return new Date(K)}(P),this.init()},Y.init=function(){var P=this.$d;this.$y=P.getFullYear(),this.$M=P.getMonth(),this.$D=P.getDate(),this.$W=P.getDay(),this.$H=P.getHours(),this.$m=P.getMinutes(),this.$s=P.getSeconds(),this.$ms=P.getMilliseconds()},Y.$utils=function(){return I},Y.isValid=function(){return this.$d.toString()!==g},Y.isSame=function(P,M){var K=_(P);return this.startOf(M)<=K&&K<=this.endOf(M)},Y.isAfter=function(P,M){return _(P)<this.startOf(M)},Y.isBefore=function(P,M){return this.endOf(M)<_(P)},Y.$g=function(P,M,K){return I.u(P)?this[M]:this.set(K,P)},Y.unix=function(){return Math.floor(this.valueOf()/1e3)},Y.valueOf=function(){return this.$d.getTime()},Y.startOf=function(P,M){var K=this,L=!!I.u(M)||M,ae=I.p(P),Z=function(z,O){var W=I.w(K.$u?Date.UTC(K.$y,O,z):new Date(K.$y,O,z),K);return L?W:W.endOf(d)},T=function(z,O){return I.w(K.toDate()[z].apply(K.toDate("s"),(L?[0,0,0,0]:[23,59,59,999]).slice(O)),K)},N=this.$W,H=this.$M,G=this.$D,q="set"+(this.$u?"UTC":"");switch(ae){case x:return L?Z(1,0):Z(31,11);case f:return L?Z(1,H):Z(0,H+1);case u:var oe=this.$locale().weekStart||0,de=(N<oe?N+7:N)-oe;return Z(L?G-de:G+(6-de),H);case d:case m:return T(q+"Hours",0);case c:return T(q+"Minutes",1);case l:return T(q+"Seconds",2);case o:return T(q+"Milliseconds",3);default:return this.clone()}},Y.endOf=function(P){return this.startOf(P,!1)},Y.$set=function(P,M){var K,L=I.p(P),ae="set"+(this.$u?"UTC":""),Z=(K={},K[d]=ae+"Date",K[m]=ae+"Date",K[f]=ae+"Month",K[x]=ae+"FullYear",K[c]=ae+"Hours",K[l]=ae+"Minutes",K[o]=ae+"Seconds",K[i]=ae+"Milliseconds",K)[L],T=L===d?this.$D+(M-this.$W):M;if(L===f||L===x){var N=this.clone().set(m,1);N.$d[Z](T),N.init(),this.$d=N.set(m,Math.min(this.$D,N.daysInMonth())).$d}else Z&&this.$d[Z](T);return this.init(),this},Y.set=function(P,M){return this.clone().$set(P,M)},Y.get=function(P){return this[I.p(P)]()},Y.add=function(P,M){var K,L=this;P=Number(P);var ae=I.p(M),Z=function(H){var G=_(L);return I.w(G.date(G.date()+Math.round(H*P)),L)};if(ae===f)return this.set(f,this.$M+P);if(ae===x)return this.set(x,this.$y+P);if(ae===d)return Z(1);if(ae===u)return Z(7);var T=(K={},K[l]=n,K[c]=s,K[o]=t,K)[ae]||1,N=this.$d.getTime()+P*T;return I.w(N,this)},Y.subtract=function(P,M){return this.add(-1*P,M)},Y.format=function(P){var M=this,K=this.$locale();if(!this.isValid())return K.invalidDate||g;var L=P||"YYYY-MM-DDTHH:mm:ssZ",ae=I.z(this),Z=this.$H,T=this.$m,N=this.$M,H=K.weekdays,G=K.months,q=K.meridiem,oe=function(O,W,F,U){return O&&(O[W]||O(M,L))||F[W].slice(0,U)},de=function(O){return I.s(Z%12||12,O,"0")},z=q||function(O,W,F){var U=O<12?"AM":"PM";return F?U.toLowerCase():U};return L.replace(y,function(O,W){return W||function(F){switch(F){case"YY":return String(M.$y).slice(-2);case"YYYY":return I.s(M.$y,4,"0");case"M":return N+1;case"MM":return I.s(N+1,2,"0");case"MMM":return oe(K.monthsShort,N,G,3);case"MMMM":return oe(G,N);case"D":return M.$D;case"DD":return I.s(M.$D,2,"0");case"d":return String(M.$W);case"dd":return oe(K.weekdaysMin,M.$W,H,2);case"ddd":return oe(K.weekdaysShort,M.$W,H,3);case"dddd":return H[M.$W];case"H":return String(Z);case"HH":return I.s(Z,2,"0");case"h":return de(1);case"hh":return de(2);case"a":return z(Z,T,!0);case"A":return z(Z,T,!1);case"m":return String(T);case"mm":return I.s(T,2,"0");case"s":return String(M.$s);case"ss":return I.s(M.$s,2,"0");case"SSS":return I.s(M.$ms,3,"0");case"Z":return ae}return null}(O)||ae.replace(":","")})},Y.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},Y.diff=function(P,M,K){var L,ae=this,Z=I.p(M),T=_(P),N=(T.utcOffset()-this.utcOffset())*n,H=this-T,G=function(){return I.m(ae,T)};switch(Z){case x:L=G()/12;break;case f:L=G();break;case h:L=G()/3;break;case u:L=(H-N)/6048e5;break;case d:L=(H-N)/864e5;break;case c:L=H/s;break;case l:L=H/n;break;case o:L=H/t;break;default:L=H}return K?L:I.a(L)},Y.daysInMonth=function(){return this.endOf(f).$D},Y.$locale=function(){return A[this.$L]},Y.locale=function(P,M){if(!P)return this.$L;var K=this.clone(),L=k(P,M,!0);return L&&(K.$L=L),K},Y.clone=function(){return I.w(this.$d,this)},Y.toDate=function(){return new Date(this.valueOf())},Y.toJSON=function(){return this.isValid()?this.toISOString():null},Y.toISOString=function(){return this.$d.toISOString()},Y.toString=function(){return this.$d.toUTCString()},R}(),B=D.prototype;return _.prototype=B,[["$ms",i],["$s",o],["$m",l],["$H",c],["$W",d],["$M",f],["$y",x],["$D",m]].forEach(function(R){B[R[1]]=function(Y){return this.$g(Y,R[0],R[1])}}),_.extend=function(R,Y){return R.$i||(R(Y,D,_),R.$i=!0),_},_.locale=k,_.isDayjs=w,_.unix=function(R){return _(1e3*R)},_.en=A[C],_.Ls=A,_.p={},_})})(_b);var N9=_b.exports;const Be=ts(N9),gn={markBulkAttendance:e=>ge.post("/attendance/bulk",e),markIndividualAttendance:(e,r)=>ge.post(`/attendance/${e}`,r),markStudentAttendanceParams:(e,r)=>ge.post(`/attendance/${e}?status=${encodeURIComponent(r.status)}&date=${encodeURIComponent(r.date)}${r.remarks?`&remarks=${encodeURIComponent(r.remarks)}`:""}`),updateAttendance:(e,r)=>{const t=[];r.status&&t.push(`status=${encodeURIComponent(r.status)}`),r.remarks!==void 0&&t.push(`remarks=${encodeURIComponent(r.remarks)}`);const n=t.length?`?${t.join("&")}`:"";return ge.put(`/attendance/${e}${n}`)},markCheckout:(e,r)=>ge.put(`/attendance/${e}/checkout`,{checkOutTime:r}),getById:e=>ge.get(`/attendance/${e}`),getStudentAttendance:e=>ge.get(`/attendance/student/${e}`),getByDate:e=>ge.get(`/attendance/date/${e}`),getByDateRange:(e,r)=>ge.get(`/attendance/date-range?startDate=${e}&endDate=${r}`),getStudentAttendanceByDateRange:(e,r,t)=>ge.get(`/attendance/student/${e}/date-range?startDate=${r}&endDate=${t}`),getStudentAttendanceCount:e=>ge.get(`/attendance/student/${e}/count`),getGradeAttendance:(e,r)=>ge.get(`/attendance/grade/${e}/date/${r}`),getSectionAttendance:(e,r,t)=>ge.get(`/attendance/grade/${e}/section/${r}/date/${t}`),getStudentAttendanceSummary:(e,r,t)=>ge.get(`/attendance/student/${e}/summary?startDate=${encodeURIComponent(r)}&endDate=${encodeURIComponent(t)}`),markClassAttendance:(e,r,t)=>ge.post("/attendance/class",{grade:e,section:r,...t}),markClassDefault:(e,r,t)=>ge.post("/attendance/class",{grade:typeof e=="string"?parseInt(e,10):e,section:r,date:t.date,defaultStatus:t.defaultStatus,remarks:t.remarks||""}),generateMonthlyReport:(e,r,t,n)=>ge.get(`/attendance/report/monthly?grade=${e}&section=${encodeURIComponent(r)}&year=${t}&month=${n}`),getMonthlyStats:(e,r,t,n)=>ge.get(`/attendance/stats/monthly?grade=${e}&section=${encodeURIComponent(r)}&year=${t}&month=${n}`),deleteAttendance:e=>ge.delete(`/attendance/${e}`)},Ib={getByRange:async(e,r)=>ge.get(`/hrm/holidays/range?startDate=${encodeURIComponent(e)}&endDate=${encodeURIComponent(r)}`)},R9=e=>e&&{PRESENT:"success",ABSENT:"error",LATE:"warning",EXCUSED:"info"}[e]||"default",O9=e=>e==="PRESENT"?"P":e==="ABSENT"?"A":e==="LATE"?"L":e==="EXCUSED"?"E":"",L9=({open:e,onClose:r,student:t})=>{const n=Be(),[s,i]=b.useState(n.month()+1),[o,l]=b.useState(n.year()),[c,d]=b.useState(null),[u,f]=b.useState(null),[h,x]=b.useState(!1),[m,g]=b.useState(null),p=b.useMemo(()=>{const A=Be(`${o}-${String(s).padStart(2,"0")}-01`).format("YYYY-MM-DD"),j=Be(A).endOf("month").format("YYYY-MM-DD");return{start:A,end:j}},[s,o]),y=async()=>{if(t!=null&&t.id){x(!0),g(null);try{const[A,j]=await Promise.all([gn.getStudentAttendanceSummary(t.id,p.start,p.end),gn.getStudentAttendanceByDateRange(String(t.id),p.start,p.end)]);d(A),f(j)}catch(A){g((A==null?void 0:A.message)||"Failed to load attendance")}finally{x(!1)}}};b.useEffect(()=>{e&&y()},[e,s,o,t==null?void 0:t.id]);const S=Be(`${o}-${String(s).padStart(2,"0")}-01`).daysInMonth(),v={};(u||[]).forEach(A=>{const j=Be(A.date).date();v[j]=A.status});const E=(A,j,w)=>{const k=R=>{const Y=R==null?"":String(R);return Y.includes('"')||Y.includes(",")||Y.includes(`
`)?'"'+Y.replace(/"/g,'""')+'"':Y},_=[j.join(","),...w.map(R=>R.map(k).join(","))].join(`\r
`),I=new Blob([_],{type:"text/csv;charset=utf-8;"}),D=URL.createObjectURL(I),B=document.createElement("a");B.href=D,B.setAttribute("download",A),document.body.appendChild(B),B.click(),document.body.removeChild(B),URL.revokeObjectURL(D)},C=async()=>{if(!(t!=null&&t.id))return;const A=`${o}-${String(s).padStart(2,"0")}-01`,j=Be(A),w=j.daysInMonth(),k={};(u||[]).forEach(Z=>{k[Z.date]=Z});const _=j.endOf("month").format("YYYY-MM-DD");let I=[];try{I=(await Ib.getByRange(j.format("YYYY-MM-DD"),_)).map(T=>T.date)}catch{}const D=Z=>Z.day()===0;let B=0;for(let Z=1;Z<=w;Z++){const T=j.date(Z),N=T.format("YYYY-MM-DD");!D(T)&&!I.includes(N)&&B++}const R=(u||[]).filter(Z=>Z.status==="PRESENT").length,Y=(u||[]).filter(Z=>Z.status==="ABSENT").length,P=(u||[]).filter(Z=>Z.status==="LATE").length,M=B>0?R*100/B:0,K=[];K.push(["StudentId","Student Name","Grade","Section","Year","Month"]),K.push([t.studentId||"",t.name||"",t.grade||"",t.section||"",o,s]),K.push(["Total Days","Present","Absent","Late","Percent"]),K.push([B,R,Y,P,M.toFixed(1)]),K.push([]),K.push(["Date","Present","Absent"]);for(let Z=1;Z<=w;Z++){const T=j.date(Z).format("YYYY-MM-DD"),N=j.date(Z);if(D(N)||I.includes(T))continue;const H=k[T],G=(H==null?void 0:H.status)==="PRESENT"?1:0,q=(H==null?void 0:H.status)==="ABSENT"?1:0;K.push([T,G,q])}const L=K[0].map(Z=>String(Z)),ae=K.slice(1);E(`student-daily-${t.id}-${o}-${s}.csv`,L,ae)};return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{overflow:"visible"}},children:[a.jsxs(Dt,{children:["Attendance - ",t?`${t.name} (${t.studentId})`:""]}),a.jsxs(Tt,{sx:{overflow:"visible"},children:[a.jsxs(tr,{direction:"row",spacing:2,sx:{mb:2},flexWrap:"wrap",rowGap:2,children:[a.jsx(Se,{select:!0,size:"small",label:"Month",value:s,onChange:A=>i(Number(A.target.value)),variant:"outlined",InputLabelProps:{shrink:!0,sx:{overflow:"visible",whiteSpace:"nowrap",zIndex:1}},sx:{minWidth:200,"& .MuiOutlinedInput-notchedOutline legend":{width:"auto"}},children:Array.from({length:12},(A,j)=>j+1).map(A=>a.jsx(Te,{value:A,children:A},A))}),a.jsx(Se,{select:!0,size:"small",label:"Year",value:o,onChange:A=>l(Number(A.target.value)),variant:"outlined",InputLabelProps:{shrink:!0,sx:{overflow:"visible",whiteSpace:"nowrap",zIndex:1}},sx:{minWidth:180,"& .MuiOutlinedInput-notchedOutline legend":{width:"auto"}},children:Array.from({length:9},(A,j)=>n.year()-4+j).map(A=>a.jsx(Te,{value:A,children:A},A))}),a.jsx(ye,{variant:"outlined",onClick:y,children:"Refresh"}),a.jsx(ye,{variant:"text",onClick:C,disabled:!(t!=null&&t.id),children:"Download CSV"})]}),h&&a.jsx(Ui,{}),m&&a.jsx(V,{color:"error",variant:"body2",sx:{mt:1},children:m}),c&&a.jsxs(ee,{sx:{mb:2},children:[a.jsxs(V,{variant:"body2",children:["Present: ",c.presentDays," | Absent: ",c.absentDays," | Late: ",c.lateDays]}),a.jsxs(V,{variant:"body2",sx:{mt:.5},children:["Attendance: ",Number(c.attendancePercentage||0).toFixed(1),"%"]}),a.jsx(Ui,{sx:{mt:.5},variant:"determinate",value:Math.min(100,Math.max(0,Number(c.attendancePercentage||0)))})]}),a.jsxs(ee,{sx:{maxWidth:"100%",overflowX:"auto"},children:[a.jsxs(ee,{component:"table",sx:{borderCollapse:"collapse",width:"max-content"},children:[a.jsx(ee,{component:"thead",children:a.jsx(ee,{component:"tr",children:Array.from({length:S},(A,j)=>j+1).map(A=>a.jsx(ee,{component:"th",sx:{px:1,py:.5,textAlign:"center"},children:A},A))})}),a.jsx(ee,{component:"tbody",children:a.jsx(ee,{component:"tr",children:Array.from({length:S},(A,j)=>j+1).map(A=>a.jsx(ee,{component:"td",sx:{px:1,py:.5,textAlign:"center"},children:v[A]?a.jsx(at,{size:"small",label:O9(v[A]),color:R9(v[A])}):a.jsx(V,{variant:"caption",color:"text.disabled",children:"-"})},A))})})]}),a.jsxs(V,{variant:"caption",color:"text.secondary",sx:{mt:1,display:"block"},children:["Legend: ",a.jsx(at,{size:"small",label:"P",color:"success",sx:{mx:.5}})," Present",a.jsx(at,{size:"small",label:"A",color:"error",sx:{mx:.5}})," Absent",a.jsx(at,{size:"small",label:"L",color:"warning",sx:{mx:.5}})," Late",a.jsx(at,{size:"small",label:"E",color:"info",sx:{mx:.5}})," Excused"]})]})]}),a.jsx(Ct,{children:a.jsx(ye,{onClick:r,children:"Close"})})]})};var p0={},$9=Lt;Object.defineProperty(p0,"__esModule",{value:!0});var Lc=p0.default=void 0,B9=$9($t()),U9=a;Lc=p0.default=(0,B9.default)((0,U9.jsx)("path",{d:"M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3m-3 11H8v-5h8zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1m-1-9H6v4h12z"}),"Print");const V9=({open:e,onClose:r,student:t})=>{const[n,s]=b.useState([]),[i,o]=b.useState([]),[l,c]=b.useState(""),[d,u]=b.useState([]),[f,h]=b.useState(!1),[x,m]=b.useState(!1),[g,p]=b.useState(null),[y,S]=b.useState(null),v=b.useRef(null);b.useEffect(()=>{if(!e)return;(async()=>{try{m(!0),p(null);const B=await ge.get("/api/exams"),R=await ge.get("/api/exam-configs/classes");s(B),o(R)}catch(B){p(B.message||"Failed to load exams/classes")}finally{m(!1)}})()},[e]);const E=b.useMemo(()=>{const D=new Set;(n||[]).forEach(R=>{const Y=R.startDate?new Date(R.startDate).getFullYear().toString():"";Y&&D.add(Y)});const B=Array.from(D).sort((R,Y)=>Number(Y)-Number(R));return!l&&B.length&&c(B[0]),B},[n]),C=b.useMemo(()=>l?(n||[]).filter(D=>D.startDate&&new Date(D.startDate).getFullYear().toString()===l):[],[l,n]),A=a.jsx("style",{children:`
      @media print { .no-print{ display:none !important; } .card { page-break-after: always; } }
      .card { border:1px solid #ddd; border-radius:8px; margin: 8px 0; padding: 16px; background:#fff; }
      .card h2 { margin: 4px 0; font-size: 20px; }
      .meta { color:#555; margin-bottom: 8px; }
      table.rc { width:100%; border-collapse: collapse; }
      table.rc th, table.rc td { border: 1px solid #bbb; padding: 6px; font-size: 13px; }
      table.rc th { background: #f6f7fb; }
      .totals { margin-top: 8px; font-weight: 600; }
      .school-title { font-weight: 700; font-size: 20px; color: #2a4d8f; }
      .header-line { height: 3px; background: linear-gradient(90deg,#2a4d8f,#4b79cf); margin: 6px 0 12px; }
    `}),j=async()=>{var P,M,K;if(!(t!=null&&t.id)){p("Missing student");return}if(!l||d.length===0){p("Please select year and exam(s).");return}const D=String(t.grade||"").match(/\d+/),B=D?parseInt(D[0],10):Number(t.grade)||void 0,R=String(t.section||"").trim(),Y=((P=i.find(L=>{var ae;return((ae=(L.name||"").match(/\d+/))==null?void 0:ae[0])===String(B)}))==null?void 0:P.id)||((M=i[0])==null?void 0:M.id);if(!B||!R||!Y){p("Unable to resolve class/section for this student");return}try{m(!0);const L={exams:{}};for(const ae of d){const Z=await ge.get("/api/exams/marks/matrix",{examId:ae,classId:Y,grade:B,section:R}),T=((K=n.find(G=>G.id===ae))==null?void 0:K.name)||`Exam ${ae}`,N=(Z.students||[]).find(G=>Number(G.studentId)===Number(t.id));N&&!L.student&&(L.student={id:Number(N.studentId),name:N.studentName,roll:N.rollNumber});const H={};N&&(N.cells||[]).forEach(G=>{H[G.subjectId]=G}),L.exams[ae]={examName:T,subjects:Z.subjects||[],cells:H}}L.student||(L.student={id:t.id,name:t.name||`${t.firstName||""} ${t.lastName||""}`.trim(),roll:t.studentId}),S(L),setTimeout(()=>{var ae;return(ae=v.current)==null?void 0:ae.scrollIntoView({behavior:"smooth"})},50),p(null)}catch(L){p(L.message||"Failed to generate academic record")}finally{m(!1)}},w=()=>window.print(),k=()=>{var L,ae;if(!y)return;const B=[["Student","Roll","Exam","Subject","Theory","Practical","Total","Max Total"].join(",")],R=((L=y.student)==null?void 0:L.name)||"",Y=((ae=y.student)==null?void 0:ae.roll)||"";Object.entries(y.exams).forEach(([Z,T])=>{T.subjects.forEach(N=>{const H=T.cells[N.subjectId]||{theoryMarks:0,practicalMarks:0},G=H.theoryMarks||0,q=H.practicalMarks||0;B.push([R,Y,T.examName,N.subjectName,String(G),String(q),String(G+q),String(N.totalMaxMarks||"")].join(","))})});const P=new Blob([B.join(`
`)+`
`],{type:"text/csv;charset=utf-8;"}),M=URL.createObjectURL(P),K=document.createElement("a");K.href=M,K.download=`Academic_${l}_${(t==null?void 0:t.studentId)||(t==null?void 0:t.id)}.csv`,K.style.display="none",document.body.appendChild(K),K.click(),document.body.removeChild(K),URL.revokeObjectURL(M)},_=D=>{const{student:B,exams:R}=D;return a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"school-title",children:"School Management System"}),a.jsx("div",{className:"header-line"}),a.jsxs("h2",{children:["Report Card - AY ",l]}),a.jsxs("div",{className:"meta",children:[a.jsx("strong",{children:"Student:"})," ",B.name," ¬† | ¬† ",a.jsx("strong",{children:"Roll:"})," ",B.roll||"-"]}),Object.entries(R).map(([Y,P])=>{let M=0,K=0;return a.jsxs(ee,{sx:{mb:2},children:[a.jsx(V,{variant:"subtitle1",sx:{mb:.5},children:P.examName}),a.jsxs("table",{className:"rc",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Subject"}),a.jsx("th",{children:"Th"}),a.jsx("th",{children:"Pr"}),a.jsx("th",{children:"Total"}),a.jsx("th",{children:"Max"})]})}),a.jsx("tbody",{children:P.subjects.map(L=>{const ae=P.cells[L.subjectId]||{theoryMarks:0,practicalMarks:0},Z=ae.theoryMarks||0,T=ae.practicalMarks||0,N=Z+T,H=L.totalMaxMarks||0;return M+=N,K+=H,a.jsxs("tr",{children:[a.jsx("td",{children:L.subjectName}),a.jsx("td",{style:{textAlign:"center"},children:Z}),a.jsx("td",{style:{textAlign:"center"},children:T}),a.jsx("td",{style:{textAlign:"center"},children:N}),a.jsx("td",{style:{textAlign:"center"},children:H})]},L.subjectId)})})]}),a.jsxs("div",{className:"totals",children:["Total: ",M," / ",K," ¬† | ¬† Percentage: ",K>0?(M*100/K).toFixed(2)+"%":"-"]})]},Y)})]})},I=(t==null?void 0:t.name)||`${(t==null?void 0:t.firstName)||""} ${(t==null?void 0:t.lastName)||""}`.trim();return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"lg",children:[a.jsxs(Dt,{children:["Academic Records - ",I," ",t!=null&&t.studentId?`(${t.studentId})`:""]}),a.jsxs(Tt,{children:[a.jsx(Fa,{open:!!g,autoHideDuration:6e3,onClose:()=>p(null),children:a.jsx(pt,{onClose:()=>p(null),severity:"error",sx:{width:"100%"},children:g})}),a.jsx(ee,{className:"no-print",sx:{mb:2},children:a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,xs:12,sm:4,md:2,children:a.jsxs(rt,{fullWidth:!0,size:"small",children:[a.jsx(ot,{children:"Year"}),a.jsx(tt,{value:l,label:"Year",onChange:D=>{c(D.target.value),u([])},children:E.map(D=>a.jsx(Te,{value:D,children:D},D))})]})}),a.jsx(X,{item:!0,xs:12,sm:8,md:6,children:a.jsxs(rt,{fullWidth:!0,size:"small",disabled:!l,children:[a.jsx(ot,{children:"Exams"}),a.jsx(tt,{multiple:!0,open:f,onOpen:()=>h(!0),onClose:()=>h(!1),value:d,label:"Exams",onChange:D=>u(D.target.value),renderValue:D=>a.jsx(ee,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:D.map(B=>{var R;return a.jsx(at,{size:"small",label:((R=C.find(Y=>Y.id===B))==null?void 0:R.name)||B},B)})}),children:C.map(D=>a.jsx(Te,{value:D.id,children:D.name},D.id))})]})}),a.jsx(X,{item:!0,xs:12,sm:12,md:"auto",children:a.jsxs(ee,{sx:{display:"flex",gap:1},children:[a.jsxs(ye,{variant:"contained",size:"small",onClick:j,disabled:x||!t,children:[" ",x?a.jsx(vr,{size:18}):"Generate"," "]}),a.jsx(ye,{variant:"outlined",size:"small",startIcon:a.jsx(ai,{}),onClick:k,disabled:!y,children:"CSV"}),a.jsx(ye,{variant:"outlined",size:"small",startIcon:a.jsx(Lc,{}),onClick:w,disabled:!y,children:"Print"})]})})]})}),A,a.jsx("div",{ref:v,children:y?_({student:y.student,exams:y.exams}):a.jsx(V,{color:"text.secondary",children:"Select options and click Generate to view the academic record."})})]}),a.jsx(Ct,{children:a.jsx(ye,{onClick:r,children:"Close"})})]})};var x0={},W9=Lt;Object.defineProperty(x0,"__esModule",{value:!0});var Fb=x0.default=void 0,H9=W9($t()),Y9=a;Fb=x0.default=(0,H9.default)((0,Y9.jsx)("path",{d:"M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 16H5V10h14zM9 14H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2zm-8 4H7v-2h2zm4 0h-2v-2h2zm4 0h-2v-2h2z"}),"CalendarMonth");var g0={},z9=Lt;Object.defineProperty(g0,"__esModule",{value:!0});var Mb=g0.default=void 0,G9=z9($t()),q9=a;Mb=g0.default=(0,G9.default)((0,q9.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload");const ea=160,Sx=[{value:"1",label:"January"},{value:"2",label:"February"},{value:"3",label:"March"},{value:"4",label:"April"},{value:"5",label:"May"},{value:"6",label:"June"},{value:"7",label:"July"},{value:"8",label:"August"},{value:"9",label:"September"},{value:"10",label:"October"},{value:"11",label:"November"},{value:"12",label:"December"}],X9=({open:e,onClose:r,student:t})=>{const[n,s]=b.useState([]),[i,o]=b.useState(!1),[l,c]=b.useState([]),[d,u]=b.useState(""),[f,h]=b.useState(""),[x,m]=b.useState(String(new Date().getMonth()+1)),[g,p]=b.useState(String(new Date().getFullYear())),[y,S]=b.useState(null);b.useEffect(()=>{if(!e)return;let w=!0;return(async()=>{try{const k=await zr.getAll();if(!w)return;s(k||[])}catch{s([])}})(),()=>{w=!1}},[e]),b.useEffect(()=>{e&&t&&(S(t),t.grade!=null&&u(String(t.grade)),t.section&&h(t.section))},[e,t]);const v=b.useMemo(()=>{const w=new Set;return(n||[]).forEach(k=>{k.grade!=null&&w.add(String(k.grade))}),Array.from(w).sort((k,_)=>Number(k)-Number(_))},[n]),E=b.useMemo(()=>{const w=new Set;return(n||[]).filter(k=>d?String(k.grade)===String(d):!0).forEach(k=>{k.section&&w.add(k.section)}),Array.from(w).sort()},[n,d]),C=b.useMemo(()=>(n||[]).filter(w=>(d?String(w.grade)===String(d):!0)&&(f?w.section===f:!0)),[n,d,f]),A=(w,k)=>{const _=M=>{const K=M==null?"":String(M),L=/[",\n]/.test(K),ae=K.replace(/"/g,'""');return L?`"${ae}"`:ae},I=["Receipt Number","Payment Date","Student Name","Student ID","Grade","Section","Amount","Method","Status"],D=w.map(M=>{var K,L;return[M.receiptNumber||"",M.paymentDate?new Date(M.paymentDate).toISOString().slice(0,10):"",M.studentName||((K=M.student)==null?void 0:K.name)||"",M.studentId||((L=M.student)==null?void 0:L.id)||"",M.studentGrade||M.grade||"",M.studentSection||M.section||"",M.amountPaid??M.amount??0,M.paymentMethod||"",M.paymentStatus||""].map(_).join(",")}),B=[I.map(_).join(","),...D].join(`
`),R=new Blob([B],{type:"text/csv;charset=utf-8"}),Y=window.URL.createObjectURL(R),P=document.createElement("a");P.href=Y,P.setAttribute("download",k),document.body.appendChild(P),P.click(),P.remove()};b.useEffect(()=>{if(!e)return;(async()=>{try{o(!0);let k=[];y!=null&&y.id?k=await Bt.getPaymentsByStudentId(Number(y.id)):d?k=await Bt.getFilteredPayments({grade:d,section:f||void 0}):k=await Bt.getAllPayments();const _=k.map(R=>{var P;const Y=(n||[]).find(M=>Number(M.id??M.studentId)===Number(R.studentId));return{...R,studentName:R.studentName||((P=R==null?void 0:R.student)==null?void 0:P.name)||(Y?Y.name:""),studentGrade:R.studentGrade||(R==null?void 0:R.grade)||(Y&&Y.grade?String(Y.grade):""),studentSection:R.studentSection||(R==null?void 0:R.section)||(Y==null?void 0:Y.section)||""}}),I=x?parseInt(x,10):void 0,D=g?parseInt(g,10):void 0,B=_.filter(R=>{if(!I&&!D)return!0;const Y=R.paymentDate?new Date(R.paymentDate):null;if(!Y||isNaN(Y.getTime()))return!1;const P=I?Y.getMonth()+1===I:!0,M=D?Y.getFullYear()===D:!0;return P&&M});c(B)}catch{c([])}finally{o(!1)}})()},[e,d,f,y==null?void 0:y.id,x,g,n]);const j=async()=>{var w;try{if(y!=null&&y.id){await Bt.downloadStudentReportCsv({studentId:Number(y.id),month:x?Number(x):void 0,year:g?Number(g):void 0});return}if(d){await Bt.downloadClassSectionReportCsv({grade:Number(d),section:f||void 0,month:x?Number(x):void 0,year:g?Number(g):void 0});return}const k=g||String(new Date().getFullYear()),_=x?((w=Sx.find(I=>I.value===x))==null?void 0:w.label)||x:"ALL";A(l,`Report-${_}-${k}.csv`)}catch{}};return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"lg",children:[a.jsxs(Dt,{children:["Fee Payments - ",t==null?void 0:t.name," ",t!=null&&t.studentId?`(${t.studentId})`:""]}),a.jsxs(Tt,{children:[a.jsxs(tr,{direction:"row",spacing:1,alignItems:"center",sx:{flexWrap:"nowrap",columnGap:1,overflowX:"auto",overflowY:"visible",minHeight:64,mb:1},children:[a.jsxs(Se,{select:!0,label:"Class",size:"small",value:d,onChange:w=>{u(w.target.value),h("")},sx:{width:ea,minWidth:ea},children:[a.jsx(Te,{value:"",children:"Select"}),v.map(w=>a.jsx(Te,{value:w,children:w},w))]}),a.jsxs(Se,{select:!0,label:"Section (optional)",size:"small",value:f,onChange:w=>h(w.target.value),disabled:!d,sx:{width:ea,minWidth:ea},children:[a.jsx(Te,{value:"",children:"All"}),E.map(w=>a.jsx(Te,{value:w,children:w},w))]}),a.jsx(Yi,{size:"small",sx:{width:ea,minWidth:ea},options:C,getOptionLabel:w=>`${w.name} (${w.studentId||w.id})`,value:y,onChange:(w,k)=>S(k),renderInput:w=>a.jsx(Se,{...w,label:"Student (optional)",placeholder:"Search name/ID",variant:"outlined",size:"small"})}),a.jsxs(Se,{select:!0,label:"Month",size:"small",value:x,onChange:w=>m(w.target.value),InputLabelProps:{shrink:!0},sx:{width:ea,minWidth:ea},InputProps:{startAdornment:a.jsx(Nn,{position:"start",children:a.jsx(Fb,{fontSize:"small",color:"action"})})},children:[a.jsx(Te,{value:"",children:"All"}),Sx.map(w=>a.jsx(Te,{value:w.value,children:w.label},w.value))]}),a.jsx(Se,{label:"Year",type:"number",size:"small",value:g,onChange:w=>p(w.target.value),InputLabelProps:{shrink:!0},sx:{width:ea,minWidth:ea},inputProps:{min:2e3,max:new Date().getFullYear()+1}}),a.jsx(ye,{size:"small",variant:"contained",startIcon:a.jsx(Mb,{}),onClick:j,sx:{whiteSpace:"nowrap",px:1,minWidth:ea,width:ea,height:32},children:"Download CSV"})]}),i?a.jsx(Ar,{}):a.jsx(cc,{payments:l,onViewReceipt:()=>{},onDownloadReceipt:()=>{},onVoidPayment:void 0,isAdmin:!1,showStudentDetails:!0,showClassSection:!1}),!i&&l.length===0&&a.jsx(V,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"No payments match the selected filters."})]}),a.jsx(Ct,{children:a.jsx(ye,{onClick:r,children:"Close"})})]})},K9=()=>{const[e,r]=b.useState(!1),[t,n]=b.useState(!1),[s,i]=b.useState(void 0),[o,l]=b.useState(!1),[c,d]=b.useState(null),[u,f]=b.useState(null),[h,x]=b.useState(void 0),[m,g]=b.useState(!1),[p,y]=b.useState(null),[S,v]=b.useState(!1),{showNotification:E}=dr(),{user:C}=$n(),[A,j]=b.useState(!1),[w,k]=b.useState(null);b.useState(!1),b.useState(!1),b.useState(null);const[_,I]=b.useState(!1),[D,B]=b.useState(!1),[R,Y]=b.useState(!1),{data:P,loading:M,error:K,refresh:L}=Gt(()=>zr.getAllStudents(),{cacheKey:"students",onError:ve=>{console.error("Error in useApi for students:",ve),k(ve)}}),{mutate:ae,loading:Z}=pr(ve=>zr.create(ve),{onSuccess:()=>{E({type:"success",message:"Student created successfully"}),r(!1),L()},onError:ve=>{var we,Ee;console.error("Error saving student:",ve);const ne=ve;ne.response&&(console.error("Server response:",ne.response.data),console.error("Status code:",ne.response.status)),E({type:"error",message:`Failed to create student: ${((Ee=(we=ne.response)==null?void 0:we.data)==null?void 0:Ee.message)||(ve==null?void 0:ve.message)||"Unknown error"}`})}}),{mutate:T,loading:N}=pr(ve=>zr.update(ve.id,ve),{onSuccess:()=>{E({type:"success",message:"Student updated successfully"}),r(!1),i(void 0),L()}}),{mutate:H}=pr(ve=>zr.delete(ve),{onSuccess:()=>{E({type:"success",message:"Student deleted successfully"}),L()}}),{mutate:G,loading:q}=pr(ve=>zr.createBulk(ve),{onSuccess:ve=>{E({type:"success",message:`${ve.length} students created successfully`}),n(!1),L()},onError:ve=>{console.error("Error creating students in bulk:",ve),E({type:"error",message:`Failed to create students: ${ve.message||"Unknown error"}`})}}),{mutate:oe}=pr(ve=>zr.updateStatus(ve.id,ve.status),{onSuccess:ve=>{E({type:"success",message:`Student status updated to ${ve.status}`}),L()},onError:ve=>{E({type:"error",message:`Failed to update student status: ${ve.message}`})}}),de=async(ve,ne)=>{try{ve.id&&await oe({id:ve.id,status:ne}),f(null)}catch(we){console.error("Error updating student status:",we)}},z=ve=>{i(ve),r(!0)},O=ve=>{i(ve),I(!0)},W=ve=>{i(ve),B(!0)},F=async ve=>{x(ve),d(null),l(!0);try{const ne=await ge.get(`/api/students/${ve.id}/deletion-impact`),we=ne&&ne.data?ne.data:ne;d(we)}catch(ne){console.warn("Could not fetch deletion impact:",ne)}},U=async ve=>{if(!ve.id){E({type:"error",message:"Cannot open fee reports: Student ID is missing"});return}if(!Rr((C==null?void 0:C.role)||"","VIEW_FEES")&&!Rr((C==null?void 0:C.role)||"","MANAGE_FEES")){E({type:"error",message:"You do not have permission to view fee details."});return}i(ve),Y(!0)},te=async()=>{var ve,ne;if(h)try{await H(h.id),l(!1),x(void 0),d(null)}catch(we){console.error("Error deleting student:",we);const Ee=we,pe=((ne=(ve=Ee==null?void 0:Ee.response)==null?void 0:ve.data)==null?void 0:ne.message)||(we==null?void 0:we.message)||"Unknown error";E({type:"error",message:`Failed to delete student: ${pe}`})}},he=async()=>{if(h!=null&&h.id)try{await oe({id:h.id,status:"INACTIVE"}),l(!1),x(void 0),d(null)}catch(ve){E({type:"error",message:(ve==null?void 0:ve.message)||"Failed to update status"})}},ie=()=>{r(!1),i(void 0)},be=()=>{g(!1),y(null)},xe=async ve=>{var ne,we;try{if(s)await T({...ve,id:s.id});else{console.log("Creating new student with properly structured data:",ve);try{await ae(ve)}catch(Ee){console.error("Standard API approach failed, trying with elevated permissions:",Ee);try{await zr.createWithElevatedPermissions(ve),E({type:"success",message:"Student created successfully with admin permissions"}),r(!1),L()}catch(pe){throw console.error("Failed with elevated permissions too:",pe),pe}}}}catch(Ee){console.error("Error in handleSubmit:",Ee),E({type:"error",message:`Error: ${((we=(ne=Ee.response)==null?void 0:ne.data)==null?void 0:we.message)||(Ee==null?void 0:Ee.message)||"Unknown error occurred"}`})}},Fe=async ve=>{try{await G(ve)}catch(ne){console.error("Standard API approach failed, trying with elevated permissions:",ne);try{await zr.createBulkWithElevatedPermissions(ve),E({type:"success",message:`${ve.length} students created successfully with admin permissions`}),n(!1),L()}catch(we){throw console.error("Failed with elevated permissions too:",we),we}}},me=[{id:"studentId",label:"ID",sortable:!0},{id:"name",label:"Name",sortable:!0},{id:"grade",label:"Grade",sortable:!0},{id:"section",label:"Section",sortable:!0},{id:"dateOfBirth",label:"Date of Birth",sortable:!0,format:kg},{id:"email",label:"Email",sortable:!0},{id:"phoneNumber",label:"Contact",sortable:!0},{id:"status",label:"Status",sortable:!0,format:(ve,ne)=>{const we=String(ve).toUpperCase();if(Rr((C==null?void 0:C.role)||"","EDIT_STUDENT"))return a.jsx(rt,{size:"small",fullWidth:!0,children:a.jsxs(tt,{value:we,onChange:Ee=>de(ne,Ee.target.value),displayEmpty:!0,variant:"standard",sx:{"& .MuiSelect-select":{py:0,color:()=>{switch(we){case"ACTIVE":return"success.main";case"INACTIVE":return"error.main";case"GRADUATED":return"info.main";case"SUSPENDED":return"warning.dark";default:return"text.primary"}}}},children:[a.jsx(Te,{value:"ACTIVE",children:"Active"}),a.jsx(Te,{value:"INACTIVE",children:"Inactive"}),a.jsx(Te,{value:"GRADUATED",children:"Graduated"}),a.jsx(Te,{value:"SUSPENDED",children:"Suspended"})]})});{let Ee="default";return we==="ACTIVE"?Ee="success":we==="INACTIVE"?Ee="error":we==="GRADUATED"?Ee="info":we==="SUSPENDED"&&(Ee="warning"),a.jsxs(V,{variant:"body2",sx:{color:`${Ee}.main`,fontWeight:"medium",display:"inline-flex",alignItems:"center",gap:.5},children:[we==="ACTIVE"&&a.jsx(ko,{fontSize:"small"}),we==="INACTIVE"&&a.jsx(Rx,{fontSize:"small"}),we==="GRADUATED"&&a.jsx(Xa,{fontSize:"small"}),we==="SUSPENDED"&&a.jsx(vS,{fontSize:"small"}),we]})}}},{id:"actions",label:"Actions",sortable:!1,format:(ve,ne)=>a.jsxs(ee,{sx:{display:"flex",gap:1},children:[Rr((C==null?void 0:C.role)||"","EDIT_STUDENT")&&a.jsx(xt,{title:"Edit",children:a.jsx(st,{size:"small",onClick:()=>z(ne),color:"primary",children:a.jsx(Za,{fontSize:"small"})})}),Rr((C==null?void 0:C.role)||"","DELETE_STUDENT")&&a.jsx(xt,{title:"Delete",children:a.jsx(st,{size:"small",onClick:()=>F(ne),color:"error",children:a.jsx(ws,{fontSize:"small"})})}),Rr((C==null?void 0:C.role)||"","MANAGE_ATTENDANCE")&&a.jsx(xt,{title:"Attendance",children:a.jsx(st,{size:"small",color:"info",onClick:()=>O(ne),children:a.jsx(mu,{fontSize:"small"})})}),Rr((C==null?void 0:C.role)||"","MANAGE_EXAMS")&&a.jsx(xt,{title:"Academic Records",children:a.jsx(st,{size:"small",color:"success",onClick:()=>W(ne),children:a.jsx(Xa,{fontSize:"small"})})}),(Rr((C==null?void 0:C.role)||"","MANAGE_FEES")||Rr((C==null?void 0:C.role)||"","VIEW_FEES"))&&a.jsx(xt,{title:"Fee Details",children:a.jsx(st,{size:"small",color:"secondary",onClick:()=>U(ne),children:a.jsx(pu,{fontSize:"small"})})})]})}];if(M)return a.jsx(Ar,{});if(K){const ve=typeof K=="string"?K:(K==null?void 0:K.message)||String(K)||"Couldn't load student data";return a.jsxs(ee,{sx:{p:3},children:[a.jsx(Kr,{title:"Error Loading Students",message:ve,onRetry:L}),a.jsxs(ee,{sx:{mt:3,display:"flex",gap:2},children:[a.jsx(ye,{variant:"contained",onClick:L,children:"Try Again"}),a.jsx(ye,{variant:"outlined",color:"secondary",onClick:()=>j(!0),children:"Diagnostics"})]}),w&&a.jsxs(Ke,{elevation:0,variant:"outlined",sx:{p:3,mt:4},children:[a.jsxs(pt,{severity:"error",sx:{mb:2},children:[a.jsxs(V,{variant:"subtitle1",children:["HTTP Status: ",w.status||"Unknown"]}),w.message]}),a.jsx(V,{variant:"subtitle1",children:"Debug Information:"}),a.jsx(ee,{component:"pre",sx:{p:2,bgcolor:"grey.100",borderRadius:1,overflowX:"auto"},children:JSON.stringify(w.originalError||w,null,2)}),a.jsxs(ee,{sx:{mt:2},children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"Possible Solutions:"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Verify the API endpoint path is correct"}),a.jsx("li",{children:"Check that your user account has permission to access student data"}),a.jsx("li",{children:"Ensure your authentication token is valid and not expired"}),a.jsx("li",{children:"Verify the backend server is running and accessible"})]})]})]})]})}return a.jsxs(ee,{sx:{p:3},children:[a.jsxs(ee,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(V,{variant:"h4",children:"Students"}),a.jsxs(ee,{children:[a.jsx(ye,{variant:"text",color:"secondary",onClick:()=>j(!0),sx:{mr:2},children:"Debug"}),a.jsx(ps,{permission:"CREATE_STUDENT",children:a.jsxs(tr,{direction:"row",spacing:2,children:[a.jsx(ye,{variant:"outlined",color:"primary",startIcon:a.jsx(of,{}),onClick:()=>n(!0),children:"Bulk Upload"}),a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(js,{}),onClick:()=>r(!0),children:"New Student"})]})})]})]}),a.jsx(Ke,{children:a.jsx(Df,{columns:me,data:P||[],loading:M,onRefresh:L,searchPlaceholder:"Search students..."})}),a.jsx(k4,{open:e,onClose:ie,onSubmit:xe,initialData:s,loading:Z||N}),a.jsx(L9,{open:_,onClose:()=>I(!1),student:s||null}),a.jsx(V9,{open:D,onClose:()=>B(!1),student:s||null}),a.jsx(X9,{open:R,onClose:()=>Y(!1),student:s||null}),a.jsx(P9,{open:t,onClose:()=>n(!1),onSubmit:Fe,loading:q}),a.jsxs(At,{open:o,onClose:()=>l(!1),children:[a.jsx(Dt,{children:"Confirm Deletion"}),a.jsxs(Tt,{children:[a.jsx(zi,{children:"Are you sure you want to delete this student? Related records will be removed where applicable."}),a.jsxs(ee,{sx:{mt:1},children:[a.jsx(V,{variant:"body2",sx:{mb:1},children:"The following will be deleted with the student:"}),a.jsxs("ul",{style:{marginTop:0},children:[a.jsxs("li",{children:["Attendance: ",c?c.attendanceCount:"‚Ä¶"]}),a.jsxs("li",{children:["Payments: ",c?c.paymentsCount:"‚Ä¶"]}),a.jsxs("li",{children:["Fee Payments: ",c?c.feePaymentsCount:"‚Ä¶"]}),a.jsxs("li",{children:["Payment Schedules: ",c?c.paymentSchedulesCount:"‚Ä¶"]}),a.jsxs("li",{children:["Fee Assignments: ",c?c.feeAssignmentsCount:"‚Ä¶"]})]}),a.jsx(pt,{severity:"info",sx:{mt:1},children:"Alternatively, you can disable the student to keep records but prevent usage."})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>l(!1),color:"primary",children:"Cancel"}),a.jsx(ye,{onClick:he,color:"warning",variant:"outlined",children:"Disable Instead"}),a.jsx(ye,{onClick:te,color:"error",variant:"contained",children:"Delete"})]})]}),a.jsxs(At,{open:m,onClose:be,fullWidth:!0,maxWidth:"md",children:[a.jsx(Dt,{children:"Fee Details"}),a.jsx(Tt,{children:S?a.jsx(ee,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%"},children:a.jsx(vr,{})}):p?a.jsx(L1,{feeDetails:p}):a.jsx(V,{children:"No fee details available"})}),a.jsx(Ct,{children:a.jsx(ye,{onClick:be,color:"primary",children:"Close"})})]}),a.jsxs(Bc,{anchorEl:u,open:!!u,onClose:()=>f(null),children:[a.jsx(Te,{onClick:()=>de(s,"ACTIVE"),children:"Set Active"}),a.jsx(Te,{onClick:()=>de(s,"INACTIVE"),children:"Set Inactive"}),a.jsx(Te,{onClick:()=>de(s,"GRADUATED"),children:"Set Graduated"}),a.jsx(Te,{onClick:()=>de(s,"SUSPENDED"),children:"Set Suspended"})]})]})};var y0={},J9=Lt;Object.defineProperty(y0,"__esModule",{value:!0});var Pb=y0.default=void 0,Q9=J9($t()),Z9=a;Pb=y0.default=(0,Q9.default)((0,Z9.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");const eV=()=>{const[e,r]=b.useState(!1),[t,n]=b.useState(null),[s,i]=b.useState(0),o=()=>i(c=>c+1);it.useEffect(()=>{const c=localStorage.getItem("token");if(c)try{const d=c.split(".");if(d.length!==3){n({error:"Invalid token format"});return}const u=JSON.parse(atob(d[1])),f=Math.floor(Date.now()/1e3),h=u.exp&&u.exp<f;n({...u,isExpired:h,expiresIn:u.exp?new Date(u.exp*1e3).toLocaleString():"Unknown",decodedPayload:u})}catch(d){const u=d&&typeof d=="object"&&"message"in d&&typeof d.message=="string"?d.message:"Unknown error";n({error:"Failed to decode token",details:u})}else n({error:"No token found in localStorage"})},[s]);const l=it.useMemo(()=>{const c=localStorage.getItem("user");if(!c)return{error:"No user data found"};try{return JSON.parse(c)}catch(d){return{error:"Failed to parse user data",details:d&&typeof d=="object"&&"message"in d&&typeof d.message=="string"?d.message:"Unknown error"}}},[s]);return a.jsxs(ds,{expanded:e,onChange:()=>r(!e),sx:{mb:2,border:"1px solid #ddd"},children:[a.jsx(us,{expandIcon:a.jsx(Wa,{}),children:a.jsxs(ee,{sx:{display:"flex",alignItems:"center",width:"100%",justifyContent:"space-between"},children:[a.jsx(V,{variant:"subtitle1",children:"Authentication Debugger"}),t!=null&&t.isExpired?a.jsx(at,{icon:a.jsx(yc,{}),label:"Token Expired",color:"error",size:"small"}):t!=null&&t.error?a.jsx(at,{icon:a.jsx(yc,{}),label:"Auth Error",color:"error",size:"small"}):a.jsx(at,{icon:a.jsx(If,{}),label:"Token Valid",color:"success",size:"small"})]})}),a.jsxs(fs,{children:[a.jsx(ee,{sx:{mb:1},children:a.jsx(ye,{size:"small",startIcon:a.jsx(Pb,{}),onClick:o,variant:"outlined",sx:{mb:2},children:"Refresh Auth Data"})}),a.jsx(V,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:"User Information:"}),a.jsx(Ke,{sx:{p:1,mb:2,bgcolor:"#f8f9fa",overflowX:"auto"},children:a.jsx("pre",{style:{margin:0},children:JSON.stringify(l,null,2)})}),a.jsx(V,{variant:"subtitle2",sx:{fontWeight:"bold",mb:1},children:"Token Information:"}),a.jsx(Ke,{sx:{p:1,mb:2,bgcolor:"#f8f9fa",overflowX:"auto"},children:a.jsx("pre",{style:{margin:0},children:JSON.stringify(t,null,2)})}),(t==null?void 0:t.isExpired)&&a.jsxs(V,{color:"error",variant:"body2",children:["Your token has expired at ",t.expiresIn,". You need to log in again."]}),(t==null?void 0:t.error)&&a.jsxs(V,{color:"error",variant:"body2",children:["Authentication error: ",t.error]}),a.jsx(V,{variant:"caption",color:"textSecondary",children:"This debugger is intended for development use only"})]})]})},tV=["staffId","firstName","lastName","email","phoneNumber","role","joinDate"],rV=`staffId,firstName,middleName,lastName,email,phoneNumber,role,joinDate,address,dateOfBirth,gender,department,designation,qualifications,emergencyContact,bloodGroup,isActive,pfUAN,gratuity,serviceEndDate,basicSalary,hra,da,profileImage
EMP001,John,M,Smith,john.smith@example.com,1234567890,Teacher,2022-05-15,123 Main St,1985-03-20,MALE,Mathematics,Senior Teacher,B.Ed in Mathematics,9876543210,A+,true,UAN12345678,GR12345,,50000,15000,5000,profile1.jpg
EMP002,Jane,,Doe,jane.doe@example.com,9876543210,Librarian,2021-06-10,456 Elm St,1990-07-12,FEMALE,Library,Head Librarian,Master in Library Science,1234567890,O+,true,UAN23456789,GR23456,,45000,13000,4500,profile2.jpg
EMP003,Robert,K,Johnson,robert.johnson@example.com,5551234567,Admin Officer,2020-03-15,789 Oak Ave,1982-11-30,MALE,Administration,Senior Manager,MBA,7778889999,B-,true,UAN34567890,GR34567,,60000,18000,6000,profile3.jpg`,nV=({open:e,onClose:r,onSubmit:t,loading:n})=>{const[s,i]=b.useState(""),[o,l]=b.useState([]),[c,d]=b.useState([]),[u,f]=b.useState("initial"),[h,x]=b.useState(""),m=b.useRef(null),g=A=>{i(A.target.value),f("initial"),l([]),d([]),x("")},p=(A,j)=>{const w=[];tV.forEach(I=>{A[I]||w.push({index:j,field:I,message:`Missing required field: ${I}`})}),A.email&&!/^\S+@\S+\.\S+$/.test(A.email)&&w.push({index:j,field:"email",message:"Invalid email format"});const k=["Teacher","Principal","Admin Officer","Management","Account Officer","Librarian"];return A.role&&!k.includes(A.role)&&w.push({index:j,field:"role",message:`Invalid role: ${A.role}. Must be one of: ${k.join(", ")}`}),A.joinDate&&!/^\d{4}-\d{2}-\d{2}$/.test(A.joinDate)&&w.push({index:j,field:"joinDate",message:"Invalid date format for joinDate. Use YYYY-MM-DD"}),A.dateOfBirth&&!/^\d{4}-\d{2}-\d{2}$/.test(A.dateOfBirth)&&w.push({index:j,field:"dateOfBirth",message:"Invalid date format for dateOfBirth. Use YYYY-MM-DD"}),A.serviceEndDate&&!/^\d{4}-\d{2}-\d{2}$/.test(A.serviceEndDate)&&w.push({index:j,field:"serviceEndDate",message:"Invalid date format for serviceEndDate. Use YYYY-MM-DD"}),["basicSalary","hra","da"].forEach(I=>{A[I]&&isNaN(Number(A[I]))&&w.push({index:j,field:I,message:`${I} must be a valid number`})}),w},y=()=>{try{const A=Lf.parse(s,{header:!0,skipEmptyLines:!0});if(A.errors.length>0){d(A.errors.map((k,_)=>({index:_,field:"csv",message:k.message}))),f("error");return}const j=A.data,w=[];if(j.forEach((k,_)=>{const I=p(k,_);w.push(...I)}),w.length>0)d(w),f("error");else{const k=j.map(_=>{const I=typeof _.isActive=="string"?String(_.isActive).toLowerCase()==="true":!!_.isActive,D=_.basicSalary?Number(_.basicSalary):void 0,B=_.hra?Number(_.hra):void 0,R=_.da?Number(_.da):void 0;return{..._,isActive:I,basicSalary:D,hra:B,da:R}});l(k),f("success")}}catch(A){console.error("Error parsing CSV:",A),d([{index:0,field:"csv",message:"Failed to parse CSV: "+(A instanceof Error?A.message:String(A))}]),f("error")}},S=async()=>{if(!(o.length===0||u!=="success"))try{await t(o),i(""),l([]),f("initial"),x("")}catch(A){console.error("Failed to submit staff data:",A)}},v=()=>{const A=new Blob([rV],{type:"text/csv;charset=utf-8;"}),j=document.createElement("a");j.href=URL.createObjectURL(A),j.setAttribute("download","staff_upload_template.csv"),document.body.appendChild(j),j.click(),document.body.removeChild(j)},E=()=>{m.current&&m.current.click()},C=A=>{var k;const j=(k=A.target.files)==null?void 0:k[0];if(!j)return;x(j.name);const w=new FileReader;w.onload=_=>{var D;const I=(D=_.target)==null?void 0:D.result;try{if(j.name.endsWith(".xlsx")||j.name.endsWith(".xls")){const B=Oc(I,{type:"binary"}),R=B.SheetNames[0],Y=B.Sheets[R],P=Db.sheet_to_csv(Y);i(P)}else if(j.name.endsWith(".csv"))i(I);else throw new Error("Unsupported file format. Please use CSV, XLSX, or XLS files.");f("initial"),l([]),d([])}catch(B){console.error("Error reading file:",B),d([{index:0,field:"file",message:"Failed to read file: "+(B instanceof Error?B.message:String(B))}]),f("error")}},j.name.endsWith(".csv")?w.readAsText(j):w.readAsBinaryString(j),A.target&&(A.target.value="")};return a.jsxs(At,{open:e,onClose:r,maxWidth:"md",fullWidth:!0,children:[a.jsx(Dt,{children:"Bulk Staff Upload"}),a.jsxs(Tt,{children:[a.jsxs(ee,{sx:{mb:2},children:[a.jsx(V,{variant:"body1",gutterBottom:!0,children:"Upload your CSV/Excel file or paste CSV data below to add or update multiple staff members at once."}),a.jsx(V,{variant:"body2",color:"text.secondary",children:"Required fields: Staff ID, First Name, Last Name, Email, Phone Number, Role, and Join Date"})]}),a.jsxs(ee,{sx:{mb:2,display:"flex",gap:1},children:[a.jsx(xt,{title:"Download sample CSV template",children:a.jsx(ye,{variant:"outlined",size:"small",onClick:v,startIcon:a.jsx(ai,{}),children:"Download Template"})}),a.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",style:{display:"none"},ref:m,onChange:C}),a.jsx(xt,{title:"Upload CSV or Excel file",children:a.jsx(ye,{variant:"contained",size:"small",onClick:E,startIcon:a.jsx(Uh,{}),color:"primary",children:"Upload File"})}),a.jsx(xt,{title:"Staff roles must be one of: Teacher, Principal, Admin Officer, Management, Account Officer, or Librarian",children:a.jsx(st,{size:"small",color:"info",children:a.jsx(Nf,{})})})]}),h&&a.jsxs(pt,{severity:"info",sx:{mb:2},children:["File loaded: ",h]}),a.jsx(Se,{label:"CSV Data",multiline:!0,rows:10,value:s,onChange:g,fullWidth:!0,variant:"outlined",placeholder:"staffId,firstName,lastName,email,phoneNumber,role,joinDate,address,dateOfBirth,gender,qualifications,emergencyContact,bloodGroup,isActive",sx:{mb:2}}),a.jsx(ee,{sx:{mb:2},children:a.jsx(ye,{variant:"contained",color:"secondary",onClick:y,disabled:!s.trim()||n,children:"Parse Data"})}),u==="success"&&a.jsxs(pt,{severity:"success",sx:{mb:2},children:[a.jsx(Mn,{children:"Data Successfully Parsed"}),"Found ",o.length," valid staff records ready to be imported."]}),u==="error"&&a.jsxs(pt,{severity:"error",sx:{mb:2},children:[a.jsx(Mn,{children:"Validation Errors"}),a.jsx(ee,{component:"ul",sx:{pl:2,mt:1},children:c.map((A,j)=>a.jsx("li",{children:`Row ${A.index+1}, ${A.field}: ${A.message}`},j))})]}),o.length>0&&a.jsxs(Ke,{variant:"outlined",sx:{p:2,mt:2,maxHeight:"200px",overflow:"auto"},children:[a.jsxs(V,{variant:"subtitle1",gutterBottom:!0,children:["Preview of Parsed Data (",o.length," staff members)"]}),a.jsx(Qt,{sx:{mb:2}}),o.slice(0,5).map((A,j)=>a.jsx(ee,{sx:{mb:1,p:1,bgcolor:"background.paper"},children:a.jsxs(V,{variant:"body2",children:[a.jsx("strong",{children:"ID:"})," ",A.staffId,",",a.jsx("strong",{children:" Name:"})," ",A.firstName," ",A.lastName,",",a.jsx("strong",{children:" Role:"})," ",A.role,",",a.jsx("strong",{children:" Email:"})," ",A.email,a.jsx("strong",{children:" Status:"})," ",A.isActive?"Active":"Inactive"]})},j)),o.length>5&&a.jsx(at,{label:`${o.length-5} more staff members`,size:"small",sx:{mt:1}})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,disabled:n,children:"Cancel"}),a.jsx(ye,{onClick:S,color:"primary",disabled:o.length===0||u!=="success"||n,startIcon:n?a.jsx(vr,{size:20}):a.jsx(ti,{}),children:n?"Importing...":"Import Staff Data"})]})]})},aV=["TEACHER","PRINCIPAL","ADMIN_OFFICER","MANAGEMENT","ACCOUNT_OFFICER","LIBRARIAN"],sV=["Mathematics","Science","English","Social Studies","Physical Education","Arts","Music","Computer Science","Languages"],iV=["A+","A-","B+","B-","AB+","AB-","O+","O-"],wx=()=>({staffId:"",firstName:"",lastName:"",email:"",phoneNumber:"",address:"",dateOfBirth:"",gender:"MALE",joinDate:new Date().toISOString().split("T")[0],role:"TEACHER",isActive:!0,qualifications:"",bloodGroup:"",emergencyContact:"",profileImage:"",pfUAN:"",gratuity:"",serviceEndDate:"",basicSalary:0,hra:0,da:0,ta:0,otherAllowances:0,pfContribution:0,taxDeduction:0,netSalary:0,salaryAccountNumber:"",bankName:"",ifscCode:"",teacherDetails:{department:"",specialization:"",subjects:"",teachingExperience:0,isClassTeacher:!1,classAssignedId:0,className:""}}),oV=({open:e,onClose:r,onSubmit:t,initialData:n,loading:s})=>{var N,H,G,q,oe,de,z;const[i,o]=b.useState(n||wx()),[l,c]=b.useState({}),[d,u]=b.useState([]),[f,h]=b.useState([]),[x,m]=b.useState([]),[g,p]=b.useState(!1),[y,S]=b.useState([]),[v,E]=b.useState({}),[C,A]=b.useState([]),[j,w]=b.useState(""),[k,_]=b.useState("");b.useState(!1),b.useEffect(()=>{n&&(console.log("StaffDialog initialData:",n),o(O=>{let W="TEACHER";if(n.role)if(typeof n.role=="object"&&n.role!==null){const we=n.role;W=we.name||we.role||W}else typeof n.role=="string"&&(W=n.role);else if(n.staffRole)if(typeof n.staffRole=="object"&&n.staffRole!==null){const we=n.staffRole;W=we.name||we.role||W}else W=String(n.staffRole);W=W.toUpperCase().replace(/ /g,"_");const F=n.phoneNumber||n.phone||"";let U="";if(n.bloodGroup!==void 0)U=n.bloodGroup;else if(typeof n=="object"&&n!==null){for(const we in n)if(we.toLowerCase()==="bloodgroup"){const Ee=n[we];Ee!==void 0&&(U=String(Ee));break}}let te="";if(n.qualifications!==void 0)te=n.qualifications;else if(typeof n=="object"&&n!==null){for(const we in n)if(we.toLowerCase()==="qualifications"){const Ee=n[we];Ee!==void 0&&(te=String(Ee));break}}const he=n.emergencyContact||"",ie=n.pfUAN||"",be=n.gratuity||"",xe=n.basicSalary||0,Fe=n.hra||0,me=n.da||0,ve=n.ta||0,ne=n.otherAllowances||0;return console.log("StaffDialog initialData DETAILS:",{emergencyContact:n.emergencyContact,pfUAN:n.pfUAN,gratuity:n.gratuity,basicSalary:n.basicSalary,hra:n.hra,da:n.da,ta:n.ta}),console.log("Normalized values:",{role:W,phoneNumber:F,bloodGroup:U,qualifications:te,emergencyContact:he,pfUAN:ie,gratuity:be,basicSalary:xe,hra:Fe,da:me,ta:ve,otherAllowances:ne}),console.log("DETAILED DEBUG - StaffDialog initialData field values:",{emergencyContact:n.emergencyContact,emergencyContactType:typeof n.emergencyContact,pfUAN:n.pfUAN,pfUANType:typeof n.pfUAN,gratuity:n.gratuity,gratuityType:typeof n.gratuity,basicSalary:n.basicSalary,basicSalaryType:typeof n.basicSalary}),{...O,...n,role:W,phoneNumber:F,bloodGroup:U,qualifications:te,emergencyContact:he,pfUAN:ie,gratuity:be,basicSalary:xe,hra:Fe,da:me,ta:ve,otherAllowances:ne}}))},[n]),b.useEffect(()=>{(async()=>{try{const W=await ge.get("/api/exam/subjects");u(W)}catch(W){console.error("Failed to load subjects list",W)}try{const W=await ge.get("/api/classes");S(W)}catch(W){console.error("Failed to load classes list",W)}})()},[]),b.useEffect(()=>{e&&!n&&(o(wx()),c({}),h([]),A([]),w(""),_(""))},[e,n]);const I=async O=>{if(!(!O||v[O]))try{const W=await ge.get(`/api/classes/${O}/sections`);E(F=>({...F,[O]:W}))}catch(W){console.error("Failed to load sections for class",O,W)}};b.useEffect(()=>{var W;const O=(W=i.teacherDetails)==null?void 0:W.id;if(!O){h([]),A([]);return}(async()=>{try{const F=await ge.get(`/api/staff/teachers/${O}/subjects`);h(F.map(U=>U.id))}catch{console.warn("No existing subject mapping or failed to load"),h([])}try{const F=await ge.get(`/api/staff/teachers/${O}/classes`);A(F);for(const U of F)await I(U.classId)}catch{console.warn("No existing class mapping or failed to load"),A([])}})()},[(N=i.teacherDetails)==null?void 0:N.id]);const D=O=>W=>{o(F=>({...F,[O]:W.target.value})),l[O]&&c(F=>({...F,[O]:""}))},B=O=>W=>{o(F=>({...F,teacherDetails:{...F.teacherDetails,[O]:W.target.value}})),l[`teacherDetails.${O}`]&&c(F=>({...F,[`teacherDetails.${O}`]:""}))},R=O=>W=>{o(F=>({...F,teacherDetails:{...F.teacherDetails,[O]:W.target.checked}}))},Y=()=>{var W,F;const O={};return i.firstName||(O.firstName="First name is required"),i.lastName||(O.lastName="Last name is required"),i.staffId||(O.staffId="Staff ID is required"),i.email?/^\S+@\S+\.\S+$/.test(i.email)||(O.email="Invalid email format"):O.email="Email is required",i.phoneNumber?/^\+?[\d\s-]{10,}$/.test(i.phoneNumber)||(O.phoneNumber="Invalid phone number"):O.phoneNumber="Phone number is required",i.pfUAN&&!/^[a-zA-Z0-9]+$/.test(i.pfUAN)&&(O.pfUAN="PF UAN must be alphanumeric only"),i.gratuity&&!/^[a-zA-Z0-9]+$/.test(i.gratuity)&&(O.gratuity="Gratuity must be alphanumeric only"),i.role==="TEACHER"&&((W=i.teacherDetails)!=null&&W.department||(O["teacherDetails.department"]="Department is required"),(F=i.teacherDetails)!=null&&F.id&&f.length===0&&(O["teacherDetails.subjects"]="Select at least one subject")),c(O),Object.keys(O).length===0},P=()=>{var W,F,U,te,he,ie,be,xe;if(!Y())return;const O={id:i.id||0,staffId:i.staffId||"",firstName:i.firstName||"",lastName:i.lastName||"",fullName:`${i.firstName||""} ${i.lastName||""}`.trim(),email:i.email||"",phoneNumber:i.phoneNumber||"",address:i.address||"",dateOfBirth:i.dateOfBirth||"",gender:i.gender||"MALE",joinDate:i.joinDate||new Date().toISOString().split("T")[0],role:i.role||"TEACHER",isActive:i.isActive!==void 0?i.isActive:!0,qualifications:i.qualifications||"",emergencyContact:i.emergencyContact||"",bloodGroup:i.bloodGroup||"",profileImage:i.profileImage||"",designations:[],pfUAN:i.pfUAN||"",gratuity:i.gratuity||"",serviceEndDate:i.serviceEndDate||"",basicSalary:i.basicSalary||0,hra:i.hra||0,da:i.da||0,ta:i.ta||0,otherAllowances:i.otherAllowances||0,pfContribution:i.pfContribution||0,taxDeduction:i.taxDeduction||0,netSalary:i.netSalary||0,salaryAccountNumber:i.salaryAccountNumber||"",bankName:i.bankName||"",ifscCode:i.ifscCode||""};(O.role||"TEACHER")==="TEACHER"&&(O.teacherDetails={id:((W=i.teacherDetails)==null?void 0:W.id)||0,department:((F=i.teacherDetails)==null?void 0:F.department)||"",specialization:((U=i.teacherDetails)==null?void 0:U.specialization)||"",subjects:((te=i.teacherDetails)==null?void 0:te.subjects)||"",teachingExperience:((he=i.teacherDetails)==null?void 0:he.teachingExperience)||0,isClassTeacher:((ie=i.teacherDetails)==null?void 0:ie.isClassTeacher)||!1,classAssignedId:((be=i.teacherDetails)==null?void 0:be.classAssignedId)||0,className:((xe=i.teacherDetails)==null?void 0:xe.className)||""},O.__subjectIds=f,O.__classMappings=C.map(Fe=>({classId:Fe.classId,section:Fe.section,academicYear:Fe.academicYear||"2025-2026"}))),t(O)},M=i.role==="TEACHER",K=async()=>{if(!j||!k)return;const O=y.find(W=>W.id===j);O&&(C.some(W=>W.classId===j&&W.section===k)||(A(W=>[...W,{classId:j,className:O.name,section:k,academicYear:"2025-2026"}]),_("")))},L=O=>{A(W=>W.filter((F,U)=>U!==O))},ae=async()=>{var W;const O=(W=i.teacherDetails)==null?void 0:W.id;if(O)try{p(!0),await ge.put(`/api/staff/teachers/${O}/subjects`,f)}catch(F){console.error("Failed to save subjects mapping",F)}finally{p(!1)}},Z=()=>{x!=null&&x.length&&(h(O=>Array.from(new Set([...O||[],...x]))),m([]))},T=O=>{h(W=>(W||[]).filter(F=>F!==O))};return a.jsx(Of,{open:e,onClose:r,title:n?"Edit Staff Member":"Add Staff Member",onSubmit:P,submitLabel:n?"Update":"Create",loading:s,maxWidth:"md",children:a.jsxs(X,{container:!0,spacing:2,children:[a.jsxs(X,{item:!0,xs:12,children:[a.jsx(V,{variant:"h6",children:"Personal Information"}),a.jsx(Qt,{sx:{mb:2}})]}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"First Name",value:i.firstName,onChange:D("firstName"),error:!!l.firstName,helperText:l.firstName,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Last Name",value:i.lastName,onChange:D("lastName"),error:!!l.lastName,helperText:l.lastName,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Staff ID",value:i.staffId,onChange:D("staffId"),error:!!l.staffId,helperText:l.staffId,required:!0,disabled:!!(n!=null&&n.id)})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,required:!0,children:[a.jsx(ot,{children:"Role"}),a.jsx(tt,{value:i.role||"TEACHER",onChange:D("role"),label:"Role",children:aV.map(O=>a.jsx(Te,{value:O,children:O.replace("_"," ")},O))})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Email",type:"email",value:i.email,onChange:D("email"),error:!!l.email,helperText:l.email,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Phone Number",value:i.phoneNumber,onChange:D("phoneNumber"),error:!!l.phoneNumber,helperText:l.phoneNumber,required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Date of Birth",type:"date",value:i.dateOfBirth,onChange:D("dateOfBirth"),InputLabelProps:{shrink:!0}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Gender"}),a.jsxs(tt,{value:i.gender||"MALE",onChange:D("gender"),label:"Gender",children:[a.jsx(Te,{value:"MALE",children:"Male"}),a.jsx(Te,{value:"FEMALE",children:"Female"}),a.jsx(Te,{value:"OTHER",children:"Other"})]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Join Date",type:"date",value:i.joinDate,onChange:D("joinDate"),InputLabelProps:{shrink:!0},required:!0})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Blood Group"}),a.jsx(tt,{value:i.bloodGroup||"",onChange:D("bloodGroup"),label:"Blood Group",children:iV.map(O=>a.jsx(Te,{value:O,children:O},O))})]})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,label:"Qualifications",multiline:!0,rows:2,value:i.qualifications,onChange:D("qualifications"),placeholder:"E.g., Bachelor of Education, Master's in Mathematics"})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,label:"Address",multiline:!0,rows:2,value:i.address,onChange:D("address")})}),a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{fullWidth:!0,label:"Emergency Contact",value:i.emergencyContact,onChange:D("emergencyContact")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"PF UAN",value:i.pfUAN,onChange:D("pfUAN"),placeholder:"Enter PF UAN"})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Gratuity",value:i.gratuity,onChange:D("gratuity"),placeholder:"Enter Gratuity"})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Service End Date",type:"date",value:i.serviceEndDate,onChange:D("serviceEndDate"),InputLabelProps:{shrink:!0}})}),a.jsxs(X,{item:!0,xs:12,children:[a.jsx(V,{variant:"h6",sx:{mt:2},children:"Salary Details"}),a.jsx(Qt,{sx:{mb:2}})]}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Basic Salary",type:"number",value:i.basicSalary,onChange:D("basicSalary"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"HRA",type:"number",value:i.hra,onChange:D("hra"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"DA",type:"number",value:i.da,onChange:D("da"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"TA",type:"number",value:i.ta,onChange:D("ta"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Other Allowances",type:"number",value:i.otherAllowances,onChange:D("otherAllowances"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"PF Contribution",type:"number",value:i.pfContribution,onChange:D("pfContribution"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Tax Deduction",type:"number",value:i.taxDeduction,onChange:D("taxDeduction"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Net Salary",type:"number",value:i.netSalary,onChange:D("netSalary"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Salary Account Number",value:i.salaryAccountNumber,onChange:D("salaryAccountNumber")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Bank Name",value:i.bankName,onChange:D("bankName")})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"IFSC Code",value:i.ifscCode,onChange:D("ifscCode")})}),M&&a.jsxs(a.Fragment,{children:[a.jsxs(X,{item:!0,xs:12,children:[a.jsx(V,{variant:"h6",sx:{mt:2},children:"Teacher Details"}),a.jsx(Qt,{sx:{mb:2}})]}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,error:!!l["teacherDetails.department"],children:[a.jsx(ot,{children:"Department"}),a.jsx(tt,{value:((H=i.teacherDetails)==null?void 0:H.department)||"",onChange:B("department"),label:"Department",required:!0,children:sV.map(O=>a.jsx(Te,{value:O,children:O},O))}),l["teacherDetails.department"]&&a.jsx(Ma,{children:l["teacherDetails.department"]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Specialization",value:(G=i.teacherDetails)==null?void 0:G.specialization,onChange:B("specialization"),placeholder:"E.g., Calculus, Algebra, Literature"})}),a.jsxs(X,{item:!0,xs:12,children:[a.jsx(V,{variant:"subtitle1",sx:{mb:1},children:"Teaching Subjects"}),a.jsx(pt,{severity:"info",sx:{mb:1},children:"Select one or more subjects and click Add. Your selection will be saved when you create or update this staff member."}),a.jsxs(tr,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[a.jsxs(rt,{fullWidth:!0,error:!!l["teacherDetails.subjects"],children:[a.jsx(ot,{children:"Subjects"}),a.jsx(tt,{multiple:!0,value:x,onChange:O=>m(O.target.value),label:"Subjects",renderValue:O=>a.jsx(tr,{direction:"row",spacing:1,flexWrap:"wrap",children:O.map(W=>{const F=d.find(U=>U.id===W);return a.jsx(at,{label:F?F.code?`${F.code} - ${F.name}`:F.name:W},W)})}),children:d.map(O=>a.jsx(Te,{value:O.id,children:O.code?`${O.code} - ${O.name}`:O.name},O.id))}),l["teacherDetails.subjects"]&&a.jsx(Ma,{children:l["teacherDetails.subjects"]})]}),a.jsx(ye,{variant:"outlined",startIcon:a.jsx(js,{}),onClick:Z,disabled:!x.length,children:"Add"})]}),a.jsx(tr,{direction:"row",spacing:1,flexWrap:"wrap",sx:{mt:1},children:f.map(O=>{const W=d.find(U=>U.id===O),F=W?W.code?`${W.code} - ${W.name}`:W.name:String(O);return a.jsx(at,{label:F,onDelete:()=>T(O),deleteIcon:a.jsx(ws,{})},O)})}),a.jsx(ee,{sx:{mt:1},children:a.jsx(ye,{variant:"contained",size:"small",onClick:ae,disabled:!((q=i.teacherDetails)!=null&&q.id)||g,children:"Save Subjects"})})]}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{fullWidth:!0,label:"Teaching Experience (years)",type:"number",value:((oe=i.teacherDetails)==null?void 0:oe.teachingExperience)||0,onChange:B("teachingExperience"),InputProps:{inputProps:{min:0}}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Class Teacher"}),a.jsxs(tt,{value:(de=i.teacherDetails)!=null&&de.isClassTeacher?"yes":"no",onChange:O=>{R("isClassTeacher")({target:{checked:String(O.target.value)==="yes"}})},label:"Class Teacher",children:[a.jsx(Te,{value:"yes",children:"Yes"}),a.jsx(Te,{value:"no",children:"No"})]})]})}),a.jsxs(X,{item:!0,xs:12,children:[a.jsx(V,{variant:"subtitle1",sx:{mt:2,mb:1},children:"Class Assignments"}),!((z=i.teacherDetails)!=null&&z.id)&&a.jsx(pt,{severity:"info",sx:{mb:1},children:"You can add class assignments now; they will be saved when you create this staff member."}),a.jsxs(tr,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:"center",children:[a.jsxs(rt,{sx:{minWidth:220},children:[a.jsx(ot,{children:"Class"}),a.jsx(tt,{value:j,label:"Class",onChange:async O=>{const W=Number(O.target.value);w(W),_(""),await I(W)},children:y.map(O=>a.jsx(Te,{value:O.id,children:O.name},O.id))})]}),a.jsxs(rt,{sx:{minWidth:160},disabled:!j,children:[a.jsx(ot,{children:"Section"}),a.jsx(tt,{value:k,label:"Section",onChange:O=>_(String(O.target.value)),children:(j&&v[j]?v[j]:[]).map(O=>a.jsx(Te,{value:O,children:O},O))})]}),a.jsx(ye,{variant:"outlined",startIcon:a.jsx(js,{}),disabled:!j||!k,onClick:K,children:"Add"})]}),a.jsx(tr,{direction:"row",spacing:1,flexWrap:"wrap",sx:{mt:1},children:C.map((O,W)=>a.jsx(at,{label:`${O.className} - ${O.section}`,onDelete:()=>L(W),deleteIcon:a.jsx(ws,{})},`${O.classId}-${O.section}`))})]})]})]})})};var mr=(e=>(e.ACTIVE="ACTIVE",e.INACTIVE="INACTIVE",e.PROBATION="PROBATION",e.TERMINATED="TERMINATED",e.LEAVE_OF_ABSENCE="LEAVE_OF_ABSENCE",e.RETIRED="RETIRED",e.CONTRACT="CONTRACT",e.RESIGNED="RESIGNED",e.ON_LEAVE="ON_LEAVE",e.SUSPENDED="SUSPENDED",e))(mr||{});const lV=["ACTIVE","TERMINATED","RETIRED","RESIGNED"],jx={Teacher:1,Principal:2,"Admin Officer":3,Librarian:4,Management:5,"Account Officer":6},cu=e=>{const r={...e};let t="";typeof r.role=="string"?t=r.role:r.role&&typeof r.role=="object"&&"name"in r.role?t=r.role.name||"":r.staffRole&&typeof r.staffRole=="object"&&"name"in r.staffRole&&(t=r.staffRole.name||""),t&&(!t.includes("_")&&t!==t.toUpperCase()&&(t=t.toUpperCase().replace(/ /g,"_")),r.role=t,jx[t]&&(r.roleId=jx[t])),r.joinDate&&!r.joiningDate&&(r.joiningDate=r.joinDate),r.phoneNumber&&!r.phone?r.phone=r.phoneNumber:r.phone&&!r.phoneNumber&&(r.phoneNumber=r.phone),(t.includes("TEACHER")||t==="Teacher")&&!r.teacherDetails&&(r.department||r.subjects)&&(r.teacherDetails={department:r.department||"",subjects:r.subjects||"",teachingExperience:r.teachingExperience||0,isClassTeacher:!1});const s=o=>{const l=r[o];if(typeof l=="string"&&!/^\d{4}-\d{2}-\d{2}$/.test(l))try{const c=new Date(l);isNaN(c.getTime())||(r[o]=c.toISOString().split("T")[0])}catch(c){console.warn(`Failed to format date for ${o}`,c)}};s("dateOfBirth"),s("joinDate"),s("joiningDate"),s("serviceEndDate");const i=o=>{const l=r[o];if(l!=null&&typeof l=="string"){const c=parseFloat(l);isNaN(c)||(r[o]=c)}};return i("basicSalary"),i("hra"),i("da"),i("ta"),i("otherAllowances"),i("pfContribution"),i("taxDeduction"),i("netSalary"),r.isActive!==void 0&&typeof r.isActive=="string"&&(r.isActive=r.isActive.toLowerCase()==="true"),r.basicSalary&&typeof r.basicSalary=="string"&&(r.basicSalary=Number(r.basicSalary)),r.hra&&typeof r.hra=="string"&&(r.hra=Number(r.hra)),r.da&&typeof r.da=="string"&&(r.da=Number(r.da)),r},cV=(e,r,t)=>{const n=()=>{const i={staff:r,expectedCount:r.length};return console.log("Trying Format 1: Wrapped in staff property with expectedCount",i),fetch(e,{method:"POST",headers:t,body:JSON.stringify(i)}).then(o=>{if(!o.ok)throw new Error(`HTTP error! Status: ${o.status}`);return o.json()}).then(o=>(console.log("Bulk upload successful with Format 1",o),o))},s=()=>(console.log("Trying Format 2: Direct array of staff members"),fetch(e,{method:"POST",headers:t,body:JSON.stringify(r)}).then(i=>{if(!i.ok)throw new Error(`HTTP error! Status: ${i.status}`);return i.json()}).then(i=>(console.log("Bulk upload successful with Format 2",i),i)));return n().catch(i=>(console.log("Format 1 failed:",i.message),s().catch(o=>{throw console.log("Format 2 failed:",o.message),{message:"Failed to import staff data after trying multiple formats",details:"The server may not be correctly configured to accept bulk staff data",originalError:o}})))},Qr={getAll:async()=>{try{console.log("Fetching staff from API...");try{const e=await ge.get("staff");if(console.log("Raw API response:",e),!e)throw console.warn("Staff API returned null/undefined response"),new Error("Empty staff response");if(Array.isArray(e)){console.log(`Staff API returned an array with ${e.length} items`);const r=e.map((t,n)=>({...t,firstName:t.firstName||"Unknown",lastName:t.lastName||"Staff",email:t.email||`staff${n+1}@example.com`,role:t.role||"Unknown"}));if(r.length>0)return r;throw console.warn("No staff members returned from API, trying alternative approach"),new Error("No staff members found")}else{console.log("Staff API returned a single object instead of an array, converting to array");const r=e;return[{...r,firstName:r.firstName||"Unknown",lastName:r.lastName||"Staff",email:r.email||"staff@example.com",role:r.role||"Unknown"}]}}catch(e){console.warn("Error with direct staff API call, trying alternative approach",e);const[r,t]=await Promise.all([Qr.getActiveTeachers(),Qr.getNonTeachingStaff()]),n=[...r,...t];if(console.log(`Retrieved ${r.length} teachers and ${t.length} non-teaching staff (${n.length} total)`),n.length===0)throw console.error("Failed to retrieve any staff members through alternative methods"),new Error("No staff members found through any method");return n}}catch(e){throw console.error("Error fetching staff list:",e),e}},getById:e=>ge.get(`staff/${e}`),create:e=>{const r=cu(e);return ge.post("staff",r)},createBulk:e=>{const r=e.map(o=>{const l=cu(o);return l.joinDate&&(l.joiningDate=l.joinDate,l.joinDate=l.joinDate),l.phoneNumber&&!l.phone&&(l.phone=l.phoneNumber),l});console.log("Sending bulk staff data to server:",JSON.stringify(r,null,2));const n=`${Et.apiUrl.endsWith("/")?Et.apiUrl.slice(0,-1):Et.apiUrl}/api/staff/bulk-upload`;console.log("Using URL:",n);const s=localStorage.getItem("token"),i={"Content-Type":"application/json"};return s?(i.Authorization=`Bearer ${s}`,console.log("Using authentication token")):console.warn("No authentication token found in localStorage"),cV(n,r,i)},bulkCreate:function(e){return this.createBulk(e)},update:(e,r)=>{const t=cu(r);return ge.put(`staff/${e}`,t)},toggleStatus:(e,r)=>ge.patch(`staff/${e}/status`,{isActive:r}),updateEmploymentStatus:(e,r)=>{console.log(`[staffService] Updating employment status for staff ID ${e} to ${r}`);const t=localStorage.getItem("token"),n=t?`Token present (${t.substring(0,15)}...)`:"Token missing";let s=[];if(t)try{const i=JSON.parse(atob(t.split(".")[1]));s=i.roles||i.authorities||[],console.log("[staffService] User roles from token:",s),console.log("[staffService] Token expires:",new Date(i.exp*1e3).toLocaleString())}catch(i){console.error("[staffService] Error decoding token:",i)}return console.log("[staffService] Request details:",{endpoint:`staff/${e}/employment-status`,method:"PATCH",payload:{employmentStatus:r},authStatus:n,userRoles:s,timestamp:new Date().toISOString()}),ge.patch(`staff/${e}/employment-status`,{employmentStatus:r}).then(i=>(console.log("[staffService] Status update successful:",{statusCode:200,responseData:i,timestamp:new Date().toISOString()}),i)).catch(i=>{var o,l,c;throw console.error("[staffService] Status update failed:",{statusCode:((o=i.response)==null?void 0:o.status)||"No status",errorMessage:((c=(l=i.response)==null?void 0:l.data)==null?void 0:c.message)||i.message,requestDetails:{url:`staff/${e}/employment-status`,method:"PATCH",payload:{employmentStatus:r},authStatus:n,userRoles:s},timestamp:new Date().toISOString()}),i})},delete:e=>ge.delete(`staff/${e}`),getActiveTeachers:async()=>{try{return(await ge.get("staff",{params:{employmentStatus:"ACTIVE",roleFilter:"Teacher"}})).data||[]}catch(e){return console.error("Error fetching active teachers:",e),[]}},getNonTeachingStaff:async()=>{try{return(await ge.get("staff",{params:{employmentStatus:"ACTIVE",roleFilter:"NonTeaching"}})).data||[]}catch(e){return console.error("Error fetching non-teaching staff:",e),[]}}},Zu=(e,r="Object Inspection")=>{if(console.group(r),e===null){console.log("Object is null"),console.groupEnd();return}if(e===void 0){console.log("Object is undefined"),console.groupEnd();return}if(console.log("Type:",typeof e),console.log("Is Array:",Array.isArray(e)),typeof e=="object")if(console.log("Keys:",Object.keys(e)),console.log("Has prototype:",Object.getPrototypeOf(e)!==null),Array.isArray(e))console.log("Array length:",e.length),console.log("First 3 items:",e.slice(0,3)),e.length>0&&(console.log("First item type:",typeof e[0]),console.log("First item keys:",typeof e[0]=="object"?Object.keys(e[0]):"Not an object"));else{const t={};Object.keys(e).forEach(n=>{const s=e[n];t[n]={type:typeof s,isNull:s===null,isUndefined:s===void 0,isArray:Array.isArray(s),sample:typeof s=="object"?Array.isArray(s)?`Array[${s.length}]`:"Object":s}}),console.log("Properties:",t)}console.groupEnd()},dV=()=>({id:9999,staffId:"TEST-001",firstName:"Test",lastName:"User",email:"test@example.com",role:"ADMIN",isActive:!0,employmentStatus:"ACTIVE",department:"IT"}),uV=e=>{console.group("Staff API Response Debug"),Zu(e,"Response Overview"),Array.isArray(e)?(console.log("Response is an array with",e.length,"items"),e.length===0?console.warn("API returned an empty array"):(console.log("First item sample:"),Zu(e[0],"First Item"))):typeof e=="object"&&e!==null?(console.log("Response is a single object"),(e.error||e.message||e.status)&&console.warn("Object may be an error response:",{hasError:"error"in e,hasMessage:"message"in e,hasStatus:"status"in e})):console.warn("Response is not an object or array:",typeof e),console.groupEnd()},fV=e=>e?e===e.toUpperCase()&&e.includes("_")?e.replace(/_/g," ").toLowerCase().split(" ").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "):e:"",hV=e=>{let r;if(typeof e=="string")r=e;else if(e&&typeof e=="object")if(e.name)r=e.name;else if(e.roleName)r=e.roleName;else return"#9e9e9e";else return"#9e9e9e";switch(r.toUpperCase()){case"TEACHER":case"TEACHERS":return"#2196f3";case"PRINCIPAL":case"PRINCIPALS":return"#9c27b0";case"ADMIN":case"ADMINISTRATOR":return"#00bcd4";case"LIBRARIAN":return"#4caf50";case"ACCOUNT_OFFICER":case"ACCOUNTANT":return"#f44336";case"MANAGEMENT":case"MANAGER":return"#ff9800";default:return"#9e9e9e"}},mV=()=>{const[e,r]=b.useState(!1),[t,n]=b.useState(!1),[s,i]=b.useState(!1),[o,l]=b.useState(void 0),[c,d]=b.useState(null),{showNotification:u}=dr(),{user:f}=$n();b.useEffect(()=>{console.log("Current user:",f),console.log("Has MANAGE_STAFF permission:",f&&f.role?Rr(f.role,"MANAGE_STAFF"):!1)},[f]);const{data:h,loading:x,error:m,refresh:g}=Gt(()=>Qr.getAll(),{cacheKey:"staffList"}),{mutate:p,loading:y}=pr(z=>Qr.create(z),{onSuccess:async z=>{var O;u({type:"success",message:"Staff member created successfully"});try{const W=z.__subjectIds||(o==null?void 0:o.__subjectIds),F=z.__classMappings||(o==null?void 0:o.__classMappings),U=(O=z==null?void 0:z.teacherDetails)==null?void 0:O.id;U&&(Array.isArray(W)&&W.length>0&&await ge.put(`/api/staff/teachers/${U}/subjects`,W),Array.isArray(F)&&F.length>0&&await ge.put(`/api/staff/teachers/${U}/classes`,F))}catch(W){console.error("Failed to persist mappings after creation",W),u({type:"warning",message:"Created staff, but failed to save subjects/classes"})}r(!1),g()},onError:z=>{u({type:"error",message:`Failed to create staff member: ${z.message}`})}}),{mutate:S,loading:v}=pr(z=>Qr.bulkCreate(z),{onSuccess:z=>{const{created:O,updated:W,errors:F}=z;F&&F.length>0?u({type:"warning",message:`Partially completed: Created ${O}, Updated ${W}, Failed ${F.length} records`}):u({type:"success",message:`Successfully imported staff data: Created ${O}, Updated ${W} records`}),n(!1),g()},onError:z=>{u({type:"error",message:`Failed to import staff data: ${z.message}`})}}),{mutate:E,loading:C}=pr(z=>Qr.update(z.id,z),{onSuccess:()=>{u({type:"success",message:"Staff member updated successfully"}),r(!1),l(void 0),g()},onError:z=>{u({type:"error",message:`Failed to update staff member: ${z.message}`})}}),{mutate:A,loading:j}=pr(z=>Qr.delete(z),{onSuccess:()=>{u({type:"success",message:"Staff member deleted successfully"}),i(!1),l(void 0),g()},onError:z=>{u({type:"error",message:`Failed to delete staff member: ${z.message}`})}});pr(z=>{const O={isActive:z.isActive};return Qr.update(z.id,O)},{onSuccess:()=>{u({type:"success",message:"Staff status updated successfully"}),g()},onError:z=>{u({type:"error",message:`Failed to update staff status: ${z.message}`})}});const{mutate:w,loading:k}=pr(z=>(console.log("Attempting to update employment status with:",{staffId:z.id,newStatus:z.status,currentTime:new Date().toISOString()}),Qr.updateEmploymentStatus(z.id,z.status)),{onSuccess:z=>{console.log("Employment status update succeeded:",{result:z,timestamp:new Date().toISOString()}),u({type:"success",message:"Employment status updated successfully"}),g()},onError:z=>{console.error("Employment status update failed:",{error:z,timestamp:new Date().toISOString()});let O=z.message||"An unknown error occurred";z.response&&z.response.data&&(z.response.data.message?O=z.response.data.message:typeof z.response.data=="string"&&(O=z.response.data)),u({type:"error",message:`Failed to update employment status: ${O}`})}}),_=async(z,O)=>{if(console.log(`[DEBUG] [${new Date().toISOString()}] Attempting to update employment status for staff ID: ${z} to ${O}`),!jj()){console.error(`[DEBUG] [${new Date().toISOString()}] Permission denied: User lacks required role (ADMIN or HR_MANAGER) for staff status updates`),I(),u({type:"error",message:"You don't have permission to update employment status. This action requires ADMIN or HR_MANAGER role."});return}console.log(`[DEBUG] [${new Date().toISOString()}] Permission check passed. User has ADMIN or HR_MANAGER role.`);try{console.log(`[DEBUG] [${new Date().toISOString()}] Calling staffService.updateEmploymentStatus with ID: ${z}, status: ${O}`);try{const W=localStorage.getItem("token");if(W){const F=pg(W);console.log("[DEBUG] Auth token details before request:",{exp:new Date(F.exp*1e3).toISOString(),roles:F.roles||F.authorities,sub:F.sub,tokenLength:W.length,tokenPrefix:W.substring(0,15)+"..."})}else console.error("[DEBUG] No authentication token found in localStorage")}catch(W){console.error("[DEBUG] Error parsing authentication token:",W)}await w({id:z,status:O}),console.log(`[DEBUG] [${new Date().toISOString()}] Employment status update successful for staff ID: ${z}`)}catch(W){console.error(`[DEBUG] [${new Date().toISOString()}] Error occurred while updating employment status:`,W),W.response?(console.error("[DEBUG] Server response error details:",{status:W.response.status,statusText:W.response.statusText,headers:W.response.headers,data:W.response.data}),W.response.status===400&&W.response.data&&W.response.data.message?(console.error("[DEBUG] Validation error from backend:",W.response.data.message),u({type:"error",message:W.response.data.message})):W.response.status===403?(console.error("[DEBUG] 403 Forbidden error detected. Possible causes:"),console.error("1. Token expired during the request"),console.error("2. Token does not contain required roles (ADMIN or HR_MANAGER)"),console.error("3. Backend permission check differs from frontend"),u({type:"error",message:"You do not have permission to perform this action"}),I()):u({type:"error",message:`Server error: ${W.response.statusText||"Unknown error"}`})):W.request?(console.error("[DEBUG] Request was made but no response received:",W.request),u({type:"error",message:"Network error: Could not connect to the server"})):(console.error("[DEBUG] Error setting up the request:",W.message),u({type:"error",message:`Error: ${W.message}`}))}},I=()=>{var z;return f?(console.log("Debug: User permissions check",{userId:f.id,userName:(f==null?void 0:f.username)||"unknown",userRole:(f==null?void 0:f.role)||"none",token:localStorage.getItem("token")?"Present (first 10 chars): "+((z=localStorage.getItem("token"))==null?void 0:z.substring(0,10))+"...":"Missing",hasManageStaff:f!=null&&f.role?Rr(f.role,"MANAGE_STAFF"):!1,timestamp:new Date().toISOString()}),f!=null&&f.role?Rr(f.role,"MANAGE_STAFF"):!1):(console.log("Debug: No user is logged in"),!1)};b.useEffect(()=>{I()},[f]);const D=async z=>{I();try{if(u({type:"info",message:"Loading staff details..."}),console.log("Original staff data:",z),z.id)try{const O=await fetch(`${Et.apiUrl}/api/staff/${z.id}`,{method:"GET",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!O.ok)throw new Error(`Failed to load staff details: ${O.status} ${O.statusText}`);const W=await O.json();console.log("API Raw response for staff:",W);const F={...z,...W,emergencyContact:W.emergencyContact||"",qualifications:W.qualifications||"",pfUAN:W.pfUAN||"",gratuity:W.gratuity||"",basicSalary:W.basicSalary!==void 0?Number(W.basicSalary):0,hra:W.hra!==void 0?Number(W.hra):0,da:W.da!==void 0?Number(W.da):0,ta:W.ta!==void 0?Number(W.ta):0,otherAllowances:W.otherAllowances!==void 0?Number(W.otherAllowances):0,bloodGroup:W.bloodGroup||""};console.log("Setting complete staff data for dialog:",F),l(F)}catch(O){console.error("Error fetching staff details:",O);const W={...z,emergencyContact:"",qualifications:"",pfUAN:"",gratuity:"",basicSalary:0,hra:0,da:0,ta:0,otherAllowances:0,bloodGroup:""};l(W),u({type:"warning",message:"Could not load complete staff details, using partial data"})}else l({...z,emergencyContact:"",qualifications:"",pfUAN:"",gratuity:"",basicSalary:0,hra:0,da:0,ta:0,otherAllowances:0,bloodGroup:""});r(!0)}catch(O){console.error("Error in handleEdit:",O),u({type:"error",message:"Failed to prepare staff data for editing"})}},B=z=>{I(),l(z),i(!0)},R=()=>{r(!1),l(void 0)},Y=()=>{n(!1)},P=()=>{o!=null&&o.id&&A(o.id)},M=async z=>{o!=null&&o.id?await E({...z,id:o.id}):await p(z)},K=async z=>{await S(z)},L=(z,O)=>{console.log("Status change requested:",{staffId:z.id,staffName:`${z.firstName} ${z.lastName}`,currentStatus:z.employmentStatus,requestedStatus:O,timestamp:new Date().toISOString()});const W=I();if(!f){console.error("Permission denied: No authenticated user"),u({type:"error",message:"Authentication required: Please log in again"}),g();return}if(!W){console.error(`Permission denied: User role ${f.role} does not have MANAGE_STAFF permission`),u({type:"error",message:"You do not have permission to update employment status"}),g();return}if(z.employmentStatus&&z.employmentStatus!==mr.ACTIVE&&O!==z.employmentStatus){console.error(`Invalid status transition from ${z.employmentStatus} to ${O}`),u({type:"error",message:"Invalid status transition: Only ACTIVE staff can be changed to other statuses"}),g();return}if((O===mr.TERMINATED||O===mr.RESIGNED||O===mr.RETIRED)&&!window.confirm(`Are you sure you want to change ${z.firstName} ${z.lastName}'s status to ${O}? This action cannot be reversed.`)){console.log("Status change cancelled by user");return}z.id&&(console.log(`Proceeding with status update for staff ${z.id} to ${O}`),_(z.id,O))},ae=z=>{if(!z)return"default";switch(z){case mr.ACTIVE:return"success";case mr.TERMINATED:case mr.RETIRED:case mr.RESIGNED:return"error";default:return z===mr.INACTIVE?"error":z===mr.PROBATION||z===mr.CONTRACT||z===mr.LEAVE_OF_ABSENCE?"warning":"default"}},Z=z=>{if(!z)return"";const O=z.firstName?z.firstName.charAt(0):"",W=z.lastName?z.lastName.charAt(0):"";return`${O}${W}`.toUpperCase()},T=z=>{if(!z)return"Unknown Staff";if(z.fullName)return z.fullName;const O=z.firstName||"",W=z.lastName||"";if(!O&&!W){const F=z.email||"";return F?F.split("@")[0].replace("."," ").replace("_"," "):"Unknown Staff"}return`${O} ${W}`.trim()},N={Teacher:"primary",Principal:"secondary","Admin Officer":"info",Management:"warning","Account Officer":"error",Librarian:"success"},H=z=>{let O;if(typeof z.role=="object"&&z.role?z.role.name?O=z.role.name:z.role.roleName&&(O=z.role.roleName):typeof z.role=="string"&&(O=z.role),!O&&z.staffRole){const W=z.staffRole;W.name?O=W.name:W.roleName&&(O=W.roleName)}return O||z.roleName&&(O=z.roleName),O||(console.warn("Unable to extract role name from staff member:",{staffId:z.staffId,name:`${z.firstName} ${z.lastName}`,role:z.role,staffRole:z.staffRole}),"")},G=b.useMemo(()=>{if(!h)return[];const z=Array.isArray(h)?h:h?[h]:[];return!c||c==="Total"?z:c==="Active"?z.filter(O=>O.isActive):z.filter(O=>{const W=H(O);if(!W)return!1;const F=W.replace(/_/g," "),U=c.toUpperCase();return console.log("Filter debug:",{activeFilter:c,normalizedFilter:U,staffRole:O.role,staffRoleObj:O.staffRole,extractedRoleName:W,normalizedRole:F,comparison:{exact:F.toUpperCase()===U,alternate:W.toUpperCase()===U,withUnderscores:W.toUpperCase()===U.replace(/ /g,"_"),contains:F.toUpperCase().includes(U),containedIn:U.includes(F.toUpperCase())}}),F.toUpperCase()===U||W.toUpperCase()===U||W.toUpperCase()===U.replace(/ /g,"_")||F.toUpperCase().includes(U)||U.includes(F.toUpperCase())||F.toLowerCase().includes(c.toLowerCase())||c.toLowerCase().includes(F.toLowerCase())})},[h,c]),q=b.useMemo(()=>{if(!h)return[];const z=Array.isArray(h)?h:h?[h]:[],O=[{label:"Total",count:z.length,color:"default"},{label:"Active",count:z.filter(W=>W.isActive).length,color:"success"}];return Object.keys(N).forEach(W=>{const F=z.filter(U=>{const te=H(U);return te===W.toUpperCase().replace(" ","_")||te===W||te.toLowerCase()===W.toLowerCase()}).length;O.push({label:W,count:F,color:N[W]})}),O},[h]),oe=z=>{d(c===z?null:z)},de=[{id:"name",label:"Name",sortable:!0,format:(z,O)=>a.jsxs(ee,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[a.jsx(Px,{sx:{bgcolor:hV(O.role),width:35,height:35,fontSize:"0.9rem"},children:Z(O)}),a.jsx(V,{variant:"body2",children:T(O)})]})},{id:"staffId",label:"Staff ID",sortable:!0},{id:"role",label:"Role",sortable:!0,format:(z,O)=>{const W=H(O);console.log("Role extraction:",{staffId:O.staffId,name:`${O.firstName} ${O.lastName}`,extractedRoleName:W,rawRole:O.role,staffRole:O.staffRole}),console.log("Role debug for staff:",{staffId:O.staffId,name:`${O.firstName} ${O.lastName}`,rawRole:O.role,extractedRoleName:W,staffRoleObj:O.staffRole,value:z});const F=W?fV(W):"Unknown";console.log("Role debug:",{displayRole:F,originalValue:z,staffRole:O.staffRole,roleProperty:O.role});let U="default";const te=(W||"").toLowerCase();return te.includes("teacher")?U="primary":te.includes("principal")?U="secondary":te.includes("admin")?U="info":te.includes("management")?U="warning":te.includes("account")?U="error":te.includes("librarian")&&(U="success"),a.jsx(at,{label:F,size:"small",color:U,variant:"filled"})}},{id:"department",label:"Department",sortable:!0,format:(z,O)=>{var F,U;const W=O.department||((F=O.teacherDetails)==null?void 0:F.department)||"-";return console.log("Department debug:",{department:W,directDepartment:O.department,teacherDetailsDepartment:(U=O.teacherDetails)==null?void 0:U.department,staffObject:O}),W}},{id:"email",label:"Email",sortable:!0},{id:"phoneNumber",label:"Contact",sortable:!0,format:(z,O)=>O.phoneNumber||O.phone||"-"},{id:"isActive",label:"Status",sortable:!0,format:(z,O)=>{const W=O.employmentStatus||mr.ACTIVE;return Rr((f==null?void 0:f.role)||"","MANAGE_STAFF")?a.jsx(rt,{size:"small",fullWidth:!0,children:a.jsx(tt,{value:W,onChange:F=>L(O,F.target.value),disabled:k,variant:"standard",sx:{"& .MuiSelect-select":{py:0,color:()=>{switch(W){case mr.ACTIVE:return"success.main";case mr.LEAVE_OF_ABSENCE:case mr.PROBATION:case mr.CONTRACT:return"warning.main";case mr.TERMINATED:case mr.RETIRED:case mr.RESIGNED:case mr.INACTIVE:return"error.main";default:return"text.primary"}}}},children:W===mr.ACTIVE?lV.map(F=>a.jsx(Te,{value:F,children:F.replace("_"," ")},F)):a.jsx(Te,{value:W,children:W?W.replace("_"," "):"UNKNOWN"},W)})}):a.jsx(at,{label:W.replace("_"," "),color:ae(W),size:"small"})}},{id:"actions",label:"Actions",sortable:!1,format:(z,O)=>a.jsxs(ee,{sx:{display:"flex",gap:1},children:[Rr((f==null?void 0:f.role)||"","MANAGE_STAFF")&&a.jsxs(a.Fragment,{children:[a.jsx(xt,{title:"Edit",children:a.jsx(st,{size:"small",onClick:()=>D(O),color:"primary",children:a.jsx(Za,{fontSize:"small"})})}),a.jsx(xt,{title:"Delete",children:a.jsx(st,{size:"small",onClick:()=>B(O),color:"error",children:a.jsx(ws,{fontSize:"small"})})})]}),O.role==="TEACHER"&&a.jsxs(a.Fragment,{children:[a.jsx(xt,{title:"View Schedule",children:a.jsx(st,{size:"small",color:"default",children:a.jsx(bS,{fontSize:"small"})})}),a.jsx(xt,{title:"View Classes",children:a.jsx(st,{size:"small",color:"info",children:a.jsx(Xa,{fontSize:"small"})})})]})]})}];if(b.useEffect(()=>{if(h){if(console.log("=== Staff Data Debug ==="),uV(h),Array.isArray(h)&&h.length>0){const z=h[0];console.log("Detailed staff inspection:"),Zu(z,"First Staff Member");const W=["firstName","lastName","role","staffId","email"].filter(F=>!z[F]);W.length>0&&console.warn("Missing critical fields:",W)}else if(Array.isArray(h)&&h.length===0){console.warn("Staff list is empty. Adding test staff member for debugging:");const z=dV();console.log(z)}}else console.warn("staffList is null or undefined")},[h]),b.useEffect(()=>{m&&(console.error("Error in Staff component:",m),u({type:"error",message:`Failed to load staff data: ${m}`}))},[m,u]),b.useEffect(()=>{h&&Array.isArray(h)&&h.length===0&&(console.log("staffList is empty array, adding fallback data"),console.log("Would display fallback staff:",[{id:0,firstName:"Default",lastName:"Staff",email:"default@example.com",role:"Unknown",isActive:!0,staffId:"STAFF-0001",department:"Administration"}]))},[h]),x&&!h)return a.jsx(Ar,{});if(m){const z=typeof m=="string"?m:(m==null?void 0:m.message)||String(m);return a.jsx(Kr,{message:z,onRetry:g})}return a.jsxs(ee,{sx:{p:3},children:[a.jsxs(ee,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsx(V,{variant:"h4",children:"Staff Management"}),Rr((f==null?void 0:f.role)||"","MANAGE_STAFF")&&a.jsxs(tr,{direction:"row",spacing:2,children:[a.jsx(ye,{variant:"outlined",color:"primary",startIcon:a.jsx(of,{}),onClick:()=>n(!0),children:"Bulk Upload"}),a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(js,{}),onClick:()=>r(!0),children:"Add Staff Member"})]})]}),a.jsx(Ke,{sx:{p:2,mb:3},children:a.jsxs(ee,{sx:{mb:2},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Staff Overview"}),a.jsx(X,{container:!0,spacing:1,children:q.map((z,O)=>a.jsx(X,{item:!0,children:a.jsx(at,{label:`${z.label}: ${z.count}`,color:z.color,variant:c===z.label?"filled":"outlined",sx:{minWidth:100,cursor:"pointer",fontWeight:c===z.label?"bold":"normal"},onClick:()=>oe(z.label)})},O))}),c&&a.jsxs(ee,{sx:{mt:2,display:"flex",alignItems:"center"},children:[a.jsx(V,{variant:"body2",color:"text.secondary",mr:1,children:"Filtered by:"}),a.jsx(at,{label:c,size:"small",onDelete:()=>d(null)})]})]})}),a.jsx(Ke,{children:a.jsx(Df,{columns:de,data:G||[],loading:x,onRefresh:g,searchPlaceholder:"Search staff...",initialSortBy:"role"})}),a.jsx(oV,{open:e,onClose:R,onSubmit:M,initialData:o,loading:y||C}),a.jsx(nV,{open:t,onClose:Y,onSubmit:K,loading:v}),a.jsxs(At,{open:s,onClose:()=>i(!1),children:[a.jsx(Dt,{children:"Confirm Deletion"}),a.jsx(Tt,{children:a.jsxs(zi,{children:["Are you sure you want to delete ",o?T(o):"this staff member","? This action cannot be undone."]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>i(!1),disabled:j,children:"Cancel"}),a.jsx(ye,{onClick:P,color:"error",disabled:j,children:j?"Deleting...":"Delete"})]})]}),!1,a.jsx(eV,{})]})};function pV({columns:e,data:r,defaultRowsPerPage:t=10,rowsPerPageOptions:n=[5,10,25,50],loading:s=!1,onRefresh:i,searchEnabled:o=!0,searchPlaceholder:l="Search...",onSearch:c,defaultSortBy:d="",defaultSortDirection:u="asc",title:f,showToolbar:h=!0,toolbarContent:x,hover:m=!0,dense:g=!1,emptyMessage:p="No data to display",keyProperty:y="id",fullHeight:S=!1}){const[v,E]=b.useState(0),[C,A]=b.useState(t),[j,w]=b.useState(""),[k,_]=b.useState(d),[I,D]=b.useState(u),B=b.useCallback(()=>{if(!j||!o)return r;const N=j.toLowerCase();return r.filter(H=>e.some(G=>{const q=G.id,oe=H[q];return oe==null?!1:String(oe).toLowerCase().includes(N)}))},[r,j,o,e]),R=b.useCallback(()=>k?[...B()].sort((N,H)=>{const G=N[k],q=H[k];return G===q?0:G==null?I==="asc"?-1:1:q==null?I==="asc"?1:-1:typeof G=="string"&&typeof q=="string"?I==="asc"?G.localeCompare(q):q.localeCompare(G):I==="asc"?G<q?-1:1:q<G?-1:1}):B(),[B,k,I]),Y=N=>{D(k===N&&I==="asc"?"desc":"asc"),_(N)},P=(N,H)=>{E(H)},M=N=>{A(parseInt(N.target.value,10)),E(0)},K=N=>{const H=N.target.value;w(H),E(0),c&&c(H)};b.useEffect(()=>{E(0)},[r.length]);const L=R().slice(v*C,(v+1)*C),ae=()=>h?a.jsxs(ee,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:1},children:[f&&a.jsx(V,{variant:"h6",component:"div",children:f}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center",ml:"auto",gap:1},children:[o&&a.jsx(Se,{size:"small",placeholder:l,value:j,onChange:K,InputProps:{startAdornment:a.jsx(qo,{color:"action",sx:{mr:1}})},sx:{width:{xs:"100%",sm:"12rem"}}}),i&&a.jsx(xt,{title:"Refresh",children:a.jsx(st,{onClick:i,size:"small",children:a.jsx(On,{})})}),x]})]}):null,Z=()=>a.jsx(Ge,{children:a.jsx(Q,{colSpan:e.length,align:"center",sx:{py:6},children:a.jsx(V,{variant:"body1",color:"text.secondary",children:p})})}),T=()=>a.jsx(Ge,{children:a.jsxs(Q,{colSpan:e.length,align:"center",sx:{py:6},children:[a.jsx(vr,{size:28,sx:{mb:2}}),a.jsx(V,{variant:"body1",color:"text.secondary",display:"block",children:"Loading data..."})]})});return a.jsxs(Ke,{sx:{width:"100%",overflow:"hidden",display:"flex",flexDirection:"column",height:S?"100%":"auto"},children:[ae(),a.jsx(Jt,{sx:{flexGrow:1},children:a.jsxs(Vt,{stickyHeader:!0,size:g?"small":"medium",children:[a.jsx(Wt,{children:a.jsx(Ge,{children:e.map(N=>a.jsx(Q,{align:N.align||"left",style:{minWidth:N.minWidth},children:N.sortable?a.jsx(Nx,{active:k===N.id,direction:k===N.id?I:"asc",onClick:()=>Y(N.id),children:N.label}):N.label},N.id))})}),a.jsx(Ht,{children:s?T():L.length===0?Z():L.map((N,H)=>a.jsx(Ge,{hover:m,children:e.map(G=>{const q=G.id,oe=N[q];return a.jsx(Q,{align:G.align||"left",children:G.format?G.format(oe,N):oe},q)})},y&&N[y]?N[y]:H))})]})}),a.jsx(rf,{rowsPerPageOptions:n,component:"div",count:R().length,rowsPerPage:C,page:v,onPageChange:P,onRowsPerPageChange:M})]})}const Ex=new Map,xV=5*60*1e3;function kx(e,r={}){const{cacheKey:t,cacheDuration:n=xV,onSuccess:s,onError:i,showErrorNotification:o=!0,dependencies:l=[],skip:c=!1,transform:d}=r,[u,f]=b.useState(null),[h,x]=b.useState(!c),[m,g]=b.useState(null),{showNotification:p}=dr(),y=b.useCallback(E=>{var C,A;return(A=(C=E==null?void 0:E.response)==null?void 0:C.data)!=null&&A.message?E.response.data.message:E!=null&&E.message?E.message:"An unexpected error occurred"},[]),S=b.useCallback(E=>{const C=y(E);g(E),o&&p({message:C,type:"error",autoHideDuration:6e3}),i&&i(E)},[y,i,o,p]),v=b.useCallback(async(E=!1)=>{if(t&&!E){const C=Ex.get(t);if(C&&Date.now()-C.timestamp<n){f(C.data),x(!1),s&&s(C.data);return}}x(!0),g(null);try{const C=await e(),A=d?d(C):C;f(A),t&&Ex.set(t,{data:A,timestamp:Date.now()}),s&&s(A)}catch(C){S(C)}finally{x(!1)}},[e,t,n,S,s,d]);return b.useEffect(()=>{c||v()},[c,...l]),{data:u,loading:h,error:m,refetch:()=>v(!0)}}function du(e,r={}){const[t,n]=b.useState(null),[s,i]=b.useState(!1),[o,l]=b.useState(null),{showNotification:c}=dr(),{onSuccess:d,onError:u,showErrorNotification:f=!0,transform:h}=r,x=b.useCallback(p=>{var y,S;return(S=(y=p==null?void 0:p.response)==null?void 0:y.data)!=null&&S.message?p.response.data.message:p!=null&&p.message?p.message:"An unexpected error occurred"},[]),m=b.useCallback(p=>{const y=x(p);l(p),f&&c({message:y,type:"error",autoHideDuration:6e3}),u&&u(p)},[x,u,f,c]),g=b.useCallback(async p=>{i(!0),l(null);try{const y=await e(p),S=h?h(y):y;return n(S),d&&d(S),S}catch(y){throw m(y),y}finally{i(!1)}},[e,m,d,h]);return{data:t,loading:s,error:o,mutate:g}}const jo={getAll:()=>ge.get("courses"),getById:e=>ge.get(`courses/${e}`),getByDepartment:e=>ge.get(`courses/department/${e}`),getByTeacherId:e=>ge.get(`courses/teacher/${e}`),create:e=>ge.post("courses",e),update:(e,r)=>ge.put(`courses/${e}`,r),delete:e=>ge.delete(`courses/${e}`),getStats:()=>ge.get("courses/stats")},gV=({open:e,onClose:r,onSubmit:t,initialData:n,loading:s=!1})=>{const[i,o]=b.useState(n||{name:"",department:"",teacherId:0,credits:0,capacity:30,enrolled:0}),l=d=>{const{name:u,value:f}=d.target;o(h=>({...h,[u]:u==="teacherId"||u==="credits"||u==="capacity"||u==="enrolled"?parseInt(f)||0:f}))},c=d=>{d.preventDefault(),t(i)};return a.jsx(At,{open:e,onClose:r,maxWidth:"sm",fullWidth:!0,children:a.jsxs("form",{onSubmit:c,children:[a.jsx(Dt,{children:n?"Edit Course":"Add Course"}),a.jsx(Tt,{children:a.jsxs(ee,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[a.jsx(Se,{fullWidth:!0,label:"Course Name",name:"name",value:i.name,onChange:l,required:!0}),a.jsx(Se,{fullWidth:!0,label:"Department",name:"department",value:i.department,onChange:l,required:!0}),a.jsx(Se,{fullWidth:!0,type:"number",label:"Teacher ID",name:"teacherId",value:i.teacherId,onChange:l,required:!0}),a.jsx(Se,{fullWidth:!0,type:"number",label:"Credits",name:"credits",value:i.credits,onChange:l,required:!0}),a.jsx(Se,{fullWidth:!0,type:"number",label:"Capacity",name:"capacity",value:i.capacity,onChange:l,required:!0}),n&&a.jsx(Se,{fullWidth:!0,type:"number",label:"Enrolled",name:"enrolled",value:i.enrolled,onChange:l,required:!0})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,children:"Cancel"}),a.jsx(ye,{type:"submit",variant:"contained",disabled:s,children:n?"Update":"Create"})]})]})})},yV=()=>{const[e,r]=b.useState(!1),[t,n]=b.useState(!1),[s,i]=b.useState(null),{showNotification:o}=dr(),{data:l,loading:c,error:d,refetch:u}=kx(()=>jo.getAll(),{cacheKey:"all-courses",showErrorNotification:!0,transform:w=>w.data}),{mutate:f,loading:h}=du(w=>jo.create(w),{onSuccess:()=>{o({message:"Course created successfully",type:"success"}),u(),r(!1)}}),{mutate:x,loading:m}=du(w=>jo.update(w.id,w.course),{onSuccess:()=>{o({message:"Course updated successfully",type:"success"}),u(),r(!1)}}),{mutate:g,loading:p}=du(w=>jo.delete(w),{onSuccess:()=>{o({message:"Course deleted successfully",type:"success"}),u(),n(!1)}}),{data:y}=kx(()=>jo.getStats(),{cacheKey:"course-stats",transform:w=>w.data}),S=[{id:"id",label:"ID",sortable:!0,minWidth:70},{id:"name",label:"Course Name",sortable:!0,minWidth:150},{id:"department",label:"Department",sortable:!0,minWidth:120,format:w=>a.jsx(at,{label:w,color:"primary",size:"small",icon:a.jsx(Xa,{})})},{id:"teacherId",label:"Teacher ID",sortable:!0,minWidth:100},{id:"credits",label:"Credits",sortable:!0,minWidth:80,align:"right"},{id:"capacity",label:"Capacity",sortable:!0,minWidth:80,align:"right"},{id:"enrolled",label:"Enrolled",sortable:!0,minWidth:80,align:"right"},{id:"actions",label:"Actions",sortable:!1,minWidth:120,align:"center",format:(w,k)=>a.jsxs(ee,{children:[a.jsx(xt,{title:"Edit",children:a.jsx(st,{size:"small",onClick:()=>E(k),color:"primary",children:a.jsx(Za,{})})}),a.jsx(xt,{title:"Delete",children:a.jsx(st,{size:"small",onClick:()=>C(k),color:"error",children:a.jsx(ws,{})})})]})}],v=()=>{i(null),r(!0)},E=w=>{i(w),r(!0)},C=w=>{i(w),n(!0)},A=async w=>{s!=null&&s.id?await x({id:s.id,course:w}):await f(w)},j=async()=>{s!=null&&s.id&&await g(s.id)};return c&&!l?a.jsx(Ar,{}):d&&!l?a.jsx(Kr,{message:"Failed to load course data.",onRetry:u}):a.jsxs(ee,{sx:{p:3},children:[a.jsxs(tr,{direction:{xs:"column",sm:"row"},spacing:2,alignItems:{xs:"stretch",sm:"center"},justifyContent:"space-between",mb:3,children:[a.jsx(V,{variant:"h4",component:"h1",children:"Course Management"}),a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(js,{}),onClick:v,children:"Add Course"})]}),y&&a.jsxs(ee,{mb:3,children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Course Statistics"}),a.jsxs(tr,{direction:{xs:"column",sm:"row"},spacing:2,mb:2,children:[a.jsx(Zl,{title:"Total Courses",value:y.totalCourses}),a.jsx(Zl,{title:"Total Capacity",value:y.totalCapacity}),a.jsx(Zl,{title:"Total Enrolled",value:y.totalEnrolled}),a.jsx(Zl,{title:"Fill Rate",value:y.fillRate})]})]}),a.jsx(pV,{columns:S,data:l||[],loading:c,onRefresh:u,searchEnabled:!0,searchPlaceholder:"Search courses...",defaultSortBy:"name",defaultSortDirection:"asc",title:"Course List",emptyMessage:"No courses found"}),a.jsx(gV,{open:e,onClose:()=>r(!1),onSubmit:A,initialData:s||void 0,loading:h||m}),a.jsxs(At,{open:t,onClose:()=>n(!1),children:[a.jsx(Dt,{children:"Delete Course"}),a.jsx(Tt,{children:a.jsxs(zi,{children:['Are you sure you want to delete the course "',s==null?void 0:s.name,'"? This action cannot be undone.']})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>n(!1),children:"Cancel"}),a.jsx(ye,{onClick:j,color:"error",variant:"contained",disabled:p,children:"Delete"})]})]})]})},Zl=({title:e,value:r})=>a.jsxs(ee,{sx:{p:2,bgcolor:"background.paper",borderRadius:1,boxShadow:1,minWidth:150},children:[a.jsx(V,{variant:"subtitle2",color:"text.secondary",children:e}),a.jsx(V,{variant:"h5",children:r})]});var Nb={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Ds,function(){var t="week",n="year";return function(s,i,o){var l=i.prototype;l.week=function(c){if(c===void 0&&(c=null),c!==null)return this.add(7*(c-this.week()),"day");var d=this.$locale().yearStart||1;if(this.month()===11&&this.date()>25){var u=o(this).startOf(n).add(1,n).date(d),f=o(this).endOf(t);if(u.isBefore(f))return 1}var h=o(this).startOf(n).date(d).startOf(t).subtract(1,"millisecond"),x=this.diff(h,t,!0);return x<0?o(this).startOf("week").week():Math.ceil(x)},l.weeks=function(c){return c===void 0&&(c=null),this.week(c)}}})})(Nb);var vV=Nb.exports;const bV=ts(vV);var Rb={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Ds,function(){var t={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},n=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,s=/\d/,i=/\d\d/,o=/\d\d?/,l=/\d*[^-_:/,()\s\d]+/,c={},d=function(p){return(p=+p)+(p>68?1900:2e3)},u=function(p){return function(y){this[p]=+y}},f=[/[+-]\d\d:?(\d\d)?|Z/,function(p){(this.zone||(this.zone={})).offset=function(y){if(!y||y==="Z")return 0;var S=y.match(/([+-]|\d\d)/g),v=60*S[1]+(+S[2]||0);return v===0?0:S[0]==="+"?-v:v}(p)}],h=function(p){var y=c[p];return y&&(y.indexOf?y:y.s.concat(y.f))},x=function(p,y){var S,v=c.meridiem;if(v){for(var E=1;E<=24;E+=1)if(p.indexOf(v(E,0,y))>-1){S=E>12;break}}else S=p===(y?"pm":"PM");return S},m={A:[l,function(p){this.afternoon=x(p,!1)}],a:[l,function(p){this.afternoon=x(p,!0)}],Q:[s,function(p){this.month=3*(p-1)+1}],S:[s,function(p){this.milliseconds=100*+p}],SS:[i,function(p){this.milliseconds=10*+p}],SSS:[/\d{3}/,function(p){this.milliseconds=+p}],s:[o,u("seconds")],ss:[o,u("seconds")],m:[o,u("minutes")],mm:[o,u("minutes")],H:[o,u("hours")],h:[o,u("hours")],HH:[o,u("hours")],hh:[o,u("hours")],D:[o,u("day")],DD:[i,u("day")],Do:[l,function(p){var y=c.ordinal,S=p.match(/\d+/);if(this.day=S[0],y)for(var v=1;v<=31;v+=1)y(v).replace(/\[|\]/g,"")===p&&(this.day=v)}],w:[o,u("week")],ww:[i,u("week")],M:[o,u("month")],MM:[i,u("month")],MMM:[l,function(p){var y=h("months"),S=(h("monthsShort")||y.map(function(v){return v.slice(0,3)})).indexOf(p)+1;if(S<1)throw new Error;this.month=S%12||S}],MMMM:[l,function(p){var y=h("months").indexOf(p)+1;if(y<1)throw new Error;this.month=y%12||y}],Y:[/[+-]?\d+/,u("year")],YY:[i,function(p){this.year=d(p)}],YYYY:[/\d{4}/,u("year")],Z:f,ZZ:f};function g(p){var y,S;y=p,S=c&&c.formats;for(var v=(p=y.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(_,I,D){var B=D&&D.toUpperCase();return I||S[D]||t[D]||S[B].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(R,Y,P){return Y||P.slice(1)})})).match(n),E=v.length,C=0;C<E;C+=1){var A=v[C],j=m[A],w=j&&j[0],k=j&&j[1];v[C]=k?{regex:w,parser:k}:A.replace(/^\[|\]$/g,"")}return function(_){for(var I={},D=0,B=0;D<E;D+=1){var R=v[D];if(typeof R=="string")B+=R.length;else{var Y=R.regex,P=R.parser,M=_.slice(B),K=Y.exec(M)[0];P.call(I,K),_=_.replace(K,"")}}return function(L){var ae=L.afternoon;if(ae!==void 0){var Z=L.hours;ae?Z<12&&(L.hours+=12):Z===12&&(L.hours=0),delete L.afternoon}}(I),I}}return function(p,y,S){S.p.customParseFormat=!0,p&&p.parseTwoDigitYear&&(d=p.parseTwoDigitYear);var v=y.prototype,E=v.parse;v.parse=function(C){var A=C.date,j=C.utc,w=C.args;this.$u=j;var k=w[1];if(typeof k=="string"){var _=w[2]===!0,I=w[3]===!0,D=_||I,B=w[2];I&&(B=w[2]),c=this.$locale(),!_&&B&&(c=S.Ls[B]),this.$d=function(M,K,L,ae){try{if(["x","X"].indexOf(K)>-1)return new Date((K==="X"?1e3:1)*M);var Z=g(K)(M),T=Z.year,N=Z.month,H=Z.day,G=Z.hours,q=Z.minutes,oe=Z.seconds,de=Z.milliseconds,z=Z.zone,O=Z.week,W=new Date,F=H||(T||N?1:W.getDate()),U=T||W.getFullYear(),te=0;T&&!N||(te=N>0?N-1:W.getMonth());var he,ie=G||0,be=q||0,xe=oe||0,Fe=de||0;return z?new Date(Date.UTC(U,te,F,ie,be,xe,Fe+60*z.offset*1e3)):L?new Date(Date.UTC(U,te,F,ie,be,xe,Fe)):(he=new Date(U,te,F,ie,be,xe,Fe),O&&(he=ae(he).week(O).toDate()),he)}catch{return new Date("")}}(A,k,j,S),this.init(),B&&B!==!0&&(this.$L=this.locale(B).$L),D&&A!=this.format(k)&&(this.$d=new Date("")),c={}}else if(k instanceof Array)for(var R=k.length,Y=1;Y<=R;Y+=1){w[1]=k[Y-1];var P=S.apply(this,w);if(P.isValid()){this.$d=P.$d,this.$L=P.$L,this.init();break}Y===R&&(this.$d=new Date(""))}else E.call(this,C)}}})})(Rb);var SV=Rb.exports;const wV=ts(SV);var Ob={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Ds,function(){var t={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(n,s,i){var o=s.prototype,l=o.format;i.en.formats=t,o.format=function(c){c===void 0&&(c="YYYY-MM-DDTHH:mm:ssZ");var d=this.$locale().formats,u=function(f,h){return f.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(x,m,g){var p=g&&g.toUpperCase();return m||h[g]||t[g]||h[p].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(y,S,v){return S||v.slice(1)})})}(c,d===void 0?{}:d);return l.call(this,u)}}})})(Ob);var jV=Ob.exports;const EV=ts(jV);var Lb={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Ds,function(){return function(t,n,s){n.prototype.isBetween=function(i,o,l,c){var d=s(i),u=s(o),f=(c=c||"()")[0]==="(",h=c[1]===")";return(f?this.isAfter(d,l):!this.isBefore(d,l))&&(h?this.isBefore(u,l):!this.isAfter(u,l))||(f?this.isBefore(d,l):!this.isAfter(d,l))&&(h?this.isAfter(u,l):!this.isBefore(u,l))}}})})(Lb);var kV=Lb.exports;const AV=ts(kV);var $b={exports:{}};(function(e,r){(function(t,n){e.exports=n()})(Ds,function(){return function(t,n){var s=n.prototype,i=s.format;s.format=function(o){var l=this,c=this.$locale();if(!this.isValid())return i.bind(this)(o);var d=this.$utils(),u=(o||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(f){switch(f){case"Q":return Math.ceil((l.$M+1)/3);case"Do":return c.ordinal(l.$D);case"gggg":return l.weekYear();case"GGGG":return l.isoWeekYear();case"wo":return c.ordinal(l.week(),"W");case"w":case"ww":return d.s(l.week(),f==="w"?1:2,"0");case"W":case"WW":return d.s(l.isoWeek(),f==="W"?1:2,"0");case"k":case"kk":return d.s(String(l.$H===0?24:l.$H),f==="k"?1:2,"0");case"X":return Math.floor(l.$d.getTime()/1e3);case"x":return l.$d.getTime();case"z":return"["+l.offsetName()+"]";case"zzz":return"["+l.offsetName("long")+"]";default:return f}});return i.bind(this)(u)}}})})($b);var TV=$b.exports;const CV=ts(TV);Be.extend(EV);Be.extend(bV);Be.extend(AV);Be.extend(CV);const DV={YY:"year",YYYY:{sectionType:"year",contentType:"digit",maxLength:4},M:{sectionType:"month",contentType:"digit",maxLength:2},MM:"month",MMM:{sectionType:"month",contentType:"letter"},MMMM:{sectionType:"month",contentType:"letter"},D:{sectionType:"day",contentType:"digit",maxLength:2},DD:"day",Do:{sectionType:"day",contentType:"digit-with-letter"},d:{sectionType:"weekDay",contentType:"digit",maxLength:2},dd:{sectionType:"weekDay",contentType:"letter"},ddd:{sectionType:"weekDay",contentType:"letter"},dddd:{sectionType:"weekDay",contentType:"letter"},A:"meridiem",a:"meridiem",H:{sectionType:"hours",contentType:"digit",maxLength:2},HH:"hours",h:{sectionType:"hours",contentType:"digit",maxLength:2},hh:"hours",m:{sectionType:"minutes",contentType:"digit",maxLength:2},mm:"minutes",s:{sectionType:"seconds",contentType:"digit",maxLength:2},ss:"seconds"},_V={year:"YYYY",month:"MMMM",monthShort:"MMM",dayOfMonth:"D",dayOfMonthFull:"Do",weekday:"dddd",weekdayShort:"dd",hours24h:"HH",hours12h:"hh",meridiem:"A",minutes:"mm",seconds:"ss",fullDate:"ll",keyboardDate:"L",shortDate:"MMM D",normalDate:"D MMMM",normalDateWithWeekday:"ddd, MMM D",fullTime12h:"hh:mm A",fullTime24h:"HH:mm",keyboardDateTime12h:"L hh:mm A",keyboardDateTime24h:"L HH:mm"},uu=["Missing UTC plugin","To be able to use UTC or timezones, you have to enable the `utc` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-utc"].join(`
`),Ax=["Missing timezone plugin","To be able to use timezones, you have to enable both the `utc` and the `timezone` plugin","Find more information on https://mui.com/x/react-date-pickers/timezone/#day-js-and-timezone"].join(`
`),IV=(e,r)=>r?(...t)=>e(...t).locale(r):e;class qn{constructor({locale:r,formats:t}={}){this.isMUIAdapter=!0,this.isTimezoneCompatible=!0,this.lib="dayjs",this.dayjs=void 0,this.locale=void 0,this.formats=void 0,this.escapedCharacters={start:"[",end:"]"},this.formatTokenMap=DV,this.setLocaleToValue=n=>{const s=this.getCurrentLocaleCode();return s===n.locale()?n:n.locale(s)},this.hasUTCPlugin=()=>typeof Be.utc<"u",this.hasTimezonePlugin=()=>typeof Be.tz<"u",this.isSame=(n,s,i)=>{const o=this.setTimezone(s,this.getTimezone(n));return n.format(i)===o.format(i)},this.cleanTimezone=n=>{switch(n){case"default":return;case"system":return Be.tz.guess();default:return n}},this.createSystemDate=n=>{if(this.hasUTCPlugin()&&this.hasTimezonePlugin()){const s=Be.tz.guess();return s!=="UTC"?Be.tz(n,s):Be(n)}return Be(n)},this.createUTCDate=n=>{if(!this.hasUTCPlugin())throw new Error(uu);return Be.utc(n)},this.createTZDate=(n,s)=>{if(!this.hasUTCPlugin())throw new Error(uu);if(!this.hasTimezonePlugin())throw new Error(Ax);const i=n!==void 0&&!n.endsWith("Z");return Be(n).tz(this.cleanTimezone(s),i)},this.getLocaleFormats=()=>{const n=Be.Ls,s=this.locale||"en";let i=n[s];return i===void 0&&(i=n.en),i.formats},this.adjustOffset=n=>{if(!this.hasTimezonePlugin())return n;const s=this.getTimezone(n);if(s!=="UTC"){const i=n.tz(this.cleanTimezone(s),!0);if(i.$offset===(n.$offset??0))return n;n.$offset=i.$offset}return n},this.date=(n,s="default")=>{if(n===null)return null;let i;return s==="UTC"?i=this.createUTCDate(n):s==="system"||s==="default"&&!this.hasTimezonePlugin()?i=this.createSystemDate(n):i=this.createTZDate(n,s),this.locale===void 0?i:i.locale(this.locale)},this.getInvalidDate=()=>Be(new Date("Invalid date")),this.getTimezone=n=>{var s;if(this.hasTimezonePlugin()){const i=(s=n.$x)==null?void 0:s.$timezone;if(i)return i}return this.hasUTCPlugin()&&n.isUTC()?"UTC":"system"},this.setTimezone=(n,s)=>{if(this.getTimezone(n)===s)return n;if(s==="UTC"){if(!this.hasUTCPlugin())throw new Error(uu);return n.utc()}if(s==="system")return n.local();if(!this.hasTimezonePlugin()){if(s==="default")return n;throw new Error(Ax)}return Be.tz(n,this.cleanTimezone(s))},this.toJsDate=n=>n.toDate(),this.parse=(n,s)=>n===""?null:this.dayjs(n,s,this.locale,!0),this.getCurrentLocaleCode=()=>this.locale||"en",this.is12HourCycleInCurrentLocale=()=>/A|a/.test(this.getLocaleFormats().LT||""),this.expandFormat=n=>{const s=this.getLocaleFormats(),i=o=>o.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(l,c,d)=>c||d.slice(1));return n.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(o,l,c)=>{const d=c&&c.toUpperCase();return l||s[c]||i(s[d])})},this.isValid=n=>n==null?!1:n.isValid(),this.format=(n,s)=>this.formatByString(n,this.formats[s]),this.formatByString=(n,s)=>this.dayjs(n).format(s),this.formatNumber=n=>n,this.isEqual=(n,s)=>n===null&&s===null?!0:n===null||s===null?!1:n.toDate().getTime()===s.toDate().getTime(),this.isSameYear=(n,s)=>this.isSame(n,s,"YYYY"),this.isSameMonth=(n,s)=>this.isSame(n,s,"YYYY-MM"),this.isSameDay=(n,s)=>this.isSame(n,s,"YYYY-MM-DD"),this.isSameHour=(n,s)=>n.isSame(s,"hour"),this.isAfter=(n,s)=>n>s,this.isAfterYear=(n,s)=>this.hasUTCPlugin()?!this.isSameYear(n,s)&&n.utc()>s.utc():n.isAfter(s,"year"),this.isAfterDay=(n,s)=>this.hasUTCPlugin()?!this.isSameDay(n,s)&&n.utc()>s.utc():n.isAfter(s,"day"),this.isBefore=(n,s)=>n<s,this.isBeforeYear=(n,s)=>this.hasUTCPlugin()?!this.isSameYear(n,s)&&n.utc()<s.utc():n.isBefore(s,"year"),this.isBeforeDay=(n,s)=>this.hasUTCPlugin()?!this.isSameDay(n,s)&&n.utc()<s.utc():n.isBefore(s,"day"),this.isWithinRange=(n,[s,i])=>n>=s&&n<=i,this.startOfYear=n=>this.adjustOffset(n.startOf("year")),this.startOfMonth=n=>this.adjustOffset(n.startOf("month")),this.startOfWeek=n=>this.adjustOffset(this.setLocaleToValue(n).startOf("week")),this.startOfDay=n=>this.adjustOffset(n.startOf("day")),this.endOfYear=n=>this.adjustOffset(n.endOf("year")),this.endOfMonth=n=>this.adjustOffset(n.endOf("month")),this.endOfWeek=n=>this.adjustOffset(this.setLocaleToValue(n).endOf("week")),this.endOfDay=n=>this.adjustOffset(n.endOf("day")),this.addYears=(n,s)=>this.adjustOffset(s<0?n.subtract(Math.abs(s),"year"):n.add(s,"year")),this.addMonths=(n,s)=>this.adjustOffset(s<0?n.subtract(Math.abs(s),"month"):n.add(s,"month")),this.addWeeks=(n,s)=>this.adjustOffset(s<0?n.subtract(Math.abs(s),"week"):n.add(s,"week")),this.addDays=(n,s)=>this.adjustOffset(s<0?n.subtract(Math.abs(s),"day"):n.add(s,"day")),this.addHours=(n,s)=>this.adjustOffset(s<0?n.subtract(Math.abs(s),"hour"):n.add(s,"hour")),this.addMinutes=(n,s)=>this.adjustOffset(s<0?n.subtract(Math.abs(s),"minute"):n.add(s,"minute")),this.addSeconds=(n,s)=>this.adjustOffset(s<0?n.subtract(Math.abs(s),"second"):n.add(s,"second")),this.getYear=n=>n.year(),this.getMonth=n=>n.month(),this.getDate=n=>n.date(),this.getHours=n=>n.hour(),this.getMinutes=n=>n.minute(),this.getSeconds=n=>n.second(),this.getMilliseconds=n=>n.millisecond(),this.setYear=(n,s)=>this.adjustOffset(n.set("year",s)),this.setMonth=(n,s)=>this.adjustOffset(n.set("month",s)),this.setDate=(n,s)=>this.adjustOffset(n.set("date",s)),this.setHours=(n,s)=>this.adjustOffset(n.set("hour",s)),this.setMinutes=(n,s)=>this.adjustOffset(n.set("minute",s)),this.setSeconds=(n,s)=>this.adjustOffset(n.set("second",s)),this.setMilliseconds=(n,s)=>this.adjustOffset(n.set("millisecond",s)),this.getDaysInMonth=n=>n.daysInMonth(),this.getWeekArray=n=>{const s=this.startOfWeek(this.startOfMonth(n)),i=this.endOfWeek(this.endOfMonth(n));let o=0,l=s;const c=[];for(;l<i;){const d=Math.floor(o/7);c[d]=c[d]||[],c[d].push(l),l=this.addDays(l,1),o+=1}return c},this.getWeekNumber=n=>n.week(),this.getYearRange=([n,s])=>{const i=this.startOfYear(n),o=this.endOfYear(s),l=[];let c=i;for(;this.isBefore(c,o);)l.push(c),c=this.addYears(c,1);return l},this.dayjs=IV(Be,r),this.locale=r,this.formats=je({},_V,t),Be.extend(wV)}getDayOfWeek(r){return r.day()+1}}var wt=(e=>(e.PRESENT="PRESENT",e.ABSENT="ABSENT",e.HALF_DAY="HALF_DAY",e.ON_LEAVE="ON_LEAVE",e.LATE="LATE",e.HOLIDAY="HOLIDAY",e))(wt||{}),Ca=(e=>(e.NATIONAL_HOLIDAY="NATIONAL_HOLIDAY",e.RELIGIOUS_HOLIDAY="RELIGIOUS_HOLIDAY",e.SCHOOL_FUNCTION="SCHOOL_FUNCTION",e.OTHER="OTHER",e))(Ca||{});const Kt={getAttendanceByDate:(e,r="ALL")=>ge.get(`/api/staff/attendance/employee/date/${e}?employeeType=${r}`),getAttendanceByDateRange:(e,r,t="ALL")=>ge.get(`/api/staff/attendance/range?startDate=${e}&endDate=${r}&employeeType=${t}`),getAttendanceByEmployee:e=>ge.get(`/api/staff/attendance/employee/${e}`),getAttendanceByEmployeeAndDateRange:(e,r,t)=>ge.get(`/api/staff/attendance/employee/${e}/range?startDate=${r}&endDate=${t}`),markAttendance:e=>ge.post("/api/staff/attendance",e),updateAttendance:(e,r)=>ge.put(`/api/staff/attendance/${e}`,r),deleteAttendance:e=>ge.delete(`/api/staff/attendance/${e}`),markBulkAttendance:e=>ge.post("/api/staff/attendance/bulk",e),uploadAttendanceFile:(e,r="ALL")=>{const t=new FormData;return t.append("file",e),t.append("employeeType",r),ge.post("/api/staff/attendance/upload",t,{headers:{"Content-Type":"multipart/form-data"}})},downloadAttendanceTemplate:()=>ge.get("/api/staff/attendance/template",{responseType:"blob"}),getAttendanceStats:(e,r,t)=>ge.get(`/api/staff/attendance/stats/employee/${e}?startDate=${r}&endDate=${t}`),getAttendanceOverview:(e,r,t="ALL")=>ge.get(`/api/staff/attendance/overview?startDate=${e}&endDate=${r}&employeeType=${t}`),getMonthlyAttendanceReport:(e,r,t="ALL")=>ge.get(`/api/staff/attendance/report/monthly?year=${e}&month=${r}&employeeType=${t}`),getCurrentMonthAttendance:(e="ALL")=>ge.get(`/api/staff/attendance/current-month?employeeType=${e}`),getAttendanceStatusTypes:()=>ge.get("/api/staff/attendance/status-types"),checkIfHoliday:e=>ge.get(`/api/staff/attendance/check-holiday?date=${e}`),getHolidaysCalendar:e=>ge.get(`/api/hrm/holidays/calendar/${e}`),getHolidayTypes:()=>ge.get("/api/hrm/holidays/holiday-types"),addHoliday:e=>ge.post("/api/hrm/holidays",e),updateHoliday:(e,r)=>ge.put(`/api/hrm/holidays/${e}`,r),deleteHoliday:e=>ge.delete(`/api/hrm/holidays/${e}`),getHolidaysByDateRange:(e,r)=>ge.get(`/api/hrm/holidays/range?startDate=${e}&endDate=${r}`),addDefaultHolidays:e=>ge.post(`/api/hrm/holidays/default-holidays/${e}`)},Bb=({date:e,isAdmin:r,staffType:t="ALL"})=>{const{showNotification:n}=dr(),[s,i]=b.useState({}),[o,l]=b.useState({}),{data:c,error:d,loading:u}=Gt(()=>Qr.getAll(),{dependencies:[]}),f=it.useMemo(()=>{if(!c)return[];if(t==="ALL")return c;const _=["teacher","librarian","principal"],I=["management","admin","director","supervisor"];return c.filter(D=>{let B="";return typeof D.role=="string"?B=D.role.toLowerCase():D.role&&typeof D.role=="object"&&"name"in D.role?B=(D.role.name||"").toLowerCase():D.staffRole&&typeof D.staffRole=="object"&&"name"in D.staffRole&&(B=(D.staffRole.name||"").toLowerCase()),t==="TEACHING"?_.some(R=>B.includes(R)):t==="NON_TEACHING"?!_.some(R=>B.includes(R)):t==="ADMINISTRATION"?I.some(R=>B.includes(R)):!0})},[c,t]),{data:h,error:x,loading:m,refetch:g}=Gt(()=>(console.log(`Fetching attendance data for date: ${e}, staffType: ${t}`),Kt.getAttendanceByDate(e,t)),{dependencies:[e,t]}),{data:p}=Gt(()=>Kt.checkIfHoliday(e),{dependencies:[e]}),y=p?p.isHoliday:!1,{mutateAsync:S}=pr(_=>Kt.markAttendance(_),{onSuccess:()=>{n("Attendance marked successfully","success"),g()},onError:_=>{n(`Error marking attendance: ${_.message}`,"error")}}),{mutateAsync:v}=pr(({id:_,data:I})=>Kt.updateAttendance(_,I),{onSuccess:()=>{n("Attendance updated successfully","success"),g()},onError:_=>{n(`Error updating attendance: ${_.message}`,"error")}}),E=it.useMemo(()=>{const _={};return h&&h.forEach(I=>{I.employeeId&&(_[I.employeeId]=I)}),_},[h]),C=(_,I)=>{var D;if(i(B=>({...B,[_]:!B[_]})),!s[_]&&I)l(B=>({...B,[_]:{...I}}));else if(!s[_]){const B=f==null?void 0:f.find(P=>P.id===_),R=(D=B==null?void 0:B.role)!=null&&D.includes("TEACHER")?"TEACHING":"NON_TEACHING",Y={employeeId:_,employeeName:`${(B==null?void 0:B.firstName)||""} ${(B==null?void 0:B.lastName)||""}`.trim(),employeeType:R,department:(B==null?void 0:B.department)||"",position:(B==null?void 0:B.position)||"",attendanceDate:e,status:y?wt.HOLIDAY:wt.PRESENT};l(P=>({...P,[_]:Y}))}},A=(_,I,D)=>{l(B=>({...B,[_]:{...B[_],[I]:D}}))},j=async _=>{const I=o[_];if(I)try{let D;console.log("Saving attendance with data:",I),I.id?(console.log(`Updating attendance record ${I.id}`),D=await v({id:I.id,data:I})):(console.log("Creating new attendance record"),D=await S(I)),console.log("Save attendance response:",D),await g(),C(_)}catch(D){console.error("Error saving attendance:",D),n(`Error saving attendance: ${D instanceof Error?D.message:"Unknown error"}`,"error")}},w=_=>_&&{PRESENT:"success",ABSENT:"error",HALF_DAY:"warning",ON_LEAVE:"info",HOLIDAY:"secondary"}[_]||"default",k=_=>_?{PRESENT:a.jsx(cf,{fontSize:"small"}),ABSENT:a.jsx(df,{fontSize:"small"}),HALF_DAY:a.jsx(Ux,{fontSize:"small"}),ON_LEAVE:a.jsx(dc,{fontSize:"small"})}[_]:void 0;return u||m?a.jsx(Ar,{}):d?a.jsx(Kr,{message:"Failed to load staff data."}):x?a.jsx(Kr,{message:"Failed to load attendance data."}):a.jsxs(ee,{children:[a.jsxs(ee,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs(V,{variant:"h6",component:"h2",children:["Daily Attendance ",y&&a.jsx(at,{label:"Holiday",color:"secondary",size:"small",sx:{ml:1}})]}),r&&a.jsx(ye,{variant:"outlined",color:"primary",onClick:()=>{f==null||f.forEach(_=>{var I;if(!E[_.id]){const D=(I=_==null?void 0:_.role)!=null&&I.includes("TEACHER")?"TEACHING":"NON_TEACHING";S({employeeId:_.id,employeeName:`${(_==null?void 0:_.firstName)||""} ${(_==null?void 0:_.lastName)||""}`.trim(),employeeType:D,department:(_==null?void 0:_.department)||"",position:(_==null?void 0:_.position)||"",attendanceDate:e,status:y?wt.HOLIDAY:wt.PRESENT})}})},children:"Mark All Present"})]}),a.jsx(Jt,{component:Ke,children:a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Staff ID"}),a.jsx(Q,{children:"Name"}),a.jsx(Q,{children:"Department"}),a.jsx(Q,{children:"Status"}),a.jsx(Q,{children:"Reason"}),r&&a.jsx(Q,{align:"center",children:"Actions"})]})}),a.jsx(Ht,{children:f&&f.length>0?f.map(_=>{var B,R,Y;const I=E[_.id],D=s[_.id]||!1;return a.jsxs(Ge,{children:[a.jsx(Q,{children:_.staffId||_.employeeId}),a.jsxs(Q,{children:[_.firstName," ",_.lastName]}),a.jsx(Q,{children:_.department||"N/A"}),a.jsx(Q,{children:D?a.jsx(rt,{fullWidth:!0,size:"small",children:a.jsx(tt,{value:((B=o[_.id])==null?void 0:B.status)||"",onChange:P=>A(_.id,"status",P.target.value),disabled:y,children:Object.values(wt).map(P=>a.jsx(Te,{value:P,children:P.replace("_"," ")},P))})}):a.jsx(at,{icon:k(I==null?void 0:I.status),label:((R=I==null?void 0:I.status)==null?void 0:R.replace("_"," "))||"Not Marked",color:w(I==null?void 0:I.status),size:"small"})}),a.jsx(Q,{children:D?a.jsx(Se,{size:"small",fullWidth:!0,placeholder:"Reason (if absent/leave)",value:((Y=o[_.id])==null?void 0:Y.reason)||"",onChange:P=>A(_.id,"reason",P.target.value)}):(I==null?void 0:I.reason)||"-"}),r&&a.jsx(Q,{align:"center",children:D?a.jsxs(a.Fragment,{children:[a.jsx(xt,{title:"Save",children:a.jsx(st,{color:"success",size:"small",onClick:()=>j(_.id),children:a.jsx(lf,{})})}),a.jsx(xt,{title:"Cancel",children:a.jsx(st,{color:"error",size:"small",onClick:()=>C(_.id),children:a.jsx(dc,{})})})]}):a.jsx(xt,{title:I?"Edit Attendance":"Mark Attendance",children:a.jsx(st,{color:"primary",size:"small",onClick:()=>C(_.id,I),children:a.jsx(Za,{})})})})]},_.id)}):a.jsx(Ge,{children:a.jsx(Q,{colSpan:6,align:"center",children:"No staff members found"})})})]})})]})},Tx=e=>{const{children:r,value:t,index:n,...s}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`report-tabpanel-${n}`,"aria-labelledby":`report-tab-${n}`,...s,children:t===n&&a.jsx(ee,{sx:{p:2},children:r})})},FV=`
  @media print {
    /* Hide UI controls during printing */
    button, .MuiTabs-root, .MuiTab-root, form, .print-hide {
      display: none !important;
    }
    
    /* Ensure content is displayed properly */
    .print-container {
      display: block !important;
      width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    
    /* Ensure tables display properly */
    table {
      width: 100% !important;
      page-break-inside: auto !important;
      border-collapse: collapse !important;
    }
    
    /* Prevent page breaks inside rows */
    tr {
      page-break-inside: avoid !important;
    }
    
    /* Ensure headers print on each page */
    thead {
      display: table-header-group !important;
    }
    
    /* Set text colors for better printing */
    * {
      color: #000 !important;
      text-shadow: none !important;
    }
    
    /* Status colors should still be visible */
    .status-present { color: #2e7d32 !important; }
    .status-absent { color: #d32f2f !important; }
    .status-half-day { color: #ed6c02 !important; }
    .status-leave { color: #0288d1 !important; }
    .status-weekend, .status-not-marked { color: #757575 !important; }
    
    /* Remove shadows and make borders more visible */
    .MuiPaper-root, .MuiCard-root {
      box-shadow: none !important;
      border: 1px solid #ddd !important;
      margin-bottom: 20px !important;
    }
    
    /* Make sure content isn't cut off */
    body {
      -webkit-print-color-adjust: exact !important;
      color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
  }
`,MV=({isAdmin:e,staffType:r="ALL"})=>{b.useEffect(()=>{const T=document.createElement("style");T.innerHTML=FV,document.head.appendChild(T);const N=document.title;return()=>{document.head.removeChild(T),document.title=N}},[]);const{showNotification:t}=dr(),[n,s]=b.useState(0),[i,o]=b.useState(""),[l,c]=b.useState(Be().subtract(30,"day")),[d,u]=b.useState(Be()),[f,h]=b.useState(Be().year()),[x,m]=b.useState(Be().month()+1),[g,p]=b.useState("ALL"),y=Be(`${f}-${x}-01`),S=y.endOf("month"),{data:v,loading:E,error:C}=Gt(()=>(console.log("Fetching all staff data"),new Promise((T,N)=>{const H=(G=0,q=2)=>{Qr.getAll().then(oe=>{console.log(`Received ${(oe==null?void 0:oe.length)||0} staff records`),T(oe||[])}).catch(oe=>{console.error(`Error fetching staff data (attempt ${G+1}):`,oe),G<q?(console.log(`Retrying staff data fetch (${G+1}/${q})...`),setTimeout(()=>H(G+1,q),1e3)):(console.error("Max retries reached. Staff data could not be loaded."),N(oe))})};H()})),{dependencies:[]}),A=b.useMemo(()=>{const T=["Science","Mathematics","English","Social Studies","Physical Education","Arts"];if(!v||v.length===0)return console.log("Using fallback departments list since staff data is not available"),T;try{const N=v.filter(G=>G.department).map(G=>G.department),H=Array.from(new Set(N)).sort();return H.length>0?H:T}catch(N){return console.error("Error processing department list:",N),T}},[v]),j=b.useMemo(()=>{try{if(!v||v.length===0){if(console.log("No staff data available for filtering"),C){console.log("Using fallback staff data due to error");const N=["TEACHER","ADMINISTRATOR","SUPPORT_STAFF"],H=["Science","Mathematics","English","Social Studies","Physical Education","Arts"];let G=[];return r==="ALL"?G=Array.from({length:5},(q,oe)=>({id:oe+1,firstName:"Sample",lastName:`Staff ${oe+1}`,employeeType:N[oe%N.length],department:H[oe%H.length],employmentStatus:"ACTIVE"})):G=Array.from({length:3},(q,oe)=>({id:oe+1,firstName:"Sample",lastName:`${r.replace("_"," ")} ${oe+1}`,employeeType:r,department:H[oe%H.length],employmentStatus:"ACTIVE"})),G}return[]}console.log(`Total staff before filtering: ${v.length}`);const T=v.filter(N=>!N||r!=="ALL"&&N.employeeType!==r?!1:N.employmentStatus==="ACTIVE");return console.log(`Staff after filtering (type=${r}): ${T.length}`),T.sort((N,H)=>{const G=`${N.firstName} ${N.lastName}`.toLowerCase(),q=`${H.firstName} ${H.lastName}`.toLowerCase();return G.localeCompare(q)}),T}catch(T){return console.error("Error filtering staff data:",T),[]}},[v,r,C]),{data:w,loading:k,error:_}=Gt(()=>i?(console.log(`Fetching attendance for staff ID: ${i}`),new Promise((T,N)=>{const H=setTimeout(()=>{console.warn(`Attendance data fetch timed out for staff ID ${i}`),N(new Error("Request timed out after 15 seconds. The server may be experiencing high load."))},15e3);let G=!1;const q=new AbortController;let oe=0;const de=1,z=()=>{console.log(`Attempting to fetch attendance data (attempt ${oe+1}/${de+1})`),Kt.getAttendanceByEmployee(Number(i)).then(O=>{if(!G)if(clearTimeout(H),console.log(`Received ${(O==null?void 0:O.length)||0} attendance records for staff ID ${i}`),O&&Array.isArray(O))T(O);else if(O==null)console.warn(`Null/undefined response for staff ID ${i}`),T([]);else if(typeof O=="object"){console.warn(`Response is an object but not an array for staff ID ${i}`,O);try{const W=Object.values(O);console.log(`Converted object to array with ${W.length} items`),T(W)}catch(W){console.error("Failed to convert object to array:",W),T([])}}else console.warn(`Invalid attendance data format for staff ID ${i}:`,O),T([])}).catch(O=>{if(G)return;if(clearTimeout(H),console.error(`Error fetching attendance for staff ID ${i}:`,O),oe<de){oe++,console.log(`Retrying attendance data fetch (${oe}/${de})...`),setTimeout(z,2e3);return}let W="Failed to load attendance data.";if(O.response){const F=O.response.status;console.error("Error response data:",O.response.data),console.error("Error response status:",F),F===404?W=`No attendance records found for this staff member (${i}).`:F===401||F===403?W="You don't have permission to view these attendance records.":F===500?W="The server encountered an error while processing this request.":F>=400&&F<500?W=`Client error (${F}): The request was invalid or cannot be processed.`:F>=500&&(W=`Server error (${F}): The server failed to fulfill the request.`),N(new Error(W))}else O.request?(console.error("No response received from server"),N(new Error("No response received from server. Please check your network connection."))):(console.error("Error message:",O.message),N(new Error(O.message||"Unknown error occurred while fetching attendance data.")))})};return z(),()=>{G=!0,clearTimeout(H),q.abort()}})):Promise.resolve([]),{dependencies:[i],showErrorNotification:!1}),{data:I,loading:D,error:B}=Gt(()=>{console.log(`Fetching monthly attendance for date range: ${y.format("YYYY-MM-DD")} to ${S.format("YYYY-MM-DD")}`);try{return Kt.getAttendanceByDateRange(y.format("YYYY-MM-DD"),S.format("YYYY-MM-DD"),r).then(T=>(console.log(`Received ${(T==null?void 0:T.length)||0} monthly attendance records`),T||[])).catch(T=>{throw console.error("Error fetching monthly attendance:",T),T})}catch(T){return console.error("Unexpected error in monthly attendance API call:",T),Promise.reject(T)}},{dependencies:[f,x,r]}),R=b.useMemo(()=>{if(!w||!i)return null;const T=w.filter(F=>{const U=Be(F.attendanceDate);return U.isAfter(l)&&U.isBefore(d)}),N=T.filter(F=>F.status===wt.PRESENT).length,H=T.filter(F=>F.status===wt.ABSENT).length,G=T.filter(F=>F.status===wt.HALF_DAY).length,q=T.filter(F=>F.status===wt.ON_LEAVE).length,oe=T.length,de=d.diff(l,"day")+1,z=de-Math.floor(de/7)*2,O=oe>0?Math.round((N+G*.5)/oe*100):0,W=T.reduce((F,U)=>(F[U.status]||(F[U.status]=[]),F[U.status].push(U.attendanceDate),F),{});return{startDate:l.format("YYYY-MM-DD"),endDate:d.format("YYYY-MM-DD"),totalWorkingDays:z,presentDays:N,absentDays:H,halfDays:G,leaveDays:q,attendancePercentage:O,datesByStatus:W}},[w,i,l,d]),Y=b.useMemo(()=>{try{if(console.log(`Processing monthly report data. Monthly attendance records: ${(I==null?void 0:I.length)||0}, Staff records: ${(v==null?void 0:v.length)||0}`),!I||!v)return console.log("Missing data for monthly report calculation:",{hasMonthlyAttendance:!!I,hasStaffData:!!v}),null;if(!Array.isArray(I))return console.error("Invalid monthly attendance data structure:",I),null;if(!Array.isArray(v))return console.error("Invalid staff data structure:",v),null;if(I.length===0)return console.log("No monthly attendance data available, creating empty report"),{year:f,month:x,monthName:y.format("MMMM"),startDate:y.format("YYYY-MM-DD"),endDate:S.format("YYYY-MM-DD"),totalWorkingDays:S.diff(y,"day")+1,employeeSummaries:[],dataStatus:"empty"};const T=I.reduce((H,G)=>{if(!G)return console.warn("Null or undefined attendance record found, skipping"),H;if(typeof G.employeeId>"u"||G.employeeId===null)return console.warn("Attendance record missing employee ID, skipping:",G),H;const q=String(G.employeeId);return H[q]||(H[q]=[]),G.attendanceDate?(H[q].push(G),H):(console.warn("Attendance record missing date, skipping:",G),H)},{});console.log(`Grouped attendance for ${Object.keys(T).length} employees`);const N=Object.entries(T).map(([H,G])=>{try{const q=parseInt(H,10),oe=v.find(ie=>ie&&ie.id===q);if(!oe)return console.warn(`No matching staff found for employee ID ${q}, creating placeholder`),{employeeId:q,employeeName:`Unknown Staff (ID: ${q})`,department:"Unknown Department",presentDays:G.filter(ie=>ie&&ie.status===wt.PRESENT).length,halfDays:G.filter(ie=>ie&&ie.status===wt.HALF_DAY).length,absentDays:G.filter(ie=>ie&&ie.status===wt.ABSENT).length,leaveDays:G.filter(ie=>ie&&ie.status===wt.ON_LEAVE).length,attendancePercentage:"0",dailyStatus:{},isPlaceholder:!0};const de=G.filter(ie=>ie&&ie.status===wt.PRESENT).length,z=G.filter(ie=>ie&&ie.status===wt.ABSENT).length,O=G.filter(ie=>ie&&ie.status===wt.HALF_DAY).length,W=G.filter(ie=>ie&&ie.status===wt.ON_LEAVE).length,F=G.filter(ie=>ie&&ie.status).length;let U="0";try{if(F>0){const ie=(de+O*.5)/F*100;!isNaN(ie)&&isFinite(ie)?U=ie.toFixed(1):console.warn(`Invalid attendance percentage calculation for employee ${q}:`,{presentDays:de,halfDays:O,validRecords:F})}}catch(ie){console.error(`Error calculating attendance percentage for employee ${q}:`,ie)}const te=G.reduce((ie,be)=>{if(!be||!be.attendanceDate||typeof be.status>"u")return ie;let xe;try{xe=Be(be.attendanceDate).format("YYYY-MM-DD")}catch{return console.warn("Invalid date format in record:",be.attendanceDate),ie}return ie[xe]=be.status,ie},{});let he="Unknown";try{const ie=oe.firstName||"",be=oe.lastName||"";he=`${ie} ${be}`.trim(),he||(he=`Staff ID: ${q}`)}catch(ie){console.warn(`Error constructing name for employee ID ${q}:`,ie),he=`Staff ID: ${q}`}return{employeeId:q,employeeName:he,department:oe.department||"Unknown",presentDays:de,halfDays:O,absentDays:z,leaveDays:W,attendancePercentage:U,dailyStatus:te,totalRecords:G.length,validRecords:F}}catch(q){return console.error(`Error processing employee ${H}:`,q),null}}).filter(Boolean);return console.log(`Processed ${N.length} employee summaries for monthly report`),{year:f,month:x,monthName:y.format("MMMM"),startDate:y.format("YYYY-MM-DD"),endDate:S.format("YYYY-MM-DD"),totalWorkingDays:S.diff(y,"day")+1,employeeSummaries:N,dataStatus:N.length>0?"populated":"empty"}}catch(T){return console.error("Error calculating monthly report:",T),{year:f,month:x,monthName:y.format("MMMM"),startDate:y.format("YYYY-MM-DD"),endDate:S.format("YYYY-MM-DD"),totalWorkingDays:S.diff(y,"day")+1,employeeSummaries:[],dataStatus:"error",error:T instanceof Error?T.message:"Unknown error"}}},[I,v,f,x,y,S]),P=b.useMemo(()=>{try{if(!Y||!Y.employeeSummaries)return C||!v?["Science","Mathematics","English","Social Studies","Arts"].map(H=>({department:H,attendanceRate:Math.floor(Math.random()*30)+70,total:Math.floor(Math.random()*10)+5})):[];const T={};return Y.employeeSummaries.forEach(N=>{if(!N)return;const H=N.department||"Unknown";T[H]||(T[H]={department:H,attendanceRate:0,total:0});const G=parseFloat(N.attendancePercentage||"0");T[H].attendanceRate+=G,T[H].total+=1}),Object.values(T).map(N=>({...N,attendanceRate:N.total>0?Math.round(N.attendanceRate/N.total):0}))}catch(T){return console.error("Error calculating department data:",T),[]}},[Y,v,C]),M=(T,N)=>{s(N)},K=T=>{const N=j==null?void 0:j.find(H=>H.id===T);return N?`${N.firstName} ${N.lastName}`:"Unknown"},L=()=>{if(n!==1){t("Please navigate to Department Reports tab to export data","info");return}if(!Y||!Y.employeeSummaries){t("No data available to export","error");return}const T=g==="ALL"?Y.employeeSummaries:Y.employeeSummaries.filter(N=>N&&N.department===g);if(T.length===0){t("No staff found in the selected department","warning");return}try{const N=S.date();let G=`Staff ID,Name,Department,${Array.from({length:N},(W,F)=>`${y.date(F+1).format("D MMM")}`).join(",")},Present,Absent,Half Day,Leave,Attendance %
`;T.forEach(W=>{const{employeeId:F,employeeName:U,department:te,presentDays:he,absentDays:ie,halfDays:be,leaveDays:xe,attendancePercentage:Fe,dailyStatus:me}=W,ve=[];for(let ne=1;ne<=N;ne++){const we=y.date(ne).format("YYYY-MM-DD"),Ee=me[we]||"-";let pe;switch(typeof Ee=="string"?Ee.toUpperCase():String(Ee).toUpperCase()){case"PRESENT":pe="P";break;case"ABSENT":pe="A";break;case"HALF_DAY":case"HALFDAY":pe="H";break;case"ON_LEAVE":case"ONLEAVE":case"LEAVE":pe="L";break;case"-":case"UNDEFINED":case"NULL":case"NONE":pe="-";break;default:console.warn(`Unknown attendance status code encountered: '${Ee}'`),pe="-"}ve.push(pe)}G+=`${F},"${U}","${te}",${ve.join(",")},${he},${ie},${be},${xe},${Fe}%
`});const q=new Blob([G],{type:"text/csv;charset=utf-8;"}),oe=URL.createObjectURL(q),de=document.createElement("a");de.setAttribute("href",oe);const z=g==="ALL"?"All_Departments":g.replace(/\s+/g,"_"),O=y.format("MMM").toLowerCase();de.setAttribute("download",`${z}_attendance_${O}_${f}.csv`),document.body.appendChild(de),de.click(),document.body.removeChild(de),URL.revokeObjectURL(oe),t(`Exported ${T.length} staff records successfully`,"success")}catch(N){console.error("Export error:",N),t("Failed to export data. Please try again.","error")}},ae=()=>{t("Preparing document for printing...","info"),document.body.classList.add("printing-attendance"),setTimeout(()=>{try{window.print()}catch(T){console.error("Print error:",T),t("There was an error when trying to print","error")}finally{setTimeout(()=>{document.body.classList.remove("printing-attendance")},500)}},500)};b.useEffect(()=>{C&&console.error("Staff data loading error:",C),_&&console.error("Staff attendance data loading error:",_),B&&console.error("Monthly attendance data loading error:",B)},[C,_,B]);const Z=b.useMemo(()=>j&&j.length>0?j:[],[j]);if(b.useEffect(()=>{if(i&&j){const T=j.find(H=>H.id===Number(i)),N=T?`${T.firstName} ${T.lastName}`:"Unknown Staff";document.title=`Attendance Report - ${N}`}else document.title="Attendance Reports & Analytics"},[i,j]),E||n===0&&i&&k||n!==0&&D)return a.jsx(Ar,{});if(C&&n===0)return a.jsxs(ee,{sx:{p:3},children:[a.jsx(V,{variant:"h6",color:"error",gutterBottom:!0,children:"Staff data could not be loaded"}),a.jsx(V,{variant:"body1",paragraph:!0,children:"We encountered an issue while fetching staff data. This might be due to:"}),a.jsxs("ul",{children:[a.jsx("li",{children:"Network connectivity issues"}),a.jsx("li",{children:"Server maintenance"}),a.jsx("li",{children:"Database connection problems"})]}),a.jsx(V,{variant:"body2",sx:{mt:2},children:"You can try switching to the Department Reports tab, which may still work with limited functionality. Alternatively, please contact your system administrator if this issue persists."}),a.jsx(ye,{variant:"contained",color:"primary",sx:{mt:2},onClick:()=>s(1),children:"Switch to Department Reports"}),a.jsx(ye,{variant:"outlined",color:"secondary",sx:{mt:2,ml:2},onClick:()=>window.location.reload(),children:"Reload Page"})]});if(n!==0&&(B||C&&!P.length)){const T=B?"attendance data":"staff data";return console.error(`Department ${T} loading error:`,B||C),a.jsx(ee,{children:a.jsx(jn,{dateAdapter:qn,children:a.jsxs(Ke,{sx:{mb:3},children:[a.jsxs(aa,{value:n,onChange:M,variant:"scrollable",scrollButtons:"auto","aria-label":"attendance reports tabs",children:[a.jsx(kt,{icon:a.jsx(za,{}),label:"Individual Reports"}),e&&a.jsx(kt,{icon:a.jsx(gu,{}),label:"Department Reports"})]}),a.jsxs(ee,{sx:{p:3},children:[a.jsxs(V,{variant:"h6",color:"error",gutterBottom:!0,children:["Department ",T," could not be loaded"]}),a.jsx(V,{variant:"body1",children:"We encountered an issue while fetching department data. This may be due to server issues or data availability problems."}),a.jsx(V,{variant:"body2",sx:{mt:2},children:"Try selecting a different month or year, switch to the Individual Reports tab, or reload the page to try again."}),a.jsxs(ee,{sx:{mt:2},children:[a.jsx(ye,{variant:"contained",color:"primary",sx:{mr:2},onClick:()=>s(0),children:"Switch to Individual Reports"}),a.jsx(ye,{variant:"outlined",onClick:()=>{m(Be().month()+1),h(Be().year())},sx:{mr:2},children:"Reset Date Range"}),a.jsx(ye,{variant:"outlined",color:"secondary",onClick:()=>window.location.reload(),children:"Reload Page"})]})]})]})})})}return a.jsxs(ee,{children:[a.jsxs(ee,{className:"print-hide",sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(V,{variant:"h6",component:"h2",children:"Attendance Reports & Analytics"}),e&&a.jsxs(ee,{className:"print-hide",children:[a.jsx(ye,{variant:"contained",color:n===1?"primary":"inherit",startIcon:a.jsx(Hi,{}),onClick:L,sx:{mr:1},title:n===1?`Export ${g==="ALL"?"all departments":g} attendance for ${Be().month(x-1).format("MMMM")} ${f}`:"Go to Department Reports tab to export data",children:"Export Department Report"}),a.jsx(ye,{variant:"outlined",startIcon:a.jsx(Wc,{}),onClick:ae,children:"Print"})]})]}),a.jsx(jn,{dateAdapter:qn,children:a.jsxs(Ke,{sx:{mb:3},children:[a.jsxs(aa,{value:n,onChange:M,variant:"scrollable",scrollButtons:"auto","aria-label":"attendance reports tabs",children:[a.jsx(kt,{icon:a.jsx(za,{}),label:"Individual Reports"}),e&&a.jsx(kt,{icon:a.jsx(gu,{}),label:"Department Reports"})]}),a.jsxs(Tx,{value:n,index:0,children:[a.jsxs(X,{container:!0,spacing:2,className:"print-hide",children:[a.jsxs(X,{item:!0,xs:12,md:4,children:[a.jsx(Yi,{id:"staff-select-autocomplete",options:Z,getOptionLabel:T=>{try{return`${T.firstName} ${T.lastName}`}catch(N){return console.error("Error in getOptionLabel:",N),"Unknown Staff"}},renderOption:(T,N)=>{try{return b.createElement("li",{...T,key:N.id},a.jsxs("div",{children:[N.firstName," ",N.lastName,N.employeeType&&a.jsxs("span",{style:{fontSize:"0.8em",marginLeft:"8px",color:"#666"},children:["(",N.employeeType.replace("_"," "),")"]})]}))}catch(H){return console.error("Error in renderOption:",H),a.jsx("li",{...T,children:"Error displaying staff"})}},value:Z.find(T=>T.id===i)||null,onChange:(T,N)=>o(N?N.id:""),renderInput:T=>a.jsx(Se,{...T,label:"Select Staff Member",placeholder:"Type to search staff",fullWidth:!0}),disableListWrap:!0,filterOptions:(T,N)=>{const H=N.inputValue.toLowerCase().trim();return H?T.filter(G=>`${G.firstName} ${G.lastName}`.toLowerCase().includes(H)):T.slice(0,100)},ListboxProps:{style:{maxHeight:250}}}),r==="ALL"?a.jsxs(V,{variant:"caption",sx:{mt:.5,color:"text.secondary"},children:["Showing all active staff members (",(j==null?void 0:j.length)||0,")"]}):a.jsxs(V,{variant:"caption",sx:{mt:.5,color:"text.secondary"},children:["Filtered to ",r.replace("_"," ").toLowerCase()," staff (",(j==null?void 0:j.length)||0,")"]})]}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(un,{label:"Start Date",value:l,onChange:T=>T&&c(Be(T)),slotProps:{textField:{fullWidth:!0}}})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(un,{label:"End Date",value:d,onChange:T=>T&&u(Be(T)),slotProps:{textField:{fullWidth:!0}}})})]}),i&&_&&a.jsx(jt,{sx:{mt:3,border:"1px solid",borderColor:"error.light"},children:a.jsxs(Ut,{children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"flex-start",mb:2},children:[a.jsx(ee,{sx:{backgroundColor:"error.light",borderRadius:"50%",width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",mr:2},children:a.jsx(V,{variant:"h5",color:"white",children:"!"})}),a.jsxs(ee,{children:[a.jsx(V,{variant:"h6",color:"error",gutterBottom:!0,children:"Attendance data could not be loaded"}),a.jsxs(V,{variant:"body1",children:["We encountered an error while trying to fetch attendance data for ",K(Number(i)),"."]})]})]}),a.jsxs(V,{variant:"body2",color:"text.secondary",sx:{mb:2,p:1,bgcolor:"background.paper",fontFamily:"monospace",borderRadius:1},children:["Error details: ",typeof _=="string"?_:(_==null?void 0:_.message)||"An unexpected error occurred when fetching attendance records."]}),a.jsx(V,{variant:"body2",sx:{mt:2},children:"This issue could be due to:"}),a.jsxs("ul",{children:[a.jsx("li",{children:"The staff member has no attendance records in the system"}),a.jsx("li",{children:"The attendance database is currently unavailable"}),a.jsx("li",{children:"There might be a network connectivity issue"})]}),a.jsxs(ee,{sx:{display:"flex",gap:2,mt:2},children:[a.jsx(ye,{variant:"contained",color:"primary",onClick:()=>o(""),children:"Select Different Staff"}),a.jsx(ye,{variant:"outlined",onClick:()=>{i&&(t("Retrying attendance data fetch...","info"),Kt.getAttendanceByEmployee(Number(i)).then(()=>{t("Attendance data refreshed successfully","success"),window.location.reload()}).catch(T=>{t(`Retry failed: ${T.message||"Unknown error"}`,"error")}))},children:"Retry"})]})]})}),i&&R?a.jsxs(ee,{className:"print-container",sx:{mt:3,"@media print":{display:"block",width:"100%"}},children:[a.jsx(jt,{sx:{mb:3,"@media print":{display:"block",pageBreakAfter:"avoid"}},children:a.jsxs(Ut,{children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsxs(ee,{children:[a.jsx(V,{variant:"h6",component:"div",children:K(Number(i))}),a.jsxs(V,{variant:"subtitle2",color:"text.secondary",children:[Be(R.startDate).format("MMM D, YYYY")," - ",Be(R.endDate).format("MMM D, YYYY")]})]}),a.jsxs(ee,{sx:{textAlign:"right"},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-end"},children:[a.jsxs(V,{variant:"h4",component:"div",color:"primary",sx:{fontWeight:"bold"},children:[R.attendancePercentage,"%"]}),a.jsx(V,{variant:"body2",color:"text.secondary",sx:{ml:1},children:"Attendance"})]}),a.jsx(ee,{sx:{display:"flex",alignItems:"center",mt:.5},children:a.jsx(V,{variant:"caption",color:"text.secondary",children:"(Present days + 0.5 √ó Half days) / Total marked days √ó 100"})})]})]}),a.jsx(Qt,{sx:{my:2}}),a.jsxs(X,{container:!0,spacing:2,sx:{mb:2},children:[a.jsx(X,{item:!0,xs:4,sm:2,children:a.jsxs(ee,{sx:{textAlign:"center",p:1,bgcolor:"success.light",borderRadius:1},children:[a.jsx(V,{variant:"h6",color:"success.dark",children:R.presentDays}),a.jsx(V,{variant:"body2",children:"Present"})]})}),a.jsx(X,{item:!0,xs:4,sm:2,children:a.jsxs(ee,{sx:{textAlign:"center",p:1,bgcolor:"error.light",borderRadius:1},children:[a.jsx(V,{variant:"h6",color:"error.dark",children:R.absentDays}),a.jsx(V,{variant:"body2",children:"Absent"})]})}),a.jsx(X,{item:!0,xs:4,sm:2,children:a.jsxs(ee,{sx:{textAlign:"center",p:1,bgcolor:"warning.light",borderRadius:1},children:[a.jsx(V,{variant:"h6",color:"warning.dark",children:R.halfDays}),a.jsx(V,{variant:"body2",children:"Half Day"})]})}),a.jsx(X,{item:!0,xs:4,sm:2,children:a.jsxs(ee,{sx:{textAlign:"center",p:1,bgcolor:"info.light",borderRadius:1},children:[a.jsx(V,{variant:"h6",color:"info.dark",children:R.leaveDays}),a.jsx(V,{variant:"body2",children:"Leave"})]})}),a.jsx(X,{item:!0,xs:4,sm:2,children:a.jsxs(ee,{sx:{textAlign:"center",p:1,bgcolor:"background.paper",borderRadius:1,border:"1px dashed",borderColor:"divider"},children:[a.jsx(V,{variant:"h6",children:R.totalWorkingDays}),a.jsx(V,{variant:"body2",children:"Working Days"})]})})]})]})}),R.datesByStatus&&Object.keys(R.datesByStatus).length>0&&a.jsx(jt,{sx:{mt:3,"@media print":{display:"block",width:"100%",breakInside:"auto",pageBreakInside:"auto"}},children:a.jsxs(Ut,{sx:{"@media print":{padding:"16px !important"}},children:[a.jsxs(V,{variant:"h6",sx:{display:"flex",alignItems:"center",mb:2},children:[a.jsx(tc,{fontSize:"small",sx:{mr:1}}),"Attendance Log"]}),a.jsx(Jt,{sx:{"@media print":{display:"block",width:"100%",pageBreakInside:"auto",breakInside:"auto"}},children:a.jsxs(Vt,{size:"small","aria-label":"attendance details table",sx:{"@media print":{width:"100%",pageBreakInside:"auto",breakInside:"auto",borderCollapse:"collapse"}},children:[a.jsx(Wt,{sx:{"@media print":{display:"table-header-group",breakInside:"avoid",pageBreakInside:"avoid"}},children:a.jsxs(Ge,{sx:{bgcolor:"background.paper","@media print":{backgroundColor:"#f5f5f5 !important"}},children:[a.jsx(Q,{sx:{fontWeight:"bold",width:"20%","@media print":{borderBottom:"2px solid #000",fontWeight:"bold"}},children:"Status"}),a.jsx(Q,{sx:{fontWeight:"bold",width:"40%","@media print":{borderBottom:"2px solid #000",fontWeight:"bold"}},children:"Date"}),a.jsx(Q,{sx:{fontWeight:"bold",width:"40%","@media print":{borderBottom:"2px solid #000",fontWeight:"bold"}},children:"Day"})]})}),a.jsx(Ht,{sx:{"@media print":{display:"table-row-group"}},children:(()=>{const T={};Object.entries(R.datesByStatus).forEach(([q,oe])=>{let de="text.primary";switch(q){case"PRESENT":de="success.main";break;case"ABSENT":de="error.main";break;case"HALF_DAY":de="warning.main";break;case"ON_LEAVE":de="info.main";break;default:console.log(`Unhandled status code in attendance data: ${q}`),de="text.primary"}let z=q;try{z=q.replace(/_/g," ")}catch(O){console.warn("Error formatting status:",O)}oe.forEach(O=>{if(!O){console.warn(`Invalid date found in ${q} records`);return}T[O]={status:z,statusColor:de}})});const N=[];let H=Be(l);const G=Be(d);for(;H.isBefore(G)||H.isSame(G,"day");){const q=H.format("YYYY-MM-DD");if(T[q])N.push({status:T[q].status,date:q,statusColor:T[q].statusColor});else{const oe=H.day();oe===0||oe===6?N.push({status:"WEEKEND",date:q,statusColor:"text.secondary"}):N.push({status:"Not Marked",date:q,statusColor:"text.secondary"})}H=H.add(1,"day")}return N.sort((q,oe)=>Be(oe.date).valueOf()-Be(q.date).valueOf()),N.map((q,oe)=>a.jsxs(Ge,{sx:{"&:last-child td, &:last-child th":{border:0},bgcolor:oe%2===0?"background.paper":"background.default","@media print":{breakInside:"avoid",pageBreakInside:"avoid",backgroundColor:oe%2===0?"#ffffff !important":"#f9f9f9 !important"}},children:[a.jsx(Q,{className:`status-${q.status.toLowerCase().replace(/ /g,"-")}`,sx:{color:q.statusColor,fontWeight:"medium"},children:q.status}),a.jsx(Q,{children:Be(q.date).format("MMM D, YYYY")}),a.jsx(Q,{children:Be(q.date).format("dddd")})]},`attendance-${q.date}`))})()})]})})]})})]}):i?a.jsxs(ee,{sx:{mt:3,textAlign:"center",p:3},children:[a.jsx(V,{children:"No attendance data found for the selected date range"}),a.jsx(V,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Try selecting a different date range or check if the staff member has attendance records."})]}):a.jsxs(ee,{sx:{mt:3,textAlign:"center",p:4,bgcolor:"background.paper",borderRadius:1},children:[a.jsx(za,{sx:{fontSize:60,color:"primary.light",mb:2,opacity:.7}}),a.jsx(V,{variant:"h6",children:"Please select a staff member to view attendance reports"}),a.jsx(V,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Individual attendance reports include attendance statistics, trends, and detailed logs."})]})]}),e&&a.jsxs(Tx,{value:n,index:1,children:[a.jsxs(X,{container:!0,spacing:2,sx:{mb:3},children:[a.jsx(X,{item:!0,xs:12,sm:4,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Year"}),a.jsx(tt,{value:f,label:"Year",onChange:T=>h(Number(T.target.value)),children:[...Array(3)].map((T,N)=>{const H=Be().year()-1+N;return a.jsx(Te,{value:H,children:H},H)})})]})}),a.jsx(X,{item:!0,xs:12,sm:4,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Month"}),a.jsx(tt,{value:x,label:"Month",onChange:T=>m(Number(T.target.value)),children:[...Array(12)].map((T,N)=>a.jsx(Te,{value:N+1,children:Be().month(N).format("MMMM")},N+1))})]})}),a.jsx(X,{item:!0,xs:12,sm:4,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Department"}),a.jsxs(tt,{value:g,label:"Department",onChange:T=>p(T.target.value),children:[a.jsx(Te,{value:"ALL",children:"All Departments"}),(A||[]).map(T=>a.jsx(Te,{value:T,children:T},T))]})]})})]}),a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Department-wise Attendance Rate"}),a.jsx(ee,{sx:{height:300},children:a.jsx(Io,{width:"100%",height:"100%",children:a.jsxs(uf,{data:P,margin:{top:20,right:30,left:20,bottom:70},children:[a.jsx(fc,{strokeDasharray:"3 3"}),a.jsx(hc,{dataKey:"department",angle:-45,textAnchor:"end",height:70}),a.jsx(mc,{label:{value:"Attendance %",angle:-90,position:"insideLeft"}}),a.jsx(Fo,{}),a.jsx(Mo,{dataKey:"attendanceRate",name:"Attendance Rate (%)",fill:"#8884d8",radius:[5,5,0,0]})]})})})]})})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Department Performance"}),a.jsx(Jt,{children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Department"}),a.jsx(Q,{align:"center",children:"Teachers"}),a.jsx(Q,{align:"center",children:"Avg. Attendance"}),a.jsx(Q,{align:"center",children:"Performance"})]})}),a.jsx(Ht,{children:P.map(T=>{let N;return T.attendanceRate>=90?N=a.jsx(at,{label:"Excellent",color:"success",size:"small"}):T.attendanceRate>=75?N=a.jsx(at,{label:"Good",color:"primary",size:"small"}):T.attendanceRate>=60?N=a.jsx(at,{label:"Average",color:"warning",size:"small"}):N=a.jsx(at,{label:"Poor",color:"error",size:"small"}),a.jsxs(Ge,{children:[a.jsx(Q,{children:T.department}),a.jsx(Q,{align:"center",children:T.total}),a.jsxs(Q,{align:"center",children:[T.attendanceRate,"%"]}),a.jsx(Q,{align:"center",children:N})]},T.department)})})]})})]})})})]})]})]})})]})},Ub=()=>{const{showNotification:e}=dr(),[r,t]=b.useState(0),[n,s]=b.useState("single"),[i,o]=b.useState(Be()),[l,c]=b.useState(Be().startOf("week")),[d,u]=b.useState(Be().endOf("week")),[f,h]=b.useState(null),[x,m]=b.useState({errors:[],warnings:[]}),[g,p]=b.useState(!1),[y,S]=b.useState(null),[v,E]=b.useState(!1),[C,A]=b.useState(""),[j,w]=b.useState(0),[k,_]=b.useState(0),{data:I,error:D}=Gt(()=>Qr.getAll(),{dependencies:[]}),{mutateAsync:B,isLoading:R}=pr(q=>Kt.uploadAttendanceFile(q),{onSuccess:q=>{S({success:!0,successCount:q.successCount||0,failureCount:q.failureCount||0,message:"File uploaded and processed successfully"}),e("Attendance data uploaded successfully","success"),t(3)},onError:q=>{S({success:!1,message:(q==null?void 0:q.message)||"Failed to upload attendance data"}),e(`Upload failed: ${(q==null?void 0:q.message)||"Unknown error"}`,"error")}}),{mutateAsync:Y,isLoading:P}=pr(q=>Kt.markBulkAttendance(q),{onSuccess:q=>{console.log("Successfully marked bulk attendance:",q)},onError:q=>{console.error("Failed to mark bulk attendance:",q)}}),{mutateAsync:M,isLoading:K}=pr(()=>Kt.downloadAttendanceTemplate(),{onSuccess:q=>{const oe=window.URL.createObjectURL(new Blob([q])),de=document.createElement("a");de.href=oe,de.setAttribute("download",`attendance_template_${Be().format("YYYY-MM-DD")}.csv`),document.body.appendChild(de),de.click(),de.remove(),e("Template downloaded successfully","success")},onError:q=>{e(`Failed to download template: ${(q==null?void 0:q.message)||"Unknown error"}`,"error")}}),L=()=>{if(!l||!d||!I){e("Missing required data for template generation","error");return}try{const q=l,oe=d,de=[];let z=q;for(;z.isBefore(oe)||z.isSame(oe,"day");)de.push(z.format("YYYY-MM-DD")),z=z.add(1,"day");let O="EmployeeId,Name,Department,";de.forEach(he=>{O+=`${Be(he).format("ddd (MM/DD)")},`}),O+=`Remarks
`,I.forEach(he=>{var Fe;const ie=he.id||"N/A",be=he.name||"Unknown",xe=((Fe=he.department)==null?void 0:Fe.name)||he.department||"N/A";O+=`${ie},${be},${xe},`,de.forEach(()=>{O+=","}),O+=`
`});const W=new Blob([O],{type:"text/csv;charset=utf-8;"}),F=URL.createObjectURL(W),U=document.createElement("a");U.setAttribute("href",F);const te=`${l.format("YYYY-MM-DD")}_to_${d.format("YYYY-MM-DD")}`;U.setAttribute("download",`weekly_attendance_template_${te}.csv`),U.style.visibility="hidden",document.body.appendChild(U),U.click(),document.body.removeChild(U),e("Weekly template downloaded successfully","success")}catch(q){console.error("Error generating weekly template:",q),e("Failed to generate weekly template","error")}},ae=q=>{if(q.target.files&&q.target.files.length>0){const oe=q.target.files[0];if(oe.type!=="text/csv"&&!oe.name.endsWith(".csv")){e("Please upload a CSV file","error");return}h(oe),Z(oe),t(1)}},Z=q=>{const oe=[],de=[];q.size>5*1024*1024&&de.push("File size exceeds 5MB. Large files may take longer to process."),n==="single"?q.name!=="attendance_template.csv"&&!q.name.includes("attendance")&&de.push("File name does not match the expected template name pattern."):!q.name.includes("weekly")&&!q.name.includes("attendance")&&de.push("File name does not match the expected weekly template pattern."),m({errors:oe,warnings:de})},T=async()=>{try{if(n==="single")await M({});else{if(!l||!d){e("Please select a valid week range","error");return}L()}}catch(q){console.error("Error downloading template:",q)}},N=async q=>{var oe;if(!l||!d||!I)throw new globalThis.Error("Missing required data for weekly upload");try{E(!0);const de=l,z=d,O=[];let W=de;for(;W.isBefore(z)||W.isSame(z,"day");)O.push(W.format("YYYY-MM-DD")),W=W.add(1,"day");_(O.length);const U=(await q.text()).split("\\n");if(U.length<2)throw new globalThis.Error("CSV file is empty or has invalid format");const te=U[0].split(","),he={};for(let Fe=3;Fe<te.length-1;Fe++){const ve=te[Fe].trim().match(/\((\d{2}\/\d{2})\)/);if(ve&&ve[1]){const[ne,we]=ve[1].split("/"),Ee=`${l.year()}-${ne}-${we}`;he[Ee]=Fe}}const ie=[];let be=0;for(let Fe=0;Fe<O.length;Fe++){const me=O[Fe];if(w(Fe+1),A(`Processing attendance for ${Be(me).format("MMM D, YYYY")} (${Fe+1}/${O.length})`),!he[me]){ie.push({date:me,success:!1,count:0,message:"No data column found for this date"});continue}const ve={};let ne=0;for(let we=1;we<U.length;we++){if(!U[we].trim())continue;const Ee=U[we].split(","),pe=parseInt(Ee[0]);if(isNaN(pe))continue;const Ce=(oe=Ee[he[me]])==null?void 0:oe.trim().toUpperCase();if(!Ce)continue;let ue;switch(Ce){case"P":ue=wt.PRESENT;break;case"A":ue=wt.ABSENT;break;case"H":ue=wt.HALF_DAY;break;case"L":ue=wt.ON_LEAVE;break;default:continue}ve[pe]=ue,ne++}if(ne===0){ie.push({date:me,success:!1,count:0,message:"No valid entries found for this date"});continue}try{const we={attendanceDate:me,attendanceMap:ve,remarks:`Uploaded via weekly bulk upload on ${Be().format("YYYY-MM-DD")}`},Ee=await Y(we);be+=ne,ie.push({date:me,success:!0,count:ne,message:`Successfully processed ${ne} records`})}catch(we){console.error(`Error processing date ${me}:`,we);const Ee=we,pe=(Ee==null?void 0:Ee.message)||"Unknown error";ie.push({date:me,success:!1,count:0,message:`Error: ${pe}`})}}const xe=ie.filter(Fe=>Fe.success).length;S({success:xe>0,successCount:be,failureCount:O.length-xe,message:`Processed attendance for ${xe} out of ${O.length} days`,dailyResults:ie}),e(`Weekly attendance processed: ${xe}/${O.length} days successful`,xe>0?xe===O.length?"success":"warning":"error")}catch(de){console.error("Error processing weekly upload:",de);const z=de,O=(z==null?void 0:z.message)||"Failed to process weekly attendance data",W=(z==null?void 0:z.message)||"Unknown error";S({success:!1,message:O}),e(`Weekly upload failed: ${W}`,"error")}finally{E(!1),t(3)}},H=async()=>{if(!f){e("Please select a file to upload","error");return}if(x.errors.length>0&&!g){e('Please fix validation errors or check "Skip validation"',"error");return}try{t(2),n==="single"?await B(f):await N(f)}catch(q){console.error("Error uploading file:",q),t(1)}},G=()=>{h(null),m({errors:[],warnings:[]}),p(!1),S(null),t(0),w(0),_(0),A(""),E(!1)};return a.jsxs(ee,{children:[a.jsx(V,{variant:"h6",component:"h2",sx:{mb:3},children:"Bulk Attendance Upload"}),a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,md:8,children:a.jsxs(Ke,{sx:{p:3,mb:3},children:[a.jsxs(ee,{sx:{mb:3},children:[a.jsx(V,{variant:"subtitle1",gutterBottom:!0,children:"Upload Mode"}),a.jsxs(Vx,{value:n,exclusive:!0,onChange:(q,oe)=>oe&&s(oe),"aria-label":"upload mode",sx:{mb:2},children:[a.jsx(uc,{value:"single","aria-label":"single day",children:"Single Day"}),a.jsx(uc,{value:"weekly","aria-label":"weekly",children:"Weekly"})]}),a.jsx(jn,{dateAdapter:qn,children:n==="single"?a.jsxs(ee,{sx:{mb:2},children:[a.jsx(un,{label:"Select Date",value:i,onChange:q=>o(q?Be(q):null),sx:{width:"100%"}}),a.jsxs(V,{variant:"body2",color:"text.secondary",sx:{mt:1},children:["Attendance will be uploaded for: ",(i==null?void 0:i.format("dddd, MMMM D, YYYY"))||"No date selected"]})]}):a.jsxs(ee,{sx:{display:"flex",flexDirection:"column",gap:2,mb:2},children:[a.jsx(un,{label:"Week Start Date",value:l,onChange:q=>c(q?Be(q):null),sx:{width:"100%"}}),a.jsx(un,{label:"Week End Date",value:d,onChange:q=>u(q?Be(q):null),sx:{width:"100%"}}),l&&d&&a.jsxs(V,{variant:"body2",color:"text.secondary",children:["Selected period: ",l.format("MMM D, YYYY")," to ",d.format("MMM D, YYYY"),"(",Be(d).diff(l,"day")+1," days)"]})]})})]}),a.jsx(Qt,{sx:{my:3}}),a.jsxs(SS,{activeStep:r,orientation:"vertical",children:[a.jsxs(_l,{children:[a.jsx(Il,{children:"Select Attendance File"}),a.jsx(Fl,{children:a.jsxs(ee,{sx:{mb:2},children:[a.jsxs(V,{variant:"body2",color:"text.secondary",paragraph:!0,children:["Upload a CSV file containing ",n==="weekly"?"weekly":""," teacher attendance data. Make sure the file follows the required format."]}),a.jsxs(jn,{dateAdapter:qn,children:["                      ",a.jsx(un,{label:"Attendance Date",value:i,onChange:q=>q&&o(Be(q)),sx:{width:"100%",mb:2}})]}),a.jsx("input",{type:"file",accept:".csv",id:"attendance-file-input",style:{display:"none"},onChange:ae}),a.jsxs(ee,{sx:{display:"flex",gap:2},children:[a.jsx(ye,{variant:"contained",component:"label",htmlFor:"attendance-file-input",startIcon:a.jsx(of,{}),children:"Select File"}),a.jsx(ye,{variant:"outlined",startIcon:a.jsx(Hi,{}),onClick:T,disabled:K||n==="weekly"&&(!l||!d),children:K?"Downloading...":`Download ${n==="weekly"?"Weekly":""} Template`})]}),K&&a.jsxs(ee,{sx:{display:"flex",alignItems:"center",mt:2},children:[a.jsx(vr,{size:20,sx:{mr:1}}),a.jsxs(V,{variant:"body2",children:["Downloading ",n==="weekly"?"weekly":""," template..."]})]})]})})]}),a.jsxs(_l,{children:[a.jsx(Il,{children:"Validate"}),a.jsx(Fl,{children:a.jsxs(ee,{sx:{mb:2},children:[a.jsxs(V,{variant:"body1",sx:{mb:2},children:["Selected File: ",a.jsx("strong",{children:f==null?void 0:f.name})]}),x.errors.length>0&&a.jsxs(pt,{severity:"error",sx:{mb:2},children:[a.jsx(Mn,{children:"Validation Errors"}),a.jsx(Gn,{dense:!0,children:x.errors.map((q,oe)=>a.jsxs(Gr,{children:[a.jsx(In,{sx:{minWidth:30},children:a.jsx(D0,{fontSize:"small",color:"error"})}),a.jsx(Fr,{primary:q})]},oe))})]}),x.warnings.length>0&&a.jsxs(pt,{severity:"warning",sx:{mb:2},children:[a.jsx(Mn,{children:"Warnings"}),a.jsx(Gn,{dense:!0,children:x.warnings.map((q,oe)=>a.jsxs(Gr,{children:[a.jsx(In,{sx:{minWidth:30},children:a.jsx(D0,{fontSize:"small",color:"warning"})}),a.jsx(Fr,{primary:q})]},oe))})]}),x.errors.length===0&&x.warnings.length===0&&a.jsxs(pt,{severity:"success",sx:{mb:2},children:[a.jsx(Mn,{children:"File Validated"}),"The file has passed all validation checks and is ready to upload."]}),x.errors.length>0&&a.jsx(Wi,{control:a.jsx(Zs,{checked:g,onChange:q=>p(q.target.checked)}),label:"Skip validation and upload anyway"}),a.jsxs(ee,{sx:{display:"flex",gap:2,mt:2},children:[a.jsx(ye,{variant:"contained",onClick:H,disabled:x.errors.length>0&&!g,children:"Upload"}),a.jsx(ye,{variant:"outlined",onClick:()=>t(0),children:"Back"})]})]})})]}),a.jsxs(_l,{children:[a.jsx(Il,{children:"Uploading"}),a.jsx(Fl,{children:a.jsxs(ee,{sx:{display:"flex",alignItems:"center",my:2},children:[a.jsx(vr,{size:24,sx:{mr:2}}),a.jsxs(ee,{children:[a.jsx(V,{children:n==="weekly"&&v?C:"Uploading and processing attendance data..."}),n==="weekly"&&v&&k>0&&a.jsxs(V,{variant:"body2",color:"text.secondary",children:["Progress: ",j,"/",k," days processed"]})]})]})})]}),a.jsxs(_l,{children:[a.jsx(Il,{children:"Complete"}),a.jsx(Fl,{children:y&&a.jsxs(ee,{sx:{mb:2},children:[y.success?a.jsxs(pt,{severity:"success",sx:{mb:2},children:[a.jsx(Mn,{children:"Upload Successful"}),a.jsxs(V,{variant:"body2",children:[n==="single"?`Successfully processed ${y.successCount} attendance records.`:"Successfully processed attendance for the selected week.",y.failureCount&&y.failureCount>0&&` ${y.failureCount} ${n==="single"?"records":"days"} failed.`]})]}):a.jsxs(pt,{severity:"error",sx:{mb:2},children:[a.jsx(Mn,{children:"Upload Failed"}),a.jsx(V,{variant:"body2",children:y.message||"An error occurred during the upload."})]}),n==="weekly"&&y.dailyResults&&a.jsxs(ee,{sx:{my:2},children:[a.jsx(V,{variant:"subtitle2",gutterBottom:!0,children:"Daily Processing Results:"}),a.jsx(Jt,{component:Ke,variant:"outlined",sx:{mb:2},children:a.jsxs(Vt,{size:"small",children:[a.jsxs("colgroup",{children:[a.jsx("col",{style:{width:"25%"}}),a.jsx("col",{style:{width:"15%"}}),a.jsx("col",{style:{width:"15%"}}),a.jsx("col",{style:{width:"45%"}})]}),a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Date"}),a.jsx(Q,{children:"Status"}),a.jsx(Q,{children:"Records"}),a.jsx(Q,{children:"Message"})]})}),a.jsx(Ht,{children:y.dailyResults.map(q=>a.jsxs(Ge,{children:[a.jsx(Q,{children:Be(q.date).format("MMM D, YYYY")}),a.jsx(Q,{children:a.jsx(at,{label:q.success?"Success":"Failed",color:q.success?"success":"error",size:"small"})}),a.jsx(Q,{children:q.count||0}),a.jsx(Q,{children:q.message})]},q.date))})]})})]}),a.jsx(ee,{sx:{display:"flex",gap:2,mt:2},children:a.jsx(ye,{variant:"contained",startIcon:a.jsx(On,{}),onClick:G,children:"Upload Another File"})})]})})]})]})]})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Upload Instructions"}),a.jsx(Qt,{sx:{mb:2}}),a.jsxs(Gn,{dense:!0,children:[a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(ko,{fontSize:"small"})}),a.jsx(Fr,{primary:`Download the ${n==="weekly"?"weekly":""} template`,secondary:"Use our template for the correct format"})]}),a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(ko,{fontSize:"small"})}),a.jsx(Fr,{primary:"Fill in the attendance data",secondary:n==="weekly"?"Mark attendance for each day of the week":"Enter data for each teacher in the CSV file"})]}),a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(ko,{fontSize:"small"})}),a.jsx(Fr,{primary:"Upload the completed file",secondary:"Upload the file and validate the data"})]}),a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(ko,{fontSize:"small"})}),a.jsx(Fr,{primary:"Review and confirm",secondary:"Verify the upload results"})]})]}),a.jsx(V,{variant:"subtitle2",sx:{mt:2,fontWeight:"bold"},children:"Valid attendance status codes:"}),a.jsxs(V,{variant:"body2",children:["P - Present",a.jsx("br",{}),"A - Absent",a.jsx("br",{}),"H - Half Day",a.jsx("br",{}),"L - On Leave"]}),n==="weekly"&&a.jsxs(ee,{sx:{mt:2},children:[a.jsx(V,{variant:"subtitle2",sx:{fontWeight:"bold"},children:"Weekly Upload Format"}),a.jsx(V,{variant:"body2",children:"For weekly attendance, each day column should be filled with the status codes listed above. Leave a cell empty if no attendance is recorded for that day."})]}),a.jsxs(V,{variant:"body2",color:"text.secondary",sx:{mt:3},children:["Need help? Check the ",a.jsx(Wn,{href:"#",underline:"hover",children:"documentation"})," or contact system administrator."]})]})})})]})]})},PV=({employeeId:e,startDate:r,endDate:t})=>{const n=es(),{showNotification:s}=dr(),{isAuthenticated:i,logout:o}=$n(),[l,c]=b.useState({}),[d,u]=b.useState(!1);b.useEffect(()=>{(async()=>{if(!i)try{console.log("User not authenticated in AttendanceWeeklyEdit, attempting token refresh");const I=window.authService;I&&I.validateToken&&(await I.validateToken()?console.log("Token refresh successful"):(console.error("Token refresh failed, redirecting to login"),o()))}catch(I){console.error("Authentication check failed:",I),o()}})()},[i,o]);const{data:f,error:h,loading:x}=Gt(()=>Qr.getById(e),{dependencies:[e]}),{data:m,error:g,loading:p}=Gt(()=>Kt.getAttendanceByEmployeeAndDateRange(e,r,t),{dependencies:[e,r,t]}),{data:y,error:S,loading:v}=Gt(()=>Kt.getHolidaysByDateRange(r,t),{dependencies:[r,t]});it.useEffect(()=>{if(m&&f){const _={},I=Be(r),D=Be(t),B=[];let R=I;for(;R.isBefore(D)||R.isSame(D,"day");)B.push(R.format("YYYY-MM-DD")),R=R.add(1,"day");m.forEach(Y=>{_[Y.attendanceDate]=Y}),B.forEach(Y=>{var P;if(!_[Y]){const M=(y==null?void 0:y.some(K=>K.date===Y))||!1;_[Y]={employeeId:e,employeeName:`${f.firstName||""} ${f.lastName||""}`.trim(),employeeType:(P=f.role)!=null&&P.includes("TEACHER")?"TEACHING":"NON_TEACHING",department:f.department||"",position:f.position||"",attendanceDate:Y,status:M?wt.HOLIDAY:wt.PRESENT,reason:""}}}),c(_)}},[m,f,y,e,r,t]);const{mutateAsync:E}=pr(_=>Kt.markAttendance(_),{onSuccess:()=>{s("Attendance saved successfully","success")},onError:_=>{s(`Failed to save attendance: ${_.message}`,"error")}}),{mutateAsync:C}=pr(({id:_,data:I})=>Kt.updateAttendance(_,I),{onSuccess:()=>{s("Attendance updated successfully","success")},onError:_=>{s(`Failed to update attendance: ${_.message}`,"error")}}),A=(_,I,D)=>{c(B=>({...B,[_]:{...B[_],[I]:D}}))},j=async()=>{u(!0);try{try{const _=window.authService;if(_&&_.validateToken&&!await _.validateToken()){console.log("Token invalid before saving, attempting refresh...");const{refreshToken:D}=await qr(()=>Promise.resolve().then(()=>ed),void 0);await D()}}catch(_){console.warn("Token validation check failed, proceeding with save anyway:",_)}for(const _ in l){const I=l[_];I.id?await C({id:I.id,data:I}):await E(I)}s("All attendance records saved successfully","success"),setTimeout(()=>{n("/staff-attendance")},500)}catch(_){s(`Error saving attendance records: ${_ instanceof Error?_.message:"Unknown error"}`,"error")}finally{u(!1)}},w=it.useMemo(()=>{const _=Be(r),I=Be(t),D=[];let B=_;for(;B.isBefore(I)||B.isSame(I,"day");)D.push(B.format("YYYY-MM-DD")),B=B.add(1,"day");return D},[r,t]),k=_=>(y==null?void 0:y.some(I=>I.date===_))||!1;return x||p||v?a.jsx(Ar,{}):h||g||S?a.jsx(Kr,{message:"Failed to load staff or attendance data."}):a.jsxs(Ke,{sx:{p:3},children:[a.jsxs(ee,{sx:{mb:3,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[a.jsxs(V,{variant:"h5",component:"h2",children:["Weekly Attendance for ",f==null?void 0:f.firstName," ",f==null?void 0:f.lastName,a.jsxs(V,{variant:"body2",color:"text.secondary",children:[(f==null?void 0:f.department)||"No Department"," ‚Ä¢ ",(f==null?void 0:f.position)||"No Position"]})]}),a.jsx(ye,{variant:"outlined",startIcon:a.jsx(wS,{}),onClick:()=>n("/staff-attendance",{replace:!0}),children:"Back"})]}),a.jsx(Jt,{children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{sx:{fontWeight:"bold"},children:"Date"}),a.jsx(Q,{sx:{fontWeight:"bold"},children:"Day"}),a.jsx(Q,{sx:{fontWeight:"bold"},children:"Status"}),a.jsx(Q,{sx:{fontWeight:"bold"},children:"Reason"})]})}),a.jsx(Ht,{children:w.map(_=>{const I=l[_],D=k(_);return a.jsxs(Ge,{children:[a.jsx(Q,{children:Be(_).format("YYYY-MM-DD")}),a.jsxs(Q,{children:[Be(_).format("ddd, MMM D"),D&&a.jsx(at,{label:"Holiday",color:"secondary",size:"small",sx:{ml:1}})]}),a.jsx(Q,{children:a.jsx(rt,{fullWidth:!0,size:"small",children:a.jsx(tt,{value:(I==null?void 0:I.status)||"",onChange:B=>A(_,"status",B.target.value),disabled:D,children:Object.values(wt).map(B=>a.jsx(Te,{value:B,children:B.replace("_"," ")},B))})})}),a.jsx(Q,{children:a.jsx(Se,{size:"small",fullWidth:!0,placeholder:"Reason (if absent/leave)",value:(I==null?void 0:I.reason)||"",onChange:B=>A(_,"reason",B.target.value),disabled:D||(I==null?void 0:I.status)===wt.PRESENT})})]},_)})})]})}),a.jsx(ee,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:a.jsx(ye,{variant:"contained",color:"primary",startIcon:a.jsx(lf,{}),onClick:j,disabled:d,children:d?"Saving...":"Save All Changes"})})]})},Vb=({startDate:e,endDate:r,isAdmin:t,staffType:n="ALL"})=>{const s=es(),{data:i,error:o,loading:l}=Gt(()=>Qr.getAll(),{dependencies:[n]}),c=it.useMemo(()=>{if(!i)return[];if(n==="ALL")return i;const E=["teacher","librarian","principal"],C=["management","admin","director","supervisor"];return i.filter(A=>{let j="";return typeof A.role=="string"?j=A.role.toLowerCase():A.role&&typeof A.role=="object"&&"name"in A.role?j=(A.role.name||"").toLowerCase():A.staffRole&&typeof A.staffRole=="object"&&"name"in A.staffRole&&(j=(A.staffRole.name||"").toLowerCase()),n==="TEACHING"?E.some(w=>j.includes(w)):n==="NON_TEACHING"?!E.some(w=>j.includes(w)):n==="ADMINISTRATION"?C.some(w=>j.includes(w)):!0})},[i,n]),{data:d,error:u,loading:f}=Gt(()=>(console.log(`Fetching weekly attendance data for date range: ${e} to ${r}`),Kt.getAttendanceByDateRange(e,r)),{dependencies:[e,r],onError:E=>{console.error("Failed to load weekly attendance data:",E)},onSuccess:E=>{console.log(`Successfully loaded ${(E==null?void 0:E.length)||0} attendance records for the week`)}}),{data:h,error:x,loading:m}=Gt(()=>(console.log(`Fetching holiday data for date range: ${e} to ${r}`),Kt.getHolidaysByDateRange(e,r)),{dependencies:[e,r],onError:E=>{console.error("Failed to load holiday data:",E)},onSuccess:E=>{console.log(`Successfully loaded ${(E==null?void 0:E.length)||0} holidays for the week`)}}),g=it.useMemo(()=>{const E=Be(e),C=Be(r),A=[];let j=E;for(;j.isBefore(C)||j.isSame(C,"day");)A.push(j.format("YYYY-MM-DD")),j=j.add(1,"day");return A},[e,r]),p=it.useMemo(()=>{const E={};return d==null||d.forEach(C=>{E[C.employeeId]||(E[C.employeeId]={}),E[C.employeeId][C.attendanceDate]=C}),E},[d]),y=it.useMemo(()=>{const E={};return h==null||h.forEach(C=>{E[C.date]=!0}),E},[h]),S=E=>{switch(E){case wt.PRESENT:return"success";case wt.ABSENT:return"error";case wt.HALF_DAY:return"warning";case wt.ON_LEAVE:return"info";case wt.HOLIDAY:return"secondary";default:return"default"}},v=E=>{switch(E){case wt.PRESENT:return a.jsx(cf,{fontSize:"small"});case wt.ABSENT:return a.jsx(df,{fontSize:"small"});case wt.HALF_DAY:return a.jsx(Ux,{fontSize:"small"});case wt.ON_LEAVE:return a.jsx(dc,{fontSize:"small"});case wt.HOLIDAY:default:return}};return l||f||m?a.jsx(Ar,{}):o||u||x?a.jsx(Kr,{message:"Failed to load attendance data."}):a.jsxs(ee,{children:[a.jsx(V,{variant:"h6",component:"h2",sx:{mb:3},children:"Weekly Attendance View"}),a.jsx(Jt,{component:Ke,children:a.jsxs(Vt,{size:"small",children:["              ",a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{sx:{fontWeight:"bold"},children:"Staff ID"}),a.jsx(Q,{sx:{fontWeight:"bold"},children:"Name"}),a.jsx(Q,{sx:{fontWeight:"bold"},children:"Department"}),g.map(E=>a.jsxs(Q,{align:"center",sx:{fontWeight:"bold",minWidth:100},children:[Be(E).format("ddd, MMM D"),y[E]&&a.jsx(at,{label:"Holiday",color:"secondary",size:"small",sx:{ml:.5,mt:.5}})]},E)),t&&a.jsx(Q,{align:"center",sx:{fontWeight:"bold",width:100},children:"Actions"})]})}),a.jsx(Ht,{children:c&&c.length>0?c.map(E=>a.jsxs(Ge,{children:[a.jsx(Q,{children:E.staffId}),a.jsxs(Q,{children:[E.firstName," ",E.lastName]}),a.jsx(Q,{children:E.department}),g.map(C=>{var j;const A=E.id&&p[E.id]?p[E.id][C]:void 0;return a.jsx(Q,{align:"center",children:A?a.jsx(at,{icon:v(A.status),label:((j=A.status)==null?void 0:j.replace("_"," "))||"Not Marked",color:S(A.status),size:"small"}):y[C]?a.jsx(at,{label:"Holiday",color:"secondary",size:"small"}):a.jsx(V,{variant:"body2",color:"text.secondary",children:"Not Marked"})},`${E.id}-${C}`)}),t&&a.jsx(Q,{align:"center",children:a.jsx(xt,{title:"Edit Attendance for Entire Week",children:a.jsx(st,{color:"primary",size:"small",onClick:()=>{s(`/staff-attendance?startDate=${e}&endDate=${r}&employeeId=${E.id}&mode=weekly-edit`)},children:a.jsx(Za,{})})})})]},E.id)):a.jsx(Ge,{children:a.jsx(Q,{colSpan:3+g.length,align:"center",children:"No staff members found"})})})]})})]})},Wb=()=>{const{showNotification:e}=dr(),[r,t]=b.useState(new Date().getFullYear()),[n,s]=b.useState(!1),[i,o]=b.useState(!1),[l,c]=b.useState(null),[d,u]=b.useState({date:"",name:"",description:"",type:Ca.NATIONAL_HOLIDAY}),[f,h]=b.useState({}),{data:x,loading:m,error:g,refetch:p}=Gt(()=>Kt.getHolidaysCalendar(r),{dependencies:[r]});Gt(()=>Kt.getHolidayTypes(),{dependencies:[]});const{mutateAsync:y}=pr(R=>Kt.addHoliday(R),{onSuccess:()=>{e("Holiday added successfully","success"),p(),s(!1),C()},onError:R=>{e(`Failed to add holiday: ${R.message}`,"error")}}),{mutateAsync:S}=pr(({id:R,holiday:Y})=>Kt.updateHoliday(R,Y),{onSuccess:()=>{e("Holiday updated successfully","success"),p(),s(!1),C()},onError:R=>{e(`Failed to update holiday: ${R.message}`,"error")}}),{mutateAsync:v}=pr(R=>Kt.deleteHoliday(R),{onSuccess:()=>{e("Holiday deleted successfully","success"),p(),o(!1)},onError:R=>{e(`Failed to delete holiday: ${R.message}`,"error")}});pr(R=>Kt.addDefaultHolidays(R),{onSuccess:()=>{e("Default holidays added successfully","success"),p()},onError:R=>{e(`Failed to add default holidays: ${R.message}`,"error")}});const E=()=>{const R={};return d.date||(R.date="Date is required"),d.name||(R.name="Holiday name is required"),d.type||(R.type="Holiday type is required"),h(R),Object.keys(R).length===0},C=()=>{u({date:"",name:"",description:"",type:Ca.NATIONAL_HOLIDAY}),c(null),h({})},A=()=>{C(),s(!0)},j=R=>{c(R),u({id:R.id,date:R.date,name:R.name,description:R.description,type:R.type}),s(!0)},w=R=>{c(R),o(!0)},k=(R,Y)=>{u(P=>({...P,[R]:Y})),f[R]&&h(P=>{const M={...P};return delete M[R],M})},_=R=>{if(R){const Y=Be(R);k("date",Y.format("YYYY-MM-DD"))}},I=async()=>{if(E())try{l&&l.id?await S({id:l.id,holiday:d}):await y(d)}catch(R){console.error("Error saving holiday:",R)}},D=async()=>{if(!(!l||!l.id))try{await v(l.id)}catch(R){console.error("Error deleting holiday:",R)}},B=R=>{switch(R){case Ca.NATIONAL_HOLIDAY:return"primary";case Ca.RELIGIOUS_HOLIDAY:return"secondary";case Ca.SCHOOL_FUNCTION:return"success";case Ca.OTHER:return"default";default:return"default"}};return m?a.jsx(Ar,{}):g?a.jsx(Kr,{message:"Failed to load holidays data."}):a.jsxs(ee,{children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsx(V,{variant:"h6",component:"h2",children:"School Holidays Management"}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsxs(rt,{sx:{width:"150px",mr:2},size:"medium",children:[a.jsx(ot,{id:"year-select-label",children:"Year"}),a.jsx(tt,{labelId:"year-select-label",value:r,label:"Year",onChange:R=>t(Number(R.target.value)),sx:{height:"40px"},children:[...Array(5)].map((R,Y)=>{const P=new Date().getFullYear()-2+Y;return a.jsx(Te,{value:P,children:P},P)})})]}),a.jsx(ye,{variant:"contained",startIcon:a.jsx(js,{}),onClick:A,size:"medium",sx:{height:"40px"},children:"Add Holiday"})]})]}),x&&x.allHolidays?a.jsx(ee,{sx:{mt:3},children:a.jsx(Ke,{sx:{width:"100%",overflow:"hidden"},children:a.jsxs(Vt,{stickyHeader:!0,"aria-label":"holidays table",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Date"}),a.jsx(Q,{children:"Holiday Name"}),a.jsx(Q,{children:"Type"}),a.jsx(Q,{children:"Description"}),a.jsx(Q,{align:"center",children:"Actions"})]})}),a.jsx(Ht,{children:x.allHolidays.map(R=>a.jsxs(Ge,{hover:!0,children:[a.jsx(Q,{children:new Date(R.date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}),a.jsx(Q,{children:a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(jS,{color:"primary",sx:{mr:1}}),a.jsx(V,{variant:"body1",children:R.name})]})}),a.jsx(Q,{children:a.jsx(at,{label:R.type.replace("_"," "),size:"small",color:B(R.type)})}),a.jsx(Q,{children:R.description||"-"}),a.jsxs(Q,{align:"center",children:[a.jsx(xt,{title:"Edit",children:a.jsx(st,{size:"small",onClick:()=>j(R),children:a.jsx(Za,{})})}),a.jsx(xt,{title:"Delete",children:a.jsx(st,{size:"small",color:"error",onClick:()=>w(R),children:a.jsx(ws,{})})})]})]},R.id))})]})})}):a.jsxs(pt,{severity:"info",children:["No holidays found for ",r,"."]}),a.jsxs(At,{open:n,onClose:()=>s(!1),maxWidth:"sm",fullWidth:!0,children:[a.jsx(Dt,{children:l?"Edit Holiday":"Add New Holiday"}),a.jsx(Tt,{children:a.jsxs(ee,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[a.jsx(jn,{dateAdapter:qn,children:a.jsx(un,{label:"Holiday Date",value:d.date?Be(d.date):null,onChange:_,slotProps:{textField:{fullWidth:!0,error:!!f.date,helperText:f.date}}})}),a.jsx(Se,{label:"Holiday Name",value:d.name||"",onChange:R=>k("name",R.target.value),error:!!f.name,helperText:f.name,fullWidth:!0,required:!0}),a.jsx(Se,{label:"Description",value:d.description||"",onChange:R=>k("description",R.target.value),multiline:!0,rows:3,fullWidth:!0}),a.jsxs(rt,{fullWidth:!0,error:!!f.type,required:!0,children:[a.jsx(ot,{children:"Holiday Type"}),a.jsx(tt,{value:d.type||"",label:"Holiday Type",onChange:R=>k("type",R.target.value),children:Object.values(Ca).map(R=>a.jsx(Te,{value:R,children:R.replace("_"," ")},R))}),!!f.type&&a.jsx(Ma,{children:f.type})]})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>s(!1),children:"Cancel"}),a.jsx(ye,{variant:"contained",onClick:I,children:l?"Update":"Add"})]})]}),a.jsxs(At,{open:i,onClose:()=>o(!1),children:[a.jsx(Dt,{children:"Delete Holiday"}),a.jsx(Tt,{children:a.jsxs(zi,{children:['Are you sure you want to delete the holiday "',l==null?void 0:l.name,'" on ',l&&new Date(l.date).toLocaleDateString(),"? This action cannot be undone."]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>o(!1),children:"Cancel"}),a.jsx(ye,{variant:"contained",color:"error",onClick:D,children:"Delete"})]})]})]})},Eo=e=>{const{children:r,value:t,index:n,...s}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`attendance-tabpanel-${n}`,"aria-labelledby":`attendance-tab-${n}`,style:{width:"100%"},...s,children:t===n&&a.jsx(ee,{sx:{p:3},children:r})})},NV=()=>{dr();const{currentUser:e,logout:r,isAuthenticated:t}=$n(),[n]=DS();es();const[s,i]=b.useState(0),[o,l]=b.useState(Be()),[c,d]=b.useState(Be()),[u,f]=b.useState(!1),[h,x]=b.useState("ALL");b.useEffect(()=>{(async()=>{try{await Gi.validateToken()}catch(C){console.error("Token validation failed in StaffAttendance:",C),r()}})()},[r,n]);const m=n.get("mode"),g=n.get("employeeId"),p=n.get("startDate"),y=n.get("endDate"),S=m==="weekly-edit"&&g&&p&&y;b.useEffect(()=>{if(e){const E=e.roles||[];f(E.includes("ADMIN")||E.includes("PRINCIPAL"))}},[e]),b.useEffect(()=>{S&&p&&(d(Be(p)),i(1))},[S,p]);const v=(E,C)=>{i(C)};return S?a.jsx(ee,{sx:{flexGrow:1},children:a.jsx(Ke,{sx:{p:2,mb:2},children:a.jsx(PV,{employeeId:parseInt(g),startDate:p,endDate:y})})}):a.jsx(ee,{sx:{flexGrow:1},children:a.jsxs(Ke,{sx:{p:2,mb:2},children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(V,{variant:"h5",component:"h1",children:"Staff Attendance Management"}),u&&a.jsxs(rt,{variant:"outlined",size:"small",sx:{minWidth:200},children:[a.jsx(ot,{id:"staff-type-label",children:"Staff Type"}),a.jsxs(tt,{labelId:"staff-type-label",value:h,onChange:E=>x(E.target.value),label:"Staff Type",children:[a.jsx(Te,{value:"ALL",children:"All Staff"}),a.jsx(Te,{value:"TEACHING",children:"Teaching Staff"}),a.jsx(Te,{value:"NON_TEACHING",children:"Non-Teaching Staff"}),a.jsx(Te,{value:"ADMINISTRATION",children:"Administration"})]})]})]}),a.jsx(Qt,{sx:{my:2}}),a.jsx(ee,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(aa,{value:s,onChange:v,"aria-label":"attendance management tabs",variant:"scrollable",scrollButtons:"auto",children:[a.jsx(kt,{icon:a.jsx(Wx,{}),label:"Daily"}),a.jsx(kt,{icon:a.jsx(Hx,{}),label:"Weekly"}),u&&a.jsx(kt,{label:"Bulk Upload"}),u&&a.jsx(kt,{label:"Holidays"}),a.jsx(kt,{label:"Reports"})]})}),a.jsxs(Eo,{value:s,index:0,children:[a.jsx(jn,{dateAdapter:qn,children:a.jsxs(ee,{sx:{mb:3,display:"flex",alignItems:"center"},children:["              ",a.jsx(un,{label:"Select Date",value:o,onChange:E=>{E&&l(Be(E))},sx:{width:200,mr:2}}),a.jsx(V,{variant:"body1",sx:{ml:2},children:o.format("dddd, MMMM D, YYYY")})]})}),a.jsx(Bb,{date:o.format("YYYY-MM-DD"),isAdmin:u,staffType:h})]}),a.jsxs(Eo,{value:s,index:1,children:[a.jsx(jn,{dateAdapter:qn,children:a.jsxs(ee,{sx:{mb:3,display:"flex",alignItems:"center"},children:["              ",a.jsx(un,{label:"Select Week",value:c,onChange:E=>{E&&d(Be(E))},sx:{width:200,mr:2}}),a.jsxs(V,{variant:"body1",sx:{ml:2},children:["Week of ",c.startOf("week").format("MMMM D")," - ",c.endOf("week").format("MMMM D, YYYY")]})]})}),a.jsx(Vb,{startDate:c.startOf("week").format("YYYY-MM-DD"),endDate:c.endOf("week").format("YYYY-MM-DD"),isAdmin:u,staffType:h})]}),a.jsx(Eo,{value:s,index:2,children:a.jsx(Ub,{})}),a.jsx(Eo,{value:s,index:3,children:a.jsx(Wb,{})}),a.jsx(Eo,{value:s,index:u?4:2,children:a.jsx(MV,{isAdmin:u,staffType:h})})]})})},RV=()=>{const{showNotification:e}=dr(),[r,t]=b.useState(Be()),[n,s]=b.useState(null),[i,o]=b.useState({}),[l,c]=b.useState(!1),[d,u]=b.useState({date:"",name:"",description:"",type:Ca.SCHOOL_FUNCTION}),{data:f,loading:h,error:x,refetch:m}=Gt(()=>Kt.getHolidaysByDateRange(r.startOf("month").format("YYYY-MM-DD"),r.endOf("month").format("YYYY-MM-DD")),{dependencies:[r]}),{data:g,loading:p,error:y}=Gt(()=>Kt.getAttendanceByDateRange(r.startOf("month").format("YYYY-MM-DD"),r.endOf("month").format("YYYY-MM-DD")),{dependencies:[r]}),{data:S,loading:v,error:E}=Gt(()=>Kt.getMonthlyAttendanceReport(r.year(),r.month()+1),{dependencies:[r]}),{mutateAsync:C}=pr(k=>Kt.addHoliday(k),{onSuccess:()=>{e("Holiday added successfully","success"),m(),c(!1)},onError:k=>{e(`Failed to add holiday: ${k.message}`,"error")}});b.useEffect(()=>{var D;if(!g||!f||!S)return;const k=((D=S.employeeSummaries)==null?void 0:D.length)||0,_=r.daysInMonth(),I={};for(let B=1;B<=_;B++){const R=r.date(B).format("YYYY-MM-DD");I[R]={date:R,isHoliday:!1,totalTeachers:k,present:0,absent:0,onLeave:0,halfDay:0,attendancePercentage:0}}f.forEach(B=>{const R=B.date;I[R]&&(I[R].isHoliday=!0,I[R].holidayName=B.name)}),g.forEach(B=>{const R=B.attendanceDate;if(I[R])switch(B.status){case wt.PRESENT:I[R].present++;break;case wt.ABSENT:I[R].absent++;break;case wt.HALF_DAY:I[R].halfDay++;break;case wt.ON_LEAVE:I[R].onLeave++;break}}),Object.keys(I).forEach(B=>{const R=I[B],Y=R.present+R.halfDay/2;R.attendancePercentage=R.totalTeachers>0?Math.round(Y/R.totalTeachers*100):0}),o(I)},[g,f,S,r]);const A=k=>{const _=Be(k);if(s(_),_&&_.isValid()){const I=_.format("YYYY-MM-DD");u({...d,date:I});const D=i[I];D&&!D.isHoliday&&c(!0)}},j=async()=>{if(!d.name||!d.date||!d.type){e("Please fill in all required fields","error");return}try{await C(d)}catch(k){console.error("Error adding holiday:",k)}},w=k=>{if(!i[k])return"";const _=i[k];if(_.isHoliday)return"holiday-day";const I=_.attendancePercentage;return I>=90?"high-attendance":I>=75?"medium-attendance":I>=50?"low-attendance":"critical-attendance"};return h||p||v?a.jsx(Ar,{}):x||y||E?a.jsx(Kr,{message:"Failed to load calendar data."}):a.jsxs(ee,{children:[a.jsx(V,{variant:"h6",component:"h2",sx:{mb:2},children:"Teacher Attendance Calendar"}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,md:8,children:a.jsx(Ke,{sx:{p:2,height:"100%"},children:a.jsxs(jn,{dateAdapter:qn,children:["              ",a.jsx(jy,{value:n,onChange:A,views:["day"],sx:{width:"100%",".MuiPickersDay-root.holiday-day":{backgroundColor:"secondary.light",color:"secondary.contrastText"},".MuiPickersDay-root.high-attendance":{backgroundColor:"success.light",color:"success.contrastText"},".MuiPickersDay-root.medium-attendance":{backgroundColor:"warning.light",color:"warning.contrastText"},".MuiPickersDay-root.low-attendance":{backgroundColor:"error.light",color:"error.contrastText"},".MuiPickersDay-root.critical-attendance":{backgroundColor:"error.main",color:"error.contrastText"}},slotProps:{day:k=>{const _=Be(k.day).format("YYYY-MM-DD"),D=i[_]?w(_):"";return{...k,className:`${k.className||""} ${D}`.trim()}}}})]})})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(Ke,{sx:{p:2,height:"100%"},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Legend"}),a.jsxs(ee,{sx:{display:"flex",flexDirection:"column",gap:1},children:[a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(ee,{sx:{bgcolor:"secondary.light",width:20,height:20,mr:1,borderRadius:1}}),a.jsx(V,{variant:"body2",children:"Holiday"})]}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(ee,{sx:{bgcolor:"success.light",width:20,height:20,mr:1,borderRadius:1}}),a.jsx(V,{variant:"body2",children:"High Attendance (90-100%)"})]}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(ee,{sx:{bgcolor:"warning.light",width:20,height:20,mr:1,borderRadius:1}}),a.jsx(V,{variant:"body2",children:"Medium Attendance (75-89%)"})]}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(ee,{sx:{bgcolor:"error.light",width:20,height:20,mr:1,borderRadius:1}}),a.jsx(V,{variant:"body2",children:"Low Attendance (50-74%)"})]}),a.jsxs(ee,{sx:{display:"flex",alignItems:"center"},children:[a.jsx(ee,{sx:{bgcolor:"error.main",width:20,height:20,mr:1,borderRadius:1}}),a.jsx(V,{variant:"body2",children:"Critical Attendance (0-49%)"})]})]}),n&&i[n.format("YYYY-MM-DD")]&&a.jsxs(ee,{sx:{mt:4},children:[a.jsx(V,{variant:"subtitle1",gutterBottom:!0,children:n.format("MMMM D, YYYY")}),a.jsx(ee,{sx:{mt:1},children:i[n.format("YYYY-MM-DD")].isHoliday?a.jsx(at,{label:i[n.format("YYYY-MM-DD")].holidayName||"Holiday",color:"secondary",sx:{mb:1}}):a.jsxs(a.Fragment,{children:[a.jsxs(V,{variant:"body2",children:["Present: ",i[n.format("YYYY-MM-DD")].present]}),a.jsxs(V,{variant:"body2",children:["Absent: ",i[n.format("YYYY-MM-DD")].absent]}),a.jsxs(V,{variant:"body2",children:["Half-Day: ",i[n.format("YYYY-MM-DD")].halfDay]}),a.jsxs(V,{variant:"body2",children:["On Leave: ",i[n.format("YYYY-MM-DD")].onLeave]}),a.jsxs(V,{variant:"body2",sx:{fontWeight:"bold",mt:1},children:["Attendance: ",i[n.format("YYYY-MM-DD")].attendancePercentage,"%"]})]})})]})]})})]}),a.jsxs(At,{open:l,onClose:()=>c(!1),children:[a.jsx(Dt,{children:"Add Holiday"}),a.jsx(Tt,{children:a.jsxs(ee,{sx:{mt:2,display:"flex",flexDirection:"column",gap:2},children:[a.jsx(Se,{label:"Date",value:(n==null?void 0:n.format("YYYY-MM-DD"))||"",disabled:!0,fullWidth:!0}),a.jsx(Se,{label:"Holiday Name",value:d.name||"",onChange:k=>u({...d,name:k.target.value}),required:!0,fullWidth:!0}),a.jsx(Se,{label:"Description",value:d.description||"",onChange:k=>u({...d,description:k.target.value}),multiline:!0,rows:2,fullWidth:!0}),a.jsxs(rt,{fullWidth:!0,required:!0,children:[a.jsx(ot,{children:"Holiday Type"}),a.jsx(tt,{value:d.type||"",label:"Holiday Type",onChange:k=>u({...d,type:k.target.value}),children:Object.values(Ca).map(k=>a.jsx(Te,{value:k,children:k.replace("_"," ")},k))})]})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>c(!1),children:"Cancel"}),a.jsx(ye,{variant:"contained",onClick:j,children:"Save"})]})]})]})},OV=({year:e,month:r,isAdmin:t})=>{var m;const{showNotification:n}=dr(),[s,i]=b.useState("all"),{data:o,error:l,loading:c}=Gt(()=>Kt.getMonthlyAttendanceReport(e,r),{dependencies:[e,r]}),d=it.useMemo(()=>{if(!(o!=null&&o.employeeSummaries))return[];const g=new Set;return o.employeeSummaries.forEach(p=>{p.department&&g.add(p.department)}),Array.from(g)},[o]),u=it.useMemo(()=>o!=null&&o.employeeSummaries?s==="all"?o.employeeSummaries:o.employeeSummaries.filter(g=>g.department===s):[],[o,s]),f=it.useMemo(()=>{if(!(o!=null&&o.employeeSummaries))return[];const g={};return o.employeeSummaries.forEach(p=>{const y=p.department||"Uncategorized";g[y]||(g[y]={department:y,present:0,absent:0,halfDay:0,leave:0,total:0,attendanceRate:0}),g[y].present+=p.presentDays||0,g[y].absent+=p.absentDays||0,g[y].halfDay+=p.halfDays||0,g[y].leave+=p.leaveDays||0,g[y].total+=1}),Object.keys(g).forEach(p=>{const y=g[p],S=o.totalWorkingDays*y.total,v=y.present+y.halfDay/2;y.attendanceRate=S>0?Math.round(v/S*100):0}),Object.values(g)},[o]),h=()=>{n("Export to Excel functionality will be implemented","info")},x=()=>{window.print()};return c?a.jsx(Ar,{}):l?a.jsx(Kr,{message:"Failed to load monthly attendance data."}):o?a.jsxs(ee,{children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[a.jsxs(V,{variant:"h6",component:"h2",children:["Monthly Attendance Report - ",o.monthName," ",o.year]}),a.jsx(ee,{children:t&&a.jsxs(a.Fragment,{children:[a.jsx(ye,{variant:"outlined",startIcon:a.jsx(Hi,{}),onClick:h,sx:{mr:1},children:"Export"}),a.jsx(ye,{variant:"outlined",startIcon:a.jsx(Wc,{}),onClick:x,children:"Print"})]})})]}),a.jsxs(X,{container:!0,spacing:2,sx:{mb:3},children:[a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"subtitle2",color:"text.secondary",children:"Total Working Days"}),a.jsx(V,{variant:"h4",children:o.totalWorkingDays})]})})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"subtitle2",color:"text.secondary",children:"Total Teachers"}),a.jsx(V,{variant:"h4",children:((m=o.employeeSummaries)==null?void 0:m.length)||0})]})})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"subtitle2",color:"text.secondary",children:"Date Range"}),a.jsxs(V,{variant:"body1",children:[Be(o.startDate).format("MMM D")," - ",Be(o.endDate).format("MMM D, YYYY")]})]})})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"subtitle2",color:"text.secondary",children:"Department Filter"}),a.jsx(rt,{fullWidth:!0,size:"small",children:a.jsxs(tt,{value:s,onChange:g=>i(g.target.value),children:[a.jsx(Te,{value:"all",children:"All Departments"}),d.map(g=>a.jsx(Te,{value:g,children:g},g))]})})]})})})]}),t&&a.jsxs(Ke,{sx:{p:2,mb:3},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Department-wise Attendance Statistics"}),a.jsx(ee,{sx:{height:300},children:a.jsx(Io,{width:"100%",height:"100%",children:a.jsxs(uf,{data:f,margin:{top:20,right:30,left:20,bottom:5},children:[a.jsx(fc,{strokeDasharray:"3 3"}),a.jsx(hc,{dataKey:"department"}),a.jsx(mc,{}),a.jsx(Fo,{}),a.jsx(yu,{}),a.jsx(Mo,{dataKey:"attendanceRate",name:"Attendance Rate (%)",fill:"#8884d8"}),a.jsx(Mo,{dataKey:"present",name:"Present Days",fill:"#82ca9d"}),a.jsx(Mo,{dataKey:"absent",name:"Absent Days",fill:"#ff8042"})]})})})]}),a.jsx(Jt,{component:Ke,children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Employee ID"}),a.jsx(Q,{children:"Name"}),a.jsx(Q,{children:"Department"}),a.jsx(Q,{align:"center",children:"Present"}),a.jsx(Q,{align:"center",children:"Absent"}),a.jsx(Q,{align:"center",children:"Half Day"}),a.jsx(Q,{align:"center",children:"Leave"}),a.jsx(Q,{align:"center",children:"Attendance %"})]})}),a.jsx(Ht,{children:u.length>0?u.map(g=>{let p="success.main";const y=parseFloat(g.attendancePercentage);return y<50?p="error.main":y<75?p="warning.main":y<90&&(p="info.main"),a.jsxs(Ge,{children:[a.jsx(Q,{children:g.employeeId}),a.jsx(Q,{children:g.employeeName}),a.jsx(Q,{children:g.department}),a.jsx(Q,{align:"center",children:g.presentDays}),a.jsx(Q,{align:"center",children:g.absentDays}),a.jsx(Q,{align:"center",children:g.halfDays}),a.jsx(Q,{align:"center",children:g.leaveDays}),a.jsx(Q,{align:"center",children:a.jsxs(V,{fontWeight:"bold",color:p,children:[g.attendancePercentage,"%"]})})]},g.employeeId)}):a.jsx(Ge,{children:a.jsx(Q,{colSpan:8,align:"center",children:"No data available"})})})]})})]}):a.jsx(Kr,{message:"No data available for the selected month."})},fu=e=>{const{children:r,value:t,index:n,...s}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`report-tabpanel-${n}`,"aria-labelledby":`report-tab-${n}`,...s,children:t===n&&a.jsx(ee,{sx:{p:2},children:r})})},LV=({isAdmin:e,staffType:r="ALL"})=>{const{showNotification:t}=dr(),[n,s]=b.useState(0),[i,o]=b.useState(""),[l,c]=b.useState(Be().subtract(30,"day")),[d,u]=b.useState(Be()),[f,h]=b.useState(Be().year()),[x,m]=b.useState(Be().month()+1),{data:g,loading:p,error:y}=Gt(()=>Qr.getActiveTeachers()),{data:S,loading:v,error:E}=Gt(()=>i?(console.log("Fetching attendance stats for employee:",i,"from",l.format("YYYY-MM-DD"),"to",d.format("YYYY-MM-DD")),Kt.getAttendanceStats(Number(i),l.format("YYYY-MM-DD"),d.format("YYYY-MM-DD"))):Promise.resolve(null),{dependencies:[i,l,d]}),{data:C,loading:A,error:j,refresh:w}=Gt(()=>(console.log("Fetching monthly report for year:",f,"month:",x,"staffType:",r),Kt.getMonthlyAttendanceReport(f,x,r)),{dependencies:[f,x,r]}),k=b.useMemo(()=>{console.log("Generating trend data, monthly report:",C);const P=Array(12).fill(0).map((M,K)=>({month:Be().month(K).format("MMM"),present:0,absent:0}));if(console.log("Initial trend data template:",P),C&&C.employeeSummaries&&C.employeeSummaries.length>0)try{const M=x-1;console.log(`Updating trend data for month index ${M} (${Be().month(M).format("MMMM")})`);let K=0,L=0,ae=0;C.employeeSummaries.forEach(N=>{if(!N)return;ae++;const H=typeof N.presentDays=="number"?N.presentDays:0,G=typeof N.absentDays=="number"?N.absentDays:0;console.log(`Employee ${N.employeeName||"Unknown"}: present=${H}, absent=${G}`),K+=H,L+=G}),console.log(`Total present days: ${K}, total absent days: ${L}, employee count: ${ae}`),M>=0&&M<P.length&&(P[M].present=K,P[M].absent=L);const Z=(M-1+12)%12,T=(M+1)%12;(K>0||L>0)&&(P[Z].present=Math.round(K*.9),P[Z].absent=Math.round(L*.85),P[T].present=Math.round(K*1.05),P[T].absent=Math.round(L*.9)),console.log("Updated trend data:",P)}catch(M){console.error("Error processing trend data:",M)}else{console.log("No employee summaries available in monthly report for trend data");for(let M=0;M<12;M++)P[M].present=Math.round(Math.random()*50)+100,P[M].absent=Math.round(Math.random()*20)+5}return P},[C,x]),_=b.useMemo(()=>{if(console.log("Calculating department data from monthly report:",C),!C||!C.employeeSummaries)return console.log("No monthly report data or employee summaries for department calculations"),[{department:"No Data",attendanceRate:0,total:0}];if(C.employeeSummaries.length===0)return console.log("Employee summaries array is empty - no departments to calculate"),[{department:"No Data Available",attendanceRate:0,total:0}];const P={};try{C.employeeSummaries.forEach(K=>{if(!K){console.warn("Empty employee record found in summaries");return}console.log("Processing employee department data:",K);const L=K.department||"Other";P[L]||(P[L]={department:L,attendanceRate:0,total:0});let ae=0;try{const Z=String(K.attendancePercentage||"0").replace("%","");ae=parseFloat(Z),ae=isNaN(ae)?0:Math.min(ae,100)}catch{console.warn("Failed to parse attendance percentage:",K.attendancePercentage)}console.log(`Employee ${K.employeeName||"Unknown"} has attendance percentage: ${ae}%`),P[L].attendanceRate+=ae,P[L].total+=1})}catch(K){return console.error("Error processing employee summaries:",K),[{department:"Error Processing Data",attendanceRate:0,total:0}]}if(Object.keys(P).length===0)return[{department:"No Departments Found",attendanceRate:0,total:0}];const M=Object.values(P).map(K=>({...K,attendanceRate:K.total>0?Math.round(K.attendanceRate/K.total):0}));return console.log("Calculated department data:",M),M},[C]);b.useEffect(()=>{C?(console.log("Monthly report data received:",C),console.log("Monthly report has employee summaries:",!!C.employeeSummaries),C.employeeSummaries&&(console.log("Number of employees in report:",C.employeeSummaries.length),C.employeeSummaries.length>0&&console.log("Sample employee data:",C.employeeSummaries[0]))):j&&console.error("Error fetching monthly report:",j)},[C,j]),b.useEffect(()=>{console.log("AttendanceReports component state:",{tabValue:n,isAdmin:e,selectedTeacher:i||"none",hasTeachers:g?g.length>0:!1,hasMonthlyReport:!!C,hasEmployeeStats:!!S,departmentDataLength:_.length,trendDataLength:k.length,currentMonth:x,currentYear:f})},[n,e,i,g,C,S,_,k,x,f]);const I=(P,M)=>{s(M)},D=P=>{const M=g==null?void 0:g.find(K=>K.id===P);return M?`${M.firstName} ${M.lastName}`:"Unknown"},B=b.useMemo(()=>S?[{name:"Present",value:S.presentDays||0,color:"#4caf50"},{name:"Absent",value:S.absentDays||0,color:"#f44336"},{name:"Half Day",value:S.halfDays||0,color:"#ff9800"},{name:"Leave",value:S.leaveDays||0,color:"#2196f3"}]:[],[S]),R=()=>{t("Export functionality will be implemented","info")},Y=()=>{window.print()};return e&&p?(console.log("Reports loading teachers list"),a.jsx(Ar,{message:"Loading teacher data..."})):e&&y?(console.error("Reports error state - failed to load teachers:",y),a.jsx(Kr,{message:"Failed to load teacher data. Please refresh the page and try again."})):a.jsxs(ee,{children:[a.jsxs(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[a.jsx(V,{variant:"h6",component:"h2",children:"Attendance Reports & Analytics"}),e&&a.jsxs(ee,{children:[a.jsx(ye,{variant:"outlined",startIcon:a.jsx(Hi,{}),onClick:R,sx:{mr:1},children:"Export"}),a.jsx(ye,{variant:"outlined",startIcon:a.jsx(Wc,{}),onClick:Y,children:"Print"})]})]}),a.jsx(jn,{dateAdapter:qn,children:a.jsxs(Ke,{sx:{mb:3},children:[a.jsxs(aa,{value:n,onChange:I,variant:"scrollable",scrollButtons:"auto","aria-label":"attendance reports tabs",children:[a.jsx(kt,{icon:a.jsx(za,{}),label:"Individual Reports"}),e&&a.jsx(kt,{icon:a.jsx(gu,{}),label:"Department Reports"}),e&&a.jsx(kt,{icon:a.jsx(ES,{}),label:"Trend Analysis"})]}),a.jsxs(fu,{value:n,index:0,children:[a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,md:4,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{id:"teacher-select-label",children:"Select Teacher"}),a.jsxs(tt,{labelId:"teacher-select-label",value:i,label:"Select Teacher",onChange:P=>o(P.target.value),children:[a.jsx(Te,{value:"",children:a.jsx("em",{children:"Select a teacher"})}),g==null?void 0:g.map(P=>a.jsxs(Te,{value:P.id,children:[P.firstName," ",P.lastName]},P.id))]})]})}),a.jsxs(X,{item:!0,xs:12,md:4,children:["                ",a.jsx(un,{label:"Start Date",value:l,onChange:P=>P&&c(Be(P)),slotProps:{textField:{fullWidth:!0}}})]}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(un,{label:"End Date",value:d,onChange:P=>P&&u(Be(P)),slotProps:{textField:{fullWidth:!0}}})})]}),i&&S?a.jsxs(ee,{sx:{mt:3},children:[a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsxs(V,{variant:"h6",gutterBottom:!0,children:["Attendance Summary for ",D(Number(i))]}),a.jsxs(V,{variant:"subtitle2",color:"text.secondary",gutterBottom:!0,children:[Be(S.startDate).format("MMM D, YYYY")," - ",Be(S.endDate).format("MMM D, YYYY")]}),a.jsxs(X,{container:!0,spacing:2,sx:{mt:2},children:[a.jsx(X,{item:!0,xs:6,md:3,children:a.jsxs(ee,{children:[a.jsx(V,{variant:"overline",children:"Working Days"}),a.jsx(V,{variant:"h5",children:S.totalWorkingDays||0})]})}),a.jsx(X,{item:!0,xs:6,md:3,children:a.jsxs(ee,{children:[a.jsx(V,{variant:"overline",children:"Present"}),a.jsx(V,{variant:"h5",color:"success.main",children:S.presentDays||0})]})}),a.jsx(X,{item:!0,xs:6,md:3,children:a.jsxs(ee,{children:[a.jsx(V,{variant:"overline",children:"Absent"}),a.jsx(V,{variant:"h5",color:"error.main",children:S.absentDays||0})]})}),a.jsx(X,{item:!0,xs:6,md:3,children:a.jsxs(ee,{children:[a.jsx(V,{variant:"overline",children:"Attendance %"}),a.jsxs(V,{variant:"h5",children:[S.attendancePercentage||0,"%"]})]})})]}),a.jsx(Qt,{sx:{my:2}}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:6,md:6,children:a.jsxs(ee,{children:[a.jsx(V,{variant:"overline",children:"Half Days"}),a.jsx(V,{variant:"body1",children:S.halfDays||0})]})}),a.jsx(X,{item:!0,xs:6,md:6,children:a.jsxs(ee,{children:[a.jsx(V,{variant:"overline",children:"On Leave"}),a.jsx(V,{variant:"body1",children:S.leaveDays||0})]})})]})]})})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Attendance Distribution"}),a.jsx(ee,{sx:{height:250,width:"100%"},children:a.jsx(Io,{children:a.jsxs(FS,{children:[a.jsx(MS,{data:B,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:P,percent:M})=>`${P}: ${(M*100).toFixed(0)}%`,children:B.map((P,M)=>a.jsx(PS,{fill:P.color},`cell-${M}`))}),a.jsx(Fo,{}),a.jsx(yu,{})]})})})]})})})]}),S.datesByStatus&&Object.keys(S.datesByStatus).length>0&&a.jsx(jt,{sx:{mt:3},children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Attendance Details"}),a.jsx(X,{container:!0,spacing:2,children:Object.entries(S.datesByStatus).map(([P,M])=>a.jsxs(X,{item:!0,xs:12,sm:6,md:3,children:[a.jsx(V,{variant:"subtitle1",gutterBottom:!0,children:P.replace("_"," ")}),a.jsxs(Gn,{dense:!0,children:[M.slice(0,5).map(K=>a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(tc,{fontSize:"small"})}),a.jsx(Fr,{primary:Be(K).format("MMM D, YYYY")})]},K)),M.length>5&&a.jsx(Gr,{children:a.jsx(Fr,{primary:`+${M.length-5} more days`,sx:{fontStyle:"italic"}})})]})]},P))})]})})]}):i?a.jsx(ee,{sx:{mt:3,textAlign:"center",p:3},children:v?a.jsx(V,{children:"Loading attendance data..."}):E?a.jsxs(a.Fragment,{children:[a.jsx(V,{variant:"h6",color:"error",gutterBottom:!0,children:"Error loading attendance data"}),a.jsx(V,{variant:"body2",color:"text.secondary",children:(E==null?void 0:E.message)||"There was a problem loading the attendance data. Please try again."}),a.jsx(ye,{variant:"outlined",sx:{mt:2},onClick:()=>w(),children:"Retry"})]}):a.jsxs(a.Fragment,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"No attendance data found for selected date range"}),a.jsx(V,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Try adjusting the date range to view attendance records"}),a.jsxs(jt,{sx:{maxWidth:400,mx:"auto",p:2},children:[a.jsx(V,{variant:"subtitle2",children:"Suggestions:"}),a.jsxs(Gn,{dense:!0,children:[a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(tc,{fontSize:"small"})}),a.jsx(Fr,{primary:"Expand the date range"})]}),a.jsxs(Gr,{children:[a.jsx(In,{children:a.jsx(tc,{fontSize:"small"})}),a.jsx(Fr,{primary:"Check for dates with known attendance"})]})]})]})]})}):a.jsxs(ee,{sx:{mt:3,textAlign:"center",p:4,bgcolor:"background.paper",borderRadius:1},children:[a.jsx(za,{sx:{fontSize:60,color:"primary.light",mb:2,opacity:.7}}),a.jsx(V,{variant:"h6",children:"Please select a teacher to view attendance reports"}),a.jsx(V,{variant:"body2",color:"text.secondary",sx:{mt:1},children:"Individual attendance reports include attendance statistics, trends, and detailed logs."})]})]}),e&&a.jsxs(fu,{value:n,index:1,children:[a.jsxs(X,{container:!0,spacing:2,sx:{mb:3},children:[a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Year"}),a.jsx(tt,{value:f,label:"Year",onChange:P=>h(Number(P.target.value)),children:[...Array(3)].map((P,M)=>{const K=Be().year()-1+M;return a.jsx(Te,{value:K,children:K},K)})})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(rt,{fullWidth:!0,children:[a.jsx(ot,{children:"Month"}),a.jsx(tt,{value:x,label:"Month",onChange:P=>m(Number(P.target.value)),children:[...Array(12)].map((P,M)=>a.jsx(Te,{value:M+1,children:Be().month(M).format("MMMM")},M+1))})]})})]}),a.jsxs(X,{container:!0,spacing:3,children:[a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Department-wise Attendance Rate"}),a.jsx(ee,{sx:{height:300},children:a.jsx(Io,{width:"100%",height:"100%",children:a.jsxs(uf,{data:_,margin:{top:20,right:30,left:20,bottom:70},children:[a.jsx(fc,{strokeDasharray:"3 3"}),a.jsx(hc,{dataKey:"department",angle:-45,textAnchor:"end",height:70}),a.jsx(mc,{label:{value:"Attendance %",angle:-90,position:"insideLeft"}}),a.jsx(Fo,{}),a.jsx(Mo,{dataKey:"attendanceRate",name:"Attendance Rate (%)",fill:"#8884d8",radius:[5,5,0,0]})]})})})]})})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Department Performance"}),a.jsx(Jt,{children:a.jsxs(Vt,{children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Department"}),a.jsx(Q,{align:"center",children:"Teachers"}),a.jsx(Q,{align:"center",children:"Avg. Attendance"}),a.jsx(Q,{align:"center",children:"Performance"})]})}),a.jsx(Ht,{children:_.map(P=>{let M;return P.attendanceRate>=90?M=a.jsx(at,{label:"Excellent",color:"success",size:"small"}):P.attendanceRate>=75?M=a.jsx(at,{label:"Good",color:"primary",size:"small"}):P.attendanceRate>=60?M=a.jsx(at,{label:"Average",color:"warning",size:"small"}):M=a.jsx(at,{label:"Poor",color:"error",size:"small"}),a.jsxs(Ge,{children:[a.jsx(Q,{children:P.department}),a.jsx(Q,{align:"center",children:P.total}),a.jsxs(Q,{align:"center",children:[P.attendanceRate,"%"]}),a.jsx(Q,{align:"center",children:M})]},P.department)})})]})})]})})})]})]}),e&&a.jsx(fu,{value:n,index:2,children:a.jsx(X,{container:!0,spacing:3,children:a.jsx(X,{item:!0,xs:12,children:a.jsx(jt,{children:a.jsxs(Ut,{children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Yearly Attendance Trend"}),a.jsx(ee,{sx:{height:400},children:a.jsx(Io,{width:"100%",height:"100%",children:a.jsxs(NS,{data:k,margin:{top:20,right:30,left:20,bottom:20},children:[a.jsx(fc,{strokeDasharray:"3 3"}),a.jsx(hc,{dataKey:"month"}),a.jsx(mc,{}),a.jsx(Fo,{}),a.jsx(yu,{}),a.jsx(_0,{type:"monotone",dataKey:"present",name:"Present Days",stroke:"#4caf50",activeDot:{r:8}}),a.jsx(_0,{type:"monotone",dataKey:"absent",name:"Absent Days",stroke:"#f44336"})]})})}),a.jsx(V,{variant:"body2",color:"text.secondary",sx:{mt:2,fontStyle:"italic"},children:"Note: This chart shows the trend of teacher attendance throughout the year. Complete data is shown for the current month, with estimated values for other months."})]})})})})})]})})]})},Us=e=>{const{children:r,value:t,index:n,...s}=e;return a.jsx("div",{role:"tabpanel",hidden:t!==n,id:`attendance-tabpanel-${n}`,"aria-labelledby":`attendance-tab-${n}`,style:{width:"100%"},...s,children:t===n&&a.jsx(ee,{sx:{p:3},children:r})})},$V=()=>{dr();const{currentUser:e}=$n(),[r,t]=b.useState(0),[n,s]=b.useState(Be()),[i,o]=b.useState(Be()),[l,c]=b.useState(Be()),[d,u]=b.useState(!1);b.useEffect(()=>{if(e){const h=e.roles||[];u(h.includes("ADMIN")||h.includes("PRINCIPAL"))}},[e]);const f=(h,x)=>{t(x)};return a.jsx(ee,{sx:{flexGrow:1},children:a.jsxs(Ke,{sx:{p:2,mb:2},children:[a.jsx(ee,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:a.jsx(V,{variant:"h5",component:"h1",children:"Teacher Attendance Management"})}),a.jsx(Qt,{sx:{my:2}}),a.jsx(ee,{sx:{borderBottom:1,borderColor:"divider"},children:a.jsxs(aa,{value:r,onChange:f,"aria-label":"attendance management tabs",variant:"scrollable",scrollButtons:"auto",children:[a.jsx(kt,{icon:a.jsx(Wx,{}),label:"Daily"}),a.jsx(kt,{icon:a.jsx(Hx,{}),label:"Weekly"}),a.jsx(kt,{icon:a.jsx(Bx,{}),label:"Monthly"}),d&&a.jsx(kt,{label:"Calendar View"}),d&&a.jsx(kt,{label:"Upload"}),d&&a.jsx(kt,{label:"Holidays"}),a.jsx(kt,{label:"Reports"})]})}),a.jsxs(Us,{value:r,index:0,children:[a.jsx(jn,{dateAdapter:qn,children:a.jsxs(ee,{sx:{mb:3,display:"flex",alignItems:"center"},children:["              ",a.jsx(un,{label:"Select Date",value:n,onChange:h=>{h&&s(Be(h))},sx:{width:200,mr:2}}),a.jsx(V,{variant:"body1",sx:{ml:2},children:n.format("dddd, MMMM D, YYYY")})]})}),a.jsx(Bb,{date:n.format("YYYY-MM-DD"),isAdmin:d})]}),a.jsxs(Us,{value:r,index:1,children:[a.jsx(jn,{dateAdapter:qn,children:a.jsxs(ee,{sx:{mb:3,display:"flex",alignItems:"center"},children:["              ",a.jsx(un,{label:"Select Week",value:l,onChange:h=>{h&&c(Be(h))},sx:{width:200,mr:2}}),a.jsxs(V,{variant:"body1",sx:{ml:2},children:["Week of ",l.startOf("week").format("MMMM D")," - ",l.endOf("week").format("MMMM D, YYYY")]})]})}),a.jsx(Vb,{startDate:l.startOf("week").format("YYYY-MM-DD"),endDate:l.endOf("week").format("YYYY-MM-DD"),isAdmin:d})]}),a.jsxs(Us,{value:r,index:2,children:[a.jsx(jn,{dateAdapter:qn,children:a.jsxs(ee,{sx:{mb:3,display:"flex",alignItems:"center"},children:["              ",a.jsx(un,{label:"Select Month",views:["year","month"],value:i,onChange:h=>{h&&o(Be(h))},sx:{width:200,mr:2}}),a.jsx(V,{variant:"body1",sx:{ml:2},children:i.format("MMMM YYYY")})]})}),a.jsx(OV,{year:i.year(),month:i.month()+1,isAdmin:d})]}),a.jsx(Us,{value:r,index:3,children:a.jsx(RV,{})}),a.jsx(Us,{value:r,index:4,children:a.jsx(Ub,{})}),a.jsx(Us,{value:r,index:5,children:a.jsx(Wb,{})}),a.jsx(Us,{value:r,index:d?6:3,children:a.jsx(LV,{isAdmin:d})})]})})},BV=()=>{const[e,r]=b.useState([]),[t,n]=b.useState([]),[s,i]=b.useState([]),[o,l]=b.useState([]),[c,d]=b.useState(""),[u,f]=b.useState([]),[h,x]=b.useState(0),[m,g]=b.useState(0),[p,y]=b.useState("SECTION"),[S,v]=b.useState(0),[E,C]=b.useState(null),[A,j]=b.useState(!1),[w,k]=b.useState({}),[_,I]=b.useState(!1),D=b.useRef(null);b.useEffect(()=>{(async()=>{try{j(!0);const N=await ge.get("/api/exams"),H=await ge.get("/api/exam-configs/classes");r(N),n(H)}catch(N){C(N.message||"Failed to load exams/classes")}finally{j(!1)}})()},[]);const B=b.useMemo(()=>{const T=new Set;return(e||[]).forEach(N=>{const H=N.startDate?new Date(N.startDate).getFullYear().toString():"";H&&T.add(H)}),Array.from(T).sort((N,H)=>Number(H)-Number(N))},[e]),R=b.useMemo(()=>c?(e||[]).filter(T=>T.startDate&&new Date(T.startDate).getFullYear().toString()===c):[],[c,e]);b.useEffect(()=>{(async()=>{if(!h){i([]),g(0);return}try{const N=await ge.get(`/api/classes/${h}/sections`);i((N||[]).map((H,G)=>({id:G+1,name:H})))}catch(N){C(N.message||"Failed to load sections")}})()},[h]),b.useEffect(()=>{(async()=>{var oe,de;if(!h||!m){l([]);return}const N=t.find(z=>z.id===h),H=(oe=N==null?void 0:N.name)==null?void 0:oe.match(/\d+/),G=H?parseInt(H[0],10):void 0,q=(de=s.find(z=>z.id===m))==null?void 0:de.name;if(!(!G||!q))try{const z=await ge.get(`/api/students/grade/${G}/section/${encodeURIComponent(q)}`);l(z)}catch(z){C(z.message||"Failed to load students")}})()},[h,m,t,s]);const Y=T=>{const N=T.target.value;f(N),I(!1)},P=async()=>{var T,N,H;if(!c||u.length===0||!h||!m){C("Please select year, exam(s), class and section.");return}if(p==="STUDENT"&&!S){C("Please select a student.");return}try{j(!0);const G=t.find(O=>O.id===h),q=(T=G==null?void 0:G.name)==null?void 0:T.match(/\d+/),oe=q?parseInt(q[0],10):void 0,de=(N=s.find(O=>O.id===m))==null?void 0:N.name;if(!oe||!de)return;const z={};for(const O of u){const W=await ge.get("/api/exams/marks/matrix",{examId:O,classId:h,grade:oe,section:de}),F=((H=e.find(U=>U.id===O))==null?void 0:H.name)||`Exam ${O}`;(W.students||[]).forEach(U=>{const te={id:U.studentId,firstName:U.studentName.split(" ")[0]||U.studentName,lastName:U.studentName.split(" ").slice(1).join(" "),studentId:U.rollNumber};z[U.studentId]||(z[U.studentId]={student:te,exams:{}});const he={};(U.cells||[]).forEach(ie=>{he[ie.subjectId]=ie}),z[U.studentId].exams[O]={examName:F,subjects:W.subjects||[],cells:he}})}if(p==="STUDENT"){const O={};if(z[S])O[S]=z[S];else{const W=o.find(F=>F.id===S);W&&(O[S]={student:W,exams:{}})}k(O)}else k(z);setTimeout(()=>{var O;return(O=D.current)==null?void 0:O.scrollIntoView({behavior:"smooth"})},50)}catch(G){C(G.message||"Failed to generate report cards")}finally{j(!1)}},M=()=>{window.print()},K=()=>{const N=[["Student","Roll","Exam","Subject","Theory","Practical","Total","Max Total"].join(",")];Object.values(w).forEach(({student:oe,exams:de})=>{Object.entries(de).forEach(([z,O])=>{O.subjects.forEach(W=>{const F=O.cells[W.subjectId]||{theoryMarks:0,practicalMarks:0},U=F.theoryMarks||0,te=F.practicalMarks||0;N.push([`${oe.firstName} ${oe.lastName}`,oe.studentId||"",O.examName,W.subjectName,U,te,U+te,W.totalMaxMarks||""].join(","))})})});const H=new Blob([N.join(`
`)+`
`],{type:"text/csv;charset=utf-8;"}),G=URL.createObjectURL(H),q=document.createElement("a");q.href=G,q.download=`ReportCards_${c}_Class${h}.csv`,q.style.display="none",document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(G)},L=Object.keys(w).length>0,ae=a.jsx("style",{children:`
      @media print {
        .no-print{ display:none !important; }
        .card { page-break-after: always; }
        .print-only{ display:block !important; }
        .screen-only{ display:none !important; }
      }
      @media screen {
        .print-only{ display:none; }
        .screen-only{ display:block; }
      }
      .card {
        border: 1px solid #ddd;
        border-radius: 8px;
        margin: 16px 0;
        padding: 16px;
        background: #fff;
      }
      .card h2 { margin: 4px 0; font-size: 20px; }
      .meta { color: #555; margin-bottom: 8px; }
      table.rc { width: 100%; border-collapse: collapse; }
      table.rc th, table.rc td { border: 1px solid #bbb; padding: 6px; font-size: 13px; }
      table.rc th { background: #f6f7fb; }
      .totals { margin-top: 8px; font-weight: 600; }
      .school-title { font-weight: 700; font-size: 22px; color: #2a4d8f; }
      .header-line { height: 3px; background: linear-gradient(90deg,#2a4d8f,#4b79cf); margin: 6px 0 12px; }
    `}),Z=T=>{const{student:N,exams:H}=T;return a.jsxs("div",{className:"card",children:[a.jsx("div",{className:"school-title",children:"School Management System"}),a.jsx("div",{className:"header-line"}),a.jsxs("h2",{children:["Report Card - AY ",c]}),a.jsxs("div",{className:"meta",children:[a.jsx("strong",{children:"Student:"})," ",N.firstName," ",N.lastName," ¬† | ¬†",a.jsx("strong",{children:"Roll:"})," ",N.studentId||"-"]}),Object.entries(H).map(([G,q])=>{let oe=0,de=0;return a.jsxs(ee,{sx:{mb:2},children:[a.jsx(V,{variant:"subtitle1",sx:{mb:.5},children:q.examName}),a.jsxs("table",{className:"rc",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{children:"Subject"}),a.jsx("th",{children:"Th"}),a.jsx("th",{children:"Pr"}),a.jsx("th",{children:"Total"}),a.jsx("th",{children:"Max"})]})}),a.jsx("tbody",{children:q.subjects.map(z=>{const O=q.cells[z.subjectId]||{theoryMarks:0,practicalMarks:0},W=O.theoryMarks||0,F=O.practicalMarks||0,U=W+F,te=z.totalMaxMarks||0;return oe+=U,de+=te,a.jsxs("tr",{children:[a.jsx("td",{children:z.subjectName}),a.jsx("td",{style:{textAlign:"center"},children:W}),a.jsx("td",{style:{textAlign:"center"},children:F}),a.jsx("td",{style:{textAlign:"center"},children:U}),a.jsx("td",{style:{textAlign:"center"},children:te})]},z.subjectId)})})]}),a.jsxs("div",{className:"totals",children:["Total: ",oe," / ",de," ¬† | ¬† Percentage: ",de>0?(oe*100/de).toFixed(2)+"%":"-"]})]},G)})]})};return a.jsxs(ee,{p:3,children:[a.jsx(V,{variant:"h4",gutterBottom:!0,children:"Report Cards"}),a.jsx(Fa,{open:!!E,autoHideDuration:6e3,onClose:()=>C(null),children:a.jsx(pt,{onClose:()=>C(null),severity:"error",sx:{width:"100%"},children:E})}),a.jsxs(Ke,{className:"no-print",sx:{p:2,mb:2},children:[a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,xs:12,md:12,children:a.jsxs(Vx,{exclusive:!0,size:"small",value:p,onChange:(T,N)=>{N&&y(N)},"aria-label":"report mode",sx:{mb:1},children:[a.jsx(uc,{value:"SECTION","aria-label":"Entire Section",children:"Entire Section"}),a.jsx(uc,{value:"STUDENT","aria-label":"Individual Student",children:"Individual Student"})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,size:"small",children:[a.jsx(ot,{children:"Year"}),a.jsx(tt,{value:c,label:"Year",onChange:T=>{d(T.target.value),f([])},children:B.map(T=>a.jsx(Te,{value:T,children:T},T))})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:4,children:a.jsxs(rt,{fullWidth:!0,size:"small",disabled:!c,children:[a.jsx(ot,{children:"Exams"}),a.jsx(tt,{multiple:!0,open:_,onOpen:()=>I(!0),onClose:()=>I(!1),value:u,label:"Exams",onChange:Y,renderValue:T=>a.jsx(ee,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:T.map(N=>{var H;return a.jsx(at,{size:"small",label:((H=R.find(G=>G.id===N))==null?void 0:H.name)||N},N)})}),children:R.map(T=>a.jsx(Te,{value:T.id,children:T.name},T.id))})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,size:"small",children:[a.jsx(ot,{children:"Class"}),a.jsxs(tt,{value:h,label:"Class",onChange:T=>{x(Number(T.target.value)),g(0)},children:[a.jsx(Te,{value:0,children:"Select Class"}),t.map(T=>a.jsx(Te,{value:T.id,children:T.name},T.id))]})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,size:"small",disabled:!h,children:[a.jsx(ot,{children:"Section"}),a.jsxs(tt,{value:m,label:"Section",onChange:T=>g(Number(T.target.value)),children:[a.jsx(Te,{value:0,children:"Select Section"}),s.map(T=>a.jsx(Te,{value:T.id,children:T.name},T.id))]})]})}),p==="STUDENT"&&a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(rt,{fullWidth:!0,size:"small",disabled:!m,children:[a.jsx(ot,{children:"Student"}),a.jsxs(tt,{value:S,label:"Student",onChange:T=>v(Number(T.target.value)),children:[a.jsx(Te,{value:0,children:"Select Student"}),o.map(T=>a.jsxs(Te,{value:T.id,children:[T.firstName," ",T.lastName," ",T.studentId?`(${T.studentId})`:""]},T.id))]})]})}),p==="SECTION"&&a.jsx(X,{item:!0,xs:12,sm:6,md:2,sx:{display:"flex",justifyContent:{xs:"flex-start",md:"flex-end"}},children:a.jsx(ye,{variant:"contained",size:"small",onClick:P,disabled:A,children:A?a.jsx(vr,{size:18}):"Generate"})})]}),p==="STUDENT"&&a.jsxs(ee,{sx:{mt:1,display:"flex",gap:1},children:[a.jsx(ye,{variant:"contained",size:"small",onClick:P,disabled:A,children:A?a.jsx(vr,{size:18}):"Generate"}),a.jsx(ye,{variant:"outlined",size:"small",startIcon:a.jsx(ai,{}),onClick:K,disabled:!L,title:"Download CSV",children:"CSV"}),a.jsx(ye,{variant:"outlined",size:"small",startIcon:a.jsx(Lc,{}),onClick:M,disabled:!L,title:"Print",children:"Print"})]})]}),L&&p==="SECTION"&&a.jsxs(a.Fragment,{children:[a.jsx(ee,{className:"no-print screen-only",sx:{mb:2},children:a.jsx(pt,{severity:"success",children:"Report cards are ready. You can download the CSV or print all now."})}),a.jsxs(ee,{className:"no-print",sx:{mb:2,display:"flex",gap:1},children:[a.jsx(ye,{variant:"outlined",size:"small",startIcon:a.jsx(ai,{}),onClick:K,children:"Download CSV (Section)"}),a.jsx(ye,{variant:"outlined",size:"small",startIcon:a.jsx(Lc,{}),onClick:M,children:"Print All"})]})]}),ae,a.jsx("div",{ref:D,className:p==="SECTION"?"print-only":"",children:L?Object.values(w).sort((T,N)=>(T.student.studentId||"").localeCompare(N.student.studentId||"")).map(T=>a.jsx("div",{children:Z(T)},T.student.id)):a.jsx(jt,{className:"screen-only",children:a.jsx(Ut,{children:a.jsx(V,{color:"text.secondary",children:"Select options and click Generate to build report cards."})})})})]})},UV=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],VV=({mask:e,onChange:r})=>{const t=n=>{const s=1<<n,i=e&s?e&~s:e|s;r(i)};return a.jsx(kS,{row:!0,children:UV.map((n,s)=>a.jsx(Wi,{control:a.jsx(Zs,{checked:!!(e&1<<s),onChange:()=>t(s)}),label:n},n))})},$c={async getSettings(){const e=await ge.get("/api/timetable/settings");return{id:e.id,working_days_mask:e.workingDaysMask??e.working_days_mask??31,periods_per_day:e.periodsPerDay??e.periods_per_day??8,period_duration_min:e.periodDurationMin??e.period_duration_min??40,lunch_after_period:e.lunchAfterPeriod??e.lunch_after_period??4,max_periods_per_teacher_per_day:e.maxPeriodsPerTeacherPerDay??e.max_periods_per_teacher_per_day??5,workingDaysMask:e.workingDaysMask,periodsPerDay:e.periodsPerDay,periodDurationMin:e.periodDurationMin,lunchAfterPeriod:e.lunchAfterPeriod,maxPeriodsPerTeacherPerDay:e.maxPeriodsPerTeacherPerDay,startTime:e.startTime??e.start_time,endTime:e.endTime??e.end_time}},async saveSettings(e){const r={workingDaysMask:e.workingDaysMask??e.working_days_mask,periodsPerDay:e.periodsPerDay??e.periods_per_day,periodDurationMin:e.periodDurationMin??e.period_duration_min,lunchAfterPeriod:e.lunchAfterPeriod??e.lunch_after_period,maxPeriodsPerTeacherPerDay:e.maxPeriodsPerTeacherPerDay??e.max_periods_per_teacher_per_day,startTime:e.startTime,endTime:e.endTime},t=await ge.put("/api/timetable/settings",r);return{id:t.id,working_days_mask:t.workingDaysMask??31,periods_per_day:t.periodsPerDay??8,period_duration_min:t.periodDurationMin??40,lunch_after_period:t.lunchAfterPeriod??4,max_periods_per_teacher_per_day:t.maxPeriodsPerTeacherPerDay??5,workingDaysMask:t.workingDaysMask,periodsPerDay:t.periodsPerDay,periodDurationMin:t.periodDurationMin,lunchAfterPeriod:t.lunchAfterPeriod,maxPeriodsPerTeacherPerDay:t.maxPeriodsPerTeacherPerDay,startTime:t.startTime,endTime:t.endTime}},async getClassSections(e){return await ge.get(`/api/classes/${e}/sections`)}},WV=()=>{const[e,r]=it.useState(!0),[t,n]=it.useState(null),[s,i]=it.useState(""),[o,l]=it.useState("");it.useEffect(()=>{(async()=>{try{const d=await $c.getSettings();n(d)}catch(d){i(d.message||"Failed to load settings")}finally{r(!1)}})()},[]);const c=async()=>{if(t){i(""),l("");try{const d={workingDaysMask:t.working_days_mask,periodsPerDay:Math.max(1,t.periods_per_day),periodDurationMin:Math.max(20,t.period_duration_min),lunchAfterPeriod:Math.max(1,t.lunch_after_period),maxPeriodsPerTeacherPerDay:Math.max(1,t.max_periods_per_teacher_per_day||t.maxPeriodsPerTeacherPerDay||5),startTime:t.startTime||"08:30:00",endTime:t.endTime||"15:30:00"},u=await $c.saveSettings(d);n(u),l("Settings saved successfully")}catch(d){i(d.message||"Save failed")}}};return e?a.jsx(V,{children:"Loading..."}):s?a.jsx(V,{color:"error",children:s}):t?a.jsxs(Ke,{sx:{p:2},children:[a.jsx(V,{variant:"h6",sx:{mb:2},children:"Global Timetable Settings"}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsxs(X,{item:!0,xs:12,children:[a.jsx(V,{variant:"subtitle2",children:"Working days"}),a.jsx(VV,{mask:t.working_days_mask,onChange:d=>n({...t,working_days_mask:d})})]}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Se,{type:"number",label:"Periods per day",fullWidth:!0,value:t.periods_per_day,onChange:d=>n({...t,periods_per_day:parseInt(d.target.value||"0",10)})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Se,{type:"number",label:"Period duration (min)",fullWidth:!0,value:t.period_duration_min,onChange:d=>n({...t,period_duration_min:parseInt(d.target.value||"0",10)})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Se,{type:"number",label:"Lunch after period",fullWidth:!0,value:t.lunch_after_period,onChange:d=>n({...t,lunch_after_period:parseInt(d.target.value||"0",10)})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Se,{type:"number",label:"Max periods per teacher per day",fullWidth:!0,value:t.max_periods_per_teacher_per_day??t.maxPeriodsPerTeacherPerDay??5,onChange:d=>n({...t,max_periods_per_teacher_per_day:parseInt(d.target.value||"0",10)}),helperText:"Used by the generator to cap a teacher's daily load"})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Se,{type:"time",label:"School start time",fullWidth:!0,InputLabelProps:{shrink:!0},value:(t.startTime||"08:30:00").slice(0,5),onChange:d=>n({...t,startTime:`${d.target.value}:00`})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Se,{type:"time",label:"School end time",fullWidth:!0,InputLabelProps:{shrink:!0},value:(t.endTime||"15:30:00").slice(0,5),onChange:d=>n({...t,endTime:`${d.target.value}:00`})})})]}),a.jsx(ee,{sx:{mt:2},children:a.jsx(ye,{variant:"contained",color:"primary",onClick:c,children:"Save"})}),a.jsx(Fa,{open:!!o,autoHideDuration:3e3,onClose:()=>l(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:a.jsx(pt,{severity:"success",sx:{width:"100%"},onClose:()=>l(""),children:o})}),a.jsx(Fa,{open:!!s,autoHideDuration:5e3,onClose:()=>i(""),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:a.jsx(pt,{severity:"error",sx:{width:"100%"},onClose:()=>i(""),children:s||"Something went wrong"})})]}):null},HV=({days:e,periods:r,data:t,onCellClick:n})=>a.jsx(Jt,{component:Ke,children:a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Period"}),e.map(s=>a.jsx(Q,{children:s},s))]})}),a.jsx(Ht,{children:Array.from({length:r},(s,i)=>i+1).map(s=>a.jsxs(Ge,{children:[a.jsx(Q,{sx:{fontWeight:600},children:s}),e.map((i,o)=>{var c;const l=((c=t[o])==null?void 0:c[s])||{};return a.jsxs(Q,{sx:{whiteSpace:"nowrap",cursor:n?"pointer":"default"},onClick:()=>n&&n(o,s),children:[a.jsx(ee,{sx:{fontWeight:600},children:l.subject||"-"}),a.jsx(ee,{sx:{color:"text.secondary",fontSize:12},children:l.teacher||""})]},`${o}-${s}`)})]},s))})]})}),Vs={async getSlots(e,r){return await ge.get(`/api/timetable/slots?classId=${e}&section=${encodeURIComponent(r)}`)},async generate(e,r,t=!0){return await ge.post("/api/timetable/generate",{classId:e,section:r,lockExisting:t})},async getAvailableSubjects(e,r){const t=await ge.get(`/api/timetable/available-subjects?classId=${e}&section=${encodeURIComponent(r)}`),s=((t==null?void 0:t.subjects)||(t==null?void 0:t.SUBJECTS)||[]).map(o=>({id:Number((o==null?void 0:o.id)??(o==null?void 0:o.ID)??(o==null?void 0:o.subjectId)??(o==null?void 0:o.SUBJECT_ID)??(o==null?void 0:o.subject_id)??0),code:String((o==null?void 0:o.code)??(o==null?void 0:o.CODE)??(o==null?void 0:o.subjectCode)??(o==null?void 0:o.SUBJECT_CODE)??(o==null?void 0:o.subject_code)??""),name:String((o==null?void 0:o.name)??(o==null?void 0:o.NAME)??(o==null?void 0:o.subjectName)??(o==null?void 0:o.SUBJECT_NAME)??(o==null?void 0:o.subject_name)??"")})),i=new Set;return s.filter(o=>o.id>0&&!i.has(o.id)&&i.add(o.id))},async getEligibleTeachers(e,r,t){const n=await ge.get(`/api/timetable/eligible-teachers?classId=${e}&section=${encodeURIComponent(r)}&subjectId=${t}`),i=((n==null?void 0:n.teachers)||(n==null?void 0:n.TEACHERS)||[]).map(l=>({id:Number((l==null?void 0:l.id)??(l==null?void 0:l.ID)??(l==null?void 0:l.teacherDetailsId)??(l==null?void 0:l.TEACHER_DETAILS_ID)??(l==null?void 0:l.teacher_details_id)??0),name:String((l==null?void 0:l.name)??(l==null?void 0:l.NAME)??(l==null?void 0:l.teacherName)??(l==null?void 0:l.TEACHER_NAME)??(l==null?void 0:l.teacher_name)??"")})),o=new Set;return i.filter(l=>l.id>0&&!o.has(l.id)&&o.add(l.id))},async updateSlot(e){return await ge.post("/api/timetable/update-slot",e)}},Cx=["Mon","Tue","Wed","Thu","Fri"],YV=()=>{const[e,r]=it.useState([]),[t,n]=it.useState(""),[s,i]=it.useState([]),[o,l]=it.useState(""),[c,d]=it.useState(8),[u,f]=it.useState({}),[h,x]=it.useState({}),[m,g]=it.useState(!1),[p,y]=it.useState(!1),[S,v]=it.useState(null),[E,C]=it.useState(null),[A,j]=it.useState([]),[w,k]=it.useState([]),[_,I]=it.useState(""),[D,B]=it.useState(""),[R,Y]=it.useState(!1),[P,M]=it.useState(!1),[K,L]=it.useState(null);it.useEffect(()=>{(async()=>{try{const T=await ge.get("/api/classes");r(T),T.length&&n(T[0].id)}catch(T){console.error("Failed to load classes",T)}})()},[]),it.useEffect(()=>{(async()=>{try{const T=await $c.getSettings();T!=null&&T.periods_per_day&&d(T.periods_per_day)}catch{}})()},[]),it.useEffect(()=>{(async()=>{if(!t){i([]),l("");return}try{const T=await $c.getClassSections(Number(t));i(T),T.length&&l(T[0])}catch(T){console.error("Failed to load sections",T)}})()},[t]);const ae=it.useCallback(async()=>{if(!(!t||!o))try{g(!0);const T=await Vs.getSlots(Number(t),o);d(T.periodsPerDay||c);const N={};x(T.grid||{}),Object.entries(T.grid||{}).forEach(([H,G])=>{const q=Number(H);N[q]={},Object.entries(G).forEach(([oe,de])=>{const z=Number(oe),O=de.subjectName||de.subjectCode||(de.subjectId?`Sub #${de.subjectId}`:""),W=de.teacherName||(de.teacherDetailsId?`Tch #${de.teacherDetailsId}`:"");N[q][z]={subject:O,teacher:W}})}),f(N)}catch(T){console.error("Failed to load slots",T),f({})}finally{g(!1)}},[t,o,c]);it.useEffect(()=>{ae()},[ae]);const Z=async()=>{if(!(!t||!o))try{g(!0),await Vs.generate(Number(t),o,!0),await ae()}catch(T){console.error("Generate failed",T)}finally{g(!1)}};return a.jsxs(Ke,{sx:{p:2},children:[a.jsx(V,{variant:"h6",sx:{mb:2},children:"Class Timetable"}),a.jsxs(ee,{sx:{display:"flex",gap:2,mb:2,flexWrap:"wrap"},children:[a.jsxs(rt,{size:"small",sx:{minWidth:200},children:[a.jsx(ot,{children:"Class"}),a.jsx(tt,{value:t,label:"Class",onChange:T=>n(Number(T.target.value)),children:e.map(T=>a.jsx(Te,{value:T.id,children:T.name},T.id))})]}),a.jsxs(rt,{size:"small",sx:{minWidth:200},disabled:!s.length,children:[a.jsx(ot,{children:"Section"}),a.jsx(tt,{value:o,label:"Section",onChange:T=>l(String(T.target.value)),children:s.map(T=>a.jsx(Te,{value:T,children:T},T))})]})]}),a.jsx(pt,{severity:"info",sx:{mb:2},children:"Tip: Configure Timetable Settings first. Teacher ‚Üî Subject/Class mappings are managed in Staff and are used here to constrain valid assignments."}),a.jsxs(ee,{sx:{display:"flex",gap:1,mb:2},children:[a.jsx(ye,{variant:"contained",onClick:Z,disabled:!t||!o||m,children:"Generate timetable"}),a.jsx(ye,{variant:"outlined",disabled:!0,children:"Export XLSX"}),a.jsx(ye,{variant:"outlined",disabled:!0,children:"Print"})]}),a.jsx(HV,{days:Cx,periods:c,data:u,onCellClick:async(T,N)=>{var G;if(!t||!o)return;v(T),C(N);const H=((G=h==null?void 0:h[T])==null?void 0:G[N])||{};I(H.subjectId||""),B(H.teacherDetailsId||""),y(!0);try{M(!0),L(null);const q=await Vs.getAvailableSubjects(Number(t),o);if(j(q),k([]),H.subjectId)try{const oe=await Vs.getEligibleTeachers(Number(t),o,Number(H.subjectId));k(oe)}catch{}}catch(q){console.error("Failed to load options",q),j([]),k([]),L("Failed to load subjects. Please retry.")}finally{M(!1)}}}),a.jsxs(At,{open:p,onClose:()=>y(!1),maxWidth:"md",fullWidth:!0,children:[a.jsx(Dt,{children:"Edit Slot"}),a.jsx(Tt,{sx:{pt:2,pb:2},children:a.jsxs(tr,{spacing:2,children:[a.jsx(Se,{label:"Day",size:"small",fullWidth:!0,value:S!=null?Cx[S]:"",InputProps:{readOnly:!0},InputLabelProps:{shrink:!0},margin:"normal"}),a.jsx(Se,{label:"Period",size:"small",fullWidth:!0,value:E??"",InputProps:{readOnly:!0},InputLabelProps:{shrink:!0},margin:"normal"}),P&&a.jsxs(ee,{sx:{display:"flex",alignItems:"center",gap:1},children:[a.jsx(vr,{size:18})," ",a.jsx("span",{children:"Loading subjects‚Ä¶"})]}),!P&&K&&a.jsxs(pt,{severity:"warning",sx:{py:.5},children:[K," ",a.jsx(ye,{size:"small",onClick:async()=>{if(!(!t||!o))try{M(!0),L(null);const T=await Vs.getAvailableSubjects(Number(t),o);j(T)}catch{L("Still cannot load subjects.")}finally{M(!1)}},children:"Retry"})]}),a.jsxs(rt,{size:"small",fullWidth:!0,margin:"dense",children:[a.jsx(ot,{children:"Subject"}),a.jsx(tt,{value:_,label:"Subject",onChange:async T=>{const N=Number(T.target.value);I(N),B("");try{M(!0);const H=await Vs.getEligibleTeachers(Number(t),o,N);k(H)}catch(H){console.error("Failed to load teachers",H),k([]),L("Failed to load teachers for this subject.")}finally{M(!1)}},children:A.map(T=>a.jsxs(Te,{value:T.id,children:[T.code," - ",T.name]},T.id))})]}),!P&&!K&&A.length===0&&a.jsx(pt,{severity:"info",sx:{py:.5},children:"No subjects configured for this class/section. Configure Timetable Requirements first."}),a.jsxs(rt,{size:"small",fullWidth:!0,margin:"dense",disabled:!_,children:[a.jsx(ot,{children:"Teacher"}),a.jsx(tt,{value:D,label:"Teacher",onChange:T=>B(Number(T.target.value)),children:w.map(T=>a.jsx(Te,{value:T.id,children:T.name},T.id))})]})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:()=>y(!1),disabled:R,children:"Cancel"}),a.jsx(ye,{variant:"contained",disabled:!t||!o||S==null||E==null||!_||!D||R,onClick:async()=>{var T;if(!(!t||!o||S==null||E==null||!_)){Y(!0);try{const N={classId:Number(t),section:String(o),dayOfWeek:Number(S)+1,periodNo:Number(E),subjectId:Number(_),teacherDetailsId:D?Number(D):null};await Vs.updateSlot(N),await ae(),y(!1)}catch(N){const H=(T=N==null?void 0:N.response)==null?void 0:T.status;alert(H===409?"Teacher has a conflict in this timeslot or slot is locked.":H===422?"Selected teacher is not eligible for this subject/class/section.":"Failed to update slot.")}finally{Y(!1)}}},children:R?a.jsx(vr,{size:18}):"Save"})]})]})]})},zV=()=>{const[e,r]=it.useState(0);return a.jsxs(ee,{sx:{width:"100%"},children:[a.jsx(Ke,{sx:{p:2,mb:2},children:a.jsxs(aa,{value:e,onChange:(t,n)=>r(n),variant:"scrollable",scrollButtons:"auto",children:[a.jsx(kt,{label:"Settings"}),a.jsx(kt,{label:"Class Timetable"})]})}),e===0&&a.jsx(WV,{}),e===1&&a.jsx(YV,{})]})};var v0={},GV=Lt;Object.defineProperty(v0,"__esModule",{value:!0});var ef=v0.default=void 0,qV=GV($t()),XV=a;ef=v0.default=(0,qV.default)((0,XV.jsx)("path",{d:"M4 6H2v14c0 1.1.9 2 2 2h14v-2H4zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-1 9H9V9h10zm-4 4H9v-2h6zm4-8H9V5h10z"}),"LibraryBooks");var b0={},KV=Lt;Object.defineProperty(b0,"__esModule",{value:!0});var Hb=b0.default=void 0,JV=KV($t()),QV=a;Hb=b0.default=(0,JV.default)((0,QV.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m4 12h-4v3l-5-5 5-5v3h4z"}),"AssignmentReturn");var vn=(e=>(e.AVAILABLE="Available",e.ISSUED="Issued",e.LOST="Lost",e.DAMAGED="Damaged",e))(vn||{});const ar={getAllBooks:()=>ge.get("/library/books"),getBookById:e=>ge.get(`/library/books/${e}`),getBooksByStatus:e=>ge.get(`/library/books/status/${e}`),searchBooks:e=>ge.get(`/library/books/search?query=${encodeURIComponent(e)}`),searchBooksByCategory:e=>ge.get(`/library/books/category/${encodeURIComponent(e)}`),createBook:e=>ge.post("/library/books",e),updateBook:(e,r)=>ge.put(`/library/books/${e}`,r),deleteBook:e=>ge.delete(`/library/books/${e}`),getAllCategories:()=>ge.get("/library/books/categories"),getAllAuthors:()=>ge.get("/library/books/authors"),getBookCounts:()=>ge.get("/library/books/counts"),titleExists:e=>ge.get(`/library/books/exists?title=${encodeURIComponent(e)}`),uploadBooksCsv:e=>ge.bulkUpload("/library/books/upload-csv",e,{isFile:!0}),getAllBookIssues:()=>ge.get("/library/book-issues"),getActiveBookIssues:()=>ge.get("/library/book-issues/active"),getBookIssueById:e=>ge.get(`/library/book-issues/${e}`),getBookIssuesByUser:e=>ge.get(`/library/book-issues/user/${e}`),getBookIssuesByDateRange:(e,r)=>ge.get(`/library/book-issues/date-range?startDate=${e}&endDate=${r}`),issueBook:e=>ge.post("/library/book-issues/issue",e),returnBook:(e,r)=>ge.put(`/library/book-issues/return/${e}${r?`?returnDate=${encodeURIComponent(r)}`:""}`),deleteBookIssue:e=>ge.delete(`/library/book-issues/${e}`),getOverdueBookIssues:()=>ge.get("/library/book-issues/overdue"),getBookIssuesDueOn:e=>ge.get("/library/book-issues/due-on",{date:e}),getBookIssuesDueInRange:(e,r)=>ge.get("/library/book-issues/due-in-week",{start:e,end:r}),getInventorySummary:()=>ge.get("/library/book-issues/inventory-summary"),getIssuedBooksCountByCategory:()=>ge.get("/library/book-issues/category-analysis"),getIssueCountByDateRange:(e,r)=>ge.get(`/library/book-issues/date-analysis?startDate=${e}&endDate=${r}`)},ZV=`title,author,category,status,copies
The Pragmatic Programmer,Andrew Hunt,Programming,Available,3
Clean Code,Robert C. Martin,Programming,Available,2`,e7=({open:e,onClose:r,onUploaded:t})=>{const[n,s]=b.useState(null),[i,o]=b.useState(!1),[l,c]=b.useState(null),[d,u]=b.useState(null),f=m=>{var p;const g=((p=m.target.files)==null?void 0:p[0])||null;s(g),c(null),u(null)},h=async()=>{if(!n){c("Please choose a CSV file.");return}o(!0),c(null);try{const m=await ar.uploadBooksCsv(n);u(m),t==null||t(m)}catch(m){c((m==null?void 0:m.message)||"Upload failed")}finally{o(!1)}},x=()=>{const m=new Blob([ZV],{type:"text/csv;charset=utf-8;"}),g=URL.createObjectURL(m),p=document.createElement("a");p.href=g,p.download="books-template.csv",p.click(),URL.revokeObjectURL(g)};return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"sm",children:[a.jsx(Dt,{children:"Bulk Upload Books (CSV)"}),a.jsxs(Tt,{children:[a.jsx(V,{variant:"body2",sx:{mb:1},children:"CSV columns: title, author, category, status, copies (status optional; defaults to Available, copies optional; defaults to 1)"}),a.jsx(ye,{startIcon:a.jsx(ai,{}),size:"small",onClick:x,sx:{mb:2},children:"Download template"}),a.jsxs(ee,{sx:{display:"flex",gap:1,alignItems:"center"},children:[a.jsxs(ye,{component:"label",variant:"outlined",startIcon:a.jsx(ti,{}),children:["Select CSV",a.jsx("input",{type:"file",accept:".csv",hidden:!0,onChange:f})]}),a.jsx(V,{variant:"body2",children:(n==null?void 0:n.name)||"No file chosen"})]}),i&&a.jsx(Ui,{sx:{mt:2}}),l&&a.jsx(pt,{severity:"error",sx:{mt:2},children:l}),d&&a.jsxs(pt,{severity:"success",sx:{mt:2},children:["Uploaded: created ",String(d.created||0),", updated ",String(d.updated||0),", skipped ",String(d.skipped||0)]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,children:"Close"}),a.jsx(ye,{variant:"contained",onClick:h,disabled:i||!n,children:"Upload"})]})]})},t7=({open:e,onClose:r,onAdded:t})=>{const[n,s]=b.useState(""),[i,o]=b.useState(""),[l,c]=b.useState(""),[d,u]=b.useState(vn.AVAILABLE),[f,h]=b.useState(1),[x,m]=b.useState(!1),[g,p]=b.useState(""),[y,S]=b.useState(""),v=()=>{s(""),o(""),c(""),u(vn.AVAILABLE),m(!1),p(""),S(""),h(1)},E=()=>{x||(v(),r())},C=async j=>{var k;const w=j.trim();if(!w)return S(""),!1;try{const _=await ar.titleExists(w);return _.exists??((k=_.data)==null?void 0:k.exists)?(S("A book with this title already exists"),!0):(S(""),!1)}catch{return S(""),!1}},A=async()=>{if(p(""),!n.trim()||!i.trim()||!l.trim()){p("Please fill all required fields");return}if(!Number.isFinite(f)||f<1||f>1e3){p("Copies must be a number between 1 and 1000");return}if(!await C(n)){m(!0);try{await ar.createBook({title:n.trim(),author:i.trim(),category:l.trim(),status:d,copies:f}),t==null||t(),v(),r()}catch(w){const k=(w==null?void 0:w.message)||"Failed to add book";p(k),String(k).toLowerCase().includes("already exists")&&S("A book with this title already exists")}finally{m(!1)}}};return a.jsxs(At,{open:e,onClose:E,fullWidth:!0,maxWidth:"sm",children:[a.jsx(Dt,{children:"Add New Book"}),a.jsx(Tt,{children:a.jsxs(tr,{spacing:1.5,sx:{mt:.5},children:[g&&a.jsx(pt,{severity:"error",children:g}),a.jsx(Se,{label:"Title",value:n,onChange:j=>{s(j.target.value),S("")},onBlur:()=>C(n),required:!0,error:!!y,helperText:y||" ",autoFocus:!0,fullWidth:!0,size:"small",margin:"dense"}),a.jsx(Se,{label:"Author",value:i,onChange:j=>o(j.target.value),required:!0,fullWidth:!0,size:"small",margin:"dense",helperText:" "}),a.jsx(Se,{label:"Category",value:l,onChange:j=>c(j.target.value),required:!0,fullWidth:!0,size:"small",margin:"dense",helperText:" "}),a.jsx(Se,{label:"Copies",type:"number",inputProps:{min:1,max:1e3,step:1},value:f,onChange:j=>h(parseInt(j.target.value||"1",10)),fullWidth:!0,size:"small",margin:"dense",helperText:" "}),a.jsxs(Se,{label:"Status",select:!0,value:d,onChange:j=>u(j.target.value),fullWidth:!0,size:"small",margin:"dense",helperText:" ",children:[a.jsx(Te,{value:vn.AVAILABLE,children:"Available"}),a.jsx(Te,{value:vn.ISSUED,children:"Issued"}),a.jsx(Te,{value:vn.LOST,children:"Lost"}),a.jsx(Te,{value:vn.DAMAGED,children:"Damaged"})]})]})}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:E,disabled:x,children:"Cancel"}),a.jsx(ye,{onClick:A,variant:"contained",disabled:x,children:"Add"})]})]})},r7=({open:e,onClose:r,onCompleted:t})=>{const[n,s]=b.useState([]),[i,o]=b.useState({status:"Issued",issueType:"Student",issueDate:Be().format("YYYY-MM-DD")}),[l,c]=b.useState(null),[d,u]=b.useState(!1),[f,h]=b.useState(!1),[x,m]=b.useState([]),[g,p]=b.useState(null);b.useEffect(()=>{e&&(ar.getBooksByStatus("Available").then(C=>s(C)),S("Student"))},[e]);const y=b.useMemo(()=>{const C=new Map;for(const A of n){const j=(A.title||"").trim().toLowerCase();C.set(j,(C.get(j)||0)+1)}return C},[n]),S=async C=>{h(!0);try{if(C==="Student"){const A=await zr.getAllStudents();m(A.map(j=>({label:`${j.name}${j.studentId?` (${j.studentId})`:""}`,value:j.studentId||String(j.id||"")})))}else{const A=await Qr.getAll();m(A.map(j=>({label:`${j.fullName||`${j.firstName||""} ${j.lastName||""}`.trim()}${j.staffId?` (${j.staffId})`:j.id?` (ID:${j.id})`:""}`,value:j.staffId||String(j.id||"")})))}}catch(A){console.warn("Failed to load people list",A),m([])}finally{h(!1)}},v=C=>{const{name:A,value:j}=C.target;o(w=>({...w,[A]:j})),A==="issueType"&&(p(null),o(w=>({...w,issuedTo:void 0})),S(j))},E=async()=>{u(!0),c(null);try{const C={id:void 0,bookId:Number(i.bookId),issuedTo:String(i.issuedTo||(g==null?void 0:g.value)||""),issueType:String(i.issueType||"Student"),issueDate:i.issueDate,dueDate:i.dueDate,status:"Issued"};await ar.issueBook(C),t==null||t(),r()}catch(C){c((C==null?void 0:C.message)||"Issue failed")}finally{u(!1)}};return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"sm",children:[a.jsx(Dt,{children:"Issue Book"}),a.jsxs(Tt,{children:[l&&a.jsx(pt,{severity:"error",sx:{mb:2},children:l}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,children:a.jsx(Se,{select:!0,fullWidth:!0,label:"Book",name:"bookId",value:i.bookId||"",onChange:v,children:n.map(C=>{const A=y.get((C.title||"").trim().toLowerCase())||1;return a.jsxs(Te,{value:C.id,children:[C.title," ‚Äî ",C.author," ",`(Available copies: ${A})`]},C.id)})})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Yi,{value:g,onChange:(C,A)=>{p(A),o(j=>({...j,issuedTo:A==null?void 0:A.value}))},options:x,loading:f,isOptionEqualToValue:(C,A)=>C.value===A.value,getOptionLabel:C=>(C==null?void 0:C.label)||"",renderInput:C=>a.jsx(Se,{...C,label:"Issued To",placeholder:"Type to filter by name",InputProps:{...C.InputProps,endAdornment:a.jsxs(a.Fragment,{children:[f?a.jsx(vr,{color:"inherit",size:16}):null,C.InputProps.endAdornment]})}})})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsxs(Se,{select:!0,fullWidth:!0,label:"Type",name:"issueType",value:i.issueType||"Student",onChange:v,children:[a.jsx(Te,{value:"Student",children:"Student"}),a.jsx(Te,{value:"Staff",children:"Staff"})]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{type:"date",fullWidth:!0,label:"Issue Date",name:"issueDate",value:i.issueDate||"",onChange:v,InputLabelProps:{shrink:!0}})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{type:"date",fullWidth:!0,label:"Due Date",name:"dueDate",value:i.dueDate||"",onChange:v,InputLabelProps:{shrink:!0},helperText:i.dueDate?" ":"Leave blank to auto-calc (5 working days)"})})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,children:"Cancel"}),a.jsx(ye,{variant:"contained",onClick:E,disabled:d||!i.bookId||!i.issuedTo,children:"Issue"})]})]})},n7=({open:e,onClose:r,onCompleted:t})=>{const[n,s]=b.useState([]),[i,o]=b.useState(""),[l,c]=b.useState(null),[d,u]=b.useState(!1),[f,h]=b.useState(!1),[x,m]=b.useState(null),[g,p]=b.useState(new Date().toISOString().slice(0,10)),y=async()=>{u(!0);try{let v=await ar.getActiveBookIssues();(!Array.isArray(v)||v.length===0)&&(v=(await ar.getAllBookIssues()||[]).filter(C=>(C.status||"").toLowerCase()==="issued"||!C.returnDate)),s(v)}catch{s([])}finally{c(null),o(""),u(!1)}};b.useEffect(()=>{e&&y()},[e]);const S=async()=>{if(i){h(!0),m(null);try{await ar.returnBook(i,g),t==null||t(),r()}catch(v){m((v==null?void 0:v.message)||"Return failed")}finally{h(!1)}}};return a.jsxs(At,{open:e,onClose:r,fullWidth:!0,maxWidth:"sm",children:[a.jsx(Dt,{children:"Return Book"}),a.jsxs(Tt,{sx:{pt:2,overflow:"visible"},children:[x&&a.jsx(pt,{severity:"error",sx:{mb:2},children:x}),a.jsxs(X,{container:!0,spacing:1.5,children:[a.jsx(X,{item:!0,xs:12,sx:{mt:1},children:a.jsx(Yi,{size:"small",fullWidth:!0,options:n,value:l,onChange:(v,E)=>{c(E),o((E==null?void 0:E.id)??"")},getOptionLabel:v=>v?`${v.bookTitle||`Book ${v.bookId}`} ‚Äî ${v.issuedTo} (${v.issueType})`:"",isOptionEqualToValue:(v,E)=>!!v&&!!E&&v.id===E.id,disablePortal:!0,loading:d,filterOptions:(v,E)=>{const C=E.inputValue.toLowerCase();return C?v.filter(A=>(A.bookTitle||`Book ${A.bookId}`).toLowerCase().includes(C)||(A.issuedTo||"").toLowerCase().includes(C)):v},renderInput:v=>a.jsx(Se,{...v,label:"Active Issues",placeholder:"Type book or name to search",InputLabelProps:{shrink:!0},InputProps:{...v.InputProps,endAdornment:a.jsxs(a.Fragment,{children:[d?a.jsx(vr,{color:"inherit",size:16}):null,v.InputProps.endAdornment]})}})})}),l&&a.jsx(X,{item:!0,xs:12,children:a.jsxs(V,{variant:"body2",color:"text.secondary",children:["Issued on ",l.issueDate," ‚Ä¢ Due ",l.dueDate]})}),a.jsx(X,{item:!0,xs:12,sm:6,children:a.jsx(Se,{size:"small",type:"date",fullWidth:!0,label:"Return Date",value:g,onChange:v=>p(v.target.value),InputLabelProps:{shrink:!0}})})]})]}),a.jsxs(Ct,{children:[a.jsx(ye,{onClick:r,children:"Cancel"}),a.jsx(ye,{variant:"contained",onClick:S,disabled:f||!i,children:"Return"})]})]})},ec=({title:e,value:r,icon:t})=>a.jsx(jt,{variant:"outlined",sx:{height:"100%"},children:a.jsx(Ut,{sx:{py:1,px:1.5},children:a.jsxs(ee,{sx:{display:"flex",alignItems:"center",gap:1},children:[t,a.jsxs(V,{variant:"body2",color:"text.primary",children:[e,": ",a.jsx("strong",{children:Number.isFinite(r)?r:0})]})]})})}),a7=()=>{const[e,r]=b.useState({total:0,available:0,issued:0,lost:0,damaged:0}),[t,n]=b.useState(0),[s,i]=b.useState(!1),[o,l]=b.useState(!1),[c,d]=b.useState(null),[u,f]=b.useState(!1),[h,x]=b.useState(!1),[m,g]=b.useState([]),[p,y]=b.useState(!1),[S,v]=b.useState([]),[E,C]=b.useState(!1),[A,j]=b.useState([]),[w,k]=b.useState(!1),[_,I]=b.useState(null),[D,B]=b.useState(new Map),[R,Y]=b.useState(new Map),[P,M]=b.useState("All"),[K,L]=b.useState(""),[ae,Z]=b.useState(""),[T,N]=b.useState("");b.useEffect(()=>{let U=!0;return(async()=>{try{const[te,he]=await Promise.all([ar.getBookCounts(),ar.getOverdueBookIssues()]);if(!U)return;r(ie=>te??ie),n(Array.isArray(he)?he.length:0)}catch(te){console.debug("Library counts not available yet",te)}})(),()=>{U=!1}},[]);const H=async()=>{y(!0);try{const U=await ar.getAllBookIssues();g(Array.isArray(U)?U:[])}catch{g([])}finally{y(!1)}};b.useEffect(()=>{H(),oe()},[]),b.useEffect(()=>{let U=!0;return(async()=>{try{const[te,he]=await Promise.all([zr.getAllStudents().catch(()=>[]),Qr.getAll().catch(()=>[])]);if(!U)return;const ie=new Map,be=new Map;(te||[]).forEach(xe=>{xe&&(xe.studentId||xe.id)&&ie.set(String(xe.studentId||xe.id),xe.name||`${xe.firstName||""} ${xe.lastName||""}`.trim())}),(he||[]).forEach(xe=>{const Fe=String(xe.staffId||xe.id||"");if(Fe){const me=xe.fullName||`${xe.firstName||""} ${xe.lastName||""}`.trim();be.set(Fe,me||xe.email||Fe)}}),B(ie),Y(be)}catch{}})(),()=>{U=!1}},[]);const G=U=>{if(U.issueeName&&U.issueeName.trim())return U.issueeName;const te=String(U.issuedTo||"").trim();if(!te)return"-";const he=(U.issueType||"").toLowerCase();return he==="student"?D.get(te)||te:he==="staff"?R.get(te)||te:D.get(te)||R.get(te)||te},q=async(U,te)=>{if(!(!U||!te||!window.confirm(`Mark this book as ${te}?`))){I(U);try{const be={...await ar.getBookById(U),status:te};await ar.updateBook(U,be);const[xe,Fe,me]=await Promise.all([ar.getBookCounts(),ar.getBooksByStatus("Available").catch(()=>[]),ar.getAllBookIssues().catch(()=>[])]);r(ve=>xe??ve),v(Array.isArray(Fe)?Fe:[]),g(Array.isArray(me)?me:[])}catch(ie){console.error("Failed to update book status",ie),alert("Failed to update book status. Please try again.")}finally{I(null)}}},oe=async()=>{C(!0);try{const U=await ar.getBooksByStatus("Available");v(Array.isArray(U)?U:[])}catch{v([])}finally{C(!1)}},de=async U=>{k(!0);try{const te=await ar.getBooksByStatus(U);j(Array.isArray(te)?te:[])}catch{j([])}finally{k(!1)}};b.useEffect(()=>{P==="All"&&oe(),(P==="Lost"||P==="Damaged")&&de(P)},[P]);const z=b.useMemo(()=>m.filter(U=>{if(P!=="All"){if(P==="Overdue"){const te=new Date().toISOString().slice(0,10);if((U.status||"").toLowerCase()!=="issued"||!U.dueDate||U.dueDate>=te)return!1}else if((U.status||"").toLowerCase()!==P.toLowerCase())return!1}if(K){const te=K.toLowerCase(),he=(U.bookTitle||"").toLowerCase(),ie=(U.issuedTo||"").toLowerCase();if(!he.includes(te)&&!ie.includes(te))return!1}return!(ae&&U.dueDate&&U.dueDate<ae||T&&U.dueDate&&U.dueDate>T)}),[m,P,K,ae,T]),O=b.useMemo(()=>{const U=new Map;for(const te of S){const he=(te.title||"").trim().toLowerCase();he&&U.set(he,(U.get(he)||0)+1)}return U},[S]),W=b.useMemo(()=>{const U=new Map;for(const te of m){if((te.status||"").toLowerCase()!=="issued")continue;const he=(te.bookTitle||"").trim().toLowerCase();he&&U.set(he,(U.get(he)||0)+1)}return U},[m]),F=b.useMemo(()=>{if(P!=="All")return[];const U=(K||"").toLowerCase();return U?S.filter(te=>(te.title||"").toLowerCase().includes(U)||(te.author||"").toLowerCase().includes(U)||(te.category||"").toLowerCase().includes(U)):S},[S,P,K]);return a.jsxs(ee,{sx:{width:"100%"},children:[a.jsx(V,{variant:"h5",gutterBottom:!0,children:"Library"}),a.jsx(V,{variant:"body2",color:"text.secondary",sx:{mb:2},children:"Manage books, issues/returns, and view quick stats."}),a.jsxs(tr,{direction:"row",spacing:1,sx:{mb:2},children:[a.jsx(ye,{size:"small",variant:"contained",onClick:U=>d(U.currentTarget),children:"Add Books ‚ñæ"}),a.jsxs(Bc,{anchorEl:c,open:!!c,onClose:()=>d(null),anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},children:[a.jsx(Te,{onClick:()=>{d(null),l(!0)},children:"Add Book"}),a.jsx(Te,{onClick:()=>{d(null),i(!0)},children:"Bulk Upload Books"})]}),a.jsx(ye,{size:"small",variant:"contained",onClick:()=>f(!0),children:"Issue Book"}),a.jsx(ye,{size:"small",variant:"contained",onClick:()=>x(!0),children:"Return Book"}),a.jsx(ye,{size:"small",variant:"contained",onClick:H,disabled:p,children:"Refresh Issues"})]}),a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(ec,{title:"Total Books",value:e.total||0,icon:a.jsx(ef,{color:"primary",fontSize:"small"})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(ec,{title:"Available",value:e.available||0,icon:a.jsx(ef,{color:"success",fontSize:"small"})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(ec,{title:"Issued",value:e.issued||0,icon:a.jsx(Hb,{color:"secondary",fontSize:"small"})})}),a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(ec,{title:"Overdue",value:t||0,icon:a.jsx(_h,{color:"warning",fontSize:"small"})})})]}),a.jsx(Qt,{sx:{my:3}}),a.jsx(V,{variant:"h6",gutterBottom:!0,children:"Books"}),a.jsxs(X,{container:!0,spacing:1,sx:{mb:2},children:[a.jsx(X,{item:!0,xs:12,sm:6,md:3,children:a.jsx(Se,{size:"small",fullWidth:!0,label:"Search (book or user)",value:K,onChange:U=>L(U.target.value)})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsxs(Se,{size:"small",select:!0,fullWidth:!0,label:"Status",value:P,onChange:U=>M(U.target.value),children:[a.jsx(Te,{value:"All",children:"All"}),a.jsx(Te,{value:"Issued",children:"Issued"}),a.jsx(Te,{value:"Returned",children:"Returned"}),a.jsx(Te,{value:"Overdue",children:"Overdue"}),a.jsx(Te,{value:"Lost",children:"Lost"}),a.jsx(Te,{value:"Damaged",children:"Damaged"})]})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsx(Se,{size:"small",type:"date",fullWidth:!0,label:"Due start",value:ae,onChange:U=>Z(U.target.value),InputLabelProps:{shrink:!0}})}),a.jsx(X,{item:!0,xs:12,sm:6,md:2,children:a.jsx(Se,{size:"small",type:"date",fullWidth:!0,label:"Due end",value:T,onChange:U=>N(U.target.value),InputLabelProps:{shrink:!0}})})]}),a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Book"}),a.jsx(Q,{children:"Issued To"}),a.jsx(Q,{children:"Issue Date"}),a.jsx(Q,{children:"Due Date"}),a.jsx(Q,{children:"Return Date"}),a.jsx(Q,{children:"Status"}),a.jsx(Q,{children:"Copies Issued"}),a.jsx(Q,{children:"Copies Available"}),a.jsx(Q,{children:"Actions"})]})}),a.jsxs(Ht,{children:[P==="All"&&a.jsxs(a.Fragment,{children:[F.map(U=>a.jsxs(Ge,{children:[a.jsx(Q,{children:U.title}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:"Available"}),a.jsx(Q,{children:W.get((U.title||"").trim().toLowerCase())||0}),a.jsx(Q,{children:O.get((U.title||"").trim().toLowerCase())||0}),a.jsx(Q,{children:a.jsxs(tr,{direction:"row",spacing:1,children:[a.jsx(ye,{size:"small",disabled:_===U.id,onClick:()=>q(U.id,vn.LOST),children:"Lost"}),a.jsx(ye,{size:"small",disabled:_===U.id,onClick:()=>q(U.id,vn.DAMAGED),children:"Damaged"})]})})]},`avail-${U.id}`)),z.map(U=>a.jsxs(Ge,{children:[a.jsx(Q,{children:U.bookTitle||`Book ${U.bookId}`}),a.jsx(Q,{children:G(U)}),a.jsx(Q,{children:U.issueDate}),a.jsx(Q,{children:U.dueDate}),a.jsx(Q,{children:U.returnDate||"-"}),a.jsx(Q,{children:U.status}),a.jsx(Q,{children:W.get((U.bookTitle||"").trim().toLowerCase())||0}),a.jsx(Q,{children:O.get((U.bookTitle||"").trim().toLowerCase())||0}),a.jsx(Q,{children:a.jsxs(tr,{direction:"row",spacing:1,children:[a.jsx(ye,{size:"small",disabled:_===(U.bookId||0),onClick:()=>q(U.bookId,vn.LOST),children:"Lost"}),a.jsx(ye,{size:"small",disabled:_===(U.bookId||0),onClick:()=>q(U.bookId,vn.DAMAGED),children:"Damaged"})]})})]},`issue-${U.id}`)),F.length===0&&z.length===0&&a.jsx(Ge,{children:a.jsx(Q,{colSpan:9,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"No records found."})})})]}),P!=="All"&&(P==="Lost"||P==="Damaged")&&a.jsxs(a.Fragment,{children:[A.filter(U=>{if(K){const te=K.toLowerCase();return(U.title||"").toLowerCase().includes(te)||(U.author||"").toLowerCase().includes(te)||(U.category||"").toLowerCase().includes(te)}return!0}).map(U=>a.jsxs(Ge,{children:[a.jsx(Q,{children:U.title}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:"-"}),a.jsx(Q,{children:U.status}),a.jsx(Q,{children:W.get((U.title||"").trim().toLowerCase())||0}),a.jsx(Q,{children:O.get((U.title||"").trim().toLowerCase())||0}),a.jsx(Q,{children:a.jsxs(tr,{direction:"row",spacing:1,children:[a.jsx(ye,{size:"small",disabled:_===U.id,onClick:()=>q(U.id,vn.LOST),children:"Lost"}),a.jsx(ye,{size:"small",disabled:_===U.id,onClick:()=>q(U.id,vn.DAMAGED),children:"Damaged"})]})})]},`status-${U.id}`)),A.length===0&&a.jsx(Ge,{children:a.jsx(Q,{colSpan:9,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"No records found."})})})]}),P!=="All"&&!(P==="Lost"||P==="Damaged")&&a.jsxs(a.Fragment,{children:[z.map(U=>a.jsxs(Ge,{children:[a.jsx(Q,{children:U.bookTitle||`Book ${U.bookId}`}),a.jsx(Q,{children:G(U)}),a.jsx(Q,{children:U.issueDate}),a.jsx(Q,{children:U.dueDate}),a.jsx(Q,{children:U.returnDate||"-"}),a.jsx(Q,{children:U.status}),a.jsx(Q,{children:W.get((U.bookTitle||"").trim().toLowerCase())||0}),a.jsx(Q,{children:O.get((U.bookTitle||"").trim().toLowerCase())||0}),a.jsx(Q,{children:a.jsxs(tr,{direction:"row",spacing:1,children:[a.jsx(ye,{size:"small",disabled:_===(U.bookId||0),onClick:()=>q(U.bookId,vn.LOST),children:"Lost"}),a.jsx(ye,{size:"small",disabled:_===(U.bookId||0),onClick:()=>q(U.bookId,vn.DAMAGED),children:"Damaged"})]})})]},U.id)),z.length===0&&a.jsx(Ge,{children:a.jsx(Q,{colSpan:9,children:a.jsx(V,{variant:"body2",color:"text.secondary",children:"No records found."})})})]})]})]}),a.jsx(e7,{open:s,onClose:()=>i(!1),onUploaded:()=>{Promise.all([ar.getBookCounts(),ar.getBooksByStatus("Available")]).then(([U,te])=>{r(he=>U??he),v(Array.isArray(te)?te:[])})}}),a.jsx(t7,{open:o,onClose:()=>l(!1),onAdded:()=>{Promise.all([ar.getBookCounts(),ar.getBooksByStatus("Available")]).then(([U,te])=>{r(he=>U??he),v(Array.isArray(te)?te:[])})}}),a.jsx(r7,{open:u,onClose:()=>f(!1),onCompleted:()=>{Promise.all([ar.getBookCounts(),ar.getOverdueBookIssues()]).then(([U,te])=>{r(he=>U??he),n(Array.isArray(te)?te.length:0)}),H()}}),a.jsx(n7,{open:h,onClose:()=>x(!1),onCompleted:()=>{Promise.all([ar.getBookCounts(),ar.getOverdueBookIssues()]).then(([U,te])=>{r(he=>U??he),n(Array.isArray(te)?te.length:0)}),H()}})]})},Dx=Array.from({length:12},(e,r)=>`${r+1}`),_x=["A","B","C","D","E","F"],hu=e=>e&&{PRESENT:"success",ABSENT:"error",LATE:"warning",EXCUSED:"info"}[e]||"default",Ix=e=>e?{PRESENT:a.jsx(cf,{fontSize:"small"}),ABSENT:a.jsx(df,{fontSize:"small"})}[e]:void 0,s7=()=>{var oe,de,z,O,W;const{showNotification:e}=dr(),{currentUser:r}=$n(),t=!!((oe=r==null?void 0:r.roles)!=null&&oe.some(F=>String(F).toUpperCase().includes("STUDENT"))),[n,s]=b.useState(0),[i,o]=b.useState(0),[l,c]=b.useState(Be()),[d,u]=b.useState("1"),[f,h]=b.useState("A"),[x,m]=b.useState([]),[g,p]=b.useState({}),[y,S]=b.useState({}),[v,E]=b.useState({}),[C,A]=b.useState(Be().month()+1),[j,w]=b.useState(Be().year()),[k,_]=b.useState(null),[I,D]=b.useState(null),[B,R]=b.useState(null),[Y,P]=b.useState(null),[M,K]=b.useState("");b.useEffect(()=>{(async()=>{try{if(t)try{const U=await ge.get("/api/students/me"),te={id:U.id,studentId:U.studentId,name:`${U.firstName} ${U.lastName}`.trim(),grade:String(U.grade),section:U.section,email:U.email,phoneNumber:U.contactNumber};m([te]),u(String(U.grade)),h(U.section),K(U.id);const he=await gn.getStudentAttendanceByDateRange(String(U.id),l.format("YYYY-MM-DD"),l.format("YYYY-MM-DD")),ie={};he&&he.length&&(ie[U.id]=he[0]),p(ie)}catch(U){e(U.message||"Failed to load your profile","error")}else{const U=await zr.getByGradeAndSection(d,f);m(U);const te=await gn.getSectionAttendance(d,f,l.format("YYYY-MM-DD")),he={};te.forEach(ie=>{he[ie.studentId]=ie}),p(he)}}catch(U){e(U.message||"Failed to load students/attendance","error")}})()},[d,f,l,t]),b.useEffect(()=>{K(""),R(null)},[d,f]);const L=async()=>{var F,U;try{if(!t){const[be,xe]=await Promise.all([gn.generateMonthlyReport(parseInt(d,10),f,j,C),gn.getMonthlyStats(parseInt(d,10),f,j,C)]);_(be),D(xe)}const te=t?(F=x[0])==null?void 0:F.id:M||(((U=x.find(be=>!!be.id))==null?void 0:U.id)??void 0),he=Be(`${j}-${String(C).padStart(2,"0")}-01`).format("YYYY-MM-DD"),ie=Be(he).endOf("month").format("YYYY-MM-DD");if(te){const be=await gn.getStudentAttendanceByDateRange(String(te),he,ie);if(P(be),t){const xe=be.filter(we=>we.status==="PRESENT").length,Fe=be.filter(we=>we.status==="ABSENT").length,me=be.filter(we=>we.status==="LATE").length,ve=xe+Fe+me+be.filter(we=>we.status==="EXCUSED").length,ne=ve>0?xe*100/ve:0;R({presentDays:xe,absentDays:Fe,lateDays:me,attendancePercentage:ne})}else{const xe=await gn.getStudentAttendanceSummary(te,he,ie);R(xe)}}else R(null),P(null)}catch(te){e(te.message||"Failed to load reports","error")}},ae=(F,U,te)=>{const he=me=>{const ve=me==null?"":String(me);return ve.includes('"')||ve.includes(",")||ve.includes(`
`)?'"'+ve.replace(/"/g,'""')+'"':ve},ie=[U.join(","),...te.map(me=>me.map(he).join(","))].join(`\r
`),be=new Blob([ie],{type:"text/csv;charset=utf-8;"}),xe=URL.createObjectURL(be),Fe=document.createElement("a");Fe.href=xe,Fe.setAttribute("download",F),document.body.appendChild(Fe),Fe.click(),document.body.removeChild(Fe),URL.revokeObjectURL(xe)},Z=()=>{if(!k)return;const F=["Grade","Section","Year","Month","StudentId","Student Name","Present","Absent","Late","Percent"],U=new Map;x.forEach(he=>{he.id!=null&&U.set(he.id,he.studentId)});const te=k.studentDetails.map(he=>[d,f,j,C,U.get(he.studentId)||String(he.studentId),he.studentName,he.presentDays,he.absentDays,he.lateDays,he.attendancePercentage.toFixed(1)]);ae(`section-attendance-${d}${f}-${j}-${C}.csv`,F,te)},T=async()=>{if(!M)return;const F=`${j}-${String(C).padStart(2,"0")}-01`,U=Be(F),te=U.daysInMonth(),he={};Y&&Y.forEach(ke=>{he[ke.date]=ke});const ie=U.endOf("month").format("YYYY-MM-DD");let be=[];try{be=(await Ib.getByRange(U.format("YYYY-MM-DD"),ie)).map(Ae=>Ae.date)}catch{}const xe=ke=>ke.day()===0;let Fe=0;for(let ke=1;ke<=te;ke++){const Ae=U.date(ke),Ue=Ae.format("YYYY-MM-DD");!xe(Ae)&&!be.includes(Ue)&&Fe++}const me=Y?Y.filter(ke=>ke.status==="PRESENT").length:B?B.presentDays:0,ve=Y?Y.filter(ke=>ke.status==="ABSENT").length:B?B.absentDays:0,ne=Y?Y.filter(ke=>ke.status==="LATE").length:B?B.lateDays:0,we=Fe,Ee=we>0?me*100/we:0,pe=x.find(ke=>ke.id===M),Ce=[];Ce.push(["StudentId","Student Name","Grade","Section","Year","Month"]),Ce.push([pe?pe.studentId:"",pe?pe.name:"",d,f,j,C]),Ce.push(["Total Days","Present","Absent","Late","Percent"]),Ce.push([we,me,ve,ne,Ee.toFixed(1)]),Ce.push([]),Ce.push(["Date","Present","Absent"]);for(let ke=1;ke<=te;ke++){const Ae=U.date(ke).format("YYYY-MM-DD"),Ue=U.date(ke);if(xe(Ue)||be.includes(Ae))continue;const Ye=he[Ae],Ve=(Ye==null?void 0:Ye.status)==="PRESENT"?1:0,Xe=(Ye==null?void 0:Ye.status)==="ABSENT"?1:0;Ce.push([Ae,Ve,Xe])}const ue=Ce[0].map(ke=>String(ke)),Me=Ce.slice(1);ae(`student-daily-${M}-${j}-${C}.csv`,ue,Me)},N=F=>{const U=g[F];S(te=>({...te,[F]:!te[F]})),y[F]||E(te=>({...te,[F]:U?{...U}:{date:l.format("YYYY-MM-DD"),status:"PRESENT"}}))},H=(F,U,te)=>{E(he=>({...he,[F]:{...he[F],[U]:te}}))},G=async(F,U)=>{var te;try{const he=v[F];if(!he)return;if((te=g[F])!=null&&te.id){const ie=await gn.updateAttendance(g[F].id,he);p(be=>({...be,[F]:ie}))}else{await gn.markStudentAttendanceParams(F,{date:he.date||l.format("YYYY-MM-DD"),status:he.status||"PRESENT",remarks:he.remarks});const ie=await gn.getSectionAttendance(d,f,l.format("YYYY-MM-DD")),be={};ie.forEach(xe=>{be[xe.studentId]=xe}),p(be)}S(ie=>({...ie,[F]:!1})),e("Saved","success")}catch(he){e(he.message||"Failed to save attendance","error")}},q=async()=>{try{await gn.markClassDefault(parseInt(d,10),f,{date:l.format("YYYY-MM-DD"),defaultStatus:"PRESENT"});const F=await gn.getSectionAttendance(d,f,l.format("YYYY-MM-DD")),U={};F.forEach(te=>{U[te.studentId]=te}),p(U),e("Marked all present","success")}catch(F){e(F.message||"Failed to mark all","error")}};return a.jsx(ee,{sx:{flexGrow:1},children:a.jsxs(Ke,{sx:{p:2,mb:2},children:[a.jsx(V,{variant:"h5",component:"h1",children:t?"My Attendance":"Student Attendance"}),a.jsxs(aa,{value:n,onChange:(F,U)=>s(U),sx:{mt:2},children:[a.jsx(kt,{label:t?"Overview":"Daily"}),a.jsx(kt,{label:"Reports",onClick:()=>{k||L()}})]}),a.jsx(Qt,{sx:{mb:2}}),n===0&&!t&&a.jsxs(ee,{sx:{display:"flex",gap:2,alignItems:"center",mt:2,mb:2},children:[a.jsx(jn,{dateAdapter:qn,children:a.jsx(un,{label:"Date",value:l,onChange:F=>F&&c(F),sx:{width:200}})}),a.jsxs(rt,{size:"small",sx:{minWidth:120},children:[a.jsx(ot,{id:"grade-label",children:"Grade"}),a.jsx(tt,{labelId:"grade-label",value:d,label:"Grade",onChange:F=>u(F.target.value),children:Dx.map(F=>a.jsx(Te,{value:F,children:F},F))})]}),a.jsxs(rt,{size:"small",sx:{minWidth:120},children:[a.jsx(ot,{id:"section-label",children:"Section"}),a.jsx(tt,{labelId:"section-label",value:f,label:"Section",onChange:F=>h(F.target.value),children:_x.map(F=>a.jsx(Te,{value:F,children:F},F))})]}),!t&&a.jsx(ye,{variant:"outlined",onClick:q,children:"Mark All Present"})]}),n===0&&!t&&a.jsx(Jt,{component:Ke,children:a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Student ID"}),a.jsx(Q,{children:"Name"}),a.jsx(Q,{children:"Status"}),a.jsx(Q,{children:"Remarks"}),a.jsx(Q,{align:"center",children:"Actions"})]})}),a.jsx(Ht,{children:x.map(F=>{var ie,be;const U=F.id,te=g[U],he=!!y[U];return a.jsxs(Ge,{children:[a.jsx(Q,{children:F.studentId}),a.jsx(Q,{children:F.name}),a.jsx(Q,{children:he?a.jsx(rt,{fullWidth:!0,size:"small",children:a.jsx(tt,{value:((ie=v[U])==null?void 0:ie.status)||(te==null?void 0:te.status)||"",onChange:xe=>H(U,"status",xe.target.value),children:["PRESENT","ABSENT","LATE","EXCUSED"].map(xe=>a.jsx(Te,{value:xe,children:xe},xe))})}):a.jsx(at,{icon:Ix(te==null?void 0:te.status),label:(te==null?void 0:te.status)||"Not Marked",color:hu(te==null?void 0:te.status),size:"small"})}),a.jsx(Q,{children:he?a.jsx(Se,{size:"small",fullWidth:!0,value:((be=v[U])==null?void 0:be.remarks)||(te==null?void 0:te.remarks)||"",onChange:xe=>H(U,"remarks",xe.target.value)}):(te==null?void 0:te.remarks)||"-"}),a.jsx(Q,{align:"center",children:he?a.jsx(xt,{title:"Save",children:a.jsx(ye,{size:"small",variant:"contained",startIcon:a.jsx(lf,{}),onClick:()=>G(U,F.studentId),children:"Save"})}):a.jsx(xt,{title:te?"Edit":"Mark",children:a.jsx(ye,{size:"small",variant:"outlined",startIcon:a.jsx(Za,{}),onClick:()=>N(U),children:te?"Edit":"Mark"})})})]},F.studentId)})})]})}),n===0&&t&&a.jsxs(ee,{children:[a.jsxs(V,{variant:"body2",sx:{mb:1},children:["Date: ",l.format("YYYY-MM-DD")]}),a.jsx(Jt,{component:Ke,children:a.jsxs(Vt,{size:"small",children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Status"}),a.jsx(Q,{children:"Remarks"})]})}),a.jsx(Ht,{children:x[0]&&a.jsxs(Ge,{children:[a.jsx(Q,{children:a.jsx(at,{icon:Ix((de=g[x[0].id])==null?void 0:de.status),label:((z=g[x[0].id])==null?void 0:z.status)||"Not Marked",color:hu((O=g[x[0].id])==null?void 0:O.status),size:"small"})}),a.jsx(Q,{children:((W=g[x[0].id])==null?void 0:W.remarks)||"-"})]})})]})})]}),n===1&&a.jsxs(ee,{sx:{display:"flex",flexDirection:"column",gap:2},children:[a.jsx(Ke,{variant:"outlined",sx:{p:2},children:a.jsxs(X,{container:!0,spacing:2,alignItems:"center",children:[a.jsx(X,{item:!0,children:a.jsxs(rt,{size:"small",sx:{minWidth:120},children:[a.jsx(ot,{id:"grade-label-r",children:"Grade"}),a.jsx(tt,{labelId:"grade-label-r",value:d,label:"Grade",onChange:F=>u(F.target.value),children:Dx.map(F=>a.jsx(Te,{value:F,children:F},F))})]})}),a.jsx(X,{item:!0,children:a.jsxs(rt,{size:"small",sx:{minWidth:120},children:[a.jsx(ot,{id:"section-label-r",children:"Section"}),a.jsx(tt,{labelId:"section-label-r",value:f,label:"Section",onChange:F=>h(F.target.value),children:_x.map(F=>a.jsx(Te,{value:F,children:F},F))})]})}),a.jsx(X,{item:!0,children:a.jsx(Se,{size:"small",label:"Month (1-12)",type:"number",value:C,onChange:F=>A(Math.max(1,Math.min(12,Number(F.target.value)))),sx:{width:140}})}),a.jsx(X,{item:!0,children:a.jsx(Se,{size:"small",label:"Year",type:"number",value:j,onChange:F=>w(Number(F.target.value)),sx:{width:120}})}),a.jsx(X,{item:!0,children:a.jsx(ye,{variant:"contained",onClick:L,children:"Load Reports"})})]})}),a.jsx(Ke,{variant:"outlined",sx:{px:2},children:a.jsxs(aa,{value:i,onChange:(F,U)=>o(U),children:[!t&&a.jsx(kt,{label:"Section Report"}),a.jsx(kt,{label:t?"My Report":"Student Report"})]})}),i===0&&!t&&a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,children:a.jsxs(jt,{variant:"outlined",children:[a.jsx(Dd,{title:"Section Monthly Report",subheader:k?`Average: ${k.averageAttendancePercentage.toFixed(1)}%`:"Run a report to view details",action:k?a.jsx(ye,{size:"small",variant:"outlined",onClick:Z,children:"Download CSV"}):null}),a.jsx(Ut,{children:k?a.jsx(Jt,{component:Ke,variant:"outlined",children:a.jsxs(Vt,{size:"small",stickyHeader:!0,children:[a.jsx(Wt,{children:a.jsxs(Ge,{children:[a.jsx(Q,{children:"Student"}),a.jsx(Q,{align:"right",children:"Present"}),a.jsx(Q,{align:"right",children:"Absent"}),a.jsx(Q,{align:"right",children:"Late"}),a.jsx(Q,{align:"right",children:"%"})]})}),a.jsx(Ht,{children:k.studentDetails.map(F=>a.jsxs(Ge,{hover:!0,children:[a.jsx(Q,{children:F.studentName}),a.jsx(Q,{align:"right",children:F.presentDays}),a.jsx(Q,{align:"right",children:F.absentDays}),a.jsx(Q,{align:"right",children:F.lateDays}),a.jsx(Q,{align:"right",children:F.attendancePercentage.toFixed(1)})]},F.studentId))})]})}):a.jsx(V,{variant:"body2",color:"text.secondary",children:'No data yet. Choose Grade/Section/Month and click "Load Reports".'})})]})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsxs(jt,{variant:"outlined",children:[a.jsx(Dd,{title:"Monthly Stats"}),a.jsx(Ut,{children:I?a.jsxs(tr,{spacing:1.5,children:[a.jsxs(V,{children:["Total Students: ",I.totalStudents]}),a.jsxs(ee,{children:[a.jsxs(V,{sx:{mb:.5},children:["Average Attendance: ",I.averageAttendance,"%"]}),a.jsx(Ui,{variant:"determinate",value:Math.min(100,Math.max(0,Number(I.averageAttendance)))})]}),a.jsxs(ee,{children:[a.jsx(V,{sx:{mb:.5},children:"100%"}),a.jsx(tr,{direction:"row",spacing:1,flexWrap:"wrap",children:I.studentsWith100Percent.length?I.studentsWith100Percent.map(F=>a.jsx(at,{label:F,size:"small"},F)):a.jsx(V,{variant:"body2",color:"text.secondary",children:"None"})})]}),a.jsxs(ee,{children:[a.jsx(V,{sx:{mb:.5},children:"Below 75%"}),a.jsx(tr,{direction:"row",spacing:1,flexWrap:"wrap",children:I.studentsBelow75Percent.length?I.studentsBelow75Percent.map(F=>a.jsx(at,{label:F,color:"warning",size:"small"},F)):a.jsx(V,{variant:"body2",color:"text.secondary",children:"None"})})]})]}):a.jsx(V,{variant:"body2",color:"text.secondary",children:"Stats will appear after loading a report."})})]})})]}),(!t&&i===1||t&&i===0)&&a.jsx(X,{container:!0,spacing:2,children:a.jsx(X,{item:!0,xs:12,children:a.jsxs(jt,{variant:"outlined",children:[a.jsx(Dd,{title:t?"My Monthly Report":"Student Report",action:B&&M?a.jsx(tr,{direction:"row",spacing:1,children:a.jsx(ye,{size:"small",variant:"outlined",onClick:T,children:"Download Daily CSV"})}):null}),a.jsx(Ut,{children:a.jsxs(tr,{spacing:1.5,children:[!t&&a.jsxs(rt,{size:"small",sx:{minWidth:240},children:[a.jsx(ot,{id:"student-select",children:"Student"}),a.jsx(tt,{labelId:"student-select",value:M===""?"":M,label:"Student",onChange:async F=>{const U=F.target.value;K(U);const te=Be(`${j}-${String(C).padStart(2,"0")}-01`).format("YYYY-MM-DD"),he=Be(te).endOf("month").format("YYYY-MM-DD");if(U&&typeof U=="number")try{const[ie,be]=await Promise.all([gn.getStudentAttendanceSummary(U,te,he),gn.getStudentAttendanceByDateRange(String(U),te,he)]);R(ie),P(be)}catch(ie){e(ie.message||"Failed to load student report","error")}else R(null),P(null)},children:x.map(F=>a.jsxs(Te,{value:F.id,children:[F.name," (",F.studentId,")"]},F.id))})]}),B?a.jsxs(ee,{children:[a.jsxs(V,{variant:"body2",children:["Present: ",B.presentDays," | Absent: ",B.absentDays," | Late: ",B.lateDays]}),a.jsxs(V,{variant:"body2",sx:{mt:.5},children:["Attendance: ",B.attendancePercentage.toFixed(1),"%"]}),a.jsx(Ui,{sx:{mt:.5},variant:"determinate",value:Math.min(100,Math.max(0,Number(B.attendancePercentage)))})]}):a.jsx(V,{variant:"body2",color:"text.secondary",children:"Select a student to view their monthly summary."}),Y?a.jsxs(a.Fragment,{children:[a.jsx(Jt,{component:Ke,variant:"outlined",sx:{maxWidth:"100%",overflowX:"auto"},children:a.jsxs(Vt,{size:"small",stickyHeader:!0,children:[a.jsx(Wt,{children:a.jsx(Ge,{children:Array.from({length:Be(`${j}-${String(C).padStart(2,"0")}-01`).daysInMonth()},(F,U)=>U+1).map(F=>a.jsx(Q,{align:"center",children:F},F))})}),a.jsx(Ht,{children:a.jsx(Ge,{children:(()=>{const U=Be(`${j}-${String(C).padStart(2,"0")}-01`).daysInMonth(),te={};Y.forEach(ie=>{const be=Be(ie.date).date();te[be]=ie.status});const he=ie=>ie==="PRESENT"?"P":ie==="ABSENT"?"A":ie==="LATE"?"L":ie==="EXCUSED"?"E":"";return Array.from({length:U},(ie,be)=>be+1).map(ie=>a.jsx(Q,{align:"center",children:te[ie]?a.jsx(at,{size:"small",label:he(te[ie]),color:hu(te[ie])}):a.jsx(V,{variant:"caption",color:"text.disabled",children:"-"})},ie))})()})})]})}),a.jsxs(V,{variant:"caption",color:"text.secondary",sx:{mt:1},children:["Legend: ",a.jsx(at,{size:"small",label:"P",color:"success",sx:{mr:1}})," Present",a.jsx(at,{size:"small",label:"A",color:"error",sx:{mx:1}})," Absent",a.jsx(at,{size:"small",label:"L",color:"warning",sx:{mx:1}})," Late",a.jsx(at,{size:"small",label:"E",color:"info",sx:{mx:1}})," Excused"]})]}):null]})})]})})})]})]})})},i7=()=>{const[e,r]=b.useState({schoolName:""}),[t,n]=b.useState(!1);b.useEffect(()=>{Uu.getSchoolSettings().then(r).catch(()=>{})},[]);const s=o=>l=>{r(c=>({...c,[o]:l.target.value}))},i=async()=>{n(!0);try{const o=await Uu.updateSchoolSettings(e);r(o)}finally{n(!1)}};return a.jsxs(ee,{sx:{p:3},children:[a.jsx(V,{variant:"h6",gutterBottom:!0,children:"School Settings"}),a.jsxs(Ke,{sx:{p:2},children:[a.jsxs(X,{container:!0,spacing:2,children:[a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(Se,{label:"School Name",fullWidth:!0,value:e.schoolName||"",onChange:s("schoolName")})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(Se,{label:"Receipt Prefix",fullWidth:!0,value:e.receiptPrefix||"",onChange:s("receiptPrefix")})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(Se,{label:"Address Line 1",fullWidth:!0,value:e.addressLine1||"",onChange:s("addressLine1")})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(Se,{label:"Address Line 2",fullWidth:!0,value:e.addressLine2||"",onChange:s("addressLine2")})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(Se,{label:"City",fullWidth:!0,value:e.city||"",onChange:s("city")})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(Se,{label:"State",fullWidth:!0,value:e.state||"",onChange:s("state")})}),a.jsx(X,{item:!0,xs:12,md:4,children:a.jsx(Se,{label:"Postal Code",fullWidth:!0,value:e.postalCode||"",onChange:s("postalCode")})}),a.jsx(X,{item:!0,xs:12,md:6,children:a.jsx(Se,{label:"Country",fullWidth:!0,value:e.country||"",onChange:s("country")})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(Se,{label:"Phone",fullWidth:!0,value:e.phone||"",onChange:s("phone")})}),a.jsx(X,{item:!0,xs:12,md:3,children:a.jsx(Se,{label:"Email",fullWidth:!0,value:e.email||"",onChange:s("email")})})]}),a.jsx(ee,{sx:{mt:2,textAlign:"right"},children:a.jsx(ye,{variant:"contained",onClick:i,disabled:t,children:t?"Saving...":"Save"})})]})]})},ft={ADMIN:"ADMIN",TEACHER:"TEACHER",STAFF:"STAFF",PARENT:"PARENT",STUDENT:"STUDENT",PRINCIPAL:"PRINCIPAL",LIBRARIAN:"LIBRARIAN"},sn=({children:e})=>e;function o7(){return a.jsx(_S,{children:a.jsx(_j,{children:a.jsx(kj,{children:a.jsx(Tj,{children:a.jsxs(IS,{children:[a.jsx(Nr,{path:"/",element:a.jsx(i4,{})}),a.jsx(Nr,{path:"/login",element:a.jsx(o4,{})}),a.jsx(Nr,{path:"/register",element:a.jsx(h4,{})}),a.jsx(Nr,{path:"/exams",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.TEACHER,ft.STAFF,ft.STUDENT,ft.PARENT,ft.PRINCIPAL],children:a.jsx(Y2,{})})})})}),a.jsx(Nr,{path:"/dashboard",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.TEACHER,ft.STAFF,ft.STUDENT,ft.PARENT,ft.PRINCIPAL],children:a.jsx(xO,{})})})})}),a.jsx(Nr,{path:"/students",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.TEACHER,ft.STAFF],children:a.jsx(K9,{})})})})}),a.jsx(Nr,{path:"/examinations/configuration",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN],children:a.jsx(H2,{apiBaseUrl:typeof window<"u"&&window.__API_BASE_URL__?window.__API_BASE_URL__:"http://localhost:8080"})})})})}),a.jsx(Nr,{path:"/staff",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.PRINCIPAL],children:a.jsx(mV,{})})})})}),a.jsx(Nr,{path:"/consolidated-courses",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.TEACHER],children:a.jsx(yV,{})})})})}),a.jsx(Nr,{path:"/teacher-attendance",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.PRINCIPAL,ft.TEACHER],children:a.jsx($V,{})})})})}),a.jsx(Nr,{path:"/staff-attendance",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.PRINCIPAL,ft.STAFF,ft.LIBRARIAN],children:a.jsx(NV,{})})})})}),a.jsx(Nr,{path:"/timetable",element:a.jsx(sn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.PRINCIPAL,ft.TEACHER],children:a.jsx(rn,{children:a.jsx(zV,{})})})})}),a.jsx(Nr,{path:"/exams/report-cards",element:a.jsx(sn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.TEACHER,ft.PRINCIPAL],children:a.jsx(rn,{children:a.jsx(BV,{})})})})}),a.jsx(Nr,{path:"/exams/marks/entry",element:a.jsx(sn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.TEACHER,ft.PRINCIPAL],children:a.jsx(rn,{children:a.jsx(u4,{})})})})}),a.jsx(Nr,{path:"/admissions",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.STAFF],children:a.jsx(E2,{})})})})}),a.jsx(Nr,{path:"/fees",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN],children:a.jsx(AO,{})})})})}),a.jsx(Nr,{path:"/library",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.LIBRARIAN],children:a.jsx(a7,{})})})})}),a.jsx(Nr,{path:"/student-attendance",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.TEACHER,ft.STUDENT],children:a.jsx(s7,{})})})})}),a.jsx(Nr,{path:"/settings/school",element:a.jsx(sn,{children:a.jsx(rn,{children:a.jsx(nn,{allowedRoles:[ft.ADMIN,ft.PRINCIPAL],children:a.jsx(i7,{})})})})})]})})})})})}vu.createRoot(document.getElementById("root")).render(a.jsx(it.StrictMode,{children:a.jsx(o7,{})}));export{qr as _,ge as a,Sn as b,Et as c,yg as d,Bt as f,pg as p,ed as t};
//# sourceMappingURL=index-aebd346b.js.map
