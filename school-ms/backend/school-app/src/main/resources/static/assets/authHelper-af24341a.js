import{b as p,c as a,_ as d}from"./index-aebd346b.js";import"./mui-vendor-a24771cc.js";import"./react-vendor-a7454736.js";import"./chart-vendor-adb38d29.js";const k=()=>{const o=localStorage.getItem("token");return o?`Bearer ${o}`:""},u=()=>{const o=p.create({baseURL:a.apiUrl,timeout:a.apiTimeout,withCredentials:!0,headers:{"Content-Type":"application/json","Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});return o.interceptors.request.use(t=>(console.log(`Auth request to ${t.url}`,{method:t.method,headers:t.headers,timestamp:new Date().toISOString()}),t)),o.interceptors.response.use(t=>t,t=>{var n,i,c,r,e,l;return console.error("Auth Request Error:",{status:(n=t.response)==null?void 0:n.status,statusText:(i=t.response)==null?void 0:i.statusText,data:(c=t.response)==null?void 0:c.data,url:(r=t.config)==null?void 0:r.url,method:(e=t.config)==null?void 0:e.method,headers:(l=t.config)==null?void 0:l.headers}),Promise.reject(t)}),o},m=async(o,t)=>{var i,c;const n=u();try{let r=null;try{r=await d(()=>import("./index-aebd346b.js").then(h=>h.d),["assets/index-aebd346b.js","assets/mui-vendor-a24771cc.js","assets/react-vendor-a7454736.js","assets/chart-vendor-adb38d29.js","assets/index-c1abdb85.css"]);const s=await r.testBackendConnectivity();if(!s.isConnected&&s.workingUrl){console.log(`ðŸ”„ AuthHelper: Updating API URL from ${a.apiUrl} to ${s.workingUrl}`),a.apiUrl=s.workingUrl;const h=u();n.defaults.baseURL=s.workingUrl}}catch(s){console.error("Failed to import connectivity checker",s)}let e=o;return!e.startsWith("/")&&!e.startsWith("http")?e=`/api/${o}`:e.startsWith("/")&&!e.startsWith("/api/")&&(e=`/api${e}`),console.log(`ðŸ“¡ AuthFetch: Attempting request to ${a.apiUrl}${e}`),(await n.post(e,t)).data}catch(r){if(console.error("Auth fetch failed:",r),r instanceof Error&&((i=r.message)!=null&&i.includes("Network Error"))||r instanceof Error&&((c=r.message)!=null&&c.includes("ECONNREFUSED"))){console.error("ðŸ”Œ Network connection error. Backend may be unavailable.");try{const e=new URL(a.apiUrl).port,l=["8080","8081","8082","5000"].filter(s=>s!==e);console.log(`ðŸ’¡ Try using one of these ports instead: ${l.join(", ")}`)}catch{}}throw r}},A={authFetch:m,createAuthRequest:u};export{m as authFetch,u as createAuthRequest,A as default,k as getAuthHeader};
//# sourceMappingURL=authHelper-af24341a.js.map
