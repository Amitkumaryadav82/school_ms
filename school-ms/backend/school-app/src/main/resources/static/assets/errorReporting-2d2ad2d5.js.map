{"version":3,"file":"errorReporting-2d2ad2d5.js","sources":["../../src/services/errorReporting.ts"],"sourcesContent":["/**\r\n * Error reporting service for payment and CORS issues\r\n * This service helps collect diagnostic information for troubleshooting payment-related problems\r\n */\r\n\r\n// List of common CORS and payment error patterns to identify\r\nconst ERROR_PATTERNS = {\r\n  CORS: [\r\n    'has been blocked by CORS policy',\r\n    'Access-Control-Allow-Origin',\r\n    'Request header field',\r\n    'is not allowed by',\r\n    'preflight response',\r\n    'Network Error'\r\n  ],\r\n  PAYMENT: [\r\n    'feeId',\r\n    'studentId',\r\n    'amount',\r\n    'Invalid payment',\r\n    'Payment failed',\r\n    'Fee structure not found'\r\n  ],\r\n  FEE_NOT_FOUND: [\r\n    'Fee not found',\r\n    'with id:',\r\n    '404 Not Found',\r\n    'EntityNotFoundException'\r\n  ]\r\n};\r\n\r\n/**\r\n * Collects detailed diagnostic information about a payment error\r\n * @param error The error that occurred\r\n * @param paymentData The payment data that was being submitted\r\n * @returns Object with diagnostic information\r\n */\r\nexport const collectPaymentErrorDiagnostics = (error: any, paymentData?: any) => {\r\n  const timestamp = new Date().toISOString();\r\n  const errorType = identifyErrorType(error);\r\n    const diagnostics = {\r\n    timestamp,\r\n    errorType,\r\n    message: error.message || 'Unknown error',\r\n    status: error.response?.status || 'unknown',\r\n    browser: navigator.userAgent,\r\n    url: error.config?.url || 'unknown',\r\n    corsRelated: errorType === 'CORS',\r\n    validationRelated: errorType === 'VALIDATION',\r\n    feeNotFoundRelated: errorType === 'FEE_NOT_FOUND',\r\n    details: {\r\n      responseData: error.response?.data,\r\n      responseHeaders: error.response?.headers,\r\n      requestHeaders: error.config?.headers,\r\n      paymentData: sanitizePaymentData(paymentData)\r\n    },\r\n    errorStack: error.stack\r\n  };\r\n  \r\n  return diagnostics;\r\n};\r\n\r\n/**\r\n * Removes sensitive data from payment information before logging\r\n */\r\nconst sanitizePaymentData = (data: any) => {\r\n  if (!data) return null;\r\n  \r\n  // Create a copy to avoid modifying the original\r\n  const sanitized = { ...data };\r\n  \r\n  // Remove potentially sensitive fields\r\n  delete sanitized.cardNumber;\r\n  delete sanitized.cvv;\r\n  delete sanitized.pin;\r\n  delete sanitized.password;\r\n  \r\n  return sanitized;\r\n};\r\n\r\n/**\r\n * Identifies the type of error based on error details\r\n */\r\nconst identifyErrorType = (error: any): 'CORS' | 'VALIDATION' | 'NETWORK' | 'SERVER' | 'FEE_NOT_FOUND' | 'UNKNOWN' => {\r\n  // Check if it's a \"Fee not found\" error\r\n  if (error.response?.status === 404 &&\r\n      ERROR_PATTERNS.FEE_NOT_FOUND.some(pattern => \r\n        error.response?.data?.message?.includes(pattern) || \r\n        error.message?.includes(pattern) ||\r\n        error.toString().includes(pattern))) {\r\n    return 'FEE_NOT_FOUND';\r\n  }\r\n  \r\n  // Check if it's a CORS error\r\n  if (ERROR_PATTERNS.CORS.some(pattern => \r\n      error.message?.includes(pattern) || \r\n      error.toString().includes(pattern) ||\r\n      error.response?.data?.message?.includes(pattern))) {\r\n    return 'CORS';\r\n  }\r\n  \r\n  // Check if it's a validation error\r\n  if (error.response?.status === 400 || \r\n      error.response?.data?.validationErrors ||\r\n      error.response?.data?.fieldErrors) {\r\n    return 'VALIDATION';  \r\n  }\r\n  \r\n  // Check if it's a network error\r\n  if (error.message?.includes('Network Error') || !error.response) {\r\n    return 'NETWORK';\r\n  }\r\n  \r\n  // Check if it's a server error\r\n  if (error.response?.status >= 500) {\r\n    return 'SERVER';\r\n  }\r\n  \r\n  return 'UNKNOWN';\r\n};\r\n\r\n/**\r\n * Reports payment errors to console and could be extended to send to a logging service\r\n */\r\nexport const reportPaymentError = (error: any, paymentData?: any) => {\r\n  const diagnostics = collectPaymentErrorDiagnostics(error, paymentData);\r\n  \r\n  console.group(`Payment Error Report [${diagnostics.timestamp}]`);\r\n  console.error(`Error Type: ${diagnostics.errorType}`);\r\n  console.error(`Message: ${diagnostics.message}`);\r\n  console.error(`Status: ${diagnostics.status}`);\r\n  \r\n  if (diagnostics.corsRelated) {\r\n    console.error('This appears to be a CORS-related issue');\r\n    console.error('CORS Troubleshooting:');\r\n    console.error('1. Check backend CORS configuration');\r\n    console.error('2. Verify allowed origins and headers');\r\n    console.error('3. Ensure preflight requests are handled correctly');\r\n  }\r\n  \r\n  if (diagnostics.validationRelated) {\r\n    console.error('This appears to be a validation error');\r\n    console.error('Validation details:', diagnostics.details.responseData);\r\n  }\r\n  \r\n  if (diagnostics.errorType === 'FEE_NOT_FOUND') {\r\n    console.error('This is a \"Fee not found\" error');\r\n    console.error('Troubleshooting steps:');\r\n    console.error('1. Create a fee structure for the student\\'s grade');\r\n    console.error('2. Check if the feeId parameter is correct');\r\n    console.error('3. Ensure the fee structure exists in the database');\r\n    console.error('4. Check the fee structure to payment mapping');\r\n    \r\n    // Add feeNotFoundRelated property to diagnostics\r\n    diagnostics.feeNotFoundRelated = true;\r\n  }\r\n  \r\n  console.error('Full diagnostics:', diagnostics);\r\n  console.groupEnd();\r\n  \r\n  return diagnostics;\r\n};\r\n\r\nexport default {\r\n  reportPaymentError,\r\n  collectPaymentErrorDiagnostics\r\n};\r\n"],"names":["ERROR_PATTERNS","collectPaymentErrorDiagnostics","error","paymentData","_a","_b","_c","_d","_e","timestamp","errorType","identifyErrorType","sanitizePaymentData","data","sanitized","_f","_g","_h","pattern","reportPaymentError","diagnostics","errorReporting"],"mappings":"AAMA,MAAMA,EAAiB,CACrB,KAAM,CACJ,kCACA,8BACA,uBACA,oBACA,qBACA,eACF,EACA,QAAS,CACP,QACA,YACA,SACA,kBACA,iBACA,yBACF,EACA,cAAe,CACb,gBACA,WACA,gBACA,yBACF,CACF,EAQaC,EAAiC,CAACC,EAAYC,IAAsB,CA/BjF,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAgCE,MAAMC,EAAY,IAAI,KAAK,EAAE,YAAY,EACnCC,EAAYC,EAAkBT,CAAK,EAoBlC,MAnBe,CACpB,UAAAO,EACA,UAAAC,EACA,QAASR,EAAM,SAAW,gBAC1B,SAAQE,EAAAF,EAAM,WAAN,YAAAE,EAAgB,SAAU,UAClC,QAAS,UAAU,UACnB,MAAKC,EAAAH,EAAM,SAAN,YAAAG,EAAc,MAAO,UAC1B,YAAaK,IAAc,OAC3B,kBAAmBA,IAAc,aACjC,mBAAoBA,IAAc,gBAClC,QAAS,CACP,cAAcJ,EAAAJ,EAAM,WAAN,YAAAI,EAAgB,KAC9B,iBAAiBC,EAAAL,EAAM,WAAN,YAAAK,EAAgB,QACjC,gBAAgBC,EAAAN,EAAM,SAAN,YAAAM,EAAc,QAC9B,YAAaI,EAAoBT,CAAW,CAC9C,EACA,WAAYD,EAAM,KAAA,CAItB,EAKMU,EAAuBC,GAAc,CACzC,GAAI,CAACA,EAAa,OAAA,KAGZ,MAAAC,EAAY,CAAE,GAAGD,GAGvB,cAAOC,EAAU,WACjB,OAAOA,EAAU,IACjB,OAAOA,EAAU,IACjB,OAAOA,EAAU,SAEVA,CACT,EAKMH,EAAqBT,GAA2F,CA7EtH,IAAAE,EAAAC,EAAAC,EAAAC,EAAAC,EAAAO,EAAAC,EAAAC,EA+EM,QAAAb,EAAAF,EAAM,WAAN,YAAAE,EAAgB,UAAW,KAC3BJ,EAAe,cAAc,KAC3BkB,GAAA,CAjFR,IAAAd,EAAAC,EAAAC,EAAAC,EAiFQ,QAAAD,GAAAD,GAAAD,EAAAF,EAAM,WAAN,YAAAE,EAAgB,OAAhB,YAAAC,EAAsB,UAAtB,YAAAC,EAA+B,SAASY,OACxCX,EAAAL,EAAM,UAAN,YAAAK,EAAe,SAASW,KACxBhB,EAAM,SAAW,EAAA,SAASgB,CAAO,EAAC,EAC/B,gBAILlB,EAAe,KAAK,KAAKkB,IAxF/B,IAAAd,EAAAC,EAAAC,EAAAC,EAyFM,QAAAH,EAAAF,EAAM,UAAN,YAAAE,EAAe,SAASc,KACxBhB,EAAM,SAAA,EAAW,SAASgB,CAAO,KACjCX,GAAAD,GAAAD,EAAAH,EAAM,WAAN,YAAAG,EAAgB,OAAhB,YAAAC,EAAsB,UAAtB,YAAAC,EAA+B,SAASW,IAAQ,EAC3C,SAILb,EAAAH,EAAM,WAAN,YAAAG,EAAgB,UAAW,MAC3BE,GAAAD,EAAAJ,EAAM,WAAN,YAAAI,EAAgB,OAAhB,MAAAC,EAAsB,mBACtBQ,GAAAP,EAAAN,EAAM,WAAN,YAAAM,EAAgB,OAAhB,MAAAO,EAAsB,YACjB,cAILC,EAAAd,EAAM,UAAN,MAAAc,EAAe,SAAS,kBAAoB,CAACd,EAAM,SAC9C,YAILe,EAAAf,EAAM,WAAN,YAAAe,EAAgB,SAAU,IACrB,SAGF,SACT,EAKaE,EAAqB,CAACjB,EAAYC,IAAsB,CAC7D,MAAAiB,EAAcnB,EAA+BC,EAAOC,CAAW,EAErE,eAAQ,MAAM,yBAAyBiB,EAAY,SAAS,GAAG,EAC/D,QAAQ,MAAM,eAAeA,EAAY,SAAS,EAAE,EACpD,QAAQ,MAAM,YAAYA,EAAY,OAAO,EAAE,EAC/C,QAAQ,MAAM,WAAWA,EAAY,MAAM,EAAE,EAEzCA,EAAY,cACd,QAAQ,MAAM,yCAAyC,EACvD,QAAQ,MAAM,uBAAuB,EACrC,QAAQ,MAAM,qCAAqC,EACnD,QAAQ,MAAM,uCAAuC,EACrD,QAAQ,MAAM,oDAAoD,GAGhEA,EAAY,oBACd,QAAQ,MAAM,uCAAuC,EACrD,QAAQ,MAAM,sBAAuBA,EAAY,QAAQ,YAAY,GAGnEA,EAAY,YAAc,kBAC5B,QAAQ,MAAM,iCAAiC,EAC/C,QAAQ,MAAM,wBAAwB,EACtC,QAAQ,MAAM,mDAAoD,EAClE,QAAQ,MAAM,4CAA4C,EAC1D,QAAQ,MAAM,oDAAoD,EAClE,QAAQ,MAAM,+CAA+C,EAG7DA,EAAY,mBAAqB,IAG3B,QAAA,MAAM,oBAAqBA,CAAW,EAC9C,QAAQ,SAAS,EAEVA,CACT,EAEeC,EAAA,CACb,mBAAAF,EACA,+BAAAlB,CACF"}