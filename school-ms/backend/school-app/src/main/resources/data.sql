-- ============================================================================
-- H2 DEV SEED: grade_levels, sections, class_sections
-- These tables power the /api/classes/{classId}/sections endpoint.
-- In dev we use H2 (see application.properties), so we need H2-compatible DDL.
-- This block is safe to run on every startup with create-drop.
-- ============================================================================

CREATE TABLE IF NOT EXISTS grade_levels (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	grade_number INT NOT NULL,
	name VARCHAR(50) NOT NULL,
	description VARCHAR(255),
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_grade_number UNIQUE (grade_number)
);

CREATE TABLE IF NOT EXISTS sections (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	section_name VARCHAR(5) NOT NULL,
	description VARCHAR(255),
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_section_name UNIQUE (section_name)
);

CREATE TABLE IF NOT EXISTS class_sections (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	grade_id BIGINT NOT NULL,
	section_id BIGINT NOT NULL,
	capacity INT DEFAULT 40,
	room_number VARCHAR(10),
	academic_year VARCHAR(9) DEFAULT '2025-2026',
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT fk_grade_id FOREIGN KEY (grade_id) REFERENCES grade_levels(id) ON DELETE CASCADE,
	CONSTRAINT fk_section_id FOREIGN KEY (section_id) REFERENCES sections(id) ON DELETE CASCADE,
	CONSTRAINT uq_grade_section_year UNIQUE (grade_id, section_id, academic_year)
);

-- Populate grades 1-12 (fresh H2 memory each boot)
INSERT INTO grade_levels (grade_number, name, description) VALUES
(1, 'Grade 1', 'First grade - Elementary level'),
(2, 'Grade 2', 'Second grade - Elementary level'),
(3, 'Grade 3', 'Third grade - Elementary level'),
(4, 'Grade 4', 'Fourth grade - Elementary level'),
(5, 'Grade 5', 'Fifth grade - Elementary level'),
(6, 'Grade 6', 'Sixth grade - Middle school level'),
(7, 'Grade 7', 'Seventh grade - Middle school level'),
(8, 'Grade 8', 'Eighth grade - Middle school level'),
(9, 'Grade 9', 'Ninth grade - High school level'),
(10, 'Grade 10', 'Tenth grade - High school level'),
(11, 'Grade 11', 'Eleventh grade - High school level'),
(12, 'Grade 12', 'Twelfth grade - High school level');

-- Populate sections A-D by default (enough for demo; extend if needed)
INSERT INTO sections (section_name, description) VALUES
('A', 'Section A'),
('B', 'Section B'),
('C', 'Section C'),
('D', 'Section D');

-- Create all combinations of grades 1-12 with sections A-D
INSERT INTO class_sections (grade_id, section_id, room_number, academic_year)
SELECT g.id, s.id, CAST(g.grade_number AS VARCHAR) || s.section_name, '2025-2026'
FROM grade_levels g
CROSS JOIN sections s
WHERE s.section_name IN ('A','B','C','D');

-- Seed School Classes (used by /api/classes and exam management)
INSERT INTO classes (name) VALUES
('Class 1'),
('Class 2'),
('Class 3'),
('Class 4'),
('Class 5'),
('Class 6'),
('Class 7'),
('Class 8'),
('Class 9'),
('Class 10'),
('Class 11'),
('Class 12');

-- Seed Subjects (used by /api/subjects in Exam Configuration)
INSERT INTO subjects (name, code, description, max_marks, theory_marks, practical_marks) VALUES
('Mathematics', 'MATH01', 'Core mathematics', 100, 100, 0),
('English Language', 'ENG01', 'English language skills', 100, 100, 0),
('Science', 'SCI01', 'General science', 100, 90, 10),
('Social Studies', 'SS01', 'History/Geography/Civics', 100, 100, 0),
('Hindi', 'HIN01', 'Hindi language', 100, 100, 0),
('Computer Science', 'CS01', 'Computers and programming', 100, 70, 30),
('Physics', 'PHY01', 'Physics theory and practical', 100, 70, 30),
('Chemistry', 'CHEM01', 'Chemistry theory and practical', 100, 70, 30),
('Biology', 'BIO01', 'Biology theory and practical', 100, 70, 30),
('Physical Education', 'PE01', 'Sports and physical education', 100, 0, 100);

-- ============================================================================
-- H2 DEV SEED: Exam Marks Tables (summary + details)
-- Supports /api/exams/marks endpoints used by Marks Entry UI
-- ============================================================================

CREATE TABLE IF NOT EXISTS exam_mark_summaries (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	exam_id BIGINT NOT NULL,
	class_id BIGINT,
	subject_id BIGINT NOT NULL,
	student_id BIGINT NOT NULL,
	is_absent BOOLEAN DEFAULT FALSE,
	absence_reason VARCHAR(500),
	total_theory_marks DOUBLE,
	total_practical_marks DOUBLE,
	locked BOOLEAN DEFAULT FALSE,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_exam_subject_student UNIQUE (exam_id, subject_id, student_id)
);

CREATE TABLE IF NOT EXISTS exam_mark_details (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	summary_id BIGINT NOT NULL,
	question_format_id BIGINT NOT NULL,
	question_number INT NOT NULL,
	unit_name VARCHAR(255),
	question_type VARCHAR(20),
	max_marks DOUBLE NOT NULL,
	obtained_marks DOUBLE DEFAULT 0,
	evaluator_comments VARCHAR(500),
	last_edit_reason VARCHAR(500),
	last_edit_at TIMESTAMP,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT fk_summary_id FOREIGN KEY (summary_id) REFERENCES exam_mark_summaries(id) ON DELETE CASCADE,
	CONSTRAINT uq_summary_qpf UNIQUE (summary_id, question_format_id)
);

-- ============================================================================
-- Test Data for School Management System
-- This file automatically loads sample data every time the application starts

-- ============================================================================
-- 1. USERS (Additional users beyond the auto-created admin)
-- ============================================================================
INSERT INTO users (created_at, updated_at, created_by, modified_by, account_non_expired, account_non_locked, credentials_non_expired, email, enabled, full_name, password, role, username) VALUES
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', true, true, true, 'teacher1@schoolms.com', true, 'Sarah Johnson', '$2a$10$Igjc9Jrznz/gzw4FkwoADeT4hOxwsm.yHaX./G0KH8qi.gVjzzm7G', 'TEACHER', 'teacher1'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', true, true, true, 'teacher2@schoolms.com', true, 'Michael Chen', '$2a$10$Igjc9Jrznz/gzw4FkwoADeT4hOxwsm.yHaX./G0KH8qi.gVjzzm7G', 'TEACHER', 'teacher2'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', true, true, true, 'principal@schoolms.com', true, 'Dr. Emily Rodriguez', '$2a$10$Igjc9Jrznz/gzw4FkwoADeT4hOxwsm.yHaX./G0KH8qi.gVjzzm7G', 'PRINCIPAL', 'principal'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', true, true, true, 'clerk@schoolms.com', true, 'Robert Smith', '$2a$10$Igjc9Jrznz/gzw4FkwoADeT4hOxwsm.yHaX./G0KH8qi.gVjzzm7G', 'CLERK', 'clerk'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', true, true, true, 'librarian@schoolms.com', true, 'Lisa Wang', '$2a$10$Igjc9Jrznz/gzw4FkwoADeT4hOxwsm.yHaX./G0KH8qi.gVjzzm7G', 'LIBRARIAN', 'librarian');

-- ============================================================================
-- 2. STAFF ROLES (Required for staff records)
-- ============================================================================
INSERT INTO staff_roles (name, description, is_active) VALUES
('Mathematics Teacher', 'Teaches mathematics subjects', true),
('Science Teacher', 'Teaches science subjects', true),
('Principal', 'School administrator and head', true),
('Administrative Clerk', 'Handles administrative tasks', true),
('Librarian', 'Manages school library', true);

-- ============================================================================
-- 3. TEACHER DETAILS (Required for some staff records)
-- ============================================================================
INSERT INTO teacher_details (created_at, updated_at, qualification, specialization, subjects_taught, years_of_experience, department, educational_background, certifications, professional_development) VALUES
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'M.Sc Mathematics', 'Algebra and Calculus', 'Mathematics, Statistics', 8, 'Mathematics', 'B.Sc Mathematics, M.Sc Mathematics', 'Teaching License, Advanced Math Certification', 'Annual Math Conference 2024'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'M.Sc Physics', 'Quantum Physics', 'Physics, Chemistry', 12, 'Science', 'B.Sc Physics, M.Sc Physics', 'Science Teaching License, Lab Safety Certification', 'Science Educators Workshop 2024'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'M.Ed Administration', 'Educational Leadership', 'Administrative Management', 15, 'Administration', 'B.A Education, M.Ed Administration, Ph.D Educational Leadership', 'Principal License, Leadership Certification', 'Educational Leadership Summit 2024'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'B.A Business Administration', 'Office Management', 'Administrative Support', 5, 'Administration', 'B.A Business Administration', 'Office Management Certification', 'Administrative Skills Workshop 2024'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'M.L.I.S', 'Information Systems', 'Library Management', 7, 'Library', 'B.A Literature, M.L.I.S', 'Library Science Certification, Digital Archives Training', 'Modern Library Management Conference 2024');

-- ============================================================================
-- 4. SCHOOL STAFF (5 staff members with relationships)
-- ============================================================================
INSERT INTO school_staff (staff_id, first_name, last_name, email, phone_number, date_of_birth, gender, address, join_date, is_active, active, role, department, designation, emergency_contact, blood_group, qualifications, employment_status, basic_salary, hra, da, user_id, role_id, teacher_details_id) VALUES
('STAFF001', 'Sarah', 'Johnson', 'sarah.johnson@schoolms.com', '+1-555-0101', '1985-03-15', 'FEMALE', '123 Maple Street, Springfield, IL 62701', '2020-08-15', true, true, 'Mathematics Teacher', 'Mathematics', 'Senior Teacher', '+1-555-0102', 'O+', 'M.Sc Mathematics, Teaching License', 'ACTIVE', 55000.00, 11000.00, 5500.00, 2, 1, 1),
('STAFF002', 'Michael', 'Chen', 'michael.chen@schoolms.com', '+1-555-0201', '1980-07-22', 'MALE', '456 Oak Avenue, Springfield, IL 62702', '2018-01-10', true, true, 'Science Teacher', 'Science', 'Department Head', '+1-555-0202', 'A+', 'M.Sc Physics, Science Teaching License', 'ACTIVE', 60000.00, 12000.00, 6000.00, 3, 2, 2),
('STAFF003', 'Emily', 'Rodriguez', 'emily.rodriguez@schoolms.com', '+1-555-0301', '1975-11-08', 'FEMALE', '789 Pine Road, Springfield, IL 62703', '2015-07-01', true, true, 'Principal', 'Administration', 'Principal', '+1-555-0302', 'B+', 'Ph.D Educational Leadership, Principal License', 'ACTIVE', 85000.00, 17000.00, 8500.00, 4, 3, 3),
('STAFF004', 'Robert', 'Smith', 'robert.smith@schoolms.com', '+1-555-0401', '1990-05-14', 'MALE', '321 Elm Street, Springfield, IL 62704', '2021-03-20', true, true, 'Administrative Clerk', 'Administration', 'Senior Clerk', '+1-555-0402', 'AB+', 'B.A Business Administration, Office Management Certification', 'ACTIVE', 40000.00, 8000.00, 4000.00, 5, 4, 4),
('STAFF005', 'Lisa', 'Wang', 'lisa.wang@schoolms.com', '+1-555-0501', '1988-09-30', 'FEMALE', '654 Birch Lane, Springfield, IL 62705', '2019-11-12', true, true, 'Librarian', 'Library', 'Head Librarian', '+1-555-0502', 'O-', 'M.L.I.S, Library Science Certification', 'ACTIVE', 48000.00, 9600.00, 4800.00, 6, 5, 5);

-- ============================================================================
-- 5. FEE STRUCTURES (5 different grade fee structures)
-- ============================================================================
INSERT INTO fee_structures (created_at, updated_at, created_by, modified_by, class_grade, annual_fees, building_fees, lab_fees) VALUES
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 1, 12000.00, 2000.00, 1000.00),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 5, 15000.00, 2500.00, 1500.00),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 8, 18000.00, 3000.00, 2000.00),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 10, 22000.00, 3500.00, 2500.00),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 12, 25000.00, 4000.00, 3000.00);

-- ============================================================================
-- 6. ADMISSIONS (5 admission records, some will be linked to students)
-- ============================================================================
INSERT INTO admissions (created_at, updated_at, created_by, modified_by, applicant_name, date_of_birth, grade_applying, application_date, contact_number, email, address, guardian_name, guardian_contact, guardian_email, blood_group, medical_conditions, previous_school, previous_grade, previous_percentage, status) VALUES
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'Alex Thompson', '2010-04-12', 8, '2024-03-15', '+1-555-1001', 'alex.thompson@email.com', '111 First Street, Springfield, IL 62706', 'David Thompson', '+1-555-1002', 'david.thompson@email.com', 'A+', 'None', 'Springfield Elementary', '7', '85%', 'APPROVED'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'Maya Patel', '2012-08-25', 5, '2024-03-20', '+1-555-1101', 'maya.patel@email.com', '222 Second Avenue, Springfield, IL 62707', 'Priya Patel', '+1-555-1102', 'priya.patel@email.com', 'B+', 'Mild asthma', 'Greenwood Elementary', '4', '92%', 'APPROVED'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'Jordan Williams', '2008-12-03', 10, '2024-03-25', '+1-555-1201', 'jordan.williams@email.com', '333 Third Road, Springfield, IL 62708', 'Michelle Williams', '+1-555-1202', 'michelle.williams@email.com', 'O+', 'None', 'Lincoln Middle School', '9', '88%', 'APPROVED'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'Zoe Garcia', '2006-06-18', 12, '2024-03-30', '+1-555-1301', 'zoe.garcia@email.com', '444 Fourth Street, Springfield, IL 62709', 'Carlos Garcia', '+1-555-1302', 'carlos.garcia@email.com', 'AB+', 'None', 'Roosevelt High School', '11', '95%', 'APPROVED'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'Emma Johnson', '2014-01-07', 1, '2024-04-05', '+1-555-1401', 'emma.johnson@email.com', '555 Fifth Avenue, Springfield, IL 62710', 'Jennifer Johnson', '+1-555-1402', 'jennifer.johnson@email.com', 'O-', 'Food allergy (nuts)', 'Sunshine Preschool', 'Kindergarten', '90%', 'PENDING');

-- ============================================================================
-- 7. STUDENTS (5 students linked to approved admissions)
-- ============================================================================
INSERT INTO students (created_at, updated_at, created_by, modified_by, student_id, first_name, last_name, date_of_birth, grade, section, roll_number, email, contact_number, address, guardian_name, guardian_contact, guardian_email, guardian_annual_income, guardian_occupation, guardian_office_address, blood_group, medical_conditions, admission_date, status, house_alloted, transport_mode, bus_route_number, whatsapp_number, aadhar_number, udise_number, subjects, admission_id) VALUES
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'STU2024001', 'Alex', 'Thompson', '2010-04-12', 8, 'A', 'R8A001', 'alex.thompson@email.com', '+1-555-1001', '111 First Street, Springfield, IL 62706', 'David Thompson', '+1-555-1002', 'david.thompson@email.com', 75000.00, 'Software Engineer', '100 Tech Park, Springfield, IL', 'A+', 'None', '2024-04-01', 'ACTIVE', 'Red House', 'BUS', 'Route-5', '+1-555-1001', '123456789012', 'UDISE001', 'Mathematics, Science, English, Social Studies', 1),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'STU2024002', 'Maya', 'Patel', '2012-08-25', 5, 'B', 'R5B002', 'maya.patel@email.com', '+1-555-1101', '222 Second Avenue, Springfield, IL 62707', 'Priya Patel', '+1-555-1102', 'priya.patel@email.com', 85000.00, 'Doctor', '200 Medical Center, Springfield, IL', 'B+', 'Mild asthma', '2024-04-01', 'ACTIVE', 'Blue House', 'PRIVATE', null, '+1-555-1101', '123456789013', 'UDISE002', 'Mathematics, Science, English, Hindi, Art', 2),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'STU2024003', 'Jordan', 'Williams', '2008-12-03', 10, 'A', 'R10A003', 'jordan.williams@email.com', '+1-555-1201', '333 Third Road, Springfield, IL 62708', 'Michelle Williams', '+1-555-1202', 'michelle.williams@email.com', 65000.00, 'Teacher', '300 Education District, Springfield, IL', 'O+', 'None', '2024-04-01', 'ACTIVE', 'Green House', 'BUS', 'Route-3', '+1-555-1201', '123456789014', 'UDISE003', 'Mathematics, Physics, Chemistry, Biology, English', 3),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'STU2024004', 'Zoe', 'Garcia', '2006-06-18', 12, 'A', 'R12A004', 'zoe.garcia@email.com', '+1-555-1301', '444 Fourth Street, Springfield, IL 62709', 'Carlos Garcia', '+1-555-1302', 'carlos.garcia@email.com', 95000.00, 'Business Owner', '400 Business Plaza, Springfield, IL', 'AB+', 'None', '2024-04-01', 'ACTIVE', 'Yellow House', 'PRIVATE', null, '+1-555-1301', '123456789015', 'UDISE004', 'Mathematics, Physics, Chemistry, Computer Science, English', 4),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'STU2024005', 'Sam', 'Lee', '2013-11-20', 3, 'C', 'R3C005', 'sam.lee@email.com', '+1-555-1501', '666 Sixth Street, Springfield, IL 62711', 'Helen Lee', '+1-555-1502', 'helen.lee@email.com', 55000.00, 'Nurse', '500 Hospital Way, Springfield, IL', 'A-', 'None', '2024-04-01', 'ACTIVE', 'Red House', 'WALKING', null, '+1-555-1501', '123456789016', 'UDISE005', 'Mathematics, English, Science, Art, Music', null);

-- ============================================================================
-- 8. ATTENDANCE (Comprehensive attendance records with all possible status values)
-- ============================================================================
-- Current day attendance (July 1, 2024)
INSERT INTO attendance (created_at, updated_at, created_by, modified_by, student_id, date, status, check_in_time, check_out_time, remarks) VALUES
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 1, '2024-07-01', 'PRESENT', '08:15:00', '15:30:00', 'On time'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 2, '2024-07-01', 'LATE', '08:45:00', '15:30:00', 'Traffic delay - arrived 15 minutes late'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 3, '2024-07-01', 'ABSENT', null, null, 'Medical appointment with doctor'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 4, '2024-07-01', 'PRESENT', '08:10:00', '15:30:00', 'Early arrival'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 5, '2024-07-01', 'HALF_DAY', '08:20:00', '12:00:00', 'Left early for family function'),

-- Previous day attendance (June 30, 2024) - showing different statuses
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 1, '2024-06-30', 'HALF_DAY', '08:15:00', '12:30:00', 'Early dismissal for dental appointment'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 2, '2024-06-30', 'PRESENT', '08:18:00', '15:30:00', 'Regular attendance'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 3, '2024-06-30', 'ON_LEAVE', null, null, 'Pre-approved family vacation'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 4, '2024-06-30', 'LATE', '08:50:00', '15:30:00', 'Bus breakdown delay'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 5, '2024-06-30', 'ABSENT', null, null, 'Sick with fever'),

-- Weekend/Holiday attendance (June 29, 2024 - Saturday)
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', 1, '2024-06-29', 'HOLIDAY', null, null, 'Weekend - Saturday'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', 2, '2024-06-29', 'HOLIDAY', null, null, 'Weekend - Saturday'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', 3, '2024-06-29', 'HOLIDAY', null, null, 'Weekend - Saturday'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', 4, '2024-06-29', 'HOLIDAY', null, null, 'Weekend - Saturday'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'system', 'system', 5, '2024-06-29', 'HOLIDAY', null, null, 'Weekend - Saturday'),

-- Additional day showing more variety (June 28, 2024)
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 1, '2024-06-28', 'LATE', '08:35:00', '15:30:00', 'Overslept - alarm malfunction'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 2, '2024-06-28', 'ON_LEAVE', null, null, 'Family wedding celebration'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 3, '2024-06-28', 'PRESENT', '08:12:00', '15:30:00', 'Perfect attendance'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 4, '2024-06-28', 'HALF_DAY', '08:15:00', '11:45:00', 'Left for medical checkup'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 5, '2024-06-28', 'PRESENT', '08:25:00', '15:30:00', 'Normal day'),

-- One more day for complete coverage (June 27, 2024)
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 1, '2024-06-27', 'ON_LEAVE', null, null, 'Educational field trip approval'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 2, '2024-06-27', 'ABSENT', null, null, 'Stomach flu - contagious'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 3, '2024-06-27', 'HALF_DAY', '08:15:00', '13:00:00', 'Early dismissal for orthodontist'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher2', 'teacher2', 4, '2024-06-27', 'PRESENT', '08:05:00', '15:30:00', 'Excellent punctuality'),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'teacher1', 'teacher1', 5, '2024-06-27', 'LATE', '09:10:00', '15:30:00', 'Car trouble - called parents');

-- ============================================================================
-- DATA LOADING COMPLETE
-- ============================================================================
-- Summary:
-- - 5 Additional Users (plus existing admin = 6 total)
-- - 5 Staff Roles
-- - 5 Teacher Details
-- - 5 School Staff members
-- - 5 Fee Structures (for grades 1, 5, 8, 10, 12)
-- - 5 Admission records
-- - 5 Students (4 linked to admissions, 1 direct)
-- - 25 Attendance records (5 students × 5 days with ALL status types)
-- - 37 Subject Masters (comprehensive subject catalog for exam configuration)
-- 
-- Attendance Status Coverage:
-- ✅ PRESENT   - Regular attendance
-- ✅ ABSENT    - Student not in school  
-- ✅ LATE      - Arrived after start time
-- ✅ HALF_DAY  - Left early or came late for half day
-- ✅ ON_LEAVE  - Pre-approved absence
-- ✅ HOLIDAY   - School closed day (weekends/holidays)
-- 
-- All foreign key relationships are properly maintained
-- Data includes realistic information with proper constraints
-- Comprehensive test data for attendance system validation
-- ============================================================================
-- 9. SUBJECT MASTERS (Default subjects for exam configuration)
-- ============================================================================
INSERT INTO subject_masters (created_at, updated_at, created_by, modified_by, subject_code, subject_name, description, subject_type, is_active) VALUES
-- Core Academic Subjects
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'MATH01', 'Mathematics', 'Core mathematics including algebra, geometry, arithmetic, and problem-solving', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'ENG01', 'English Language', 'English language skills including reading, writing, speaking, and comprehension', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'ENG02', 'English Literature', 'Study of English literary works, poetry, prose, and drama', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'HIN01', 'Hindi', 'Hindi language and literature studies', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'SAN01', 'Sanskrit', 'Classical Sanskrit language and literature', 'THEORY', true),

-- Science Subjects
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'PHY01', 'Physics', 'Fundamental physics concepts with theory and practical applications', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'CHEM01', 'Chemistry', 'Chemical principles and laboratory experiments', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'BIO01', 'Biology', 'Life sciences including botany, zoology, and human biology', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'SCI01', 'General Science', 'Integrated science for elementary and middle grades', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'EVS01', 'Environmental Science', 'Environmental studies and sustainability concepts', 'THEORY', true),

-- Social Studies
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'HIST01', 'History', 'World and national history studies', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'GEO01', 'Geography', 'Physical and human geography studies', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'CIV01', 'Civics', 'Citizenship, government, and civic responsibilities', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'ECON01', 'Economics', 'Basic economic principles and concepts', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'SS01', 'Social Studies', 'Integrated social studies for elementary grades', 'THEORY', true),

-- Computer and Technology
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'CS01', 'Computer Science', 'Programming, algorithms, and computer fundamentals', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'IT01', 'Information Technology', 'Computer applications and digital literacy', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'COMP01', 'Computer Applications', 'Practical computer skills and software usage', 'PRACTICAL', true),

-- Languages
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'FRE01', 'French', 'French language studies', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'GER01', 'German', 'German language studies', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'SPA01', 'Spanish', 'Spanish language studies', 'THEORY', true),

-- Arts and Creative Subjects
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'ART01', 'Fine Arts', 'Drawing, painting, and visual arts', 'PRACTICAL', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'MUS01', 'Music', 'Music theory and practical performance', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'DAN01', 'Dance', 'Classical and contemporary dance forms', 'PRACTICAL', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'DRA01', 'Drama', 'Theater arts and dramatic performance', 'PRACTICAL', true),

-- Physical Education and Health
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'PE01', 'Physical Education', 'Sports, fitness, and physical wellness', 'PRACTICAL', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'HE01', 'Health Education', 'Health awareness and wellness concepts', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'YOGA01', 'Yoga', 'Yoga practice and philosophy', 'PRACTICAL', true),

-- Vocational and Technical
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'HE02', 'Home Economics', 'Home management and life skills', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'AGR01', 'Agriculture', 'Agricultural science and farming techniques', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'CRAFT01', 'Craft and Design', 'Handicrafts and design thinking', 'PRACTICAL', true),

-- Business and Commerce
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'ACC01', 'Accountancy', 'Financial accounting principles and practice', 'BOTH', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'BST01', 'Business Studies', 'Business management and entrepreneurship', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'COMM01', 'Commerce', 'Commercial principles and trade studies', 'THEORY', true),

-- Advanced Mathematics and Sciences
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'STAT01', 'Statistics', 'Statistical analysis and data interpretation', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'PSYCHO01', 'Psychology', 'Human behavior and mental processes', 'THEORY', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'SOCIO01', 'Sociology', 'Society and social relationships', 'THEORY', true),

-- Elementary Integrated Subjects
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'LKG01', 'LKG Activities', 'Integrated learning activities for Lower Kindergarten', 'PRACTICAL', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'UKG01', 'UKG Activities', 'Integrated learning activities for Upper Kindergarten', 'PRACTICAL', true),
('2024-07-04 10:00:00', '2024-07-04 10:00:00', 'admin', 'admin', 'PREP01', 'Preparatory Studies', 'Foundation skills for primary education', 'BOTH', true);

-- ============================================================================
-- DATA LOADING COMPLETE
-- ============================================================================

-- ============================================================================
-- TIMETABLE + TEACHER-SUBJECT NORMALIZATION (DEV SEED)
-- These are additive H2 tables used for the new Timetable feature and
-- to normalize teacher subjects without changing legacy columns.
-- Safe on create-drop; uses IF NOT EXISTS and loose FKs where applicable.
-- ============================================================================

-- Map teachers to canonical subjects (normalized)
CREATE TABLE IF NOT EXISTS teacher_subject_map (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	teacher_details_id BIGINT NOT NULL,
	subject_id BIGINT NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_teacher_subject UNIQUE (teacher_details_id, subject_id)
);

-- Map teachers to classes and sections (normalized)
CREATE TABLE IF NOT EXISTS teacher_class_map (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	teacher_details_id BIGINT NOT NULL,
	class_id BIGINT NOT NULL,
	section VARCHAR(5) NOT NULL,
	academic_year VARCHAR(9),
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_teacher_class_section UNIQUE (teacher_details_id, class_id, section)
);

-- Optional audit for migration issues (kept empty in dev seed)
CREATE TABLE IF NOT EXISTS teacher_subject_migration_issues (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	teacher_details_id BIGINT NOT NULL,
	raw_subject_name VARCHAR(255) NOT NULL,
	reason VARCHAR(50) NOT NULL,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Global Timetable settings (singleton)
CREATE TABLE IF NOT EXISTS timetable_settings (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	working_days_mask INT DEFAULT 31, -- Mon..Fri bits = 11111 (31)
	periods_per_day INT DEFAULT 8,
	period_duration_min INT DEFAULT 40,
	lunch_after_period INT DEFAULT 4,
	max_periods_per_teacher_per_day INT DEFAULT 5,
	start_time TIME DEFAULT TIME '08:30:00',
	end_time TIME DEFAULT TIME '15:30:00',
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Backward-compatible migration for existing dev DBs where columns might be missing
ALTER TABLE timetable_settings ADD COLUMN IF NOT EXISTS start_time TIME DEFAULT TIME '08:30:00';
ALTER TABLE timetable_settings ADD COLUMN IF NOT EXISTS end_time TIME DEFAULT TIME '15:30:00';
ALTER TABLE timetable_settings ADD COLUMN IF NOT EXISTS max_periods_per_teacher_per_day INT DEFAULT 5;

-- Per-class/section overrides (optional)
CREATE TABLE IF NOT EXISTS timetable_class_settings (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	class_id BIGINT NOT NULL, -- references classes(id)
	section_id BIGINT NOT NULL, -- references sections(id)
	periods_per_day INT,
	period_duration_min INT,
	lunch_after_period INT,
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_class_section UNIQUE (class_id, section_id)
);

-- Subject requirements per class/section (drives generator)
CREATE TABLE IF NOT EXISTS timetable_requirements (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	class_id BIGINT NOT NULL,
	section_id BIGINT NOT NULL,
	subject_id BIGINT NOT NULL,
	preferred_teacher_details_id BIGINT,
	weekly_periods INT NOT NULL,
	notes VARCHAR(500),
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_req UNIQUE (class_id, section_id, subject_id)
);

-- Weekly template of slots (day_of_week: 1=Mon..7=Sun)
CREATE TABLE IF NOT EXISTS timetable_slots (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	class_id BIGINT NOT NULL,
	section_id BIGINT NOT NULL,
	day_of_week INT NOT NULL,
	period_no INT NOT NULL,
	subject_id BIGINT,
	teacher_details_id BIGINT,
	locked BOOLEAN DEFAULT FALSE,
	generated_by VARCHAR(10) DEFAULT 'AUTO',
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_slot UNIQUE (class_id, section_id, day_of_week, period_no)
);

-- Dated overlay for substitutions (actuals)
CREATE TABLE IF NOT EXISTS timetable_substitutions (
	id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	date DATE NOT NULL,
	class_id BIGINT NOT NULL,
	section_id BIGINT NOT NULL,
	period_no INT NOT NULL,
	original_teacher_details_id BIGINT,
	substitute_teacher_details_id BIGINT,
	reason VARCHAR(20), -- ABSENT|HOLIDAY|MANUAL
	approved_by VARCHAR(100),
	created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT uq_subst UNIQUE (date, class_id, section_id, period_no)
);

-- Seed minimal defaults for quick dev usage
INSERT INTO timetable_settings (working_days_mask, periods_per_day, period_duration_min, lunch_after_period, max_periods_per_teacher_per_day, start_time, end_time)
	SELECT 31, 8, 40, 4, 5, TIME '08:30:00', TIME '15:30:00'
	WHERE NOT EXISTS (SELECT 1 FROM timetable_settings);

-- Sample teacher-subject mappings (based on seeded subjects and teacher_details rows)
-- Map TeacherDetails#1 (Math) to MATH01
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT 1, s.id FROM subjects s WHERE s.code = 'MATH01'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_subject_map tsm WHERE tsm.teacher_details_id = 1 AND tsm.subject_id = s.id
	);
-- Map TeacherDetails#2 (Science) to PHY01 and CHEM01
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT 2, s.id FROM subjects s WHERE s.code = 'PHY01'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_subject_map tsm WHERE tsm.teacher_details_id = 2 AND tsm.subject_id = s.id
	);
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT 2, s.id FROM subjects s WHERE s.code = 'CHEM01'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_subject_map tsm WHERE tsm.teacher_details_id = 2 AND tsm.subject_id = s.id
	);

-- Also map English to Teacher 1 and General Science to Teacher 2 for richer generation
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT 1, s.id FROM subjects s WHERE s.code = 'ENG01'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_subject_map tsm WHERE tsm.teacher_details_id = 1 AND tsm.subject_id = s.id
	);
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT 2, s.id FROM subjects s WHERE s.code = 'SCI01'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_subject_map tsm WHERE tsm.teacher_details_id = 2 AND tsm.subject_id = s.id
	);

-- Sample teacher-class mappings
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 1, c.id, 'A', '2025-2026' FROM classes c WHERE c.name = 'Class 5'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_class_map tcm WHERE tcm.teacher_details_id = 1 AND tcm.class_id = c.id AND tcm.section = 'A'
	);
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 2, c.id, 'A', '2025-2026' FROM classes c WHERE c.name = 'Class 10'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_class_map tcm WHERE tcm.teacher_details_id = 2 AND tcm.class_id = c.id AND tcm.section = 'A'
	);

-- Additional mappings to support timetable generation demo
-- Teacher 1 (Math) also teaches Class 6-B and Class 7-A
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 1, c.id, 'B', '2025-2026' FROM classes c WHERE c.name = 'Class 6'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_class_map tcm WHERE tcm.teacher_details_id = 1 AND tcm.class_id = c.id AND tcm.section = 'B'
	);
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 1, c.id, 'A', '2025-2026' FROM classes c WHERE c.name = 'Class 7'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_class_map tcm WHERE tcm.teacher_details_id = 1 AND tcm.class_id = c.id AND tcm.section = 'A'
	);

-- Teacher 2 (Science) also teaches Class 9-A
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 2, c.id, 'A', '2025-2026' FROM classes c WHERE c.name = 'Class 9'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_class_map tcm WHERE tcm.teacher_details_id = 2 AND tcm.class_id = c.id AND tcm.section = 'A'
	);

-- Map Teacher 2 (Science) also to Class 5-A to fulfill Science requirements
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 2, c.id, 'A', '2025-2026' FROM classes c WHERE c.name = 'Class 5'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_class_map tcm WHERE tcm.teacher_details_id = 2 AND tcm.class_id = c.id AND tcm.section = 'A'
	);

-- Define minimal timetable requirements for generator to target (weekly periods per subject)
-- Class 5-A: Math 5 periods, Science 4 periods
INSERT INTO timetable_requirements (class_id, section_id, subject_id, weekly_periods)
SELECT c.id, s.id, subj.id, 5
FROM classes c
JOIN grade_levels gl ON gl.grade_number = 5
JOIN sections sec ON sec.section_name = 'A'
JOIN class_sections cs ON cs.grade_id = gl.id AND cs.section_id = sec.id
JOIN sections s ON s.id = cs.section_id
JOIN subjects subj ON subj.code = 'MATH01'
WHERE c.name = 'Class 5'
	AND NOT EXISTS (
		SELECT 1 FROM timetable_requirements tr WHERE tr.class_id = c.id AND tr.section_id = s.id AND tr.subject_id = subj.id
	);
INSERT INTO timetable_requirements (class_id, section_id, subject_id, weekly_periods)
SELECT c.id, s.id, subj.id, 4
FROM classes c
JOIN grade_levels gl ON gl.grade_number = 5
JOIN sections sec ON sec.section_name = 'A'
JOIN class_sections cs ON cs.grade_id = gl.id AND cs.section_id = sec.id
JOIN sections s ON s.id = cs.section_id
JOIN subjects subj ON subj.code = 'SCI01'
WHERE c.name = 'Class 5'
	AND NOT EXISTS (
		SELECT 1 FROM timetable_requirements tr WHERE tr.class_id = c.id AND tr.section_id = s.id AND tr.subject_id = subj.id
	);

-- Class 10-A: Physics 4, Chemistry 4
INSERT INTO timetable_requirements (class_id, section_id, subject_id, weekly_periods)
SELECT c.id, s.id, subj.id, 4
FROM classes c
JOIN grade_levels gl ON gl.grade_number = 10
JOIN sections sec ON sec.section_name = 'A'
JOIN class_sections cs ON cs.grade_id = gl.id AND cs.section_id = sec.id
JOIN sections s ON s.id = cs.section_id
JOIN subjects subj ON subj.code = 'PHY01'
WHERE c.name = 'Class 10'
	AND NOT EXISTS (
		SELECT 1 FROM timetable_requirements tr WHERE tr.class_id = c.id AND tr.section_id = s.id AND tr.subject_id = subj.id
	);

-- Add English as a lighter subject for Class 5-A to increase distribution
INSERT INTO timetable_requirements (class_id, section_id, subject_id, weekly_periods)
SELECT c.id, s.id, subj.id, 3
FROM classes c
JOIN grade_levels gl ON gl.grade_number = 5
JOIN sections sec ON sec.section_name = 'A'
JOIN class_sections cs ON cs.grade_id = gl.id AND cs.section_id = sec.id
JOIN sections s ON s.id = cs.section_id
JOIN subjects subj ON subj.code = 'ENG01'
WHERE c.name = 'Class 5'
	AND NOT EXISTS (
		SELECT 1 FROM timetable_requirements tr WHERE tr.class_id = c.id AND tr.section_id = s.id AND tr.subject_id = subj.id
	);
INSERT INTO timetable_requirements (class_id, section_id, subject_id, weekly_periods)
SELECT c.id, s.id, subj.id, 4
FROM classes c
JOIN grade_levels gl ON gl.grade_number = 10
JOIN sections sec ON sec.section_name = 'A'
JOIN class_sections cs ON cs.grade_id = gl.id AND cs.section_id = sec.id
JOIN sections s ON s.id = cs.section_id
JOIN subjects subj ON subj.code = 'CHEM01'
WHERE c.name = 'Class 10'
	AND NOT EXISTS (
		SELECT 1 FROM timetable_requirements tr WHERE tr.class_id = c.id AND tr.section_id = s.id AND tr.subject_id = subj.id
	);

-- ============================================================================
-- DEV RESET + CLEAN TEACHER DATASET FOR TIMETABLE (Focus: Class 5 - Section A)
-- This block resets mappings and requirements for Class 5-A and seeds a complete
-- 35-period/week timetable with a curated set of subjects and teachers.
-- Safe to re-run on H2 dev; only affects Class 5-A.
-- ============================================================================

-- Resolve ids
-- class_id for 'Class 5'
CREATE TABLE IF NOT EXISTS _tmp_ids (k VARCHAR(50) PRIMARY KEY, v BIGINT);
MERGE INTO _tmp_ids (k, v)
KEY(k)
VALUES ('class5', (SELECT id FROM classes WHERE name='Class 5'));
MERGE INTO _tmp_ids (k, v)
KEY(k)
VALUES ('secA', (SELECT id FROM sections WHERE section_name='A'));

-- Clean existing 5-A data
DELETE FROM timetable_slots WHERE class_id = (SELECT v FROM _tmp_ids WHERE k='class5') AND section_id = (SELECT v FROM _tmp_ids WHERE k='secA');
DELETE FROM timetable_requirements WHERE class_id = (SELECT v FROM _tmp_ids WHERE k='class5') AND section_id = (SELECT v FROM _tmp_ids WHERE k='secA');
DELETE FROM teacher_class_map WHERE class_id = (SELECT v FROM _tmp_ids WHERE k='class5') AND section = 'A';

-- Ensure extra teacher roles exist (idempotent)
INSERT INTO staff_roles (name, description, is_active)
SELECT 'English Teacher', 'Teaches English', true
WHERE NOT EXISTS (SELECT 1 FROM staff_roles WHERE name='English Teacher');
INSERT INTO staff_roles (name, description, is_active)
SELECT 'Social Studies Teacher', 'Teaches Social Studies', true
WHERE NOT EXISTS (SELECT 1 FROM staff_roles WHERE name='Social Studies Teacher');
INSERT INTO staff_roles (name, description, is_active)
SELECT 'Physical Education Teacher', 'Teaches Physical Education', true
WHERE NOT EXISTS (SELECT 1 FROM staff_roles WHERE name='Physical Education Teacher');
INSERT INTO staff_roles (name, description, is_active)
SELECT 'Computer Science Teacher', 'Teaches Computer Science', true
WHERE NOT EXISTS (SELECT 1 FROM staff_roles WHERE name='Computer Science Teacher');
INSERT INTO staff_roles (name, description, is_active)
SELECT 'Art Teacher', 'Teaches Fine Arts', true
WHERE NOT EXISTS (SELECT 1 FROM staff_roles WHERE name='Art Teacher');
INSERT INTO staff_roles (name, description, is_active)
SELECT 'Music Teacher', 'Teaches Music', true
WHERE NOT EXISTS (SELECT 1 FROM staff_roles WHERE name='Music Teacher');

-- Add additional teacher_details (ids auto)
INSERT INTO teacher_details (created_at, updated_at, qualification, specialization, subjects_taught, years_of_experience, department, educational_background, certifications, professional_development)
SELECT CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'M.A English', 'English Pedagogy', 'English', 7, 'Languages', 'B.A English, M.A English', 'Teaching License', 'ELT Workshop'
WHERE NOT EXISTS (SELECT 1 FROM teacher_details WHERE specialization='English Pedagogy');
INSERT INTO teacher_details (created_at, updated_at, qualification, specialization, subjects_taught, years_of_experience, department, educational_background, certifications, professional_development)
SELECT CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'M.A History', 'Social Studies', 'Social Studies', 6, 'Humanities', 'B.A History, M.A History', 'Teaching License', 'SS Symposium'
WHERE NOT EXISTS (SELECT 1 FROM teacher_details WHERE specialization='Social Studies');
INSERT INTO teacher_details (created_at, updated_at, qualification, specialization, subjects_taught, years_of_experience, department, educational_background, certifications, professional_development)
SELECT CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'B.PEd', 'Physical Education', 'Physical Education', 5, 'Sports', 'B.PEd', 'Coaching Cert', 'PE Summit'
WHERE NOT EXISTS (SELECT 1 FROM teacher_details WHERE specialization='Physical Education');
INSERT INTO teacher_details (created_at, updated_at, qualification, specialization, subjects_taught, years_of_experience, department, educational_background, certifications, professional_development)
SELECT CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'B.Tech CS', 'Computer Science', 'Computer Science', 4, 'Computer', 'B.Tech CS', 'CS Teaching Cert', 'Code Camp'
WHERE NOT EXISTS (SELECT 1 FROM teacher_details WHERE specialization='Computer Science');
INSERT INTO teacher_details (created_at, updated_at, qualification, specialization, subjects_taught, years_of_experience, department, educational_background, certifications, professional_development)
SELECT CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'M.F.A', 'Fine Arts', 'Art', 8, 'Arts', 'BFA, MFA', 'Art Cert', 'Art Educators Conf'
WHERE NOT EXISTS (SELECT 1 FROM teacher_details WHERE specialization='Fine Arts');
INSERT INTO teacher_details (created_at, updated_at, qualification, specialization, subjects_taught, years_of_experience, department, educational_background, certifications, professional_development)
SELECT CURRENT_TIMESTAMP, CURRENT_TIMESTAMP, 'M.Mus', 'Music', 'Music', 9, 'Music', 'B.Mus, M.Mus', 'Music Cert', 'Music Ed Forum'
WHERE NOT EXISTS (SELECT 1 FROM teacher_details WHERE specialization='Music');

-- Create School Staff rows for the newly added teachers (idempotent)
INSERT INTO school_staff (staff_id, first_name, last_name, email, phone_number, date_of_birth, gender, address, join_date, is_active, active, role, department, designation, emergency_contact, blood_group, qualifications, employment_status, basic_salary, hra, da, user_id, role_id, teacher_details_id)
SELECT 'TCH006', 'Anita', 'Sharma', 'anita.sharma@schoolms.com', '+1-555-0601', '1989-02-14', 'FEMALE', '12 Teacher Lane, Springfield, IL', CURRENT_DATE, true, true, 'English Teacher', 'Languages', 'English Teacher', '+1-555-0602', 'A+', 'M.A English, Teaching License', 'ACTIVE', 52000.00, 10400.00, 5200.00, NULL, (SELECT id FROM staff_roles WHERE name='English Teacher'), td.id
FROM teacher_details td
WHERE td.specialization='English Pedagogy'
	AND NOT EXISTS (SELECT 1 FROM school_staff ss WHERE ss.teacher_details_id = td.id);

INSERT INTO school_staff (staff_id, first_name, last_name, email, phone_number, date_of_birth, gender, address, join_date, is_active, active, role, department, designation, emergency_contact, blood_group, qualifications, employment_status, basic_salary, hra, da, user_id, role_id, teacher_details_id)
SELECT 'TCH007', 'Raj', 'Verma', 'raj.verma@schoolms.com', '+1-555-0701', '1987-05-10', 'MALE', '34 Educators Ave, Springfield, IL', CURRENT_DATE, true, true, 'Social Studies Teacher', 'Humanities', 'Social Studies Teacher', '+1-555-0702', 'B+', 'M.A History, Teaching License', 'ACTIVE', 51000.00, 10200.00, 5100.00, NULL, (SELECT id FROM staff_roles WHERE name='Social Studies Teacher'), td.id
FROM teacher_details td
WHERE td.specialization='Social Studies'
	AND NOT EXISTS (SELECT 1 FROM school_staff ss WHERE ss.teacher_details_id = td.id);

INSERT INTO school_staff (staff_id, first_name, last_name, email, phone_number, date_of_birth, gender, address, join_date, is_active, active, role, department, designation, emergency_contact, blood_group, qualifications, employment_status, basic_salary, hra, da, user_id, role_id, teacher_details_id)
SELECT 'TCH008', 'Prakash', 'Singh', 'prakash.singh@schoolms.com', '+1-555-0801', '1991-09-01', 'MALE', '56 Sports Way, Springfield, IL', CURRENT_DATE, true, true, 'Physical Education Teacher', 'Sports', 'PE Teacher', '+1-555-0802', 'O+', 'B.PEd, Coaching Cert', 'ACTIVE', 48000.00, 9600.00, 4800.00, NULL, (SELECT id FROM staff_roles WHERE name='Physical Education Teacher'), td.id
FROM teacher_details td
WHERE td.specialization='Physical Education'
	AND NOT EXISTS (SELECT 1 FROM school_staff ss WHERE ss.teacher_details_id = td.id);

INSERT INTO school_staff (staff_id, first_name, last_name, email, phone_number, date_of_birth, gender, address, join_date, is_active, active, role, department, designation, emergency_contact, blood_group, qualifications, employment_status, basic_salary, hra, da, user_id, role_id, teacher_details_id)
SELECT 'TCH009', 'Neha', 'Gupta', 'neha.gupta@schoolms.com', '+1-555-0901', '1992-12-20', 'FEMALE', '78 Code Blvd, Springfield, IL', CURRENT_DATE, true, true, 'Computer Science Teacher', 'Computer', 'CS Teacher', '+1-555-0902', 'AB+', 'B.Tech CS, CS Teaching Cert', 'ACTIVE', 50000.00, 10000.00, 5000.00, NULL, (SELECT id FROM staff_roles WHERE name='Computer Science Teacher'), td.id
FROM teacher_details td
WHERE td.specialization='Computer Science'
	AND NOT EXISTS (SELECT 1 FROM school_staff ss WHERE ss.teacher_details_id = td.id);

INSERT INTO school_staff (staff_id, first_name, last_name, email, phone_number, date_of_birth, gender, address, join_date, is_active, active, role, department, designation, emergency_contact, blood_group, qualifications, employment_status, basic_salary, hra, da, user_id, role_id, teacher_details_id)
SELECT 'TCH010', 'Arun', 'Mehta', 'arun.mehta@schoolms.com', '+1-555-1001', '1984-07-18', 'MALE', '90 Art St, Springfield, IL', CURRENT_DATE, true, true, 'Art Teacher', 'Arts', 'Art Teacher', '+1-555-1002', 'A-', 'BFA, MFA, Art Cert', 'ACTIVE', 47000.00, 9400.00, 4700.00, NULL, (SELECT id FROM staff_roles WHERE name='Art Teacher'), td.id
FROM teacher_details td
WHERE td.specialization='Fine Arts'
	AND NOT EXISTS (SELECT 1 FROM school_staff ss WHERE ss.teacher_details_id = td.id);

INSERT INTO school_staff (staff_id, first_name, last_name, email, phone_number, date_of_birth, gender, address, join_date, is_active, active, role, department, designation, emergency_contact, blood_group, qualifications, employment_status, basic_salary, hra, da, user_id, role_id, teacher_details_id)
SELECT 'TCH011', 'Ritu', 'Kohli', 'ritu.kohli@schoolms.com', '+1-555-1101', '1986-11-05', 'FEMALE', '23 Melody Rd, Springfield, IL', CURRENT_DATE, true, true, 'Music Teacher', 'Music', 'Music Teacher', '+1-555-1102', 'B-', 'B.Mus, M.Mus, Music Cert', 'ACTIVE', 48000.00, 9600.00, 4800.00, NULL, (SELECT id FROM staff_roles WHERE name='Music Teacher'), td.id
FROM teacher_details td
WHERE td.specialization='Music'
	AND NOT EXISTS (SELECT 1 FROM school_staff ss WHERE ss.teacher_details_id = td.id);

-- Map subject expertise: reuse #1 Math+Eng, #2 Science; assign others via lookup
-- Math (MATH01) already mapped to teacher_details 1; English (ENG01) to 1; Science (SCI01) to 2.
-- Social Studies -> new SS specialist
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT td.id, s.id
FROM teacher_details td, subjects s
WHERE td.specialization='Social Studies' AND s.code='SS01'
	AND NOT EXISTS (SELECT 1 FROM teacher_subject_map t WHERE t.teacher_details_id=td.id AND t.subject_id=s.id);
-- Hindi -> map to English teacher or create dedicated? Map to English teacher for demo unless exists Hindi specialist
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT (SELECT id FROM teacher_details WHERE specialization='English Pedagogy'), s.id
FROM subjects s
WHERE s.code='HIN01'
	AND NOT EXISTS (
		SELECT 1 FROM teacher_subject_map t WHERE t.teacher_details_id=(SELECT id FROM teacher_details WHERE specialization='English Pedagogy') AND t.subject_id=s.id
	);
-- Computer Science -> CS specialist
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT td.id, s.id
FROM teacher_details td, subjects s
WHERE td.specialization='Computer Science' AND s.code='CS01'
	AND NOT EXISTS (SELECT 1 FROM teacher_subject_map t WHERE t.teacher_details_id=td.id AND t.subject_id=s.id);
-- PE -> PE specialist
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT td.id, s.id
FROM teacher_details td, subjects s
WHERE td.specialization='Physical Education' AND s.code='PE01'
	AND NOT EXISTS (SELECT 1 FROM teacher_subject_map t WHERE t.teacher_details_id=td.id AND t.subject_id=s.id);
-- Art -> Fine Arts specialist
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT td.id, s.id
FROM teacher_details td, subjects s
WHERE td.specialization='Fine Arts' AND s.code='ART01'
	AND NOT EXISTS (SELECT 1 FROM teacher_subject_map t WHERE t.teacher_details_id=td.id AND t.subject_id=s.id);
-- Music -> Music specialist
INSERT INTO teacher_subject_map (teacher_details_id, subject_id)
SELECT td.id, s.id
FROM teacher_details td, subjects s
WHERE td.specialization='Music' AND s.code='MUS01'
	AND NOT EXISTS (SELECT 1 FROM teacher_subject_map t WHERE t.teacher_details_id=td.id AND t.subject_id=s.id);

-- Assign all these teachers to Class 5 - Section 'A'
-- Reuse existing: td.id=1 (Math/Eng), td.id=2 (Science)
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 1, (SELECT v FROM _tmp_ids WHERE k='class5'), 'A', '2025-2026'
WHERE NOT EXISTS (
		SELECT 1 FROM teacher_class_map WHERE teacher_details_id=1 AND class_id=(SELECT v FROM _tmp_ids WHERE k='class5') AND section='A'
);
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT 2, (SELECT v FROM _tmp_ids WHERE k='class5'), 'A', '2025-2026'
WHERE NOT EXISTS (
		SELECT 1 FROM teacher_class_map WHERE teacher_details_id=2 AND class_id=(SELECT v FROM _tmp_ids WHERE k='class5') AND section='A'
);
-- For each specialization added above
INSERT INTO teacher_class_map (teacher_details_id, class_id, section, academic_year)
SELECT td.id, (SELECT v FROM _tmp_ids WHERE k='class5'), 'A', '2025-2026'
FROM teacher_details td
WHERE td.specialization IN ('English Pedagogy','Social Studies','Physical Education','Computer Science','Fine Arts','Music')
	AND NOT EXISTS (
		SELECT 1 FROM teacher_class_map tcm WHERE tcm.teacher_details_id=td.id AND tcm.class_id=(SELECT v FROM _tmp_ids WHERE k='class5') AND tcm.section='A'
	);

-- Comprehensive weekly requirements: 35 teachable periods/week (8/day, lunch after 4th -> 5 lunches)
-- Mon..Fri = 5 days x 7 effective periods/day = 35
INSERT INTO timetable_requirements (class_id, section_id, subject_id, weekly_periods)
SELECT (SELECT v FROM _tmp_ids WHERE k='class5'), (SELECT v FROM _tmp_ids WHERE k='secA'), subj.id, req.weekly
FROM (
		SELECT 'MATH01' code, 6 weekly UNION ALL
		SELECT 'ENG01', 6 UNION ALL
		SELECT 'SCI01', 5 UNION ALL
		SELECT 'SS01', 4 UNION ALL
		SELECT 'HIN01', 5 UNION ALL
		SELECT 'CS01', 2 UNION ALL
		SELECT 'PE01', 2 UNION ALL
		SELECT 'ART01', 2 UNION ALL
		SELECT 'MUS01', 3
) req
JOIN subjects subj ON subj.code = req.code;

-- Cleanup temp ids table
DROP TABLE IF EXISTS _tmp_ids;

